(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[332],{2022:(e,t,n)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(5714)}])},5714:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>ti});var r=n(4848),s=n(6540),o=n(4922),i=function(e){return e.SCYTHE="scythe",e.SWORD="sword",e.SABRES="sabres",e.SABRES2="sabres2",e.STAFF="staff",e}({});let a={sword:{normal:29,range:5.5,maxHitsPerSwing:1},scythe:{normal:17,range:4.4,maxHitsPerSwing:1},sabres:{normal:13,range:4,maxHitsPerSwing:2},sabres2:{normal:11,range:4,maxHitsPerSwing:2},staff:{normal:15,range:4,maxHitsPerSwing:1}},l={scythe:{q:{key:"q",cooldown:.7,currentCooldown:0,icon:"/Eidolon/icons/q1.svg",maxCooldown:1,name:"Scythe Q",isUnlocked:!0},e:{key:"e",cooldown:.7,currentCooldown:0,icon:"/Eidolon/icons/e1.svg",maxCooldown:.7,name:"Scythe E",isUnlocked:!0},r:{key:"r",cooldown:1.8,currentCooldown:0,icon:"/Eidolon/icons/r1.svg",maxCooldown:1.8,name:"Boneclaw",isUnlocked:!1},passive:{key:"1",cooldown:.775,currentCooldown:0,icon:"/Eidolon/icons/p1.svg",maxCooldown:0,name:"Reanimate",isUnlocked:!1}},sword:{q:{key:"q",cooldown:1,currentCooldown:0,icon:"/Eidolon/icons/q2.svg",maxCooldown:1.08,name:"Sword Q",isUnlocked:!0},e:{key:"e",cooldown:3.25,currentCooldown:0,icon:"/Eidolon/icons/e2.svg",maxCooldown:4,name:"Sword E",isUnlocked:!0},r:{key:"r",cooldown:1.5,currentCooldown:0,icon:"/Eidolon/icons/r2.svg",maxCooldown:1.75,name:"Oathstrike",isUnlocked:!1},passive:{key:"1",cooldown:0,currentCooldown:0,icon:"/Eidolon/icons/p2.svg",maxCooldown:0,name:"Crusader Aura",isUnlocked:!1}},sabres:{q:{key:"q",cooldown:.6,currentCooldown:0,icon:"/Eidolon/icons/q3.svg",maxCooldown:.9,name:"Sabres Q",isUnlocked:!0},e:{key:"e",cooldown:.5,currentCooldown:0,icon:"/Eidolon/icons/e3.svg",maxCooldown:1,name:"Sabres E",isUnlocked:!0},r:{key:"r",cooldown:10,currentCooldown:0,icon:"/Eidolon/icons/r3.svg",maxCooldown:5,name:"Blizzard",isUnlocked:!1},passive:{key:"1",cooldown:0,currentCooldown:0,icon:"/Eidolon/icons/p3.svg",maxCooldown:0,name:"Firebeam",isUnlocked:!1}},sabres2:{q:{key:"q",cooldown:.7,currentCooldown:0,icon:"/Eidolon/icons/q4.svg",maxCooldown:1.5,name:"Sabres2 Q",isUnlocked:!0},e:{key:"e",cooldown:1.5,currentCooldown:0,icon:"/Eidolon/icons/e4.svg",maxCooldown:6,name:"Firebeam",isUnlocked:!0},r:{key:"r",cooldown:15,currentCooldown:0,icon:"/Eidolon/icons/r4.svg",maxCooldown:15,name:"Blizzard",isUnlocked:!1},passive:{key:"1",cooldown:.5,currentCooldown:0,icon:"/Eidolon/icons/p1.svg",maxCooldown:0,name:"Reanimate",isUnlocked:!1}},staff:{q:{key:"q",cooldown:.8,currentCooldown:0,icon:"/Eidolon/icons/q4.svg",maxCooldown:1,name:"Staff Q",isUnlocked:!0},e:{key:"e",cooldown:2,currentCooldown:0,icon:"/Eidolon/icons/e4.svg",maxCooldown:0,name:"Firebeam",isUnlocked:!0},r:{key:"r",cooldown:15,currentCooldown:0,icon:"/Eidolon/icons/r4.svg",maxCooldown:15,name:"Blizzard",isUnlocked:!1},passive:{key:"1",cooldown:.5,currentCooldown:0,icon:"/Eidolon/icons/p1.svg",maxCooldown:0,name:"Reanimate",isUnlocked:!1}}},c=(e,t,n)=>{let r=l[e][t];return"sword"===e&&"q"===t&&n.sword.passive.isUnlocked?.675:r.cooldown},u={scythe:{q:{title:"Reap",description:"A swift scythe attack in an arc - Cooldown: 0.75 seconds - Range: 4.2 feet",cost:"Cooldown: 0.75 seconds",range:"Range: 4.2 feet",damage:"Damage: 17"},e:{title:"Chaos Bolt",description:"Consumes 1 Orb Charge to fire a long range bolt to a single enemy.",cost:"Consumes 1 Orb Charge",range:"Range: 80 feet",damage:"Damage: 53"},r:{title:"Bone Claw",description:"Summon skeletal lazer claws - Cooldown: 1.8 seconds - Range: 4.0-8.0 feet",cost:"Cooldown: 2.5 seconds",range:"Range: 8.0 feet",damage:"Damage: 67"},passive:{title:"Reanimate",description:"Consumes 1 Orb Charge to heal for 10 health."}},sword:{q:{title:"Slash",description:"A powerful sword strike in an arc - Cooldown: 1.1 seconds - Range: 6.5 feet",cost:"1.1",range:"6.5",damage:"29"},e:{title:"Smite",description:"A devastating holy strike - Cooldown: 3.0 seconds - Range: 6.5 feet",cost:"30",range:"4.0",damage:"35"},r:{title:"Oathstrike",description:"Consumes 4 Orb Charges to heal while  damaging enemies in an arc.",cost:"50",range:"7.0",damage:"65"},passive:{title:"Crusader Aura",description:"Increases attack speed by 35% and gives attacks a 20% chance to heal."}},sabres:{q:{title:"Double Slash",description:"Quick dual-wielding attack",cost:"12",range:"3.8",damage:"13"},e:{title:"Ether Bow Shot",description:"Damage scales with charge time: 1.75 secondsRange: 80+ feet",cost:"Consumes 1 Orb Charge",range:"Range: 80 feet",damage:"Damage: 53"},r:{title:"Blizzard",description:"Unleash a devastating ice storm to nearby enemies for 6 seconds - 10 second cooldown",cost:"60",range:"12.0",damage:"85"},passive:{title:"Frost Lance",description:"Consumes 1 Orb Charge to fire a beam of ice that piereces through all enemies in a line. 4 foot minimum range."}},sabres2:{q:{title:"Test",description:"Test ability"},e:{title:"Test",description:"Test ability"},r:{title:"Test",description:"Test ability"},passive:{title:"Test",description:"Test ability"}},staff:{q:{title:"Test",description:"Test ability"},e:{title:"Test",description:"Test ability"},r:{title:"Test",description:"Test ability"},passive:{title:"Test",description:"Test ability"}}},h=["#E7CAD0","#F0D5DB","#F5E0E5","#FAE8EC","#FFF0F3"],d=["#FFAFC5","#FFB6C1","#FFC0CB","#FFD1DC","#FFE4E1"],m=()=>{let e=[];for(let t=0;t<58;t++){let t=Math.random()*Math.PI*2,n=46+10*Math.random(),r=Math.cos(t)*n,s=Math.sin(t)*n,i=.6+.8*Math.random();e.push({position:new o.Pq0(r,0,s),scale:i})}return e},p=()=>[{position:new o.Pq0(-15,0,-5),scale:1.3,trunkColor:new o.Q1f(h[1]),leafColor:new o.Q1f(d[1])},{position:new o.Pq0(-25,0,-10.5),scale:.75,trunkColor:new o.Q1f(h[1]),leafColor:new o.Q1f(d[1])},{position:new o.Pq0(-12,0,-8),scale:1.25,trunkColor:new o.Q1f(h[1]),leafColor:new o.Q1f(d[1])},{position:new o.Pq0(-12,0,-13.5),scale:.8,trunkColor:new o.Q1f(h[1]),leafColor:new o.Q1f(d[1])},{position:new o.Pq0(30,0,5),scale:1.3,trunkColor:new o.Q1f(h[1]),leafColor:new o.Q1f(d[1])},{position:new o.Pq0(16,0,-10),scale:.75,trunkColor:new o.Q1f(h[1]),leafColor:new o.Q1f(d[1])},{position:new o.Pq0(12,0,8),scale:1.25,trunkColor:new o.Q1f(h[1]),leafColor:new o.Q1f(d[1])},{position:new o.Pq0(-11,0,5),scale:1.3,trunkColor:new o.Q1f(h[1]),leafColor:new o.Q1f(d[1])},{position:new o.Pq0(-12,0,-28.5),scale:.75,trunkColor:new o.Q1f(h[1]),leafColor:new o.Q1f(d[1])},{position:new o.Pq0(12,0,-8),scale:1.25,trunkColor:new o.Q1f(h[1]),leafColor:new o.Q1f(d[1])},{position:new o.Pq0(-12,0,23.5),scale:.8,trunkColor:new o.Q1f(h[1]),leafColor:new o.Q1f(d[1])},{position:new o.Pq0(18,0,-8),scale:1.1,trunkColor:new o.Q1f(h[2]),leafColor:new o.Q1f(d[2])},{position:new o.Pq0(17.5,0,-10),scale:.9,trunkColor:new o.Q1f(h[2]),leafColor:new o.Q1f(d[2])},{position:new o.Pq0(15,0,-11.5),scale:1.1,trunkColor:new o.Q1f(h[2]),leafColor:new o.Q1f(d[2])},{position:new o.Pq0(16.5,0,-6.5),scale:.75,trunkColor:new o.Q1f(h[2]),leafColor:new o.Q1f(d[2])},{position:new o.Pq0(-20,0,-20),scale:1.2,trunkColor:new o.Q1f(h[0]),leafColor:new o.Q1f(d[0])},{position:new o.Pq0(-10,0,-22),scale:.9,trunkColor:new o.Q1f(h[1]),leafColor:new o.Q1f(d[1])},{position:new o.Pq0(0,0,-23),scale:.95,trunkColor:new o.Q1f(h[2]),leafColor:new o.Q1f(d[2])},{position:new o.Pq0(10,0,-22),scale:1.4,trunkColor:new o.Q1f(h[0]),leafColor:new o.Q1f(d[0])},{position:new o.Pq0(20,0,-20),scale:.95,trunkColor:new o.Q1f(h[1]),leafColor:new o.Q1f(d[1])},{position:new o.Pq0(-12,0,12),scale:.8,trunkColor:new o.Q1f(h[2]),leafColor:new o.Q1f(d[2])},{position:new o.Pq0(12,0,12),scale:.8,trunkColor:new o.Q1f(h[0]),leafColor:new o.Q1f(d[0])},{position:new o.Pq0(-5,0,-15),scale:.85,trunkColor:new o.Q1f(h[1]),leafColor:new o.Q1f(d[1])},{position:new o.Pq0(5,0,-18),scale:.85,trunkColor:new o.Q1f(h[2]),leafColor:new o.Q1f(d[2])}],f=()=>{let e=[];for(let t=0;t<70;t++){let t=Math.random()*Math.PI*2,n=45*Math.random(),r=n*Math.cos(t),s=n*Math.sin(t),i=.45+.2*Math.random();e.push({position:new o.Pq0(r,0,s),scale:i})}return e},x=()=>{let e=Math.random()*Math.PI*2,t=37*Math.random(),n=Math.cos(e)*t,r=Math.sin(e)*t;return new o.Pq0(n,0,r)},g=()=>{let e=[];for(let t=0;t<35;t++){let t=Math.random()*Math.PI*2,n=44*Math.random(),r=Math.cos(t)*n,s=Math.sin(t)*n,i=.6+.4*Math.random();e.push({position:new o.Pq0(r,0,s),scale:i})}return e};var j=n(8875),y=n(2805),v=n(7980);function M(e){let{color:t="#FFCAE5",roughness:n=.5,metalness:i=.1}=e,a=(0,s.useRef)(null),l=(0,s.useRef)(null),c=(0,s.useRef)(new o.BKk({uniforms:{time:{value:0},scale:{value:20},elevation:{value:.3},groundScale:{value:0},patchScale:{value:.1},baseColor:{value:new o.Q1f(t)},roughnessValue:{value:n},metalnessValue:{value:i}},vertexShader:"\n      varying vec2 vUv;\n      varying vec3 vNormal;\n      \n      void main() {\n        vUv = uv;\n        vNormal = normal;\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n      }\n    ",fragmentShader:"\n      uniform float time;\n      uniform float scale;\n      uniform float elevation;\n      uniform float groundScale;\n      uniform float patchScale;\n      \n      varying vec2 vUv;\n      varying vec3 vNormal;\n      \n      // Simplex noise function\n      vec3 mod289(vec3 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }\n      vec2 mod289(vec2 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }\n      vec3 permute(vec3 x) { return mod289(((x*34.0)+1.0)*x); }\n      \n      float snoise(vec2 v) {\n        const vec4 C = vec4(0.211324865405187,\n                           0.366025403784439,\n                          -0.577350269189626,\n                           0.024390243902439);\n        vec2 i  = floor(v + dot(v, C.yy) );\n        vec2 x0 = v -   i + dot(i, C.xx);\n        vec2 i1;\n        i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\n        vec4 x12 = x0.xyxy + C.xxzz;\n        x12.xy -= i1;\n        i = mod289(i);\n        vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))\n                         + i.x + vec3(0.0, i1.x, 1.0 ));\n        vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);\n        m = m*m ;\n        m = m*m ;\n        vec3 x = 2.0 * fract(p * C.www) - 1.0;\n        vec3 h = abs(x) - 0.5;\n        vec3 ox = floor(x + 0.5);\n        vec3 a0 = x - ox;\n        m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );\n        vec3 g;\n        g.x  = a0.x  * x0.x  + h.x  * x0.y;\n        g.yz = a0.yz * x12.xz + h.yz * x12.yw;\n        return 130.0 * dot(m, g);\n      }\n      \n      void main() {\n        // Create brown patches\n        vec2 patchUv = vUv * patchScale;\n        float patchPattern = snoise(patchUv + time * 0.01);\n        float patchPattern2 = snoise(patchUv * 1.5 + time * 0.015); // Second noise for third color\n        \n        // Base colors\n        vec3 grassColor = vec3(0.2, 0.35, 0.15);     // Dark green base\n        vec3 brownColor = vec3(0.45, 0.32, 0.22);     // Brighter earth brown\n        vec3 lightBrownColor = vec3(0.55, 0.42, 0.30); // Light brown\n        \n        // Mix colors based on noise patterns\n        vec3 baseGroundColor = mix(grassColor, brownColor, patchPattern * 0.7);\n        baseGroundColor = mix(baseGroundColor, lightBrownColor, patchPattern2 * 0.5);\n        \n        // Add noise detail\n        vec2 uv = vUv * scale;\n        float n = snoise(uv) * 0.5;\n        n += snoise(uv * 2.0) * 0.25;\n        \n        // Apply detail to final color\n        vec3 finalColor = mix(baseGroundColor, baseGroundColor * 1.2, n * 0.3);\n        \n        gl_FragColor = vec4(finalColor, 1.0);\n      }\n    ",side:o.$EB})).current;return(0,s.useEffect)(()=>{if(!l.current){let e=new o.ypk;for(let t=0;t<8;t++){let n=t/8*Math.PI*2,r=50*Math.cos(n),s=50*Math.sin(n);0===t?e.moveTo(r,s):e.lineTo(r,s)}e.closePath(),l.current=e}},[]),(0,v.F)(e=>{let{clock:t}=e;c.uniforms&&(c.uniforms.time.value=t.getElapsedTime())}),(0,r.jsx)("group",{children:(0,r.jsxs)("mesh",{ref:a,rotation:[-Math.PI/2,0,0],receiveShadow:!0,children:[l.current&&(0,r.jsx)("shapeGeometry",{args:[l.current]}),(0,r.jsx)("primitive",{object:c,attach:"material"})]})})}let P=e=>{let{position:t,scale:n=1,isInteractive:o=!1,health:i=100}=e,a=(0,s.useRef)(null);return((0,s.useEffect)(()=>{if(o&&i<=0&&a.current){var e;null===(e=a.current.parent)||void 0===e||e.remove(a.current)}},[i,o]),o&&i<=0)?null:(0,r.jsxs)("group",{name:"mountain",position:t,scale:n,children:[(0,r.jsxs)("mesh",{ref:a,castShadow:!0,receiveShadow:!0,children:[(0,r.jsx)("coneGeometry",{args:[23,35,6]}),(0,r.jsx)("meshStandardMaterial",{color:"#2a2a2a",metalness:.1,roughness:.9,emissive:"#222222"})]}),(0,r.jsxs)("mesh",{position:[-4,-5,-2],rotation:[0,.5,.1],castShadow:!0,children:[(0,r.jsx)("coneGeometry",{args:[24,28,5]}),(0,r.jsx)("meshStandardMaterial",{color:"#252525",metalness:.1,roughness:.9})]}),(0,r.jsxs)("mesh",{position:[0,14,0],castShadow:!0,children:[(0,r.jsx)("coneGeometry",{args:[5,8,6]}),(0,r.jsx)("meshStandardMaterial",{color:"#ffffff",metalness:.1,roughness:.6})]})]})},w=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1,n=new o.Q1f(e);return n.r=o.cj9.clamp(n.r+(Math.random()-.5)*t,0,1),n.g=o.cj9.clamp(n.g+(Math.random()-.5)*t,0,1),n.b=o.cj9.clamp(n.b+(Math.random()-.5)*t,0,1),n},S=s.memo(e=>{let{position:t=new o.Pq0(0,2,-5),scale:n=.8,trunkColor:i,leafColor:a}=e,l=(0,s.useMemo)(()=>w(i),[i]),c=(0,s.useMemo)(()=>w(a),[a]),u=.25*n,h=4.2*n,d=1.5*n,m=2*n;return(0,r.jsx)("group",{name:"tree",position:t,scale:n,children:(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[u,1.2*u,h,8]}),(0,r.jsx)("meshStandardMaterial",{color:l,roughness:.8,metalness:.1}),(0,r.jsxs)("mesh",{position:[0,.6*h,0],name:"tree-top",children:[(0,r.jsx)("coneGeometry",{args:[d,m,8]}),(0,r.jsx)("meshStandardMaterial",{color:c,roughness:.4,metalness:.1,emissive:c,emissiveIntensity:.4})]}),(0,r.jsxs)("mesh",{position:[0,.8*h,0],name:"tree-top-2",children:[(0,r.jsx)("coneGeometry",{args:[.7*d,.7*m,8]}),(0,r.jsx)("meshStandardMaterial",{color:c.clone().multiplyScalar(1.1),roughness:.4,metalness:.1,emissive:c,emissiveIntensity:.3})]}),(0,r.jsxs)("mesh",{position:[0,h,0],name:"tree-top-3",children:[(0,r.jsx)("coneGeometry",{args:[.4*d,.4*m,8]}),(0,r.jsx)("meshStandardMaterial",{color:c.clone().multiplyScalar(1.2),roughness:.4,metalness:.1,emissive:c,emissiveIntensity:.2})]})]})})}),I=e=>{let{position:t,scale:n}=e,i=(0,s.useRef)(null),a=(0,s.useMemo)(()=>new o.Q1f("#A8DBFF"),[]),l=(0,s.useMemo)(()=>new o.Q1f("#9b4f96"),[]);return(0,v.F)(e=>{i.current&&(i.current.position.y=t.y+.05*Math.sin(e.clock.getElapsedTime()))}),(0,r.jsxs)("group",{position:t,scale:n,children:[(0,r.jsxs)("mesh",{ref:i,children:[(0,r.jsx)("cylinderGeometry",{args:[.1,.12,.8,16]}),(0,r.jsx)("meshStandardMaterial",{color:a.clone().multiplyScalar(.9),roughness:.4,metalness:.1,emissive:a,emissiveIntensity:.2})]}),(0,r.jsxs)("mesh",{position:[0,.4,0],children:[(0,r.jsx)("sphereGeometry",{args:[.32,32,32,0,2*Math.PI,0,Math.PI/2]}),(0,r.jsx)("meshStandardMaterial",{color:a,roughness:.4,metalness:.1,emissive:a,emissiveIntensity:.35})]}),[...Array(6)].map((e,t)=>(0,r.jsxs)("mesh",{position:[.15*Math.sin(t*Math.PI/3),.3,.15*Math.cos(t*Math.PI/3)],rotation:[Math.PI/2,0,0],children:[(0,r.jsx)("circleGeometry",{args:[.04,16]}),(0,r.jsx)("meshStandardMaterial",{color:l,emissive:l,emissiveIntensity:.2})]},t))]})},C=e=>{let{color:t,size:n,meshRef:i,opacity:a=1}=e,l=(0,s.useRef)(null),c=(0,s.useRef)(new Float32Array(90)),u=(0,s.useRef)(new Float32Array(30)),h=(0,s.useRef)(new Float32Array(30)),d=(0,s.useRef)(!1);return(0,s.useEffect)(()=>{if(i.current&&!d.current){let{x:e,y:t,z:n}=i.current.position;for(let r=0;r<30;r++)c.current[3*r]=e,c.current[3*r+1]=t,c.current[3*r+2]=n,u.current[r]=0,h.current[r]=0;d.current=!0}},[i]),(0,v.F)(()=>{var e;if(!(null===(e=l.current)||void 0===e?void 0:e.parent)||!i.current||!d.current)return;let{x:t,y:r,z:s}=i.current.position;for(let e=29;e>0;e--)c.current[3*e]=c.current[(e-1)*3],c.current[3*e+1]=c.current[(e-1)*3+1],c.current[3*e+2]=c.current[(e-1)*3+2],u.current[e]=.6*Math.pow(1-e/30,2)*a,h.current[e]=.5*n*Math.pow(1-e/30,.5);if(c.current[0]=t,c.current[1]=r,c.current[2]=s,u.current[0]=.6*a,h.current[0]=1.2*n,l.current){let e=l.current.geometry;e.attributes.position.array=c.current,e.attributes.position.needsUpdate=!0,e.attributes.opacity&&(e.attributes.opacity.array=u.current,e.attributes.opacity.needsUpdate=!0),e.attributes.scale&&(e.attributes.scale.array=h.current,e.attributes.scale.needsUpdate=!0)}}),(0,r.jsxs)("points",{ref:l,children:[(0,r.jsxs)("bufferGeometry",{children:[(0,r.jsx)("bufferAttribute",{attach:"attributes-position",count:30,array:c.current,itemSize:3}),(0,r.jsx)("bufferAttribute",{attach:"attributes-opacity",count:30,array:u.current,itemSize:1}),(0,r.jsx)("bufferAttribute",{attach:"attributes-scale",count:30,array:h.current,itemSize:1})]}),(0,r.jsx)("shaderMaterial",{transparent:!0,depthWrite:!1,blending:o.EZo,vertexShader:"\n          attribute float opacity;\n          attribute float scale;\n          varying float vOpacity;\n          void main() {\n            vOpacity = opacity;\n            vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n            gl_Position = projectionMatrix * mvPosition;\n            gl_PointSize = scale * 20.0 * (300.0 / -mvPosition.z);\n          }\n        ",fragmentShader:"\n          varying float vOpacity;\n          uniform vec3 uColor;\n          void main() {\n            float d = length(gl_PointCoord - vec2(0.5));\n            float strength = smoothstep(0.5, 0.1, d);\n            vec3 glowColor = mix(uColor, vec3(1.0), 0.4);\n            gl_FragColor = vec4(glowColor, vOpacity * strength);\n          }\n        ",uniforms:{uColor:{value:t}}})]})};function b(e){let{position:t,direction:n,onImpact:i}=e,a=(0,s.useRef)(null),l=(0,s.useRef)(new o.zD7),c=(0,s.useRef)(t.clone()),{scene:u}=(0,v.D)(),h=new o.Q1f("#00ff44"),d=(0,s.useRef)(null),m=(0,s.useRef)(null),p=(0,s.useRef)(null),f=e=>{let t=new o.tBo,n=e.clone().sub(c.current).normalize();t.set(c.current,n);let r=u.children.filter(e=>"mountain"===e.name&&e instanceof o.YJl||"tree"===e.name&&e instanceof o.YJl).flatMap(e=>{let t=[];return e.traverse(e=>{e instanceof o.eaF&&t.push(e)}),t}),s=t.intersectObjects(r,!0);if(s.length>0){let t=s[0],n=c.current.distanceTo(e);if(t.distance<=n)return console.log("Collision detected:",t.point),!0}return!1},x=e=>{p.current&&(p.current.position.copy(e),p.current.visible=!0,m.current=l.current.getElapsedTime())};return(0,v.F)((e,t)=>{if(!a.current)return;if(l.current.getElapsedTime()>10){a.current.removeFromParent();return}let r=n.clone().multiplyScalar(.3*t*60),s=c.current.clone().add(r);if(f(s)?(a.current&&(x(c.current),a.current.removeFromParent()),i()):(c.current.copy(s),a.current.position.copy(c.current)),null!==m.current&&p.current){let e=(l.current.getElapsedTime()-m.current)/.3;if(e>=1)p.current.visible=!1,m.current=null;else{let t=.8*(1+e);p.current.scale.set(t,t,t);let n=1-e;p.current.children.forEach(e=>{e instanceof o.eaF&&e.material instanceof o._4j&&(e.material.opacity=n)})}}}),(0,r.jsxs)("group",{name:"fireball-group",children:[(0,r.jsxs)("mesh",{ref:a,position:c.current,children:[(0,r.jsx)("sphereGeometry",{args:[.25,32,32]}),(0,r.jsx)("meshStandardMaterial",{emissive:h,emissiveIntensity:2,toneMapped:!1}),(0,r.jsx)("pointLight",{color:h,intensity:5,distance:12})]}),(0,r.jsx)("group",{ref:d,visible:!1,children:(0,r.jsxs)("mesh",{children:[(0,r.jsx)("sphereGeometry",{args:[.3125,16,16]}),(0,r.jsx)("meshStandardMaterial",{color:h,emissive:h,emissiveIntensity:2,transparent:!0,opacity:1,depthWrite:!1,blending:o.EZo})]})}),(0,r.jsx)(C,{color:h,size:.25,meshRef:a,opacity:1}),(0,r.jsxs)("group",{ref:p,visible:!1,children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("sphereGeometry",{args:[.5,16,16]}),(0,r.jsx)("meshStandardMaterial",{color:h,emissive:h,emissiveIntensity:3,transparent:!0,opacity:1,depthWrite:!1,blending:o.EZo})]}),(0,r.jsxs)("mesh",{children:[(0,r.jsx)("sphereGeometry",{args:[.8,16,16]}),(0,r.jsx)("meshStandardMaterial",{color:h,emissive:h,emissiveIntensity:2,transparent:!0,opacity:.5,depthWrite:!1,blending:o.EZo})]}),(0,r.jsx)("pointLight",{color:h,intensity:8,distance:4,decay:2})]})]})}function E(e){let{isSwinging:t,onSwingComplete:n}=e,i=(0,s.useRef)(null),a=(0,s.useRef)(0),l=[-1.055,1.1,.35];return(0,v.F)((e,r)=>{if(t&&i.current){a.current+=6*r;let e=Math.min(a.current/Math.PI/1.5,1);if(a.current>=.85*Math.PI){a.current=0,i.current.rotation.set(0,0,0),i.current.position.set(...l),n();return}let t=e<=.25?2*e:.75-(e-.125)*1.7,s=l[0]+2.5*Math.sin(t*Math.PI),o=l[1]+-1.5*Math.sin(t*Math.PI),c=l[2]+1.1*Math.cos(t*Math.PI);i.current.position.set(s,o,c);let u=Math.PI/3*Math.sin(t*Math.PI),h=Math.sin(t*Math.PI)*Math.PI,d=Math.PI/3*Math.sin(t*Math.PI);i.current.rotation.set(u,h,d)}else!t&&i.current&&(i.current.rotation.x*=.85,i.current.rotation.y*=.85,i.current.rotation.z*=.85,i.current.position.x+=(l[0]-i.current.position.x)*.2,i.current.position.y+=(l[1]-i.current.position.y)*.2,i.current.position.z+=(l[2]-i.current.position.z)*.2)}),(0,r.jsxs)("group",{ref:i,position:[l[0],l[1],l[2]],rotation:[0,0,Math.PI],scale:[1,1,1.05],children:[(0,r.jsxs)("group",{position:[0,-.4,0],rotation:[0,0,-Math.PI],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[.05,.05,2.3,12]})," ",(0,r.jsx)("meshStandardMaterial",{color:"#2c1810",roughness:.7})]}),[...Array(10)].map((e,t)=>(0,r.jsxs)("mesh",{position:[0,1-.2*t,0],rotation:[Math.PI/2,0,0],children:[" ",(0,r.jsx)("torusGeometry",{args:[.06,.01,8,16]}),(0,r.jsx)("meshStandardMaterial",{color:"#8B4513",metalness:.3,roughness:.7})]},t))]}),(0,r.jsxs)("group",{position:[0,.6,0],rotation:[Math.PI/1,0,Math.PI],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[.08,.08,.3,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#2c1810",roughness:.6})]}),(0,r.jsx)("group",{"rotation-x":(0,v.F)(e=>2*e.clock.getElapsedTime()),children:(0,r.jsxs)("mesh",{"position-y":-.075,rotation:[Math.PI/2,0,0],children:[(0,r.jsx)("torusGeometry",{args:[.145,.02,16,32]}),(0,r.jsx)("meshStandardMaterial",{color:"#39ff14",emissive:"#39ff14",emissiveIntensity:1.5,transparent:!0,opacity:.7})]})}),(0,r.jsx)("group",{"rotation-x":(0,v.F)(e=>-(2*e.clock.getElapsedTime())),children:(0,r.jsxs)("mesh",{"position-y":.03,rotation:[Math.PI/2,0,0],children:[(0,r.jsx)("torusGeometry",{args:[.175,.02,16,32]}),(0,r.jsx)("meshStandardMaterial",{color:"#39ff14",emissive:"#39ff14",emissiveIntensity:1.5,transparent:!0,opacity:.7})]})}),(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[.13,.11,.32,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#39ff14",emissive:"#39ff14",emissiveIntensity:1.5,transparent:!0,opacity:.3})]})]}),(0,r.jsx)("group",{position:[0,.49,1.1],rotation:[-1,-Math.PI/2,Math.PI/2.2],scale:[1,.75,1],children:(0,r.jsxs)("mesh",{children:[(0,r.jsx)("extrudeGeometry",{args:[(()=>{let e=new o.ypk;return e.moveTo(0,0),e.lineTo(.4,-.13),e.bezierCurveTo(.8,.22,1.33,.5,1.6,.515),e.lineTo(1.125,.75),e.bezierCurveTo(.5,.2,.225,0,.1,.7),e.lineTo(0,0),e})(),{steps:1,depth:1e-4,bevelEnabled:!0,bevelThickness:.03,bevelSize:.035,bevelSegments:1,curveSegments:16,depth:.03}]}),(0,r.jsx)("meshStandardMaterial",{color:"#39ff14",emissive:"#39ff14",emissiveIntensity:1.3,metalness:.8,roughness:.1,opacity:1,transparent:!0,side:o.$EB})]})})]})}function R(e){let{isSwinging:t,isSmiting:n,isOathstriking:i,onSwingComplete:a,onSmiteComplete:l,onOathstrikeComplete:c}=e,u=(0,s.useRef)(null),h=(0,s.useRef)(0),d=(0,s.useRef)(0),m=[-1.18,.225,.3];(0,v.F)((e,r)=>{if(u.current){if(i){h.current+=10*r;let e=Math.min(h.current/Math.PI/1.7,1),t=m[0]+2.5*Math.sin(e*Math.PI),n=m[1]+-1*Math.sin(e*Math.PI),s=m[2]+1.5*Math.cos(e*Math.PI);u.current.position.set(t,n,s);let o=Math.PI/3*Math.sin(e*Math.PI*.8),i=Math.sin(e*Math.PI)*Math.PI,a=Math.PI/3*Math.sin(e*Math.PI*.9);u.current.rotation.set(o,i,a),h.current>=Math.PI&&(h.current=0,u.current.rotation.set(0,0,0),u.current.position.set(...m),null==c||c());return}if(n){let e,t,n,s,o;d.current+=r*(d.current<Math.PI/2?3:6);let i=Math.min(d.current/Math.PI,1);if(i<.5){let r=1*i;e=-Math.PI/3-r*Math.PI/3,t=r*Math.PI/4,n=m[0]+1.5*r,s=m[1]+1.5*r,o=m[2]-1.5*r}else{let r=(i-.5)*2;e=-2*Math.PI/3+3*r*Math.PI/2,t=Math.PI/4*(1-r),n=m[0]+1.5*(1-r),s=m[1]+(1.5-2*r),o=m[2]-(1.5-3*r)}u.current.position.set(n,s,o),u.current.rotation.set(e,t,0),d.current>=Math.PI&&(d.current=0,u.current.rotation.set(0,0,0),u.current.position.set(...m),l());return}if(t){h.current+=10*r;let e=Math.min(h.current/Math.PI/1.6,1),t=m[0]+2.5*Math.sin(e*Math.PI),n=m[1]+-1*Math.sin(e*Math.PI),s=m[2]+1.5*Math.cos(e*Math.PI);u.current.position.set(t,n,s);let o=Math.PI/3*Math.sin(e*Math.PI*.8),i=Math.sin(e*Math.PI)*Math.PI,l=Math.PI/3*Math.sin(e*Math.PI*.9);u.current.rotation.set(o,i,l),h.current>=Math.PI&&(h.current=0,u.current.rotation.set(0,0,0),u.current.position.set(...m),a())}else t||n||(u.current.rotation.x*=.85,u.current.rotation.y*=.85,u.current.rotation.z*=.85,u.current.position.x+=(m[0]-u.current.position.x)*.2,u.current.position.y+=(m[1]-u.current.position.y)*.2,u.current.position.z+=(m[2]-u.current.position.z)*.2)}});let p={steps:2,depth:.05,bevelEnabled:!0,bevelThickness:.014,bevelSize:.02,bevelOffset:.04,bevelSegments:2},f={...p,depth:.06,bevelThickness:.03,bevelSize:.025,bevelOffset:0,bevelSegments:6};return(0,r.jsx)("group",{rotation:[-.3,0,0],children:(0,r.jsxs)("group",{ref:u,position:[m[0],m[1],m[2]],rotation:[0,0,Math.PI],scale:[1,1,1],children:[(0,r.jsxs)("group",{position:[-.025,-.45,0],rotation:[0,0,-Math.PI],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[.03,.04,.9,12]}),(0,r.jsx)("meshStandardMaterial",{color:"#2a3b4c",roughness:.7})]}),[...Array(8)].map((e,t)=>(0,r.jsxs)("mesh",{position:[0,.35-.11*t,0],rotation:[Math.PI/2,0,0],children:[(0,r.jsx)("torusGeometry",{args:[.045,.016,8,16]}),(0,r.jsx)("meshStandardMaterial",{color:"#1a2b3c",metalness:.6,roughness:.4})]},t))]}),(0,r.jsxs)("group",{position:[-.025,.28,0],rotation:[Math.PI,1.5,Math.PI],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("torusGeometry",{args:[.26,.07,16,32]}),(0,r.jsx)("meshStandardMaterial",{color:"#4a5b6c",metalness:.9,roughness:.1})]}),[...Array(8)].map((e,t)=>(0,r.jsxs)("mesh",{position:[.25*Math.cos(t*Math.PI/4),.25*Math.sin(t*Math.PI/4),0],rotation:[0,0,t*Math.PI/4-Math.PI/2],children:[(0,r.jsx)("coneGeometry",{args:[.07,.55,3]}),(0,r.jsx)("meshStandardMaterial",{color:"#4a5b6c",metalness:.9,roughness:.1})]},"spike-".concat(t))),(0,r.jsxs)("mesh",{children:[(0,r.jsx)("sphereGeometry",{args:[.155,16,16]}),(0,r.jsx)("meshStandardMaterial",{color:new o.Q1f(0xffff00),emissive:new o.Q1f(0xff6600),emissiveIntensity:1,transparent:!0,opacity:1})]}),(0,r.jsxs)("mesh",{children:[(0,r.jsx)("sphereGeometry",{args:[.1,16,16]}),(0,r.jsx)("meshStandardMaterial",{color:new o.Q1f(0xffff00),emissive:new o.Q1f(0xffff00),emissiveIntensity:40,transparent:!0,opacity:.8})]}),(0,r.jsxs)("mesh",{children:[(0,r.jsx)("sphereGeometry",{args:[.145,16,16]}),(0,r.jsx)("meshStandardMaterial",{color:new o.Q1f(0xffff00),emissive:new o.Q1f(0xffff00),emissiveIntensity:35,transparent:!0,opacity:.6})]}),(0,r.jsxs)("mesh",{children:[(0,r.jsx)("sphereGeometry",{args:[.175,16,16]}),(0,r.jsx)("meshStandardMaterial",{color:new o.Q1f(0xffff00),emissive:new o.Q1f(0xffff00),emissiveIntensity:30,transparent:!0,opacity:.4})]}),(0,r.jsx)("pointLight",{color:new o.Q1f(0xffff00),intensity:2,distance:.5,decay:2})]}),(0,r.jsxs)("group",{position:[0,.63,0],rotation:[0,-Math.PI/2,Math.PI/2],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("extrudeGeometry",{args:[(()=>{let e=new o.ypk;return e.moveTo(0,0),e.lineTo(-.25,.25),e.lineTo(-.15,-.15),e.lineTo(0,0),e.lineTo(.25,.25),e.lineTo(.15,-.15),e.lineTo(0,0),e.lineTo(0,.08),e.lineTo(.2,.2),e.quadraticCurveTo(.8,.15,1.5,.18),e.quadraticCurveTo(2,.1,2.2,0),e.quadraticCurveTo(2,-.1,1.5,-.18),e.quadraticCurveTo(.8,-.15,.2,-.2),e.lineTo(0,-.08),e.lineTo(0,0),e})(),p]}),(0,r.jsx)("meshStandardMaterial",{color:new o.Q1f(0x9932cc),emissive:new o.Q1f(8881105),emissiveIntensity:.8,metalness:.3,roughness:.1})]}),(0,r.jsxs)("mesh",{children:[(0,r.jsx)("extrudeGeometry",{args:[(()=>{let e=new o.ypk;return e.moveTo(0,0),e.lineTo(0,.06),e.lineTo(.15,.15),e.quadraticCurveTo(1.2,.12,1.5,.15),e.quadraticCurveTo(2,.08,2.15,0),e.quadraticCurveTo(2,-.08,1.5,-.15),e.quadraticCurveTo(1.2,-.12,.15,-.15),e.lineTo(0,-.05),e.lineTo(0,0),e})(),f]}),(0,r.jsx)("meshStandardMaterial",{color:new o.Q1f(8881105),emissive:new o.Q1f(8881105),emissiveIntensity:2,metalness:.2,roughness:.1,opacity:.8,transparent:!0})]})]})]})})}let _=(e,t,n)=>e*(1-n)+t*n;function k(e){let{isSwinging:t,onSwingComplete:n,onLeftSwingStart:i,onRightSwingStart:a,isBowCharging:l}=e,c=(0,s.useRef)(null),u=(0,s.useRef)(0),h=(0,s.useRef)(null),d=(0,s.useRef)(0),m=[-.8,.75,.75],p=[.8,.75,.75],f=(0,s.useRef)(0),x=(0,s.useRef)(!1),g=(0,s.useRef)(0);(0,v.F)((e,r)=>{if(c.current&&h.current){if(l)c.current.position.x+=(-.8-c.current.position.x)*.3,c.current.position.y+=(-.2-c.current.position.y)*.3,c.current.position.z+=(.5-c.current.position.z)*.3,h.current.position.x+=(.8-h.current.position.x)*.3,h.current.position.y+=(-.2-h.current.position.y)*.3,h.current.position.z+=(.5-h.current.position.z)*.3,c.current.rotation.x=_(1.05*c.current.rotation.x,.37*Math.PI,.3),c.current.rotation.z=_(c.current.rotation.z,1.05*Math.PI,.2),h.current.rotation.x=_(1.05*h.current.rotation.x,.37*Math.PI,.3),h.current.rotation.z=_(h.current.rotation.z,-(1.05*Math.PI),.2),u.current=0,d.current=0,g.current=0,f.current=0,x.current=!1;else if(t){if(0===u.current&&0===d.current&&(x.current=!1),c.current){if(g.current<.15)g.current+=r;else{0===u.current&&i(),u.current+=7*r;let e=Math.min(u.current/Math.PI,1),t=m[0]+1.2*Math.sin(e*Math.PI),n=m[1]+-.3*Math.sin(e*Math.PI*2),s=m[2]+2*Math.sin(e*Math.PI);c.current.position.set(t,n,s);let o=.5*Math.PI*Math.sin(e*Math.PI),a=.3*Math.PI*Math.sin(e*Math.PI),l=.2*Math.PI*Math.sin(e*Math.PI);c.current.rotation.set(o,a,l),u.current>=Math.PI&&(u.current=0,g.current=0,c.current.rotation.set(0,0,0),c.current.position.set(...m))}}if(h.current){0===d.current&&a(),d.current+=7*r;let e=Math.min(d.current/Math.PI,1),t=p[0]-1.2*Math.sin(e*Math.PI),s=p[1]+-.3*Math.sin(e*Math.PI*2),o=p[2]+2*Math.sin(e*Math.PI);h.current.position.set(t,s,o);let i=.5*Math.PI*Math.sin(e*Math.PI),l=-(.3*Math.PI*Math.sin(e*Math.PI)),c=-(.2*Math.PI*Math.sin(e*Math.PI));h.current.rotation.set(i,l,c),d.current>=Math.PI&&(d.current=0,f.current=0,h.current.rotation.set(0,0,0),h.current.position.set(...p),x.current=!0,n())}}else c.current.position.x+=(m[0]-c.current.position.x)*.2,c.current.position.y+=(m[1]-c.current.position.y)*.2,c.current.position.z+=(m[2]-c.current.position.z)*.2,h.current.position.x+=(p[0]-h.current.position.x)*.2,h.current.position.y+=(p[1]-h.current.position.y)*.2,h.current.position.z+=(p[2]-h.current.position.z)*.2,c.current.rotation.x*=.85,c.current.rotation.y*=.85,c.current.rotation.z*=.85,h.current.rotation.x*=.85,h.current.rotation.y*=.85,h.current.rotation.z*=.85,t||(u.current=0,d.current=0,g.current=0,f.current=0,x.current=!1)}});let j=()=>{let e=new o.ypk;return e.moveTo(0,0),e.lineTo(-.15,.1),e.lineTo(-.2,0),e.lineTo(-.2,-.05),e.lineTo(0,0),e.lineTo(.15,.1),e.lineTo(.2,0),e.lineTo(.3,0),e.lineTo(0,0),e.lineTo(0,.05),e.quadraticCurveTo(.3,.15,.5,.2),e.quadraticCurveTo(.7,.25,.9,.15),e.quadraticCurveTo(1,.1,1.1,0),e.quadraticCurveTo(1,-.05,.8,-.1),e.lineTo(.7,-.15),e.lineTo(.65,-.1),e.quadraticCurveTo(.4,-.08,.2,-.05),e.quadraticCurveTo(.1,-.02,0,0),e},y=()=>{let e=new o.ypk;return e.moveTo(0,0),e.lineTo(-.13,.08),e.lineTo(-.18,0),e.lineTo(-.08,-.04),e.lineTo(0,0),e.lineTo(.13,.08),e.lineTo(.18,0),e.lineTo(.08,-.04),e.lineTo(0,0),e.lineTo(0,.04),e.quadraticCurveTo(.28,.13,.48,.18),e.quadraticCurveTo(.68,.23,.88,.13),e.quadraticCurveTo(.98,.08,1.08,0),e.quadraticCurveTo(.98,-.04,.78,-.08),e.lineTo(.68,-.13),e.lineTo(.63,-.08),e.quadraticCurveTo(.38,-.06,.18,-.04),e.quadraticCurveTo(.08,-.02,0,0),e},M={steps:2,depth:.02,bevelEnabled:!0,bevelThickness:.004,bevelSize:.01,bevelSegments:3},P={...M,depth:.025,bevelThickness:.003,bevelSize:.004,bevelOffset:0};return(0,r.jsxs)("group",{position:[0,-.25,-.1],rotation:[0,0,0],scale:[.8,.8,.8],children:[(0,r.jsxs)("group",{ref:c,position:[m[0],m[1],m[2]],rotation:[0,0,Math.PI],scale:[1,1,1],children:[(0,r.jsxs)("group",{position:[0,-.125,0],rotation:[0,0,-Math.PI],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[.015,.02,.45,12]}),(0,r.jsx)("meshStandardMaterial",{color:"#2a3b4c",roughness:.7})]}),[void 0,void 0,void 0,void 0].map((e,t)=>(0,r.jsxs)("mesh",{position:[0,.175-.065*t,0],children:[(0,r.jsx)("torusGeometry",{args:[.0225,.004,8,16]}),(0,r.jsx)("meshStandardMaterial",{color:"#1a2b3c",metalness:.6,roughness:.4})]},t))]}),(0,r.jsxs)("group",{position:[0,.3,0],rotation:[0,Math.PI/2,Math.PI/2],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("extrudeGeometry",{args:[j(),M]}),(0,r.jsx)("meshStandardMaterial",{color:"#0066ff",emissive:"#0088ff",emissiveIntensity:3,metalness:.9,roughness:.2,opacity:.9,transparent:!0})]}),(0,r.jsxs)("mesh",{position:[0,0,-.02],children:["  ",(0,r.jsx)("extrudeGeometry",{args:[y(),{...P,depth:.06}]}),(0,r.jsx)("meshStandardMaterial",{color:"#0033ff",emissive:"#0066ff",emissiveIntensity:8,metalness:.7,roughness:.1,opacity:.4,transparent:!0})]}),(0,r.jsx)("pointLight",{color:"#0088ff",intensity:5,distance:2,decay:2})]})]}),(0,r.jsxs)("group",{ref:h,position:[p[0],p[1],p[2]],rotation:[0,0,Math.PI],scale:[1,1,1],children:[(0,r.jsxs)("group",{position:[0,-.125,0],rotation:[0,0,-Math.PI],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[.015,.02,.45,12]}),(0,r.jsx)("meshStandardMaterial",{color:"#2a3b4c",roughness:.7})]}),[void 0,void 0,void 0,void 0].map((e,t)=>(0,r.jsxs)("mesh",{position:[0,.175-.065*t,0],children:[(0,r.jsx)("torusGeometry",{args:[.0225,.004,8,16]}),(0,r.jsx)("meshStandardMaterial",{color:"#1a2b3c",metalness:.6,roughness:.4})]},t))]}),(0,r.jsxs)("group",{position:[0,.3,0],rotation:[0,Math.PI/2,Math.PI/2],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("extrudeGeometry",{args:[j(),M]}),(0,r.jsx)("meshStandardMaterial",{color:"#0066ff",emissive:"#0088ff",emissiveIntensity:2,metalness:.9,roughness:.2,opacity:.9,transparent:!0})]}),(0,r.jsxs)("mesh",{position:[0,0,-.02],children:["  ",(0,r.jsx)("extrudeGeometry",{args:[y(),{...P,depth:.06}]}),(0,r.jsx)("meshStandardMaterial",{color:"#0033ff",emissive:"#0066ff",emissiveIntensity:3.5,metalness:.7,roughness:.1,opacity:.4,transparent:!0})]}),(0,r.jsx)("pointLight",{color:"#0088ff",intensity:1.5,distance:2,decay:2})]})]})]})}function T(e){let{position:t,direction:n,chargeProgress:i,isCharging:a,onRelease:l}=e,c=(0,s.useRef)(null),u=(0,s.useRef)(a),h=(0,s.useRef)(null);return(0,s.useEffect)(()=>{if(c.current){let e=Math.atan2(n.x,n.z);c.current.rotation.set(0,e,0)}},[n]),(0,v.F)(()=>{!u.current&&a&&(h.current=Date.now()),u.current&&!a&&(l(Math.min((h.current?(Date.now()-h.current)/1e3:0)/2,1)),h.current=null),u.current=a}),(0,r.jsxs)("group",{ref:c,position:t.toArray(),children:[(0,r.jsxs)("mesh",{rotation:[Math.PI/2,0,0],children:[(0,r.jsx)("tubeGeometry",{args:[new o.s0K(new o.Pq0(-.8,0,0),new o.Pq0(-.85,.3,0),new o.Pq0(.85,.3,0),new o.Pq0(.8,0,0)),64,.035,8,!1]}),(0,r.jsx)("meshStandardMaterial",{color:"#00ffff",emissive:"#00ffff",emissiveIntensity:2,transparent:!0,opacity:.8})]}),(0,r.jsxs)("mesh",{children:[(0,r.jsx)("tubeGeometry",{args:[(e=>{let t=2*e;return new o.s0K(new o.Pq0(-.8,0,0),new o.Pq0(0,-.1,-t),new o.Pq0(0,.1,-t),new o.Pq0(.8,0,0))})(i),32,.02,8,!1]}),(0,r.jsx)("meshStandardMaterial",{color:"#ffffff",emissive:"#ffffff",emissiveIntensity:4,transparent:!0,opacity:.6})]}),(0,r.jsxs)("group",{children:[(0,r.jsxs)("mesh",{position:[-.4,0,.32],rotation:[Math.PI/2,0,Math.PI/6],children:[(0,r.jsx)("boxGeometry",{args:[.6,.02,.05]}),(0,r.jsx)("meshStandardMaterial",{color:"#00ffff",emissive:"#00ffff",emissiveIntensity:2,transparent:!0,opacity:.8})]}),(0,r.jsxs)("mesh",{position:[.4,0,.32],rotation:[Math.PI/2,0,-Math.PI/6],children:[(0,r.jsx)("boxGeometry",{args:[.6,.02,.05]}),(0,r.jsx)("meshStandardMaterial",{color:"#00ffff",emissive:"#00ffff",emissiveIntensity:2,transparent:!0,opacity:.8})]})]}),a&&(0,r.jsxs)("group",{position:[0,0,.8-2*i],rotation:[Math.PI/2,0,0],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[.01,.02,.7,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#00ffff",emissive:"#00ffff",emissiveIntensity:3,transparent:!0,opacity:.9})]}),(0,r.jsxs)("mesh",{position:[0,.35,0],children:[(0,r.jsx)("coneGeometry",{args:[.03,.175,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#00ffff",emissive:"#00ffff",emissiveIntensity:3,transparent:!0,opacity:.9})]})]}),a&&(0,r.jsxs)("mesh",{rotation:[0,Math.PI-2*Math.PI/2,Math.PI],position:[0,0,.65],children:[(0,r.jsx)("tubeGeometry",{args:[new o.VnP(new o.Pq0(0,0,0),new o.Pq0(0,0,20)),64,.025,8,!1]}),(0,r.jsx)("meshStandardMaterial",{color:"#00ffff",emissive:"#00ffff",emissiveIntensity:1,transparent:!0,opacity:.3*i})]})]})}function G(e){let{position:t,onComplete:n}=e,o=(0,s.useRef)(null),i=(0,s.useRef)(0),a=(0,s.useRef)(0);return(0,v.F)((e,t)=>{if(!o.current)return;if(a.current<.05){a.current+=t;return}i.current+=t;let r=Math.min(i.current/.75,1);if(r<1){o.current.position.y=40*(1-r);let e=r<.9?1:1-(r-.9)/.1;o.current.scale.set(e,e,e)}else n()}),(0,r.jsxs)("group",{ref:o,position:[t.x,25,t.z],visible:a.current>=.05,children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[.175,.175,20,16]}),(0,r.jsx)("meshStandardMaterial",{color:"#ffaa00",emissive:"#ff8800",emissiveIntensity:25,transparent:!0,opacity:.95})]}),(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[.42,.42,20,16]}),(0,r.jsx)("meshStandardMaterial",{color:"#ffaa00",emissive:"#ff8800",emissiveIntensity:10,transparent:!0,opacity:.75})]}),(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[.7,.6,20,16]}),(0,r.jsx)("meshStandardMaterial",{color:"#ffaa00",emissive:"#ff8800",emissiveIntensity:2,transparent:!0,opacity:.55})]}),(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[1,1,20,16]}),(0,r.jsx)("meshStandardMaterial",{color:"#ffcc00",emissive:"#ffaa00",emissiveIntensity:3,transparent:!0,opacity:.35})]}),[void 0,void 0,void 0].map((e,t)=>(0,r.jsxs)("mesh",{rotation:[0,t*Math.PI/1.5,0],children:[(0,r.jsx)("torusGeometry",{args:[1.2,.08,8,32]}),(0,r.jsx)("meshStandardMaterial",{color:"#ffaa00",emissive:"#ff8800",emissiveIntensity:4,transparent:!0,opacity:.3})]},t)),[...Array(8)].map((e,t)=>(0,r.jsxs)("mesh",{position:[1*Math.cos(t*Math.PI/4),(t-4)*2,1*Math.sin(t*Math.PI/4)],children:[(0,r.jsx)("sphereGeometry",{args:[.15,8,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#ffaa00",emissive:"#ff8800",emissiveIntensity:12,transparent:!0,opacity:.6})]},t)),(0,r.jsx)("pointLight",{position:[0,-10,0],color:"#ff8800",intensity:20,distance:12}),(0,r.jsx)("pointLight",{position:[0,0,0],color:"#ffaa00",intensity:10,distance:6})]})}var D=n(2027);function F(e){let{damage:t,position:n,isCritical:o=!1,isLightning:i=!1,isBlizzard:a=!1,isHealing:l=!1,isBoneclaw:c=!1,isOathstrike:u=!1,isFirebeam:h=!1,onComplete:d}=e;console.log("DamageNumber props:",{damage:t,isCritical:o,isBlizzard:a,isLightning:i,isHealing:l,isBoneclaw:c});let m=(0,s.useRef)(null),p=(0,s.useRef)(Date.now()),f=n.y+3.5,{camera:x}=(0,v.D)(),g=Date.now()%1e3/1e3,j=.3*Math.sin(g*Math.PI*2),y=.2*Math.cos(g*Math.PI*2);(0,v.F)(()=>{if(!m.current)return;let e=(Date.now()-p.current)/1e3;if(e>=1.5){d();return}m.current.quaternion.copy(x.quaternion);let t=e/1.5,r=f+1.2*(1-Math.pow(1-t,3)),s=n.x+j;m.current.position.set(s,r+y,n.z),m.current.material.opacity=Math.min(1,3*(1-t))});let M=()=>l?"#338C66":o?"#ff0000":c?"#39ff14":i?"#ffff00":u?"#8783D1":h?"#58FCEC":a?"#61EDFF":"#ffffff";return console.log("Text color:",M(),"isHealing:",l),(0,r.jsx)(D.E,{ref:m,position:[n.x,f,n.z],fontSize:.6,color:M(),anchorX:"center",anchorY:"middle",outlineWidth:.05,outlineColor:"#000000","material-transparent":!0,"material-depthTest":!1,children:l?"+".concat(t):t})}function z(e){let{children:t,position:n=[0,0,0],lockX:i=!1,lockY:a=!1,lockZ:l=!1}=e,c=(0,s.useRef)(null);return(0,v.F)(e=>{let{camera:t}=e;if(!c.current)return;let n=c.current.position,r=t.position,s=new o.Pq0().subVectors(r,n),u=c.current.rotation.clone();a||(u.y=Math.atan2(s.x,s.z)),i||(u.x=Math.atan2(-s.y,Math.sqrt(s.x*s.x+s.z*s.z))),l||(u.z=0),c.current.rotation.set(u.x,u.y,u.z)}),(0,r.jsx)("group",{ref:c,position:n,children:t})}function q(e){let{parentRef:t,weaponType:n}=e,a=(0,s.useRef)([]),l=(0,s.useRef)([]),[c,u]=(0,s.useState)(!1);(0,s.useEffect)(()=>{if(t.current){let e=t.current.position.clone();l.current=Array(32).fill(0).map(()=>e.clone()),u(!0)}},[t]);let h=()=>{switch(n){case i.SCYTHE:return"#39ff14";case i.SWORD:return"#8783D1";case i.SABRES:return"#58FCEC"}};return((0,v.F)(()=>{if(!t.current||!c)return;let e=t.current.position.clone();l.current.unshift(e),l.current=l.current.slice(0,32),a.current.forEach((e,t)=>{e&&l.current[t]&&(e.position.copy(l.current[t]),e.scale.setScalar(1-t/32*.6),e.material&&e.material instanceof o.V9B&&(e.material.opacity=(1-t/32)*.2))})}),c)?(0,r.jsx)(r.Fragment,{children:Array.from({length:32}).map((e,t)=>(0,r.jsxs)("mesh",{ref:e=>{e&&(a.current[t]=e)},children:[(0,r.jsx)("sphereGeometry",{args:[.43,32,32]}),(0,r.jsx)("meshBasicMaterial",{color:new o.Q1f(h()),transparent:!0,opacity:.3,depthWrite:!1})]},t))}):null}function B(e){let{collectedBones:t,isLeftWing:n}=e,i=(0,s.useRef)(null),a=[{pos:new o.Pq0(n?-.3:.3,.3,0),rot:new o.O9p(0,0,n?-Math.PI/6:Math.PI/6),scale:1.3},{pos:new o.Pq0(n?-.5:.5,.45,0),rot:new o.O9p(0,0,n?-Math.PI/3.5:Math.PI/3.5),scale:1.4},{pos:new o.Pq0(n?-.65:.65,.6,0),rot:new o.O9p(0,0,n?-Math.PI/2.5:Math.PI/2.5),scale:1},{pos:new o.Pq0(n?-.85:.85,.72,.1),rot:new o.O9p(.1,0,n?-Math.PI/2.2:Math.PI/2.2),scale:1},{pos:new o.Pq0(n?-1.05:1.05,.8,.2),rot:new o.O9p(.2,0,n?-Math.PI/2:Math.PI/2),scale:.9},{pos:new o.Pq0(n?-1.2:1.2,.9,.2),rot:new o.O9p(.2,0,n?-Math.PI/1.8:Math.PI/1.8),scale:.8},{pos:new o.Pq0(n?-1.3:1.3,.75,.2),rot:new o.O9p(.05,0,n?-(-Math.PI/.475):-(Math.PI/.475)),scale:1},{pos:new o.Pq0(n?-1.13:1.13,.445,.17),rot:new o.O9p(.2,0,n?-(-Math.PI/.45):-(Math.PI/.45)),scale:.8}],l=()=>(0,r.jsxs)("group",{children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[.023,.0175,.32,3]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,r.jsxs)("mesh",{position:new o.Pq0(0,.2,0),children:[(0,r.jsx)("sphereGeometry",{args:[.035,4,4]}),(0,r.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]})]});return(0,r.jsx)("group",{ref:i,rotation:new o.O9p(0,Math.PI,0),position:new o.Pq0(0,-.3,0),children:a.slice(0,Math.min(15,t)).map((e,t)=>(0,r.jsx)("group",{position:e.pos,rotation:e.rot,scale:e.scale,children:l()},"bone-".concat(t)))})}let A=()=>(0,r.jsxs)("group",{rotation:[Math.PI/4,0,0],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[.02,.015,.2,4]}),(0,r.jsx)("meshStandardMaterial",{color:"#ffffff",roughness:.4,metalness:.3})]}),(0,r.jsxs)("mesh",{position:new o.Pq0(0,.135,0),rotation:new o.O9p(0,0,Math.PI/6),children:[(0,r.jsx)("sphereGeometry",{args:[.03,4,4]}),(0,r.jsx)("meshStandardMaterial",{color:"#ffffff",roughness:.5,metalness:.2})]}),(0,r.jsxs)("mesh",{position:new o.Pq0(0,-.1,0),rotation:new o.O9p(0,0,-Math.PI/6),children:[(0,r.jsx)("sphereGeometry",{args:[.03,4,4]}),(0,r.jsx)("meshStandardMaterial",{color:"#a4a4a4",roughness:.5,metalness:.2})]})]});function L(e){let{parentRef:t}=e,n=(0,s.useRef)([]),o=(0,s.useRef)(null);return(0,v.F)(()=>{if(!t.current||!o.current)return;let e=t.current.position;o.current.position.set(e.x,0,e.z),n.current.forEach((e,t)=>{let n=t/16*Math.PI*2+.001*Date.now(),r=.5*Math.cos(n),s=.5*Math.sin(n),o=.01*Math.sin(.002*Date.now()+t);e.position.set(r,o+.13,s),e.rotation.y=n+Math.PI/3})}),(0,r.jsx)("group",{ref:o,children:Array.from({length:16}).map((e,t)=>(0,r.jsx)("mesh",{ref:e=>{e&&(n.current[t]=e)},children:A()},t))})}let O=()=>{let e=(0,s.useRef)(null),t=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(0,r.jsxs)("group",{position:[0,e,0],scale:t,children:[(0,r.jsxs)("group",{rotation:[0,0,-Math.PI/3],children:[(0,r.jsxs)("mesh",{position:[.1,0,0],rotation:[1,Math.PI/2,0],children:[(0,r.jsx)("torusGeometry",{args:[.2,.015,8,12,.75*Math.PI]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,r.jsxs)("mesh",{position:[.3,-.15,0],children:[(0,r.jsx)("sphereGeometry",{args:[.02,4,4]}),(0,r.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]})]}),(0,r.jsxs)("group",{rotation:[0,0,Math.PI/3],children:[(0,r.jsxs)("mesh",{position:[-.1,0,0],rotation:[0,-Math.PI/2,0],children:[(0,r.jsx)("torusGeometry",{args:[.2,.015,8,12,.75*Math.PI]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,r.jsxs)("mesh",{position:[-.3,-.15,0],children:[(0,r.jsx)("sphereGeometry",{args:[.02,4,4]}),(0,r.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]})]}),(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[.02,.02,.1,4]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]})]})};return(0,r.jsx)("group",{ref:e,position:[0,.04,-0],rotation:[.25,Math.PI+Math.PI/.97,0],children:(0,r.jsxs)("group",{children:[(0,r.jsxs)("group",{children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[.04,.04,.8,4]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),[-.3,-.15,0,.15,.3].map((e,t)=>(0,r.jsxs)("group",{position:[0,e,0],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[.06,.06,.04,6]}),(0,r.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]}),(0,r.jsxs)("mesh",{position:[0,0,.04],children:[(0,r.jsx)("boxGeometry",{args:[.04,.03,.04]}),(0,r.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]})]},t))]}),(0,r.jsxs)("group",{position:[0,0,0],children:[t(.45,.7),t(.3,.8),t(.15,.9),t(0,1),t(-.15,.9),t(-.3,.8),t(-.45,.7)]})]})})},N=()=>{let e=(0,s.useRef)(null);(0,v.F)(t=>{let{clock:n}=t;if(!e.current)return;let r=n.getElapsedTime();e.current.rotation.y=.3*Math.sin(.5*r),e.current.rotation.x=.1+.07*Math.sin(.7*r)});let t=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1?arguments[1]:void 0,n=.6*Math.pow(t/13,1.3),s=Math.PI,o=Math.atan2(.6*Math.pow((t+1)/15,2)-n,.1*(1-t/20))+(0===t?s:0);return(0,r.jsxs)("group",{position:[0,-n+.35,-(.18*t)*(1-t/40)],scale:e,rotation:[-o,0,0],children:[(0,r.jsxs)("mesh",{rotation:[Math.PI,0,0],children:[(0,r.jsx)("cylinderGeometry",{args:[.04,.055,.125,6]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,r.jsxs)("group",{rotation:[Math.PI/2,0,Math.PI/2],children:[(0,r.jsxs)("mesh",{position:[0,.08,0],children:[(0,r.jsx)("coneGeometry",{args:[.02,.06,4]}),(0,r.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]}),(0,r.jsxs)("mesh",{position:[.08,0,0],rotation:[0,0,Math.PI/2],children:[(0,r.jsx)("coneGeometry",{args:[.015,.04,4]}),(0,r.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]}),(0,r.jsxs)("mesh",{position:[-.085,0,0],rotation:[0,0,Math.PI/2],children:[(0,r.jsx)("coneGeometry",{args:[.015,.04,4]}),(0,r.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]})]}),(0,r.jsxs)("group",{rotation:[Math.PI/24,0,-Math.PI/2],children:[(0,r.jsxs)("mesh",{position:[0,.08,0],children:[(0,r.jsx)("coneGeometry",{args:[.02,.06,4]}),(0,r.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]}),(0,r.jsxs)("mesh",{position:[.05,0,0],rotation:[0,0,2*Math.PI],children:[(0,r.jsx)("coneGeometry",{args:[.015,.04,4]}),(0,r.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]}),(0,r.jsxs)("mesh",{position:[-.085,0,0],rotation:[0,0,Math.PI/2],children:[(0,r.jsx)("coneGeometry",{args:[.015,.04,4]}),(0,r.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]})]}),(0,r.jsxs)("mesh",{position:[0,.1,.01],rotation:[Math.PI/2,0,0],children:[(0,r.jsx)("sphereGeometry",{args:[.03,6,6]}),(0,r.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]})]})};return(0,r.jsx)("group",{ref:e,position:[0,-.7,-.25],rotation:[-.1,0,0],children:[...Array(15)].map((e,n)=>t(1-.04*n,n))})},H=e=>{switch(e){case i.SCYTHE:return"#00ff44";case i.SWORD:return"#8783D1";case i.SABRES:case i.SABRES2:return"#73EEDC";default:return"#00ff44"}},Q=e=>{let t=H(e);return(0,r.jsxs)("group",{children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("boxGeometry",{args:[.15,.03,.03]}),(0,r.jsx)("meshStandardMaterial",{color:t,transparent:!0,opacity:.6,emissive:t,emissiveIntensity:.5})]}),(0,r.jsxs)("mesh",{children:[(0,r.jsx)("sphereGeometry",{args:[.035,9,9]}),(0,r.jsx)("meshStandardMaterial",{color:t,emissive:t,emissiveIntensity:1.5,transparent:!0,opacity:.4})]})]})};function W(e){let{parentRef:t,weaponType:n}=e,o=(0,s.useRef)([]),i=(0,s.useRef)(null);return(0,v.F)(e=>{let{clock:n}=e;if(!t.current||!i.current)return;let r=t.current.position;i.current.position.set(r.x,.03,r.z),o.current.forEach((e,t)=>{if(!e)return;let r=n.getElapsedTime(),s=t/30*.6,o=t/30*Math.PI*4+2*r,i=.47*(1-.7*s),a=Math.cos(o)*i,l=Math.sin(o)*i;e.position.set(a,s,l),e.rotation.y=o+Math.PI/2,e.rotation.x=Math.PI/6,e.rotation.z=.1*Math.sin(3*r+t);let c=e.children[0];c&&c.material&&(c.material.opacity=Math.max(.1,1-2*s))})}),(0,r.jsxs)("group",{ref:i,children:[Array.from({length:30}).map((e,t)=>(0,r.jsx)("group",{ref:e=>{e&&(o.current[t]=e)},children:Q(n)},t)),(0,r.jsx)("pointLight",{color:H(n),intensity:2,distance:1.3,position:[0,.15,0]})]})}function U(e){let t=.11>Math.random();return{damage:t?2*e:e,isCritical:t}}let Y=Math.PI/1.5;function Z(e){let{position:t,direction:n,onComplete:i}=e,a=(0,s.useRef)(null),l=(0,s.useRef)(0),c=(0,s.useRef)(0),u=new o.Q1f("#39ff14"),h=new o.Pq0(t.x+5*n.x,0,t.z+5*n.z),d=new o.Pq0(-n.z,0,n.x).normalize(),m=h.clone().add(d.clone().multiplyScalar(-1.35)),p=h.clone().add(d.clone().multiplyScalar(1.35));(0,v.F)((e,t)=>{if(!a.current)return;if(c.current<.125){c.current+=t;return}l.current+=t;let n=Math.min(l.current/1.2,1);if(n<1){a.current.position.y=3*(1-n);let e=n<.9?1:1-(n-.9)/.2;a.current.scale.set(e,e,e)}else i()});let f=(e,t)=>(0,r.jsxs)("group",{position:[e.x,0,e.z],rotation:[Math.PI/6,Math.atan2(n.x,n.z),0],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[.1,.1,15,16]}),(0,r.jsx)("shaderMaterial",{transparent:!0,depthWrite:!1,blending:o.EZo,vertexShader:"\n            varying vec2 vUv;\n            void main() {\n              vUv = uv;\n              gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n            }\n          ",fragmentShader:"\n            uniform vec3 uColor;\n            varying vec2 vUv;\n            void main() {\n              float strength = 1.0 - length(vUv - vec2(0.5));\n              vec3 glowColor = mix(uColor, vec3(1.0), 0.3);\n              gl_FragColor = vec4(glowColor, strength * 0.95);\n            }\n          ",uniforms:{uColor:{value:u}}})]}),(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[.2,.2,15,16]}),(0,r.jsx)("shaderMaterial",{transparent:!0,depthWrite:!1,blending:o.EZo,vertexShader:"\n            varying vec2 vUv;\n            void main() {\n              vUv = uv;\n              gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n            }\n          ",fragmentShader:"\n            uniform vec3 uColor;\n            varying vec2 vUv;\n            void main() {\n              float strength = 1.0 - length(vUv - vec2(0.5));\n              vec3 glowColor = mix(uColor, vec3(1.0), 0.4);\n              gl_FragColor = vec4(glowColor, strength * 0.7);\n            }\n          ",uniforms:{uColor:{value:u}}})]}),(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[.35,.35,15,16]}),(0,r.jsx)("shaderMaterial",{transparent:!0,depthWrite:!1,blending:o.EZo,vertexShader:"\n            varying vec2 vUv;\n            void main() {\n              vUv = uv;\n              gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n            }\n          ",fragmentShader:"\n            uniform vec3 uColor;\n            varying vec2 vUv;\n            void main() {\n              float strength = 1.0 - length(vUv - vec2(0.5));\n              vec3 glowColor = mix(uColor, vec3(1.0), 0.5);\n              gl_FragColor = vec4(glowColor, strength * 0.4);\n            }\n          ",uniforms:{uColor:{value:u}}})]}),(0,r.jsx)("pointLight",{position:[0,-5,0],color:u,intensity:20,distance:6}),(0,r.jsx)("pointLight",{position:[0,0,0],color:u,intensity:15,distance:3})]});return(0,r.jsxs)("group",{ref:a,visible:c.current>=.125,children:[f(m,!1),f(h,!0),f(p,!1)]})}function V(e){let{position:t,direction:n,onComplete:o,parentRef:i,onHitTarget:a,enemyData:l,onSwingComplete:c}=e,u=(0,s.useRef)(null),h=(0,s.useRef)(0),d=(0,s.useRef)(!1),m=(0,s.useRef)(!1),p=(e,t)=>(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[t,.8*t,e,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),f=e=>(0,r.jsxs)("mesh",{children:[(0,r.jsx)("sphereGeometry",{args:[e,8,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),x=(e,t)=>(0,r.jsxs)("group",{children:[(0,r.jsx)("group",{position:[t/2,0,0],children:p(e,.06)}),(0,r.jsx)("group",{position:[-t/2,0,0],children:p(e,.06)}),(0,r.jsx)("group",{position:[0,e/2,0],children:f(.08)}),(0,r.jsx)("group",{position:[0,-e/2,0],children:f(.08)})]});return(0,v.F)((e,t)=>{if(!u.current||!(null==i?void 0:i.current))return;h.current+=6*t;let r=Math.min(h.current/Math.PI,1);if(r>=1){h.current=0,null==c||c(u.current.position.clone(),n),o();return}let s=i.current.position.clone(),p=i.current.rotation.y,f=-(2*Math.sin(r*Math.PI))+2,x=Math.cos(r*Math.PI)+1.9,g=2*Math.sin(r*Math.PI)+.5,j=f*Math.cos(p)+g*Math.sin(p),y=-f*Math.sin(p)+g*Math.cos(p);u.current.position.set(s.x+j,s.y+x,s.z+y);let v=-(Math.cos(r*Math.PI)/(Math.PI/1.5)),M=p+Math.PI/2-r*Math.PI,P=-(Math.PI/4*Math.sin(r*Math.PI));u.current.rotation.set(v,M,P),.1>Math.abs(r-.1)&&!d.current&&(d.current=!0,m.current=!0,(function(e,t,n){let r=[];return n.forEach(n=>{if(n.health<=0)return;let s=n.position.clone().sub(e);if(s.length()>7.5||(s.normalize(),Math.acos(s.dot(t))>Y/2))return;let{damage:o,isCritical:i}=U(67);r.push({targetId:n.id,damage:o,isCritical:i,position:n.position.clone()})}),r})(u.current.position,n,l).forEach(e=>{null==a||a(e.targetId,e.damage,e.isCritical,e.position,!0)}))}),(0,r.jsxs)(r.Fragment,{children:[m.current&&(0,r.jsx)(Z,{position:t,direction:n,onComplete:()=>{m.current=!1}}),(0,r.jsx)("group",{ref:u,position:t,rotation:[0,Math.atan2(n.x,n.z),Math.PI/4],children:(0,r.jsxs)("group",{children:[x(1.15,.15),(0,r.jsxs)("group",{position:[-.22,-.85,.21],children:["   ",(0,r.jsxs)("mesh",{children:[(0,r.jsx)("sphereGeometry",{args:[.12,12,12]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,r.jsxs)("group",{rotation:[-.7,-0,-Math.PI/5],children:[x(.8,.12),(0,r.jsxs)("group",{position:[0,-.5,0],rotation:[0,0,1-Math.PI/4],children:[f(.09),(0,r.jsxs)("group",{position:[0,-.1,0],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("boxGeometry",{args:[.2,.15,.08]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4})]}),[-.08,-.04,0,.04,.08].map((e,t)=>(0,r.jsxs)("group",{position:[e,-.1,0],rotation:[0,0,(t-2)*Math.PI/10],children:[p(.5,.02),(0,r.jsx)("group",{position:[.025,-.3,0],rotation:[0,0,Math.PI+Math.PI/16],children:(0,r.jsxs)("mesh",{children:[(0,r.jsx)("coneGeometry",{args:[.03,.3,6]}),(0,r.jsx)("meshStandardMaterial",{color:"#d4d4d4",roughness:.3,metalness:.4})]})})]},t))]})]})]})]})]})})]})}function K(e){let{initialPosition:t,onComplete:n,type:o}=e,i=(0,s.useRef)(null),a=(0,s.useRef)(1.5*Math.random()+3.65),l=(0,s.useRef)({x:1.5*Math.random(),y:.25*Math.random(),z:1*Math.random()}),c=(0,s.useRef)(Math.min(t.length(),2.65)),u=(0,s.useRef)(Math.atan2(t.z,t.x));return(0,v.F)((e,t)=>{i.current&&("falling"===o?(i.current.position.y-=a.current*t,i.current.position.y<0&&n()):(u.current+=t,i.current.position.x=Math.cos(u.current)*c.current,i.current.position.z=Math.sin(u.current)*c.current,u.current>2*Math.PI&&n()),i.current.rotation.x+=l.current.x,i.current.rotation.y+=l.current.y,i.current.rotation.z+=l.current.z)}),(0,r.jsxs)("mesh",{ref:i,position:t,children:[(0,r.jsx)("tetrahedronGeometry",{args:[.07]}),(0,r.jsx)("meshStandardMaterial",{color:"#80ffff",emissive:"#40a0ff",emissiveIntensity:1,transparent:!0,opacity:.7})]})}function X(e){let{onComplete:t}=e,n=(0,s.useRef)(null),o=(0,s.useRef)(0),i=(0,s.useRef)({x:.2*Math.random(),y:2*Math.random(),z:.3*Math.random()});return(0,v.F)((e,r)=>{if(!n.current)return;o.current+=r,n.current.rotation.x+=i.current.x*r,n.current.rotation.y+=i.current.y*r,n.current.rotation.z+=i.current.z*r;let s=.1*Math.sin(2*o.current)+1;n.current.scale.setScalar(s),o.current>6&&t()}),(0,r.jsxs)("mesh",{ref:n,children:[(0,r.jsx)("torusGeometry",{args:[.8,.075,8,32]}),(0,r.jsx)("meshStandardMaterial",{color:"#80ffff",emissive:"#40a0ff",emissiveIntensity:2,transparent:!0,opacity:.3})]})}function $(e){let{onComplete:t,enemyData:n=[],onHitTarget:i,parentRef:a}=e,l=(0,s.useRef)(null),c=(0,s.useRef)(0),u=(0,s.useRef)(0),h=(0,s.useRef)([]),d=(0,s.useRef)([]);return(0,v.F)((e,r)=>{if(!l.current||!(null==a?void 0:a.current))return;let s=a.current.position;if(l.current.position.copy(s),c.current+=r,c.current>=6){t();return}if(l.current.rotation.y+=4*r,.2>Math.random()){let e=Math.random()*Math.PI*2,t=.8*Math.random()/50,n=new o.Pq0(Math.cos(e)*t,2.35+1.7*Math.random(),Math.sin(e)*t);h.current.push({id:Date.now()+Math.random(),position:n,type:"orbital"})}if(Math.random()>.2){let e=Math.random()*Math.PI*2,t=2.5*Math.random(),n=new o.Pq0(Math.cos(e)*t,1.2+3*Math.random(),Math.sin(e)*t);h.current.push({id:Date.now()+Math.random(),position:n,type:"falling"})}.1>Math.random()&&d.current.push({id:Date.now()+Math.random()});let m=Date.now();m-u.current>=1e3&&(u.current=m,n&&i&&(function(e,t){let n=[];return t.forEach(t=>{if(!(t.health<=0)&&4.75>=t.position.distanceTo(e)){let{damage:e,isCritical:r}=U(29);n.push({targetId:t.id,damage:e,isCritical:r,position:t.position.clone()})}}),n})(s,n).forEach(e=>{i(e.targetId,e.damage,e.isCritical,e.position,!0)}))}),(0,r.jsxs)("group",{ref:l,children:[h.current.map(e=>(0,r.jsx)(K,{initialPosition:e.position,type:e.type,onComplete:()=>{h.current=h.current.filter(t=>t.id!==e.id)}},e.id)),d.current.map(e=>(0,r.jsx)(X,{onComplete:()=>{d.current=d.current.filter(t=>t.id!==e.id)}},e.id))]})}let J=e=>{let{parentRef:t}=e,[n,r]=(0,s.useState)(!1);return{isActive:n,activateFirebeam:(0,s.useCallback)(()=>{if(!t.current)return;let e=t.current.position.clone();e.y+=1;let n=new o.Pq0(0,0,1).applyQuaternion(t.current.quaternion);return r(!0),{position:e,direction:n,onComplete:()=>r(!1),damage:37}},[t]),deactivateFirebeam:(0,s.useCallback)(()=>{r(!1)},[])}};function ee(e){let{parentRef:t,charges:n,orbitRadius:o=.55,orbitSpeed:a=.8,particleSize:l=.08,particleCount:c=8,weaponType:u}=e,h=(0,s.useRef)([]),d=(()=>{switch(u){case i.SCYTHE:return"#00ff44";case i.SWORD:return"#8783D1";case i.SABRES:case i.SABRES2:return"#73EEDC";default:return"#00ff44"}})();return(0,v.F)(()=>{t.current&&h.current.forEach((e,t)=>{let n=t/c*Math.PI*2+.001*Date.now()*a,r=Math.cos(n)*o,s=Math.sin(n)*o,i=.05*Math.sin(.002*Date.now()+t);e.position.set(r,i,s)})}),(0,r.jsx)(r.Fragment,{children:Array.from({length:c}).map((e,t)=>{let s=n[t];return(0,r.jsxs)("mesh",{ref:e=>{e&&(h.current[t]=e)},children:[(0,r.jsx)("sphereGeometry",{args:[l,8,8]}),(0,r.jsx)("meshStandardMaterial",{color:(null==s?void 0:s.available)?d:"#333333",emissive:(null==s?void 0:s.available)?d:"#333333",emissiveIntensity:(null==s?void 0:s.available)?2:.5,transparent:!0,opacity:(null==s?void 0:s.available)?.8:.4})]},t)})})}let et=e=>{let{parentRef:t,onHit:n,enemyData:r,setActiveEffects:o,charges:i,setCharges:a,setDamageNumbers:l,nextDamageNumberId:c}=e,u=(0,s.useRef)(0),h=(0,s.useRef)(null),d=(0,s.useRef)(0),{isActive:m,activateFirebeam:p,deactivateFirebeam:f}=J({onHit:n,parentRef:t}),x=(0,s.useCallback)(()=>{null!==h.current&&(o(e=>e.filter(e=>e.id!==h.current)),h.current=null),f()},[f,o]),g=(0,s.useCallback)(()=>{let e=i.findIndex(e=>e.available);return -1!==e&&(a(t=>t.map((t,n)=>n===e?{...t,available:!1,cooldownStartTime:Date.now()}:t)),setTimeout(()=>{a(t=>t.map((t,n)=>n===e?{...t,available:!0,cooldownStartTime:null}:t))},7750),!0)},[i,a]),j=(0,s.useCallback)(()=>{let e=Date.now();if(e-d.current<700||!g())return;let t=p();if(!t)return;let{position:s,direction:i,damage:a}=t,m=u.current++;h.current=m,d.current=e,o(e=>[...e,{id:m,type:"firebeam",position:s,direction:i}]),r.forEach(e=>{if(e.health<=0)return;let t=e.position.clone().sub(s),r=i.angleTo(t),o=t.length();r<.35&&o<20&&(n(e.id,a),l(t=>[...t,{id:c.current++,damage:a,position:e.position.clone(),isCritical:!1,isFirebeam:!0}]))}),setTimeout(()=>{x()},6e3)},[c,l,p,r,n,o,g,x]);return(0,s.useEffect)(()=>()=>{x()},[x]),{isActive:m,startFirebeam:j,stopFirebeam:x}},en=e=>{let{beamRef:t}=e,n=(0,s.useRef)(0),r=(0,s.useRef)(!0),o=(0,s.useRef)(!1);return(0,s.useEffect)(()=>{let e=t.current;return()=>{r.current=!1,e&&(o.current=!0,setTimeout(()=>{e&&(e.scale.z=0)},2500))}},[t]),(0,v.F)((e,r)=>{if(t.current){if(o.current)n.current-=r/2.5,n.current>0&&(t.current.scale.z=n.current);else if(n.current<1){n.current+=r/0;let e=Math.min(n.current,1);t.current.scale.z=e}}}),{reset:()=>{n.current=0,r.current=!1,o.current=!0,setTimeout(()=>{t.current&&(t.current.scale.z=0),o.current=!1},5e3)}}};function er(e){let{position:t,direction:n,onComplete:o}=e,i=(0,s.useRef)(null);(0,s.useEffect)(()=>{let e=i.current;return()=>{e&&(e.scale.z=0),o()}},[o]);let{reset:a}=en({beamRef:i,position:t,direction:n});return(0,s.useEffect)(()=>()=>{a()},[a]),(0,r.jsxs)("group",{ref:i,position:t.toArray(),rotation:[0,Math.atan2(n.x,n.z),0],children:[(0,r.jsxs)("group",{position:[0,-1.1,0],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("sphereGeometry",{args:[.65,16,16]}),(0,r.jsx)("meshStandardMaterial",{color:"#58FCEC",emissive:"#58FCEC",emissiveIntensity:2.5,transparent:!0,opacity:.65})]}),(0,r.jsxs)("mesh",{children:[(0,r.jsx)("sphereGeometry",{args:[.825,16,16]}),(0,r.jsx)("meshStandardMaterial",{color:"#58FCEC",emissive:"#58FCEC",emissiveIntensity:.7,transparent:!0,opacity:.65})]}),[void 0,void 0,void 0].map((e,t)=>(0,r.jsxs)("mesh",{rotation:[Math.PI/2,0,t*Math.PI/3],children:[(0,r.jsx)("torusGeometry",{args:[.875,.075,8,32]}),(0,r.jsx)("meshStandardMaterial",{color:"#58FCEC",emissive:"#58FCEC",emissiveIntensity:.8,transparent:!0,opacity:.9})]},"ring-".concat(t))),(0,r.jsx)("pointLight",{color:"#58FCEC",intensity:20,distance:3})]}),(0,r.jsxs)("group",{position:[0,-1.1,10.7],children:[(0,r.jsxs)("mesh",{rotation:[Math.PI/2,0,0],children:[(0,r.jsx)("cylinderGeometry",{args:[.1,.1,20,16]}),(0,r.jsx)("meshStandardMaterial",{color:"#58FCEC",emissive:"#58FCEC",emissiveIntensity:2,transparent:!0,opacity:.95})]}),(0,r.jsxs)("mesh",{rotation:[Math.PI/2,0,0],children:[(0,r.jsx)("cylinderGeometry",{args:[.275,.275,20,16]}),(0,r.jsx)("meshStandardMaterial",{color:"#58FCEC",emissive:"#58FCEC",emissiveIntensity:1.5,transparent:!0,opacity:.7})]}),(0,r.jsxs)("mesh",{rotation:[Math.PI/2,0,0],children:[(0,r.jsx)("cylinderGeometry",{args:[.425,.425,20,16]}),(0,r.jsx)("meshStandardMaterial",{color:"#58FCEC",emissive:"#58FCEC",emissiveIntensity:.5,transparent:!0,opacity:.6})]}),[void 0,void 0,void 0,void 0,void 0].map((e,t)=>(0,r.jsxs)("mesh",{rotation:[-Math.PI/4,0,-(t*Math.PI/1.5)],position:[0,0,10],children:[(0,r.jsx)("torusGeometry",{args:[.35,.05,8,32]}),(0,r.jsx)("meshStandardMaterial",{color:"#58FCEC",emissive:"#58FCEC",emissiveIntensity:1,transparent:!0,opacity:.3})]},t)),[...Array(24)].map((e,t)=>(0,r.jsxs)("mesh",{position:[(Math.random()-.5)*1.75,(Math.random()-.5)*1.75,10*Math.random()],rotation:[Math.random()*Math.PI*2,Math.random()*Math.PI*2,Math.random()*Math.PI*2],children:[(0,r.jsx)("boxGeometry",{args:[.05,.05,.1]})," ",(0,r.jsx)("meshStandardMaterial",{color:"#58FCEC",emissive:"#58FCEC",emissiveIntensity:2,transparent:!0,opacity:.75})]},"spark-".concat(t))),(0,r.jsx)("pointLight",{position:[0,0,18.5],color:"#58FCEC",intensity:12,distance:4})]})]})}let es=e=>{let{position:t,onComplete:n}=e,[o,i]=(0,s.useState)(0);(0,v.F)((e,t)=>{i(e=>{let r=e+t;return r>=1.5&&n(),r})});let a=o/1.5,l=Math.sin(a*Math.PI),c=1+2*a;return(0,r.jsxs)("group",{position:t.toArray(),children:[[void 0,void 0,void 0].map((e,t)=>(0,r.jsxs)("mesh",{position:[0,2*a+.5*t,0],rotation:[Math.PI/2,0,2*o],children:[(0,r.jsx)("torusGeometry",{args:[.8-.2*t,.05,16,32]}),(0,r.jsx)("meshStandardMaterial",{color:"#00ff88",emissive:"#00ff88",emissiveIntensity:2,transparent:!0,opacity:l*(1-.2*t)})]},"ring-".concat(t))),(0,r.jsxs)("mesh",{scale:[c,c,c],children:[(0,r.jsx)("sphereGeometry",{args:[.5,32,32]}),(0,r.jsx)("meshStandardMaterial",{color:"#00ff88",emissive:"#00ff88",emissiveIntensity:3,transparent:!0,opacity:.3*l})]}),[...Array(12)].map((e,t)=>{let n=t/12*Math.PI*2,s=1+a;return(0,r.jsxs)("mesh",{position:[Math.cos(n+2*o)*s,2*a+.5*Math.sin(3*o+t),Math.sin(n+2*o)*s],children:[(0,r.jsx)("sphereGeometry",{args:[.1,8,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#00ff88",emissive:"#00ff88",emissiveIntensity:2,transparent:!0,opacity:.8*l})]},"particle-".concat(t))}),(0,r.jsx)("pointLight",{color:"#00ff88",intensity:4*l,distance:5,decay:2})]})},eo=(0,s.forwardRef)((e,t)=>{let{parentRef:n,onHealthChange:i,charges:a,setCharges:l,setDamageNumbers:c,nextDamageNumberId:u}=e,[h,d]=(0,s.useState)(!1),{castReanimate:m}=function(e){let{charges:t,setCharges:n,onHealthChange:r,parentRef:i,setDamageNumbers:a,nextDamageNumberId:l}=e,c=(0,s.useRef)(0);return{castReanimate:(0,s.useCallback)(()=>{let e=Date.now();if(e-c.current<775)return console.log("Reanimate is on cooldown"),!1;let s=t.findIndex(e=>e.available);if(-1===s)return console.log("No charges available for Reanimate"),!1;c.current=e,n(e=>e.map((e,t)=>t===s?{...e,available:!1,cooldownStartTime:Date.now()}:e));let u=null==i?void 0:i.current;return u&&a(e=>[...e,{id:l.current++,damage:10,position:u.position.clone().add(new o.Pq0(0,2,0)),isCritical:!1,isHealing:!0}]),r(10),setTimeout(()=>{n(e=>e.map((e,t)=>t===s?{...e,available:!0,cooldownStartTime:null}:e))},7750),console.log("Reanimate casted. Healed for ".concat(10," points.")),!0},[t,n,r,i,a,l])}}({parentRef:n,charges:a,setCharges:l,onHealthChange:i,setDamageNumbers:c,nextDamageNumberId:u}),p=(0,s.useCallback)(()=>{let e=m();return e&&d(!0),e},[m]);return(0,s.useImperativeHandle)(t,()=>({castReanimate:p})),h&&n.current?(0,r.jsx)(es,{position:n.current.position.clone().add(new o.Pq0(0,0,0)),onComplete:()=>d(!1)}):null});eo.displayName="Reanimate";let ei=e=>{let{effectRef:t,parentRef:n}=e,r=(0,s.useRef)(0),i=(0,s.useRef)(!0);return(0,s.useEffect)(()=>{let e=t.current;return()=>{i.current=!1,e&&e.scale.set(0,0,0)}},[t]),(0,v.F)((e,s)=>{if(!t.current||!i.current||!n.current)return;r.current+=s;let a=r.current/.1225;if(a<=1){let e=n.current.quaternion,r=new o.Pq0(0,0,2);r.applyQuaternion(e),t.current.position.copy(n.current.position).add(r).setY(.1);let s=new o.PTz().setFromAxisAngle(new o.Pq0(-1,0,0),-Math.PI/2);t.current.quaternion.copy(e).multiply(s);let i=1.5*Math.sin(a*Math.PI);t.current.scale.set(i,i,.5*i),t.current.traverse(e=>{let t=e.material;(null==t?void 0:t.opacity)!==void 0&&(t.opacity=Math.sin(a*Math.PI))})}else i.current=!1,t.current&&t.current.scale.set(0,0,0)}),{reset:()=>{r.current=0,i.current=!0,t.current&&t.current.scale.set(0,0,0)}}};function ea(e){let{position:t,direction:n,onComplete:o,parentRef:i}=e,a=(0,s.useRef)(null);(0,s.useEffect)(()=>()=>{o()},[o]);let{reset:l}=ei({effectRef:a,position:t,direction:n,parentRef:i});return(0,s.useEffect)(()=>()=>{l()},[l]),(0,r.jsx)("group",{ref:a,position:t.toArray(),rotation:[Math.PI/2,Math.atan2(n.x,n.z),0],children:(0,r.jsxs)("group",{position:[0,0,0],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("torusGeometry",{args:[3,.8,8,32,Math.PI]}),(0,r.jsx)("meshStandardMaterial",{color:"#6B67A8",emissive:"#5B4B99",emissiveIntensity:8,transparent:!0,opacity:.9})]}),(0,r.jsxs)("mesh",{children:[(0,r.jsx)("torusGeometry",{args:[3,.4,16,32,Math.PI]}),(0,r.jsx)("meshStandardMaterial",{color:"#8783D1",emissive:"#6B67A8",emissiveIntensity:6,transparent:!0,opacity:.7})]}),(0,r.jsxs)("mesh",{children:[(0,r.jsx)("torusGeometry",{args:[2,.9,16,32,Math.PI]}),(0,r.jsx)("meshStandardMaterial",{color:"#A59FFA",emissive:"#8783D1",emissiveIntensity:4,transparent:!0,opacity:.5})]}),[...Array(12)].map((e,t)=>(0,r.jsxs)("mesh",{position:[1.5*Math.cos(t*Math.PI/6),1.5*Math.sin(t*Math.PI/6),0],children:[(0,r.jsx)("sphereGeometry",{args:[.15,8,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#ff8800",emissive:"#ff6600",emissiveIntensity:6,transparent:!0,opacity:.6})]},t)),(0,r.jsx)("pointLight",{color:"#8783D1",intensity:15,distance:8}),(0,r.jsx)("pointLight",{color:"#6B67A8",intensity:10,distance:12})]})})}let el=e=>{let{currentHealth:t,maxHealth:n,onHealthChange:r,setDamageNumbers:o,nextDamageNumberId:i,healAmount:a=10}=e;return{processHealing:(0,s.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a,s=arguments.length>1?arguments[1]:void 0,l=Math.min(e,n-t);l>0&&(r(l),o&&i&&o(e=>[...e,{id:i.current++,damage:l,position:s,isCritical:!1,isHealing:!0}]))},[t,n,r,o,i,a])}},ec=e=>{let{parentRef:t,onHit:n,charges:r,setCharges:i,enemyData:a,onHealthChange:l,setDamageNumbers:c,nextDamageNumberId:u,currentHealth:h,maxHealth:d}=e,[m,p]=(0,s.useState)(!1),{processHealing:f}=el({currentHealth:h,maxHealth:d,onHealthChange:l,setDamageNumbers:c,nextDamageNumberId:u,healAmount:9}),x=(0,s.useCallback)(()=>{let e=r.filter(e=>e.available);if(e.length<4)return console.log("Not enough charges available for Oathstrike"),!1;i(t=>t.map((t,n)=>n===e[0].id-1||n===e[1].id-1||n===e[2].id-1||n===e[3].id-1?{...t,available:!1,cooldownStartTime:Date.now()}:t));for(let t=0;t<4;t++)e[t].id&&setTimeout(()=>{i(n=>n.map((n,r)=>r===e[t].id-1?{...n,available:!0,cooldownStartTime:null}:n))},7750);return!0},[r,i]);return{isActive:m,activateOathstrike:(0,s.useCallback)(()=>{if(!t.current||!x())return null;let e=t.current.position.clone();e.y+=1;let r=new o.Pq0(0,0,1).applyQuaternion(t.current.quaternion);p(!0),f(9,e);let s=r.clone(),i=.6*Math.PI;return a.forEach(t=>{if(t.health<=0)return;let r=t.position.clone().sub(e);if(6.5>=r.length()&&Math.abs(s.angleTo(r))<=i/2){let{damage:e,isCritical:r}=U(43);n(t.id,e),c(n=>[...n,{id:u.current++,damage:e,position:t.position.clone(),isCritical:r,isOathstrike:!0}])}}),{position:e,direction:r,onComplete:()=>{p(!1)}}},[u,c,t,x,a,n,f])}},eu=e=>{let{onHealthChange:t,parentRef:n,setDamageNumbers:r,nextDamageNumberId:i,currentHealth:a,maxHealth:l}=e,[c,u]=(0,s.useState)(!1),{processHealing:h}=el({currentHealth:a,maxHealth:l,onHealthChange:t,setDamageNumbers:r,nextDamageNumberId:i,healAmount:8});return{processHealingChance:(0,s.useCallback)(()=>{n.current&&.175>Math.random()&&(h(8,n.current.position.clone().add(new o.Pq0(0,2,0))),u(!0))},[h,n,.175,8]),showHealingEffect:c,setShowHealingEffect:u}},eh=e=>{let{position:t,onComplete:n}=e,[o,i]=(0,s.useState)(0);(0,v.F)((e,t)=>{i(e=>{let r=e+t;return r>=1.5&&n(),r})});let a=o/1.5,l=Math.sin(a*Math.PI),c=1+2*a;return(0,r.jsxs)("group",{position:t.toArray(),children:[[void 0,void 0,void 0].map((e,t)=>(0,r.jsxs)("mesh",{position:[0,2*a+.5*t,0],rotation:[Math.PI/2,0,2*o],children:[(0,r.jsx)("torusGeometry",{args:[.8-.2*t,.05,16,32]}),(0,r.jsx)("meshStandardMaterial",{color:"#ffaa00",emissive:"#ff8800",emissiveIntensity:2,transparent:!0,opacity:l*(1-.2*t)})]},"ring-".concat(t))),(0,r.jsxs)("mesh",{scale:[c,c,c],children:[(0,r.jsx)("sphereGeometry",{args:[.5,32,32]}),(0,r.jsx)("meshStandardMaterial",{color:"#ffaa00",emissive:"#ff8800",emissiveIntensity:3,transparent:!0,opacity:.3*l})]}),[...Array(12)].map((e,t)=>{let n=t/12*Math.PI*2,s=1+a;return(0,r.jsxs)("mesh",{position:[Math.cos(n+2*o)*s,2*a+.5*Math.sin(3*o+t),Math.sin(n+2*o)*s],children:[(0,r.jsx)("sphereGeometry",{args:[.1,8,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#ffaa00",emissive:"#ff8800",emissiveIntensity:2,transparent:!0,opacity:.8*l})]},"particle-".concat(t))}),(0,r.jsx)("pointLight",{color:"#ff8800",intensity:4*l,distance:5,decay:2})]})},ed=(0,s.forwardRef)((e,t)=>{let{parentRef:n,onHealthChange:i,setDamageNumbers:a,nextDamageNumberId:l,currentHealth:c,maxHealth:u}=e,h=(0,s.useRef)(null),{processHealingChance:d,showHealingEffect:m,setShowHealingEffect:p}=eu({onHealthChange:i,parentRef:n,setDamageNumbers:a,nextDamageNumberId:l,currentHealth:c,maxHealth:u});return(0,s.useImperativeHandle)(t,()=>({processHealingChance:d})),(0,v.F)(()=>{if(h.current&&n.current){let e=n.current.position;h.current.position.set(e.x,.015,e.z),h.current.rotation.y+=.0012}}),(0,r.jsxs)(r.Fragment,{children:[m&&n.current&&(0,r.jsx)(eh,{position:n.current.position.clone().add(new o.Pq0(0,0,0)),onComplete:()=>p(!1)}),(0,r.jsxs)("group",{ref:h,children:[(0,r.jsx)("group",{rotation:[0,0,0],position:[0,.005,0],children:[0,Math.PI/2,Math.PI,1.5*Math.PI].map((e,t)=>(0,r.jsxs)("mesh",{rotation:[-Math.PI/2,0,e+8e-4*Date.now()],children:[(0,r.jsx)("ringGeometry",{args:[.85,1,3]}),(0,r.jsx)("meshStandardMaterial",{color:"#ffaa00",emissive:"#ff8800",emissiveIntensity:2,transparent:!0,opacity:.6,depthWrite:!1})]},t))}),(0,r.jsxs)("mesh",{position:[0,.1,0],children:[(0,r.jsx)("cylinderGeometry",{args:[.925,.5,-.175,32]}),(0,r.jsx)("meshStandardMaterial",{color:"#ff8800",emissive:"#ff6600",emissiveIntensity:1,transparent:!0,opacity:.55,depthWrite:!1})]})]})]})});function em(e){var t,n;let{onHit:l,controlsRef:c,currentWeapon:u,health:h,maxHealth:d,isPlayer:m=!1,abilities:p,onAbilityUse:f,onPositionUpdate:x,enemyData:g,onHealthChange:j}=e,y=(0,s.useRef)(null),[M,P]=(0,s.useState)(!1),[w,S]=(0,s.useState)([]),I=(0,s.useRef)(0),{camera:C}=(0,v.D)(),{keys:_}=function(e){let{groupRef:t,controlsRef:n,camera:r,speed:i=.08,onPositionUpdate:a,health:l}=e,c=(0,s.useRef)({w:!1,a:!1,s:!1,d:!1}),u=(0,s.useRef)(!1);return(0,s.useEffect)(()=>{l<=0?(u.current=!0,c.current={w:!1,a:!1,s:!1,d:!1}):u.current=!1},[l]),(0,s.useEffect)(()=>{let e=()=>{u.current=!0,c.current={w:!1,a:!1,s:!1,d:!1}},t=()=>{u.current=!1};return window.addEventListener("gameOver",e),window.addEventListener("gameReset",t),()=>{window.removeEventListener("gameOver",e),window.removeEventListener("gameReset",t)}},[]),(0,v.F)(()=>{if(!t.current||u.current)return;let e=new o.Pq0;r.getWorldDirection(e),e.y=0,e.normalize();let s=new o.Pq0(-e.z,0,e.x),l=new o.Pq0(0,0,0);if(c.current.w&&l.add(e),c.current.s&&l.sub(e),c.current.a&&l.sub(s),c.current.d&&l.add(s),l.length()>0){l.normalize(),t.current.position.add(l.multiplyScalar(i));let e=Math.atan2(l.x,l.z);t.current.rotation.y=e}if(n.current){let e=t.current.position;n.current.target.set(e.x,e.y,e.z)}a(t.current.position.clone())}),(0,s.useEffect)(()=>{let e=e=>{if(u.current)return;let t=e.key.toLowerCase();t in c.current&&(c.current[t]=!0)},t=e=>{let t=e.key.toLowerCase();t in c.current&&(c.current[t]=!1)};return window.addEventListener("keydown",e),window.addEventListener("keyup",t),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",t)}},[]),{keys:c}}({groupRef:y,controlsRef:c,camera:C,onPositionUpdate:x,health:h}),[D,A]=(0,s.useState)(!1),[H,Q]=(0,s.useState)([]),Y=(0,s.useRef)(0),[Z,K]=(0,s.useState)([]),X=(0,s.useRef)(0),[J,en]=(0,s.useState)({}),[es,ei]=(0,s.useState)(!1),[el,eu]=(0,s.useState)(0),eh=(0,s.useRef)(null),em=(0,s.useRef)(0),[ep,ef]=(0,s.useState)([]),[ex,eg]=(0,s.useState)([{id:1,available:!0,cooldownStartTime:null},{id:2,available:!0,cooldownStartTime:null},{id:3,available:!0,cooldownStartTime:null},{id:4,available:!0,cooldownStartTime:null},{id:5,available:!0,cooldownStartTime:null},{id:6,available:!0,cooldownStartTime:null},{id:7,available:!0,cooldownStartTime:null},{id:8,available:!0,cooldownStartTime:null}]),[ej]=(0,s.useState)(15),ey=(0,s.useRef)(new Set),[ev,eM]=(0,s.useState)([]),[eP,ew]=(0,s.useState)(!1),[eS,eI]=(0,s.useState)(!1),eC=(0,s.useRef)(null),eb=(0,s.useCallback)(()=>{if(!y.current)return;let e=ex.findIndex(e=>e.available);if(-1===e)return;let t=y.current.position.clone();t.y+=1;let n=new o.Pq0(0,0,1);n.applyQuaternion(y.current.quaternion),eg(t=>t.map((t,n)=>n===e?{...t,available:!1,cooldownStartTime:Date.now()}:t)),S(e=>[...e,{id:I.current++,position:t.clone(),startPosition:t.clone(),direction:n.normalize(),maxDistance:35}])},[y,ex]),eE=(e,t)=>{t&&eM(e=>[...e,{id:Date.now(),type:"fireballExplosion",position:t,direction:new o.Pq0,duration:.125,startTime:Date.now()}]),S(t=>t.filter(t=>t.id!==e))},eR=e=>{if(!y.current||!M)return;let t=Date.now();if(t-(J["".concat(e,"_time")]||0)<240)return;let n=g.find(t=>t.id===e);if(!n)return;en(e=>({...e,[n.id]:(e[n.id]||0)+1,["".concat(n.id,"_time")]:t}));let r=n.id.startsWith("enemy");if(!r)return;let s=r&&u===i.SABRES?2:1,c=J[n.id]||0;if(!(c>=s)&&y.current.position.distanceTo(n.position)<=a[u].range){if(u===i.SABRES){let e=new o.Pq0().subVectors(n.position,y.current.position).normalize(),t=new o.Pq0(0,0,1).applyQuaternion(y.current.quaternion);if(Math.abs(e.angleTo(t))>Math.PI/5)return}let e=a[u].normal;if(D&&u===i.SWORD){if(ey.current.has(n.id)||n.health<=0)return;ey.current.add(n.id);let{damage:e,isCritical:t}=U(31);l(n.id,e),K(r=>[...r,{id:X.current++,damage:e,position:n.position.clone(),isCritical:t}]),setTimeout(()=>{let e=g.find(e=>e.id===n.id);if(!e||e.health<=0){ey.current.delete(n.id);return}let{damage:t,isCritical:r}=U(47);l(n.id,t),K(n=>[...n,{id:X.current++,damage:t,position:e.position.clone(),isCritical:r,isLightning:!0}]),ey.current.delete(n.id)},300)}let{damage:t,isCritical:r}=U(e);l(n.id,t);let s=n.health-t;if(u===i.SWORD&&p[i.SWORD].passive.isUnlocked&&!D&&!eP&&!eS&&s>0){var h;null===(h=eC.current)||void 0===h||h.processHealingChance(),eI(!0)}if(s>0){if(u===i.SABRES){let e=0===c?-.4:.4;K(s=>[...s,{id:X.current++,damage:t,position:new o.Pq0(n.position.x+e,n.position.y,n.position.z),isCritical:r}])}else K(e=>[...e,{id:X.current++,damage:t,position:n.position.clone(),isCritical:r}])}}},e_=()=>{P(!1),en({}),A(!1),eI(!1)};(0,v.F)((e,t)=>{if(y.current){if(M&&y.current&&g.forEach(e=>{eR(e.id)}),es&&null!==eh.current){let e=Math.min((Date.now()-eh.current)/1e3/1.85,1);eu(e);let n=em.current;em.current+=(e-n)*t*15,e>=1&&eG(1)}ef(e=>e.map(e=>e.position.distanceTo(e.startPosition)<e.maxDistance?(e.position.add(e.direction.clone().multiplyScalar(.625)),g.forEach(t=>{let n=new o.Pq0(e.position.x,0,e.position.z),r=new o.Pq0(t.position.x,0,t.position.z);1.375>n.distanceTo(r)&&eO(e.id,t.id,e.power,e.position)}),e):null).filter(Boolean)),S(e=>e.map(e=>{if(e.position.distanceTo(e.startPosition)<e.maxDistance)for(let t of(e.position.add(e.direction.clone().multiplyScalar(.5)),g)){if(t.health<=0)continue;let n=t.position.clone();if(n.y=1.5,1.5>e.position.distanceTo(n))return eN(e.id,t.id,e.position.clone()),eE(e.id,e.position.clone()),null}return e}).filter(Boolean)),eg(e=>e.map(e=>!e.available&&e.cooldownStartTime&&Date.now()-e.cooldownStartTime>=7750?{...e,available:!0,cooldownStartTime:null}:e)),eM(e=>e.filter(e=>!e.duration||!e.startTime||(Date.now()-e.startTime)/1e3<e.duration)),eM(e=>e.filter(e=>"firebeam"!==e.type||!e.startTime||!e.duration||(Date.now()-e.startTime)/1e3<e.duration))}});let[ek,eT]=(0,s.useState)(0),eG=(0,s.useCallback)(e=>{if(!y.current)return;let t=Date.now();if(t-ek<500)return;eT(t);let n=y.current.position.clone();n.y+=1;let r=new o.Pq0(0,0,1);r.applyQuaternion(y.current.quaternion);let s=n.clone();ef(t=>[...t,{id:Date.now(),position:s.clone(),direction:r.clone(),power:e,startTime:Date.now(),maxDistance:80,startPosition:s.clone()}]),ei(!1),eu(0),eh.current=null,f(u,"e")},[u,y,ef,f,ek]),{startFirebeam:eD,stopFirebeam:eF}=et({parentRef:y,onHit:l,enemyData:g,setActiveEffects:eM,charges:ex,setCharges:eg,setDamageNumbers:K,nextDamageNumberId:X}),ez=(0,s.useRef)(null),eq=(0,s.useCallback)(e=>{j&&j(e)},[j]),{activateOathstrike:eB}=ec({parentRef:y,onHit:l,charges:ex,setCharges:eg,enemyData:g,onHealthChange:eq,setDamageNumbers:K,nextDamageNumberId:X,currentHealth:h,maxHealth:d});!function(e){let{keys:t,groupRef:n,currentWeapon:r,abilities:a,isSwinging:l,isSmiting:c,isBowCharging:u,bowChargeProgress:h,nextSmiteId:d,setIsSwinging:m,setIsSmiting:p,setIsBowCharging:f,setBowChargeStartTime:x,setSmiteEffects:g,setActiveEffects:j,onAbilityUse:y,shootFireball:v,releaseBowShot:M,startFirebeam:P,stopFirebeam:w,castReanimate:S,health:I,maxHealth:C,onHealthChange:b,activateOathstrike:E,setIsOathstriking:R}=e,_=(0,s.useRef)(0),k=(0,s.useRef)(!1);(0,s.useEffect)(()=>{I<=0?k.current=!0:k.current=!1},[I]),(0,s.useEffect)(()=>{let e=e=>{if(k.current)return;let s=e.key.toLowerCase();if(!(s in t.current)||!t.current[s]){if(s in t.current&&(t.current[s]=!0),"q"===s&&a[r].q.currentCooldown<=0&&!l&&(_.current=Date.now(),m(!0),y(r,"q")),"e"===s&&a[r].e.currentCooldown<=0){if(r!==i.SWORD||c)(r===i.SABRES2||r===i.STAFF)&&P&&w?(P(),y(r,"e")):r!==i.SABRES||u?r===i.SCYTHE&&(v(),y(r,"e")):(f(!0),x(Date.now()));else{if(Date.now()-_.current<625){console.log("Cannot use Smite so soon after a normal attack");return}p(!0),m(!0);let e=n.current.position.clone();e.add(new o.Pq0(0,0,3.5).applyQuaternion(n.current.quaternion)),g(t=>[...t,{id:d.current++,position:e}]),y(r,"e")}}if("1"===s&&a[r].passive.isUnlocked&&(r===i.SCYTHE?S():r===i.SABRES&&P&&w&&(P(),y(r,"passive"))),"r"===s){let e=a[r].r;if(e.isUnlocked&&e.currentCooldown<=0)switch(r){case i.SWORD:let t=E();t&&(R(!0),j(e=>[...e,{id:Math.random(),type:"oathstrike",position:t.position,direction:t.direction}]),y(r,"r"));break;case i.SABRES:case i.SABRES2:j(e=>[...e,{id:Math.random(),type:"blizzard",position:n.current.position.clone(),direction:new o.Pq0(0,0,0)}]),y(r,"r");break;case i.SCYTHE:j(e=>[...e,{id:Math.random(),type:"boneclaw",position:n.current.position.clone(),direction:new o.Pq0(0,0,1).applyQuaternion(n.current.quaternion)}]),y(r,"r")}}}},s=e=>{if(k.current)return;let n=e.key.toLowerCase();n in t.current&&(t.current[n]=!1),"e"===n&&u&&M(h)};return window.addEventListener("keydown",e),window.addEventListener("keyup",s),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",s)}},[t,n,r,a,l,c,u,h,m,p,f,g,j,y,v,M,d,x,P,w,S,I,C,b,R,E]),(0,s.useEffect)(()=>{let e=e=>{k.current||0!==e.button||(t.current.mouse0=!0)},n=e=>{k.current||0!==e.button||(t.current.mouse0=!1)};return window.addEventListener("mousedown",e),window.addEventListener("mouseup",n),()=>{window.removeEventListener("mousedown",e),window.removeEventListener("mouseup",n)}},[t]),(0,s.useEffect)(()=>{let e=setInterval(()=>{!k.current&&t.current&&(t.current.mouse0||t.current.q)&&a[r].q.currentCooldown<=0&&!l&&(_.current=Date.now(),m(!0),y(r,"q"))},50);return()=>clearInterval(e)},[m,t,a,r,l,y]),(0,s.useEffect)(()=>{let e=()=>{k.current=!0},t=()=>{k.current=!1};return window.addEventListener("gameOver",e),window.addEventListener("gameReset",t),()=>{window.removeEventListener("gameOver",e),window.removeEventListener("gameReset",t)}},[])}({keys:_,groupRef:y,currentWeapon:u,abilities:p,isSwinging:M,isSmiting:D,isBowCharging:es,bowChargeProgress:el,nextSmiteId:Y,setIsSwinging:P,setIsSmiting:A,setIsBowCharging:ei,setBowChargeStartTime:e=>{eh.current=e},setSmiteEffects:Q,setActiveEffects:eM,onAbilityUse:f,shootFireball:eb,releaseBowShot:eG,startFirebeam:eD,stopFirebeam:eF,castReanimate:()=>{var e;null===(e=ez.current)||void 0===e||e.castReanimate()},reanimateRef:ez,health:h,maxHealth:d,onHealthChange:j,activateOathstrike:eB,setIsOathstriking:ew});let eA=e=>{Q(t=>t.filter(t=>t.id!==e))},eL=e=>{K(t=>t.filter(t=>t.id!==e))};(0,s.useEffect)(()=>{u===i.SABRES&&en({})},[u]);let eO=(e,t,n,r)=>{if(!t.startsWith("enemy"))return;let s=g.find(e=>e.id===t);if(!s)return;let i="".concat(e,"_").concat(t);if(J[i])return;let a=new o.Pq0(r.x,0,r.z),c=new o.Pq0(s.position.x,0,s.position.z);if(a.distanceTo(c)>1.4)return;en(e=>({...e,[i]:1}));let u=Math.floor(11+n*n*76)+(n>=.99?20:0);l(t,u),s.health-u>0&&K(e=>[...e,{id:X.current++,damage:u,position:s.position.clone(),isCritical:n>=.99}])},eN=(e,t,n)=>{if(!t.startsWith("enemy"))return;let r=g.find(e=>e.id===t);if(!r)return;let{damage:s,isCritical:i}=U(59);l(t,s),r.health-s>0&&K(e=>[...e,{id:X.current++,damage:s,position:r.position.clone(),isCritical:i}]),n&&eM(e=>[...e,{id:Date.now(),type:"fireballExplosion",position:n,direction:new o.Pq0,duration:.125,startTime:Date.now()}]),eE(e)};return(0,v.F)(()=>{y.current&&x(y.current.position.clone())}),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("group",{ref:y,position:[0,1,0],children:[(0,r.jsxs)("mesh",{scale:1.1,children:[(0,r.jsx)("sphereGeometry",{args:[.35,32,32]}),(0,r.jsx)("meshBasicMaterial",{color:"#EAC4D5",transparent:!0,opacity:.1,depthWrite:!1})]}),(0,r.jsxs)("mesh",{position:[0,.2,.25],scale:.35,children:[(0,r.jsx)("sphereGeometry",{args:[.25,32,32]}),(0,r.jsx)("meshPhongMaterial",{color:"#EAC4D5",transparent:!0,opacity:.3,emissive:"#EAC4D5",emissiveIntensity:.1})]}),(0,r.jsxs)("group",{position:[0,.2,-.2],children:[(0,r.jsx)("group",{rotation:[0,Math.PI/5.5,0],children:(0,r.jsx)(B,{collectedBones:ej,isLeftWing:!0,parentRef:y})}),(0,r.jsx)("group",{rotation:[0,-Math.PI/5.5,0],children:(0,r.jsx)(B,{collectedBones:ej,isLeftWing:!1,parentRef:y})})]}),(0,r.jsx)(ee,{parentRef:y,charges:ex,weaponType:u}),(0,r.jsx)("group",{scale:[1,.85,1],position:[0,0,-.1],children:(0,r.jsx)(O,{})}),(0,r.jsx)(N,{}),u===i.SABRES?(0,r.jsx)(k,{isSwinging:M,onSwingComplete:e_,onLeftSwingStart:()=>{},onRightSwingStart:()=>{},isBowCharging:es}):u===i.SCYTHE?(0,r.jsx)(E,{parentRef:y,isSwinging:M,onSwingComplete:e_}):(0,r.jsx)(R,{isSwinging:M,isSmiting:D,isOathstriking:eP,onSwingComplete:e_,onSmiteComplete:()=>{A(!1),P(!1),en({})},onOathstrikeComplete:()=>{ew(!1),P(!1),en({})}}),!m&&(0,r.jsxs)(z,{position:[0,2,0],lockX:!1,lockY:!1,lockZ:!1,children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("planeGeometry",{args:[1,.1]}),(0,r.jsx)("meshBasicMaterial",{color:"#333333"})]}),(0,r.jsx)("mesh",{position:[.5+h/d*.5,0,.001],children:(0,r.jsx)("planeGeometry",{args:[h/d,.08]})})]})]}),(0,r.jsx)(q,{parentRef:y,weaponType:u}),w.map(e=>(0,r.jsx)(b,{position:e.position,direction:e.direction,onImpact:t=>eE(e.id,t)},e.id)),H.map(e=>(0,r.jsx)(G,{weaponType:u,position:e.position,onComplete:()=>eA(e.id)},e.id)),Z.map(e=>(0,r.jsx)(F,{damage:e.damage,position:e.position,isCritical:e.isCritical,isLightning:e.isLightning,isHealing:e.isHealing,isBlizzard:e.isBlizzard,isBoneclaw:e.isBoneclaw,isOathstrike:e.isOathstrike,isFirebeam:e.isFirebeam,onComplete:()=>eL(e.id)},e.id)),u===i.SABRES&&es&&(0,r.jsx)(T,{position:(null===(t=y.current)||void 0===t?void 0:t.position.clone().add(new o.Pq0(0,.8,0)))||new o.Pq0,direction:new o.Pq0(0,0,1).applyQuaternion((null===(n=y.current)||void 0===n?void 0:n.quaternion)||new o.PTz),chargeProgress:el,isCharging:es,onRelease:eG}),ep.map(e=>(0,r.jsxs)("group",{children:[(0,r.jsxs)("group",{position:e.position.toArray(),rotation:[0,Math.atan2(e.direction.x,e.direction.z),0],children:[(0,r.jsxs)("mesh",{rotation:[Math.PI/2,0,0],children:[(0,r.jsx)("cylinderGeometry",{args:[.03,.125,2.1,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#00ffff",emissive:"#00ffff",emissiveIntensity:1,transparent:!0,opacity:1})]}),[void 0,void 0,void 0,void 0,void 0].map((e,t)=>(0,r.jsxs)("mesh",{position:[0,0,-(.45*t)+.5],rotation:[Math.PI,0,.003*Date.now()+t*Math.PI/3],children:[(0,r.jsx)("torusGeometry",{args:[.125+.04*t,.05,8,16]}),(0,r.jsx)("meshStandardMaterial",{color:"#00ffff",emissive:"#00ffff",emissiveIntensity:3,transparent:!0,opacity:.9-.125*t,blending:o.EZo})]},"ring-".concat(t))),(0,r.jsx)("pointLight",{color:"#00ffff",intensity:3,distance:4,decay:2}),(0,r.jsx)("pointLight",{color:"#80ffff",intensity:1.7,distance:6,decay:1})]}),e.power>=1&&e.position.distanceTo(e.startPosition)<e.maxDistance&&!e.hasCollided&&(0,r.jsxs)("group",{position:e.position.toArray(),rotation:[0,Math.atan2(e.direction.x,e.direction.z),0],children:[(0,r.jsxs)("mesh",{rotation:[Math.PI/2,0,0],children:[(0,r.jsx)("cylinderGeometry",{args:[.15,.35,2,6]}),(0,r.jsx)("meshStandardMaterial",{color:"#EAC4D5",emissive:"#EAC4D5",emissiveIntensity:1.5,transparent:!0,opacity:.7})]}),[...Array(8)].map((e,t)=>{let n=t/8*Math.PI*2;return(0,r.jsx)("group",{position:[.4*Math.sin(n+.003*Date.now()),.4*Math.cos(n+.003*Date.now()),-1.4],children:(0,r.jsxs)("mesh",{children:[(0,r.jsx)("sphereGeometry",{args:[.125,4,4]}),(0,r.jsx)("meshStandardMaterial",{color:"#00ffff",emissive:"#00ffff",emissiveIntensity:1,transparent:!0,opacity:.5,blending:o.EZo})]})},"ghost-trail-".concat(t))}),[...Array(8)].map((e,t)=>{let n=t/8*Math.PI*2;return(0,r.jsx)("group",{position:[.4*Math.sin(n+.003*Date.now()),.4*Math.cos(n+.003*Date.now()),-2],children:(0,r.jsxs)("mesh",{children:[(0,r.jsx)("sphereGeometry",{args:[.125,4,4]}),(0,r.jsx)("meshStandardMaterial",{color:"#00ffff",emissive:"#00ffff",emissiveIntensity:1,transparent:!0,opacity:.4,blending:o.EZo})]})},"ghost-trail-".concat(t))}),[...Array(12)].map((e,t)=>(0,r.jsx)("group",{position:[0,0,-(.3*t)-1.5],rotation:[0,.001*Date.now()+t,0],children:(0,r.jsxs)("mesh",{scale:1-.015*t,children:[(0,r.jsx)("torusGeometry",{args:[.4,.1,3,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#00ffff",emissive:"#00ffff",emissiveIntensity:1,transparent:!0,opacity:.3,blending:o.EZo})]})},"wisp-".concat(t))),(0,r.jsx)("pointLight",{color:"#EAC4D5",intensity:3,distance:4,decay:2}),(0,r.jsx)("pointLight",{color:"#ffffff",intensity:1,distance:6,decay:1})]})]},e.id)),(0,r.jsx)(W,{parentRef:y,weaponType:u}),(0,r.jsx)(L,{parentRef:y}),ev.map(e=>"boneclaw"===e.type?(0,r.jsx)(V,{position:e.position,direction:e.direction,parentRef:y,enemyData:g,onComplete:()=>{eM(t=>t.filter(t=>t.id!==e.id))},onHitTarget:(e,t,n,r,s)=>{l(e,t),K(e=>[...e,{id:X.current++,damage:t,position:r.clone(),isCritical:n,isBoneclaw:s}])}},e.id):"blizzard"===e.type?(0,r.jsx)($,{position:e.position,enemyData:g,parentRef:y,onHitTarget:(e,t,n,r,s)=>{l(e,t),K(e=>[...e,{id:X.current++,damage:t,position:r.clone(),isCritical:n,isBlizzard:s}])},onComplete:()=>{eM(t=>t.filter(t=>t.id!==e.id))}},e.id):"firebeam"===e.type?(0,r.jsx)(er,{position:e.position,direction:e.direction,onComplete:()=>{eM(t=>t.filter(t=>t.id!==e.id))}},e.id):"oathstrike"===e.type?(0,r.jsx)(ea,{position:e.position,direction:e.direction,onComplete:()=>{eM(t=>t.filter(t=>t.id!==e.id))},parentRef:y},e.id):null),(0,r.jsx)(eo,{ref:ez,parentRef:y,onHealthChange:eq,charges:ex,setCharges:eg,setDamageNumbers:K,nextDamageNumberId:X,currentHealth:h,maxHealth:d}),u===i.SWORD&&p[i.SWORD].passive.isUnlocked&&(0,r.jsx)(ed,{ref:eC,parentRef:y,onHealthChange:eq,setDamageNumbers:K,nextDamageNumberId:X,currentHealth:h,maxHealth:d}),ev.map(e=>{if("fireballExplosion"===e.type){let t=e.startTime?(Date.now()-e.startTime)/1e3:0,n=Math.max(0,1-t/(e.duration||.125));return(0,r.jsxs)("group",{position:e.position,children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("sphereGeometry",{args:[.3*(1+2*t),32,32]}),(0,r.jsx)("meshStandardMaterial",{color:"#00ff44",emissive:"#33ff66",emissiveIntensity:2*n,transparent:!0,opacity:.8*n,depthWrite:!1,blending:o.EZo})]}),(0,r.jsxs)("mesh",{children:[(0,r.jsx)("sphereGeometry",{args:[.2*(1+3*t),24,24]}),(0,r.jsx)("meshStandardMaterial",{color:"#66ff88",emissive:"#ffffff",emissiveIntensity:3*n,transparent:!0,opacity:.9*n,depthWrite:!1,blending:o.EZo})]}),[.4,.6,.8,1].map((e,s)=>(0,r.jsxs)("mesh",{rotation:[Math.random()*Math.PI,Math.random()*Math.PI,Math.random()*Math.PI],children:[(0,r.jsx)("torusGeometry",{args:[e*(1+3*t),.045,16,32]}),(0,r.jsx)("meshStandardMaterial",{color:"#00ff44",emissive:"#33ff66",emissiveIntensity:.8*n,transparent:!0,opacity:.5*n*(1-.2*s),depthWrite:!1,blending:o.EZo})]},s)),[...Array(8)].map((e,s)=>{let i=s/8*Math.PI*2,a=.5*(1+2*t);return(0,r.jsxs)("mesh",{position:[Math.sin(i)*a,Math.cos(i)*a,0],children:[(0,r.jsx)("sphereGeometry",{args:[.05,8,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#66ff88",emissive:"#ffffff",emissiveIntensity:2*n,transparent:!0,opacity:.8*n,depthWrite:!1,blending:o.EZo})]},"spark-".concat(s))}),(0,r.jsx)("pointLight",{color:"#00ff44",intensity:2*n,distance:4,decay:2}),(0,r.jsx)("pointLight",{color:"#66ff88",intensity:1*n,distance:6,decay:1})]},e.id)}return null})]})}ed.displayName="CrusaderAura";var ep=n(2433);function ef(){let e=(e,t)=>(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[t,.8*t,e,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),t=e=>(0,r.jsxs)("mesh",{children:[(0,r.jsx)("sphereGeometry",{args:[e,8,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),n=(n,s)=>(0,r.jsxs)("group",{children:[(0,r.jsx)("group",{position:[s/2,0,0],children:e(n,.04)}),(0,r.jsx)("group",{position:[-s/2,0,0],children:e(n,.04)}),(0,r.jsx)("group",{position:[0,n/2,0],children:t(.06)}),(0,r.jsx)("group",{position:[0,-n/2,0],children:t(.06)})]});return(0,r.jsx)("group",{children:(0,r.jsxs)("group",{children:[n(.65,.05),(0,r.jsxs)("group",{position:[0,-.35,0],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("sphereGeometry",{args:[.08,12,12]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,r.jsxs)("group",{position:[0,-.15,0],children:[n(.7,.06),(0,r.jsxs)("group",{position:[0,-.25,0],rotation:[Math.PI/2,0,0],children:[t(.06),(0,r.jsxs)("group",{position:[0,-.015,.1],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("boxGeometry",{args:[.15,.02,.4]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),[-.05,0,.05].map((e,t)=>(0,r.jsx)("group",{position:[e,.15,.25],rotation:[-Math.PI,0,0],children:(0,r.jsxs)("group",{children:[n(.15,.02),(0,r.jsx)("group",{position:[0,-.1,0],rotation:[Math.PI/6,0,0],children:(0,r.jsxs)("mesh",{children:[(0,r.jsx)("coneGeometry",{args:[.02,.15,6]}),(0,r.jsx)("meshStandardMaterial",{color:"#d4d4d4",roughness:.3,metalness:.4})]})})]})},t))]})]})]})]})]})})}function ex(e){let{isLeftHand:t=!1}=e,n=(e,t)=>(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[t,.8*t,e,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),s=e=>(0,r.jsxs)("mesh",{children:[(0,r.jsx)("sphereGeometry",{args:[e,8,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),o=(e,t)=>(0,r.jsxs)("group",{children:[(0,r.jsx)("group",{position:[t/2,0,0],children:n(e,.06)}),(0,r.jsx)("group",{position:[-t/2,0,0],children:n(e,.06)}),(0,r.jsx)("group",{position:[0,e/2,0],children:s(.08)}),(0,r.jsx)("group",{position:[0,-e/2,0],children:s(.08)})]});return(0,r.jsx)("group",{children:(0,r.jsxs)("group",{children:[o(1.3,.15),(0,r.jsxs)("group",{position:[.25,-.85,.21],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("sphereGeometry",{args:[.12,12,12]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,r.jsxs)("group",{rotation:[-.7,-0,Math.PI/5],children:[o(.8,.12),(0,r.jsxs)("group",{position:[0,-.5,0],rotation:[0,0,Math.PI/5.5],children:[s(.09),(0,r.jsxs)("group",{position:[0,-.1,0],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("boxGeometry",{args:[.2,.15,.08]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4})]}),[-.08,-.04,0,.04,.08].map((e,t)=>(0,r.jsxs)("group",{position:[e,-.1,0],rotation:[0,0,(t-2)*Math.PI/10],children:[n(.5,.02),(0,r.jsx)("group",{position:[.025,-.3,0],rotation:[0,0,Math.PI+Math.PI/16],children:(0,r.jsxs)("mesh",{children:[(0,r.jsx)("coneGeometry",{args:[.03,.3,6]}),(0,r.jsx)("meshStandardMaterial",{color:"#d4d4d4",roughness:.3,metalness:.4})]})})]},t)),!t&&(0,r.jsx)("group",{position:[0,-.2,.3],rotation:[Math.PI/2,0,0],scale:[.8,.8,.8],children:(0,r.jsx)(eg,{})})]})]})]})]})]})})}function eg(){let e={color:"#ff0000",emissive:"#660000",emissiveIntensity:.5,roughness:.4,metalness:.6};return(0,r.jsxs)("group",{rotation:[0,-1.05,-Math.PI/2.5],position:[.3,-.1,.75],children:[(0,r.jsxs)("mesh",{position:[0,0,0],children:[(0,r.jsx)("cylinderGeometry",{args:[.125,.125,3.35,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#8b0000",roughness:.4,metalness:.3})]}),(0,r.jsxs)("mesh",{position:[0,-.25,0],rotation:[Math.PI/2,-Math.PI/2,Math.PI/2],children:[(0,r.jsx)("cylinderGeometry",{args:[.3,.3,.125]}),(0,r.jsx)("meshStandardMaterial",{color:"#a00000",roughness:.4,metalness:.5})]}),(0,r.jsxs)("mesh",{position:[0,1,0],children:[(0,r.jsx)("cylinderGeometry",{args:[.325,.125,2.9,4]}),(0,r.jsx)("meshStandardMaterial",{...e})]}),(0,r.jsxs)("mesh",{position:[0,3.45,0],children:[(0,r.jsx)("coneGeometry",{args:[.325,2,4]}),(0,r.jsx)("meshStandardMaterial",{...e})]}),(0,r.jsx)("pointLight",{color:"#ff0000",intensity:.5,distance:2,decay:2})]})}function ej(){return(0,r.jsxs)("group",{children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[.125,.2,.3,6,1,!1,0,2*Math.PI]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),[0,.2,.1].map((e,t)=>(0,r.jsx)("group",{position:[0,.25,e-.1],rotation:[0,0,0],children:(0,r.jsxs)("mesh",{children:[(0,r.jsx)("coneGeometry",{args:[.04,.225,5]}),(0,r.jsx)("meshStandardMaterial",{color:"#d4d4d4",roughness:.3,metalness:.4})]})},t))]})}function ey(e){let{position:t,isAttacking:n,isWalking:o,onHit:i}=e,a=(0,s.useRef)(null),[l,c]=(0,s.useState)(0),[u,h]=(0,s.useState)(0),d=(0,s.useRef)();return(0,v.F)((e,r)=>{if(a.current){if(o){c(e=>(e+4*r)%(2*Math.PI));let e=Math.abs(.1*Math.sin(l));a.current&&(a.current.position.y=t[1]-e),["LeftLeg","RightLeg"].forEach(e=>{var t,n;let r=null===(t=a.current)||void 0===t?void 0:t.getObjectByName(e);if(r){let t=e.includes("Right")?l:l+Math.PI,s=.3*Math.sin(t);r.rotation.x=s;let o=null===(n=r.children[0])||void 0===n?void 0:n.children[1];if(o){let e=Math.max(0,Math.sin(t+Math.PI/4));o.rotation.x=.2+.8*e;let n=.1*Math.sin(t);o.rotation.y=n}let i=.05*Math.sin(t);r.rotation.y=i}}),["LeftArm","RightArm"].forEach(e=>{var t;let n=null===(t=a.current)||void 0===t?void 0:t.getObjectByName(e);if(n){let t=.1*Math.sin(e.includes("Right")?l+Math.PI:l);n.rotation.x=t}})}if(n){h(e=>e+3*r);let e=Math.sin(Math.min(u,Math.PI/2))*Math.PI,t=a.current.getObjectByName("RightArm");t&&(t.rotation.x=-e),u>Math.PI/4&&i&&!d.current&&(d.current=setTimeout(()=>{d.current=void 0},0)),u>Math.PI/2&&h(0)}else d.current&&(clearTimeout(d.current),d.current=void 0)}}),(0,s.useEffect)(()=>()=>{d.current&&clearTimeout(d.current)},[]),(0,r.jsxs)("group",{ref:a,position:[t[0],t[1]+1,t[2]],children:[(0,r.jsxs)("group",{name:"Body",position:[0,1.2,0],scale:.85,children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[.08,.08,1.4,6]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),[-.5,-.25,0,.25,.5].map((e,t)=>(0,r.jsxs)("group",{position:[0,e,0],children:[(0,r.jsx)("group",{rotation:[0,0,-Math.PI/3.5],children:(0,r.jsxs)("mesh",{position:[.1,0,0],rotation:[1,Math.PI/2,0],children:[(0,r.jsx)("torusGeometry",{args:[.22,.015,8,12,1*Math.PI]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]})}),(0,r.jsx)("group",{rotation:[0,0,Math.PI/3.5],children:(0,r.jsxs)("mesh",{position:[-.1,0,0],rotation:[0,-Math.PI/2,0],children:[(0,r.jsx)("torusGeometry",{args:[.22,.015,8,12,1*Math.PI]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]})})]},t))]}),(0,r.jsxs)("group",{name:"Head",position:[0,2,0],children:[(0,r.jsxs)("group",{children:[(0,r.jsxs)("mesh",{position:[0,0,-.05],children:[(0,r.jsx)("sphereGeometry",{args:[.22,8,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,r.jsxs)("mesh",{position:[0,-.02,.12],children:[(0,r.jsx)("boxGeometry",{args:[.28,.28,.1]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,r.jsxs)("group",{children:[(0,r.jsxs)("mesh",{position:[.12,-.08,.1],children:[(0,r.jsx)("boxGeometry",{args:[.08,.12,.15]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,r.jsxs)("mesh",{position:[-.12,-.08,.1],children:[(0,r.jsx)("boxGeometry",{args:[.08,.12,.15]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]})]}),(0,r.jsx)("group",{position:[0,-.15,.05],children:(0,r.jsxs)("mesh",{position:[0,-.08,.08],rotation:[0,Math.PI/5,0],children:[(0,r.jsx)("cylinderGeometry",{args:[.08,.08,.2,5]}),(0,r.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]})}),(0,r.jsx)("group",{position:[.025,-.25,.2175],children:[-.03,-.06,-.09,-0,.03].map((e,t)=>(0,r.jsx)("group",{position:[e,0,0],rotation:[.5,0,0],children:(0,r.jsxs)("mesh",{children:[(0,r.jsx)("coneGeometry",{args:[.02,.075,3]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.3,metalness:.4})]})},t))}),(0,r.jsx)("group",{position:[0,-.18,.2],children:[-.06,-.02,.02,.06].map((e,t)=>(0,r.jsx)("group",{position:[e,0,0],rotation:[2.5,0,0],children:(0,r.jsxs)("mesh",{children:[(0,r.jsx)("coneGeometry",{args:[.01,.08,3]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.3,metalness:.4})]})},t))})]}),(0,r.jsxs)("group",{position:[0,.05,.14],children:[(0,r.jsxs)("group",{position:[-.07,0,0],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("sphereGeometry",{args:[.02,8,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#000000",emissive:"#ff0000",emissiveIntensity:3})]}),(0,r.jsxs)("mesh",{scale:1.2,children:[(0,r.jsx)("sphereGeometry",{args:[.035,8,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#ff0000",emissive:"#ff0000",emissiveIntensity:1,transparent:!0,opacity:.75})]}),(0,r.jsxs)("mesh",{scale:1.4,children:[(0,r.jsx)("sphereGeometry",{args:[.05,6.5,2]}),(0,r.jsx)("meshStandardMaterial",{color:"#ff0000",emissive:"#ff0000",emissiveIntensity:1,transparent:!0,opacity:.7})]}),(0,r.jsx)("pointLight",{color:"#ff0000",intensity:.5,distance:1,decay:2})]}),(0,r.jsxs)("group",{position:[.07,0,0],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("sphereGeometry",{args:[.02,8,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#000000",emissive:"#ff0000",emissiveIntensity:3})]}),(0,r.jsxs)("mesh",{scale:1.2,children:[(0,r.jsx)("sphereGeometry",{args:[.035,8,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#ff0000",emissive:"#ff0000",emissiveIntensity:1,transparent:!0,opacity:.75})]}),(0,r.jsxs)("mesh",{scale:1.4,children:[(0,r.jsx)("sphereGeometry",{args:[.05,6.5,2]}),(0,r.jsx)("meshStandardMaterial",{color:"#ff0000",emissive:"#ff0000",emissiveIntensity:1,transparent:!0,opacity:.7})]}),(0,r.jsx)("pointLight",{color:"#ff0000",intensity:.5,distance:1,decay:2})]})]})]}),(0,r.jsx)("group",{position:[-.35,1.6,0],rotation:[-.35,-Math.PI-.4,-.35],children:(0,r.jsx)(ej,{})}),(0,r.jsx)("group",{position:[.35,1.6,0],rotation:[-.35,Math.PI-.4,.35],children:(0,r.jsx)(ej,{})}),(0,r.jsx)("group",{name:"LeftArm",position:[-.35,1.525,0],scale:[-.4,.4,.4],rotation:[0,Math.PI/2,0],children:(0,r.jsx)(ex,{isLeftHand:!0})}),(0,r.jsx)("group",{name:"RightArm",position:[.35,1.525,.1],scale:[.4,.4,.4],rotation:[0,-Math.PI/2.5,0],children:(0,r.jsx)(ex,{isLeftHand:!1})}),(0,r.jsxs)("group",{position:[0,.7,0],children:[" ",(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[.26,.25,.15,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]})]}),(0,r.jsx)("group",{name:"LeftLeg",position:[.2,.3,0],children:(0,r.jsx)(ef,{})}),(0,r.jsx)("group",{name:"RightLeg",position:[-.2,.3,0],children:(0,r.jsx)(ef,{})}),(0,r.jsx)("group",{position:[0,1.8,0],children:(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[.04,.04,.2,6]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]})})]})}let ev=()=>(0,r.jsx)("group",{children:(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[.03,.015,.3,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#99ccff",transparent:!0,opacity:.5,emissive:"#66b3ff",emissiveIntensity:.75})]})});function eM(e){let{position:t,onComplete:n,isSpawning:o=!1}=e,i=(0,s.useRef)([]),a=(0,s.useRef)(null),l=(0,s.useRef)(Date.now());return(0,v.F)(()=>{if(!a.current)return;let e=Date.now()-l.current,r=Math.min(e/1500,1),s=o?1-r:r;a.current.position.copy(t),i.current.forEach((t,n)=>{let r=Math.floor(n/8)/14,o=1.3*r*(s<.5?2*s:2-2*s),i=n%8/8*Math.PI*2+.006*(1+3*r)*e,a=Math.cos(i+2*r)*o,l=Math.sin(i+2*r)*o,c=(1-r)*2.8*(1+.1*Math.sin(.002*e));t.position.set(a,c,l),t.rotation.y=i+Math.PI/2,t.rotation.z=Math.PI/2+.8*r,t.rotation.x=.2*Math.sin(.004*e+n);let u=t.material;u.opacity=Math.max(0,.7-.4*r-(s>.7?(s-.7)*3:0)),u.emissiveIntensity=.5+.3*Math.sin(.004*e+n);let h=1+.2*Math.sin(.003*e+.5*n);t.scale.set(h,h,h)}),1===r&&n&&n()}),(0,r.jsx)("group",{ref:a,children:Array.from({length:120}).map((e,t)=>(0,r.jsx)("mesh",{ref:e=>{e&&(i.current[t]=e)},children:ev()},t))})}function eP(e){let{id:t,initialPosition:n,position:i,health:a,maxHealth:l,onTakeDamage:c,onPositionUpdate:u,playerPosition:h,onAttackPlayer:d}=e,m=(0,s.useRef)(null),p=(0,s.useRef)(Date.now()+2e3),[f,x]=(0,s.useState)(!1),[g,j]=(0,s.useState)(!1),[y,M]=(0,s.useState)(!1),[P,w]=(0,s.useState)(!0),[S,I]=(0,s.useState)(!1),C=(0,s.useRef)(n.clone()),b=(0,s.useRef)(n.clone()),E=(0,s.useRef)(Date.now()),R=(0,s.useRef)(a);(0,s.useEffect)(()=>{R.current=a},[a]);let _=(0,s.useCallback)(e=>{if(R.current<=0)return;let n=Math.max(0,R.current-e);c("enemy-".concat(t),e),0===n&&R.current>0&&(M(!0),j(!0))},[t,c]);return(0,s.useEffect)(()=>{i&&(C.current.copy(i),b.current.copy(i),m.current&&m.current.position.copy(i))},[i]),(0,v.F)((e,n)=>{if(!m.current||R.current<=0||!h){I(!1);return}let r=C.current.distanceTo(h);if(r>2&&R.current>0){x(!1),I(!0);let e=new o.Pq0().subVectors(h,C.current).normalize().multiplyScalar(.1475*n*60);b.current.copy(C.current).add(e),C.current.lerp(b.current,.1475),m.current.position.copy(C.current);let r=new o.Pq0().copy(h).setY(C.current.y);m.current.lookAt(r);let s=Date.now();s-E.current>=50&&C.current.distanceTo(i)>.1&&(u(t,C.current.clone()),E.current=s)}else I(!1),b.current.copy(C.current);if(r<=2&&R.current>0){let e=Date.now();if(e-p.current>=2e3){x(!0);let t=C.current.clone();setTimeout(()=>{let e=C.current.distanceTo(h);R.current>0&&e<=2&&.5>t.distanceTo(C.current)&&d(6)},1e3),p.current=e,setTimeout(()=>{x(!1)},500)}}}),(0,s.useEffect)(()=>{0!==a||y||(M(!0),j(!0))},[a,y]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("group",{ref:m,visible:!P&&R.current>0,position:C.current,onClick:e=>{e.stopPropagation()},children:[(0,r.jsx)(ey,{position:[0,0,0],isAttacking:f,isWalking:S&&R.current>0,onHit:_}),(0,r.jsx)(ep.Q,{position:[0,3.5,0],follow:!0,lockX:!1,lockY:!1,lockZ:!1,children:R.current>0&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("mesh",{position:[0,0,0],children:[(0,r.jsx)("planeGeometry",{args:[2,.25]}),(0,r.jsx)("meshBasicMaterial",{color:"#333333",opacity:.8,transparent:!0})]}),(0,r.jsxs)("mesh",{position:[-1+R.current/l,0,.001],children:[(0,r.jsx)("planeGeometry",{args:[R.current/l*2,.23]}),(0,r.jsx)("meshBasicMaterial",{color:"#ff3333",opacity:.9,transparent:!0})]}),(0,r.jsx)(D.E,{position:[0,0,.002],fontSize:.2,color:"#ffffff",anchorX:"center",anchorY:"middle",fontWeight:"bold",children:"".concat(Math.ceil(R.current),"/").concat(l)})]})})]}),P&&(0,r.jsx)(eM,{position:C.current,onComplete:()=>{w(!1)},isSpawning:!0}),g&&(0,r.jsx)(eM,{position:C.current,onComplete:()=>{j(!1)},isSpawning:!1})]})}let ew=()=>{let e=(0,v.H)(o.Tap,"/textures/ring-alpha.jpg"),t=(0,s.useRef)(null);return(0,s.useEffect)(()=>{let e=setInterval(()=>{t.current&&(t.current.rotation.z+=1e-4)},16);return()=>clearInterval(e)},[]),(0,r.jsxs)("group",{position:[100,80,-150],scale:[28,28,28],rotation:[1,.1,.1],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("sphereGeometry",{args:[1,32,32]}),(0,r.jsx)("meshStandardMaterial",{color:"#B8E0D2",roughness:.7,metalness:.2,emissive:"#B8E0D2",emissiveIntensity:.675})]}),(0,r.jsxs)("mesh",{ref:t,rotation:[Math.PI/2.8,0,0],children:[(0,r.jsx)("ringGeometry",{args:[1.4,2.1,64]}),(0,r.jsx)("meshStandardMaterial",{map:e,color:"#A8DBFF",transparent:!0,opacity:1,side:o.$EB,alphaMap:e,roughness:.7,metalness:.2,emissive:"#77FFC0",emissiveIntensity:1.1})]}),(0,r.jsxs)("mesh",{scale:[1.05,1.05,1.05],children:[(0,r.jsx)("sphereGeometry",{args:[1,32,32]}),(0,r.jsx)("meshBasicMaterial",{color:"#4dff90",transparent:!0,opacity:.5})]}),(0,r.jsxs)("mesh",{scale:[1.1,1.1,1.1],children:[(0,r.jsx)("sphereGeometry",{args:[1,32,32]}),(0,r.jsx)("meshBasicMaterial",{color:"#4dff90",transparent:!0,opacity:.2,side:o.hsX})]})]})},eS={uniforms:{topColor:{value:new o.Q1f("#DD81A6")},middleColor:{value:new o.Q1f("#EDADC7")},bottomColor:{value:new o.Q1f("#FFDAB9")},offset:{value:33},exponent:{value:.6}},vertexShader:"\n    varying vec3 vWorldPosition;\n    \n    void main() {\n      vec4 worldPosition = modelMatrix * vec4(position, 1.0);\n      vWorldPosition = worldPosition.xyz;\n      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n    }\n  ",fragmentShader:"\n    uniform vec3 topColor;\n    uniform vec3 middleColor;\n    uniform vec3 bottomColor;\n    uniform float offset;\n    uniform float exponent;\n    \n    varying vec3 vWorldPosition;\n    \n    void main() {\n      float h = normalize(vWorldPosition + vec3(0.0, offset, 0.0)).y;\n      float mixStrength = max(pow(max(h, 0.0), exponent), 0.0);\n      vec3 color = mix(middleColor, topColor, mixStrength);\n      color = mix(bottomColor, color, smoothstep(0.0, 1.0, h));\n      gl_FragColor = vec4(color, 1.0);\n    }\n  "},eI=()=>{let e=(0,s.useMemo)(()=>({uniforms:eS.uniforms,vertexShader:eS.vertexShader,fragmentShader:eS.fragmentShader,side:o.hsX}),[]);return(0,r.jsxs)("mesh",{children:[(0,r.jsx)("sphereGeometry",{args:[500,32,32]}),(0,r.jsx)("shaderMaterial",{attach:"material",args:[e]})]})},eC=()=>{let e=document.createElement("canvas");e.width=308,e.height=308;let t=e.getContext("2d");if(t){t.clearRect(0,0,308,308);let e=t.createRadialGradient(154,154,0,154,154,154);e.addColorStop(0,"rgba(255, 255, 255, 0.6)"),e.addColorStop(.2,"rgba(255, 255, 255, 0.3)"),e.addColorStop(.5,"rgba(255, 255, 255, 0.1)"),e.addColorStop(.8,"rgba(255, 255, 255, 0.05)"),e.addColorStop(1,"rgba(255, 255, 255, 0)"),t.fillStyle=e,t.beginPath(),t.arc(154,154,154,0,2*Math.PI),t.fill()}let n=new o.gPd(e);return n.needsUpdate=!0,n},eb=e=>{let{count:t=2e3,radius:n=100}=e,i=(0,s.useMemo)(()=>eC(),[]),a=(0,s.useMemo)(()=>{let e=new Float32Array(3*t),r=new Float32Array(3*t),s=new Float32Array(t);for(let i=0;i<t;i++){let t=2*Math.PI*Math.random(),a=Math.acos(2*Math.random()-1),l=n*Math.cbrt(Math.random());e[3*i]=l*Math.sin(a)*Math.cos(t),e[3*i+1]=l*Math.sin(a)*Math.sin(t),e[3*i+2]=l*Math.cos(a);let c=new o.Q1f;c.setHSL(.33+.02*Math.random(),1,.8+.2*Math.random()),r[3*i]=.3*c.r,r[3*i+1]=1.5*c.g,r[3*i+2]=.3*c.b,s[i]=8*Math.random()+4}return{positions:e,colors:r,sizes:s}},[t,n]),l=s.useRef(null);return(0,v.F)(e=>{let{clock:t}=e;l.current&&(l.current.rotation.y=.05*t.getElapsedTime())}),(0,r.jsxs)("points",{ref:l,children:[(0,r.jsxs)("bufferGeometry",{children:[(0,r.jsx)("bufferAttribute",{attach:"attributes-position",count:t,array:a.positions,itemSize:3}),(0,r.jsx)("bufferAttribute",{attach:"attributes-color",count:t,array:a.colors,itemSize:3}),(0,r.jsx)("bufferAttribute",{attach:"attributes-size",count:t,array:a.sizes,itemSize:1,normalized:!0})]}),(0,r.jsx)("pointsMaterial",{size:1,vertexColors:!0,transparent:!0,opacity:.6,sizeAttenuation:!0,blending:o.EZo,depthWrite:!1,map:i})]})};function eE(e){let{mountainData:t,treeData:n,mushroomData:i,unitProps:{controlsRef:a,...l},onLevelComplete:c,spawnInterval:u=6e3,maxSkeletons:h=15,initialSkeletons:d=5}=e,[m,p]=(0,s.useState)(()=>Array.from({length:d},(e,t)=>{let n=x();return{id:"skeleton-".concat(t),position:n.clone(),initialPosition:n.clone(),health:200,maxHealth:200}})),[f,g]=(0,s.useState)(d),[j,y]=(0,s.useState)(l.health),v=(0,s.useRef)(null),[w,C]=(0,s.useState)(new o.Pq0(0,0,0)),b=(0,s.useCallback)((e,t)=>{console.log("Target ".concat(e," takes ").concat(t," damage")),p(n=>n.map(n=>{let r=e.replace("enemy-","");if(n.id===r){let e=Math.max(0,n.health-t);if(console.log("Enemy ".concat(r," health: ").concat(n.health," -> ").concat(e)),0===e&&n.health>0){var s;console.log("Enemy defeated, triggering onEnemyDeath"),null===(s=l.onEnemyDeath)||void 0===s||s.call(l)}return{...n,health:e}}return n}))},[l]),E=(0,s.useCallback)(e=>{var t;null===(t=l.onDamage)||void 0===t||t.call(l,e)},[l]),R=(0,s.useCallback)(e=>{C(e)},[]),_=(0,s.useCallback)((e,t)=>{p(n=>n.map(n=>n.id===e.replace("enemy-","")?{...n,position:t.clone()}:n))},[]),k={onHit:b,controlsRef:a,currentWeapon:l.currentWeapon,onWeaponSelect:l.onWeaponSelect,health:j,maxHealth:l.maxHealth,isPlayer:l.isPlayer,abilities:l.abilities,onAbilityUse:l.onAbilityUse,onPositionUpdate:R,onHealthChange:e=>{if("function"==typeof e)y(t=>{var n;let r=e(t);return null===(n=l.onHealthChange)||void 0===n||n.call(l,r),r});else{var t;y(e),null===(t=l.onHealthChange)||void 0===t||t.call(l,e)}},enemyData:m.map(e=>({id:"enemy-".concat(e.id),position:e.position,initialPosition:e.initialPosition,health:e.health,maxHealth:e.maxHealth})),onDamage:l.onDamage,onEnemyDeath:()=>{console.log("Kill counted in Scene")},onFireballDamage:l.onFireballDamage,fireballManagerRef:l.fireballManagerRef,onSmiteDamage:l.onSmiteDamage};return(0,s.useEffect)(()=>{if(f>=h)return;let e=setInterval(()=>{p(t=>{if(f>=h)return clearInterval(e),t;let n=x(),r={id:"skeleton-".concat(f),position:n.clone(),initialPosition:n.clone(),health:200,maxHealth:200};return g(e=>e+1),[...t,r]})},u);return()=>clearInterval(e)},[f,h,u]),(0,s.useEffect)(()=>{let e=m.every(e=>e.health<=0),t=f>=h;e&&t&&c()},[m,f,h,c]),(0,s.useEffect)(()=>{a.current&&(a.current.object.position.set(0,12,-18),a.current.target.set(0,0,0),a.current.update())},[a]),(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)("group",{children:[(0,r.jsx)(eb,{}),(0,r.jsx)(eI,{}),(0,r.jsx)(ew,{}),(0,r.jsx)(M,{color:"#FFAFC5",roughness:.5,metalness:.1}),t.map((e,t)=>(0,r.jsx)(P,{position:e.position,scale:e.scale},"mountain-".concat(t))),n.map((e,t)=>(0,r.jsx)(S,{position:e.position,scale:e.scale,trunkColor:e.trunkColor,leafColor:e.leafColor},"tree-".concat(t))),i.map((e,t)=>(0,r.jsx)(I,{position:e.position,scale:e.scale},"mushroom-".concat(t))),(0,r.jsx)("group",{ref:v,children:(0,r.jsx)(em,{...k})}),m.map(e=>(0,r.jsx)(eP,{id:e.id,initialPosition:e.initialPosition,position:e.position,health:e.health,maxHealth:e.maxHealth,onTakeDamage:b,onPositionUpdate:_,playerPosition:w,onAttackPlayer:E},e.id))]})})}let eR=()=>(0,r.jsxs)("group",{children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("boxGeometry",{args:[.055,.015,.015]}),(0,r.jsx)("meshStandardMaterial",{color:"#ff0000",transparent:!0,opacity:.35,emissive:"#ff0000",emissiveIntensity:.4})]}),(0,r.jsxs)("mesh",{children:[(0,r.jsx)("sphereGeometry",{args:[.032,6,6]}),(0,r.jsx)("meshStandardMaterial",{color:"#ff0000",emissive:"#ff0000",emissiveIntensity:.9,transparent:!0,opacity:.6})]})]});function e_(e){let{parentRef:t}=e,n=(0,s.useRef)([]),o=(0,s.useRef)(null);return(0,v.F)(e=>{let{clock:r}=e;if(!t.current||!o.current)return;let s=t.current.position;o.current.position.set(s.x,0,s.z),n.current.forEach((e,t)=>{if(!e)return;let n=r.getElapsedTime(),s=t/25*.65,o=t/25*Math.PI*4+2*n,i=.425*(1.1-1.5*s),a=Math.cos(o)*i,l=Math.sin(o)*i;e.position.set(a,s,l),e.rotation.y=o+Math.PI/2,e.rotation.x=Math.PI/6,e.rotation.z=.1*Math.sin(3*n+t);let c=e.children[0];c&&c.material&&(c.material.opacity=Math.max(.1,1-2*s))})}),(0,r.jsxs)("group",{ref:o,children:[Array.from({length:25}).map((e,t)=>(0,r.jsx)("group",{ref:e=>{e&&(n.current[t]=e)},children:eR()},t)),(0,r.jsx)("pointLight",{color:"#ff0000",intensity:1.25,distance:2.5,position:[0,.25,0]})]})}function ek(){return(0,r.jsx)("group",{children:[-.905,.905].map(e=>(0,r.jsxs)("group",{position:[.575*e,.9,-.55],rotation:[-.9,0,3.025*e],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[.09,.0125,1]}),(0,r.jsx)("meshStandardMaterial",{color:"#d4d4d4",roughness:.4,metalness:.3})]}),(0,r.jsx)("group",{position:[0,2.2,.1],scale:2,children:[-.03,-.06,-.09,0,.03].map((e,t)=>(0,r.jsx)("group",{position:[e,0,0],rotation:[.5,0,0],children:(0,r.jsxs)("mesh",{children:[(0,r.jsx)("coneGeometry",{args:[.02,.075,3]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.3,metalness:.4})]})},t))}),(0,r.jsxs)("group",{position:[0,.375,.2],rotation:[-0,0,.3*e],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[.08,.008,.8,32,32]}),(0,r.jsx)("meshStandardMaterial",{color:"#c4c4c4",roughness:.3,metalness:.4})]}),[void 0,void 0,void 0,void 0,void 0].map((t,n)=>(0,r.jsx)("group",{position:[.02*e,.095*n,.07],rotation:[Math.PI/1.5,0,0],children:(0,r.jsxs)("mesh",{children:[(0,r.jsx)("coneGeometry",{args:[.0325,.1,32,32]}),(0,r.jsx)("meshStandardMaterial",{color:"#b4b4b4",roughness:.5,metalness:.3})]})},n))]}),(0,r.jsx)("group",{position:[0,1.15,.325],rotation:[-.675,0,.5*e],children:(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[.071,.0075,.6,5]}),(0,r.jsx)("meshStandardMaterial",{color:"#b4b4b4",roughness:.3,metalness:.5})]})})]},e))})}let eT=e=>{let{parentRef:t}=e,n=(0,s.useRef)(null),i=(0,s.useRef)(new Float32Array(66)),a=(0,s.useRef)(new Float32Array(22)),l=(0,s.useRef)(new Float32Array(22)),c=(0,s.useRef)(0);return(0,v.F)((e,r)=>{var s;if(!(null===(s=n.current)||void 0===s?void 0:s.parent)||!t.current)return;c.current+=r;let o=t.current.position;for(let e=0;e<22;e++){let t=e/22*Math.PI*2+c.current,n=.1*+Math.sin(2*c.current+.2*e);i.current[3*e]=o.x+Math.cos(t)*n,i.current[3*e+1]=o.y+1e-4*Math.sin(c.current+.1*e),i.current[3*e+2]=o.z+Math.sin(t)*n,a.current[e]=.25*Math.pow(1-e/22,1.5),l.current[e]=.4*Math.pow(1-e/22,.6)}if(n.current){let e=n.current.geometry;e.attributes.position.needsUpdate=!0,e.attributes.opacity.needsUpdate=!0,e.attributes.scale.needsUpdate=!0}}),(0,r.jsxs)("points",{ref:n,children:[(0,r.jsxs)("bufferGeometry",{children:[(0,r.jsx)("bufferAttribute",{attach:"attributes-position",count:22,array:i.current,itemSize:3}),(0,r.jsx)("bufferAttribute",{attach:"attributes-opacity",count:22,array:a.current,itemSize:1}),(0,r.jsx)("bufferAttribute",{attach:"attributes-scale",count:22,array:l.current,itemSize:1})]}),(0,r.jsx)("shaderMaterial",{transparent:!0,depthWrite:!1,blending:o.EZo,vertexShader:"\n          attribute float opacity;\n          attribute float scale;\n          varying float vOpacity;\n          void main() {\n            vOpacity = opacity;\n            vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n            gl_Position = projectionMatrix * mvPosition;\n            gl_PointSize = scale * 20.0 * (300.0 / -mvPosition.z);\n          }\n        ",fragmentShader:"\n          varying float vOpacity;\n          void main() {\n            float d = length(gl_PointCoord - vec2(0.5));\n            float strength = smoothstep(0.5, 0.1, d);\n            vec3 glowColor = mix(vec3(0.6, 0.0, 0.0), vec3(0.8, 0.1, 0.1), 0.4);\n            gl_FragColor = vec4(glowColor, vOpacity * strength);\n          }\n        "})]})};function eG(e){let{isSwinging:t,onSwingComplete:n}=e,i=(0,s.useRef)(null),a=(0,s.useRef)(0),l=[-1.055,1.1,.35];return(0,v.F)((e,r)=>{if(t&&i.current){a.current+=6*r;let e=Math.min(a.current/Math.PI/1.5,1);if(a.current>=.5*Math.PI){a.current=0,i.current.rotation.set(0,0,0),i.current.position.set(...l),n();return}let t=e<=.25?2*e:.5-(e-.25),s=l[0]+-2*Math.sin(t*Math.PI),o=l[1]+-1.2*Math.sin(t*Math.PI),c=l[2]+.9*Math.cos(t*Math.PI);i.current.position.set(s,o,c);let u=Math.PI/4*Math.sin(t*Math.PI),h=Math.PI/2*Math.sin(t*Math.PI),d=Math.PI/4*Math.sin(t*Math.PI);i.current.rotation.set(u,h,d)}else!t&&i.current&&(i.current.rotation.x*=.85,i.current.rotation.y*=.85,i.current.rotation.z*=.85,i.current.position.x+=(l[0]-i.current.position.x)*.2,i.current.position.y+=(l[1]-i.current.position.y)*.2,i.current.position.z+=(l[2]-i.current.position.z)*.2)}),(0,r.jsxs)("group",{ref:i,position:[l[0],l[1],l[2]],rotation:[0,0,Math.PI],scale:[1,1,1],children:[(0,r.jsxs)("group",{position:[0,-.7,0],rotation:[0,0,-Math.PI],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[.05,.05,2.5,12]})," ",(0,r.jsx)("meshStandardMaterial",{color:"#2c1810",roughness:.7})]}),[...Array(7)].map((e,t)=>(0,r.jsxs)("mesh",{position:[0,.81-.3*t,0],rotation:[Math.PI/2,0,0],children:[" ",(0,r.jsx)("torusGeometry",{args:[.06,.01,8,16]}),(0,r.jsx)("meshStandardMaterial",{color:"#8B4513",metalness:.3,roughness:.7})]},t))]}),(0,r.jsxs)("group",{position:[0,.35,0],rotation:[Math.PI/1,0,Math.PI],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[.08,.08,.3,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#2c1810",roughness:.6})]}),(0,r.jsx)("group",{"rotation-x":(0,v.F)(e=>2*e.clock.getElapsedTime()),children:(0,r.jsxs)("mesh",{"position-y":-.075,rotation:[Math.PI/2,0,0],children:[(0,r.jsx)("torusGeometry",{args:[.145,.02,16,32]}),(0,r.jsx)("meshStandardMaterial",{color:"#ff3300",emissive:"#ff3300",emissiveIntensity:1.5,transparent:!0,opacity:.7})]})}),(0,r.jsx)("group",{"rotation-x":(0,v.F)(e=>-(2*e.clock.getElapsedTime())),children:(0,r.jsxs)("mesh",{"position-y":.03,rotation:[Math.PI/2,0,0],children:[(0,r.jsx)("torusGeometry",{args:[.175,.02,16,32]}),(0,r.jsx)("meshStandardMaterial",{color:"#ff0000",emissive:"#ff0000",emissiveIntensity:1.5,transparent:!0,opacity:.7})]})}),(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[.13,.11,.32,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#ff1a1a",emissive:"#ff1a1a",emissiveIntensity:1.5,transparent:!0,opacity:.3})]})]}),(0,r.jsx)("group",{position:[0,.375,1.175],rotation:[-1,-Math.PI/2,Math.PI/2.2],children:(0,r.jsxs)("mesh",{children:[(0,r.jsx)("extrudeGeometry",{args:[(()=>{let e=new o.ypk;return e.moveTo(0,0),e.lineTo(.15,-.23),e.bezierCurveTo(.8,.22,1.13,.5,1.6,.6),e.lineTo(1.125,.75),e.bezierCurveTo(.5,.2,.225,0,.1,.7),e.lineTo(0,0),e})(),{steps:1,depth:1e-4,bevelEnabled:!0,bevelThickness:.03,bevelSize:.035,bevelSegments:1,curveSegments:16,depth:.03}]}),(0,r.jsx)("meshStandardMaterial",{color:"#ff0000",emissive:"#ff0000",emissiveIntensity:1.25,metalness:.8,roughness:.1,opacity:.5,transparent:!0,side:o.$EB})]})})]})}function eD(e){let{isSwinging:t,onSwingComplete:n}=e,i=(0,s.useRef)(null),a=(0,s.useRef)(0),l=[-1.055,1.1,.35];return(0,v.F)((e,r)=>{if(t&&i.current){a.current+=6*r;let e=Math.min(a.current/Math.PI/1.5,1);if(a.current>=.5*Math.PI){a.current=0,i.current.rotation.set(0,0,0),i.current.position.set(...l),n();return}let t=e<=.25?2*e:.5-(e-.25),s=l[0]+2*Math.sin(t*Math.PI),o=l[1]+-1.2*Math.sin(t*Math.PI),c=l[2]+.9*Math.cos(t*Math.PI);i.current.position.set(s,o,c);let u=Math.PI/4*Math.sin(t*Math.PI),h=Math.PI/2*Math.sin(t*Math.PI),d=Math.PI/4*Math.sin(t*Math.PI);i.current.rotation.set(u,h,d)}else!t&&i.current&&(i.current.rotation.x*=.85,i.current.rotation.y*=.85,i.current.rotation.z*=.85,i.current.position.x+=(l[0]-i.current.position.x)*.2,i.current.position.y+=(l[1]-i.current.position.y)*.2,i.current.position.z+=(l[2]-i.current.position.z)*.2)}),(0,r.jsxs)("group",{ref:i,position:[l[0],l[1],l[2]],rotation:[0,0,Math.PI],scale:[1,1,1],children:[(0,r.jsxs)("group",{position:[0,-.7,0],rotation:[0,0,-Math.PI],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[.05,.05,2.5,12]})," ",(0,r.jsx)("meshStandardMaterial",{color:"#2c1810",roughness:.7})]}),[...Array(7)].map((e,t)=>(0,r.jsxs)("mesh",{position:[0,.81-.3*t,0],rotation:[Math.PI/2,0,0],children:[" ",(0,r.jsx)("torusGeometry",{args:[.06,.01,8,16]}),(0,r.jsx)("meshStandardMaterial",{color:"#8B4513",metalness:.3,roughness:.7})]},t))]}),(0,r.jsxs)("group",{position:[0,.35,0],rotation:[Math.PI/1,0,Math.PI],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[.08,.08,.3,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#2c1810",roughness:.6})]}),(0,r.jsx)("group",{"rotation-x":(0,v.F)(e=>2*e.clock.getElapsedTime()),children:(0,r.jsxs)("mesh",{"position-y":-.075,rotation:[Math.PI/2,0,0],children:[(0,r.jsx)("torusGeometry",{args:[.145,.02,16,32]}),(0,r.jsx)("meshStandardMaterial",{color:"#ff3300",emissive:"#ff3300",emissiveIntensity:1.5,transparent:!0,opacity:.7})]})}),(0,r.jsx)("group",{"rotation-x":(0,v.F)(e=>-(2*e.clock.getElapsedTime())),children:(0,r.jsxs)("mesh",{"position-y":.03,rotation:[Math.PI/2,0,0],children:[(0,r.jsx)("torusGeometry",{args:[.175,.02,16,32]}),(0,r.jsx)("meshStandardMaterial",{color:"#ff0000",emissive:"#ff0000",emissiveIntensity:1.5,transparent:!0,opacity:.7})]})}),(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[.13,.11,.32,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#ff1a1a",emissive:"#ff1a1a",emissiveIntensity:1.5,transparent:!0,opacity:.3})]})]}),(0,r.jsx)("group",{position:[0,.375,1.175],rotation:[-1,-Math.PI/2,Math.PI/2.2],children:(0,r.jsxs)("mesh",{children:[(0,r.jsx)("extrudeGeometry",{args:[(()=>{let e=new o.ypk;return e.moveTo(0,0),e.lineTo(.15,-.23),e.bezierCurveTo(.8,.22,1.13,.5,1.6,.6),e.lineTo(1.125,.75),e.bezierCurveTo(.5,.2,.225,0,.1,.7),e.lineTo(0,0),e})(),{steps:1,depth:1e-4,bevelEnabled:!0,bevelThickness:.03,bevelSize:.035,bevelSegments:1,curveSegments:16,depth:.03}]}),(0,r.jsx)("meshStandardMaterial",{color:"#ff0000",emissive:"#ff0000",emissiveIntensity:1.25,metalness:.8,roughness:.1,opacity:.5,transparent:!0,side:o.$EB})]})})]})}function eF(e){let{isAttacking:t,isWalking:n,playerPosition:i}=e,a=(0,s.useRef)(null);return(0,v.F)(()=>{if(!a.current)return;n&&(a.current.position.y=.1*Math.sin(.001*Date.now()));let e=new o.Pq0().subVectors(i,a.current.position).setY(0).normalize(),t=new o.kn4;t.lookAt(new o.Pq0(0,0,0),e,new o.Pq0(0,1,0));let r=new o.O9p(0,0,0);r.setFromRotationMatrix(t),a.current.rotation.y=r.y}),(0,r.jsxs)("group",{ref:a,onClick:e=>{e.stopPropagation()},children:[(0,r.jsx)("group",{scale:[.6,.6,.6],position:[0,2.25,0],rotation:[.4,0,0],children:(0,r.jsx)(ek,{})}),(0,r.jsx)("group",{scale:[1.8,1.4,1.6],position:[0,1.7,0],children:(0,r.jsx)(O,{})}),(0,r.jsxs)("group",{scale:[1.9,1.6,1.4],position:[0,2,0],children:[(0,r.jsx)("group",{rotation:[0,Math.PI/7,0],children:(0,r.jsx)(B,{collectedBones:15,isLeftWing:!0,parentRef:a})}),(0,r.jsx)("group",{rotation:[0,-Math.PI/7,0],children:(0,r.jsx)(B,{collectedBones:15,isLeftWing:!1,parentRef:a})})]}),(0,r.jsxs)("group",{scale:[.65,.65,.65],position:[0,1.9,0],children:[(0,r.jsx)("group",{position:[-.85,.25,.1],rotation:[0,-(Math.PI/2),0],children:(0,r.jsx)(ez,{})}),(0,r.jsx)("group",{position:[.85,.25,.1],rotation:[0,-Math.PI/6,0],children:(0,r.jsx)(ez,{})})]}),(0,r.jsx)("group",{scale:[2,2,2],position:[0,1.75,-.15],children:(0,r.jsx)(N,{})}),(0,r.jsx)("group",{position:[0,2.1,0],children:(0,r.jsx)(eT,{parentRef:a})}),(0,r.jsx)("group",{position:[0,1.25,0],scale:[.7,.7,.7],children:(0,r.jsx)(eT,{parentRef:a})}),(0,r.jsxs)("group",{scale:[2.1,2.25,2.1],children:[(0,r.jsx)("group",{position:[0,0,.1],rotation:[0,0,0],children:(0,r.jsx)(e_,{parentRef:a})}),(0,r.jsx)("group",{position:[0,0,-.1],rotation:[0,Math.PI,0],children:(0,r.jsx)(e_,{parentRef:a})}),(0,r.jsx)("group",{position:[.1,0,0],rotation:[0,Math.PI/2,0],children:(0,r.jsx)(e_,{parentRef:a})}),(0,r.jsx)("group",{position:[-.1,0,0],rotation:[0,-Math.PI/2,0],children:(0,r.jsx)(e_,{parentRef:a})})]}),(0,r.jsx)("group",{position:[.5,2.6,.2],rotation:[Math.PI/3+.2,1+Math.PI+1.15,1.45],scale:[.6,.6,.6],children:(0,r.jsx)(eD,{isSwinging:t,onSwingComplete:()=>{},parentRef:a})}),(0,r.jsx)("group",{position:[-.5,2.31,-1],rotation:[Math.PI/3+.2,-(1+Math.PI+1.15),-1.45],scale:[.6,.6,.6],children:(0,r.jsx)(eG,{isSwinging:t,onSwingComplete:()=>{},parentRef:a})})]})}function ez(){let e=(e,t)=>(0,r.jsxs)("mesh",{children:[(0,r.jsx)("cylinderGeometry",{args:[t,.8*t,e,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),t=e=>(0,r.jsxs)("mesh",{children:[(0,r.jsx)("sphereGeometry",{args:[e,8,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),n=(n,s)=>(0,r.jsxs)("group",{children:[(0,r.jsx)("group",{position:[s/2,0,0],children:e(n,.06)}),(0,r.jsx)("group",{position:[-s/2,0,0],children:e(n,.06)}),(0,r.jsx)("group",{position:[0,n/2,0],children:t(.08)}),(0,r.jsx)("group",{position:[0,-n/2,0],children:t(.115)})]});return(0,r.jsx)("group",{children:(0,r.jsxs)("group",{children:[n(1,.15),(0,r.jsxs)("group",{position:[.25,-.85,.21],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("sphereGeometry",{args:[.12,12,12]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,r.jsxs)("group",{rotation:[-.7,-0,Math.PI/5],children:[n(.8,.12),(0,r.jsxs)("group",{position:[0,-.5,0],rotation:[0,0,Math.PI/5.5],children:[t(.09),(0,r.jsxs)("group",{position:[0,-.1,0],children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("boxGeometry",{args:[.2,.15,.08]}),(0,r.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4})]}),[-.08,-.04,0,.04,.08].map((t,n)=>(0,r.jsxs)("group",{position:[t,-.1,0],rotation:[0,0,(n-2)*Math.PI/10],children:[e(.5,.02),(0,r.jsx)("group",{position:[.025,-.3,0],rotation:[0,0,Math.PI+Math.PI/16],children:(0,r.jsxs)("mesh",{children:[(0,r.jsx)("coneGeometry",{args:[.03,.3,6]}),(0,r.jsx)("meshStandardMaterial",{color:"#d4d4d4",roughness:.3,metalness:.4})]})})]},n))]})]})]})]})]})})}function eq(e){let{color:t,size:n,meshRef:i}=e,a=(0,s.useRef)(null),l=(0,s.useRef)(new Float32Array(60)),c=(0,s.useRef)(new Float32Array(20)),u=(0,s.useRef)(new Float32Array(20)),h=(0,s.useRef)(!1);return(0,s.useEffect)(()=>{if(i.current&&!h.current){let e=i.current.position;for(let t=0;t<20;t++)l.current[3*t]=e.x,l.current[3*t+1]=e.y,l.current[3*t+2]=e.z,c.current[t]=0,u.current[t]=0;h.current=!0}},[i]),(0,v.F)(()=>{var e;if(!(null===(e=a.current)||void 0===e?void 0:e.parent)||!i.current||!h.current)return;let t=i.current.position;for(let e=19;e>0;e--)l.current[3*e]=l.current[(e-1)*3],l.current[3*e+1]=l.current[(e-1)*3+1]+.5,l.current[3*e+2]=l.current[(e-1)*3+2],c.current[e]=.9*Math.pow(1-e/20,.3),u.current[e]=n*(2-e/20*.5);if(l.current[0]=t.x,l.current[1]=t.y,l.current[2]=t.z,c.current[0]=.9,u.current[0]=8*n,a.current){let e=a.current.geometry;e.attributes.position.array=l.current,e.attributes.position.needsUpdate=!0,e.attributes.opacity&&(e.attributes.opacity.array=c.current,e.attributes.opacity.needsUpdate=!0),e.attributes.scale&&(e.attributes.scale.array=u.current,e.attributes.scale.needsUpdate=!0)}}),(0,r.jsxs)("points",{ref:a,children:[(0,r.jsxs)("bufferGeometry",{children:[(0,r.jsx)("bufferAttribute",{attach:"attributes-position",count:20,array:l.current,itemSize:3}),(0,r.jsx)("bufferAttribute",{attach:"attributes-opacity",count:20,array:c.current,itemSize:1}),(0,r.jsx)("bufferAttribute",{attach:"attributes-scale",count:20,array:u.current,itemSize:1})]}),(0,r.jsx)("shaderMaterial",{transparent:!0,depthWrite:!1,blending:o.EZo,vertexShader:"\n          attribute float opacity;\n          attribute float scale;\n          varying float vOpacity;\n          void main() {\n            vOpacity = opacity;\n            vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n            gl_Position = projectionMatrix * mvPosition;\n            gl_PointSize = scale * 45.0 * (300.0 / -mvPosition.z);\n          }\n        ",fragmentShader:"\n          varying float vOpacity;\n          uniform vec3 uColor;\n          void main() {\n            float d = length(gl_PointCoord - vec2(0.5));\n            float strength = smoothstep(0.5, 0.1, d);\n            vec3 glowColor = mix(uColor, vec3(1.0), 0.4);\n            gl_FragColor = vec4(glowColor, vOpacity * strength);\n          }\n        ",uniforms:{uColor:{value:t}}})]})}let eB=(e,t,n)=>{let s=(Date.now()-t)/1e3,i=Math.max(0,1-s/1.25);return i<=0?(n(),null):(0,r.jsxs)("group",{position:e,children:[(0,r.jsxs)("mesh",{children:[(0,r.jsx)("sphereGeometry",{args:[1.2*(2+s),32,32]}),(0,r.jsx)("meshStandardMaterial",{color:"#ff2200",emissive:"#ff4400",emissiveIntensity:2*i,transparent:!0,opacity:1.8*i,depthWrite:!1,blending:o.EZo})]}),(0,r.jsxs)("mesh",{children:[(0,r.jsx)("sphereGeometry",{args:[1,24,24]}),(0,r.jsx)("meshStandardMaterial",{color:"#ff8800",emissive:"#ffffff",emissiveIntensity:2*i,transparent:!0,opacity:1.9*i,depthWrite:!1,blending:o.EZo})]}),[2,2.15,2.3,2.5,2.7].map((e,t)=>(0,r.jsxs)("mesh",{rotation:[Math.random()*Math.PI,Math.random()*Math.PI,Math.random()*Math.PI],children:[(0,r.jsx)("torusGeometry",{args:[e*(1.325+2*s),.225,4,32]}),(0,r.jsx)("meshStandardMaterial",{color:"#ff2200",emissive:"#ff4400",emissiveIntensity:.7*i,transparent:!0,opacity:.95*i*(1-.1*t),depthWrite:!1,blending:o.EZo})]},t)),(0,r.jsx)("pointLight",{color:"#ff2200",intensity:.8*i,distance:8*(1+s),decay:2}),(0,r.jsx)("pointLight",{color:"#ff8800",intensity:.8*i,distance:12,decay:1})]})};function eA(e){var t;let{targetPosition:n,onImpact:i,onComplete:a,playerPosition:l}=e,c=(0,s.useRef)(null),u=(0,s.useRef)(null),h=(0,s.useRef)(new o.Pq0(n.x,-5,n.z)),d=(0,s.useRef)(new o.Pq0(n.x,60,n.z)),[m,p]=(0,s.useState)(!1),[f,x]=(0,s.useState)(!1),g=(0,s.useRef)(null),[j,y]=(0,s.useState)(null),M=(0,s.useRef)(new o.Pq0().subVectors(h.current,d.current).normalize());return(0,s.useEffect)(()=>{let e=setTimeout(()=>{x(!0)},1090);return()=>clearTimeout(e)},[]),(0,v.F)((e,t)=>{if(!c.current||!f||m){m&&!j&&y(Date.now());return}let n=c.current.position;(2.95>n.distanceTo(h.current)||n.y<=.1)&&(p(!0),y(Date.now()),2.95>=new o.Pq0(l.x,0,l.z).distanceTo(new o.Pq0(h.current.x,0,h.current.z))&&i(42)),n.addScaledVector(M.current,27.75*t)}),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("group",{position:[h.current.x,.1,h.current.z],children:[(0,r.jsxs)("mesh",{ref:g,rotation:[-Math.PI/2,0,0],children:[(0,r.jsx)("ringGeometry",{args:[2.75,2.95,64]}),(0,r.jsx)("meshBasicMaterial",{color:"#ff2200",transparent:!0,opacity:.6,side:o.$EB})]}),(0,r.jsxs)("mesh",{rotation:[-Math.PI/2,0,0],scale:[1+.2*Math.sin(.005*Date.now()),1+.2*Math.sin(.005*Date.now()),1],children:[(0,r.jsx)("ringGeometry",{args:[2.95-.8,2.35,64]}),(0,r.jsx)("meshBasicMaterial",{color:"#ff4400",transparent:!0,opacity:.4+.2*Math.sin(.003*Date.now()),side:o.$EB})]}),(0,r.jsxs)("mesh",{rotation:[-Math.PI/2,.0035*Date.now(),0],children:[(0,r.jsx)("ringGeometry",{args:[2.7,2.95,64]}),(0,r.jsx)("meshBasicMaterial",{color:"#ff3300",transparent:!0,opacity:.3,side:o.$EB})]}),[...Array(15)].map((e,t)=>(0,r.jsxs)("mesh",{position:[2.45*Math.sin(.001*Date.now()+t),.5*Math.sin(.002*Date.now()+t),2.45*Math.cos(.001*Date.now()+t)],children:[(0,r.jsx)("sphereGeometry",{args:[.1,8,8]}),(0,r.jsx)("meshBasicMaterial",{color:"#ff3300",transparent:!0,opacity:.3+.2*Math.sin(.004*Date.now()+t)})]},t))]}),f&&(0,r.jsx)("group",{ref:c,position:d.current,children:(0,r.jsxs)("mesh",{ref:u,children:[(0,r.jsx)("sphereGeometry",{args:[.75,16,16]}),(0,r.jsx)("meshBasicMaterial",{color:"#ff4400"}),(0,r.jsx)("pointLight",{color:"#ff4400",intensity:5,distance:8}),(0,r.jsx)(eq,{meshRef:u,color:new o.Q1f("#ff4400"),size:.09})]})}),j&&eB((null===(t=c.current)||void 0===t?void 0:t.position)||h.current,j,a)]})}function eL(e){let{position:t,duration:n,range:i}=e,a=(0,s.useRef)(null),l=(0,s.useRef)(Date.now());return(0,v.F)(()=>{if(!a.current)return;let e=(Date.now()-l.current)/1e3,t=Math.min(e/n,1),r=1+.15*Math.sin(8*e);a.current.scale.setScalar(r),t>.7&&(a.current.material.opacity=.6*(1-(t-.7)/.3))}),(0,r.jsxs)("group",{position:[t.x,1.15,t.z],children:[(0,r.jsxs)("mesh",{ref:a,rotation:[-Math.PI/2,0,0],children:[(0,r.jsx)("ringGeometry",{args:[i-.2,i,64]}),(0,r.jsx)("meshBasicMaterial",{color:"#ff3300",transparent:!0,opacity:.6,side:o.$EB})]}),(0,r.jsxs)("mesh",{rotation:[-Math.PI/2,0,0],children:[(0,r.jsx)("ringGeometry",{args:[i-.8,i-.6,64]}),(0,r.jsx)("meshBasicMaterial",{color:"#ff4400",transparent:!0,opacity:.2,side:o.$EB})]})]})}function eO(e){let{id:t,initialPosition:n,position:i,health:a,maxHealth:l,onTakeDamage:c,onPositionUpdate:u,playerPosition:h,onAttackPlayer:d}=e,m=(0,s.useRef)(null),p=(0,s.useRef)(Date.now()+2e3),f=(0,s.useRef)(Date.now()),x=(0,s.useRef)(n.clone()),g=(0,s.useRef)(h.clone()),j=(0,s.useRef)(a),[y,M]=(0,s.useState)(!1),[P,w]=(0,s.useState)(!1),[S,I]=(0,s.useState)(!0),[C,b]=(0,s.useState)(!1),[E,R]=(0,s.useState)(!1),[_,k]=(0,s.useState)(!1),T=(0,s.useRef)(3800),G=(0,s.useRef)(9e3);(0,s.useEffect)(()=>{g.current.copy(h)},[h]),(0,s.useEffect)(()=>{i&&(x.current.copy(i),m.current&&m.current.position.copy(x.current))},[i]),(0,s.useEffect)(()=>{j.current=a},[a]),(0,s.useEffect)(()=>{let e=a<=l/2;T.current=e?2250:3800,G.current=e?5e3:9e3},[a,l]),(0,s.useEffect)(()=>{let e=setTimeout(()=>{I(!1)},3e3);return()=>clearTimeout(e)},[]),(0,s.useEffect)(()=>{0!==a||P||(console.log("Boss ".concat(t," died")),w(!0))},[a,t,P]);let F=(0,s.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=x.current;return!(new o.Pq0(n.x-e.x,0,n.z-e.z).length()>4)&&4>=Math.abs(e.y+t-(n.y+2))},[]),z=(0,s.useCallback)((e,n)=>{!(j.current<=0)&&n&&F(n)&&(c("enemy-".concat(t),e),0===Math.max(0,j.current-e)&&j.current>0&&w(!0))},[t,c,F]),q=(0,s.useCallback)(()=>{y||_||Date.now()-p.current<T.current||(R(!0),p.current=Date.now(),k(!0),setTimeout(()=>{R(!1),M(!0),setTimeout(()=>{let e=x.current.clone();e.y=0;let t=g.current.clone();t.y=0,5>=e.distanceTo(t)&&d(26)},270),setTimeout(()=>{M(!1),setTimeout(()=>{k(!1)},T.current)},540)},1500))},[y,_,d,26,5]),B=(0,s.useCallback)(()=>{C||(b(!0),setTimeout(()=>{b(!1)},3500))},[C]);return(0,v.F)(()=>{if(!m.current||a<=0)return;let e=Date.now(),n=x.current.distanceTo(g.current);if(e-f.current>=G.current&&a>0&&(B(),f.current=e),n>5&&a>0){M(!1);let e=new o.Pq0().subVectors(g.current,x.current).normalize(),n=x.current.clone().add(e.multiplyScalar(.15));x.current.lerp(n,.15),m.current.position.copy(x.current);let r=new o.Pq0(g.current.x,x.current.y,g.current.z);m.current.lookAt(r),m.current.rotateY(Math.PI/2),x.current.distanceTo(i)>.01&&u(t,x.current.clone())}else e-p.current>=T.current&&(q(),p.current=e)}),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("group",{ref:m,visible:!S&&a>0,position:x.current,scale:[1.75,1.75,1.75],onClick:e=>e.stopPropagation(),children:[(0,r.jsx)(eF,{isAttacking:y,isWalking:!y&&a>0,onHit:z,playerPosition:h}),(0,r.jsx)(ep.Q,{position:[0,5,0],follow:!0,lockX:!1,lockY:!1,lockZ:!1,children:j.current>0&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("mesh",{position:[0,0,0],children:[(0,r.jsx)("planeGeometry",{args:[4,.4]}),(0,r.jsx)("meshBasicMaterial",{color:"#333333",opacity:.8,transparent:!0})]}),(0,r.jsxs)("mesh",{position:[-2+j.current/l*2,0,.001],children:[(0,r.jsx)("planeGeometry",{args:[j.current/l*4,.35]}),(0,r.jsx)("meshBasicMaterial",{color:"#ff0000",opacity:.9,transparent:!0})]}),(0,r.jsx)(D.E,{position:[0,0,.002],fontSize:.3,color:"#ffffff",anchorX:"center",anchorY:"middle",fontWeight:"bold",children:"".concat(Math.ceil(j.current),"/").concat(l)})]})})]}),C&&(0,r.jsx)(eA,{targetPosition:g.current,onImpact:e=>d(e),onComplete:()=>b(!1),playerPosition:g.current}),E&&(0,r.jsx)(eL,{position:x.current,duration:1,range:5})]})}let eN=e=>{let{position:t,scale:n=1}=e;return(0,r.jsxs)("group",{position:t,scale:n,children:[(0,r.jsxs)("mesh",{position:[0,.1,0],children:[(0,r.jsx)("cylinderGeometry",{args:[.02,.02,.8,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#8783D1"})]}),[0,72,144,216,288].map((e,t)=>(0,r.jsxs)("mesh",{position:[0,.3,0],rotation:[.3,e*Math.PI/180,0],children:[(0,r.jsx)("sphereGeometry",{args:[.12,8,8,0,2*Math.PI,0,Math.PI/2]}),(0,r.jsx)("meshStandardMaterial",{color:"#8783D1",emissive:"#8783D1",emissiveIntensity:.5})]},t)),(0,r.jsxs)("mesh",{position:[0,.425,0],children:[(0,r.jsx)("sphereGeometry",{args:[.08,8,8]}),(0,r.jsx)("meshStandardMaterial",{color:"#ffeb3b",emissive:"#ff8800",emissiveIntensity:.35})]})]})},eH=new o.Pq0(0,0,0);function eQ(e){let{mountainData:t,treeData:n,mushroomData:i,unitProps:a,skeletonProps:l,killCount:c,onLevelComplete:u,spawnInterval:h=8500,maxSkeletons:d=23,initialSkeletons:m=5,spawnCount:p=2,flowerData:f}=e,[g,j]=(0,s.useState)(!1),[y,v]=(0,s.useState)(m||5),[w,C]=(0,s.useState)(()=>l.map((e,t)=>({id:"skeleton-".concat(t),position:e.initialPosition.clone(),initialPosition:e.initialPosition.clone(),currentPosition:e.initialPosition.clone(),health:250,maxHealth:250}))),[b,E]=(0,s.useState)(a.health),R=(0,s.useRef)(null),[_,k]=(0,s.useState)(new o.Pq0(0,0,0)),[T,G]=(0,s.useState)(!1),[D,F]=(0,s.useState)(5184),[z,q]=(0,s.useState)(eH.clone()),B=(0,s.useCallback)((e,t)=>{if(e.includes("boss")){F(Math.max(0,D-t));return}C(n=>n.map(n=>{let r=e.replace("enemy-","");if(n.id===r){let e=Math.max(0,n.health-t);if(0===e&&n.health>0){var s;null===(s=a.onEnemyDeath)||void 0===s||s.call(a)}return{...n,health:e}}return n}))},[D,a]),A=(0,s.useCallback)(e=>{var t;null===(t=a.onDamage)||void 0===t||t.call(a,e)},[a]),L=(0,s.useCallback)(e=>{k(e)},[]),O=(0,s.useCallback)((e,t)=>{if(e.includes("boss")){q(t.clone());return}C(n=>n.map(n=>n.id===e.replace("enemy-","")?{...n,position:t.clone()}:n))},[]),N={onHit:B,controlsRef:a.controlsRef,currentWeapon:a.currentWeapon,onWeaponSelect:a.onWeaponSelect,health:b,maxHealth:a.maxHealth,isPlayer:a.isPlayer,abilities:a.abilities,onAbilityUse:a.onAbilityUse,onPositionUpdate:L,onHealthChange:e=>{if("function"==typeof e)E(t=>{var n;let r=e(t);return null===(n=a.onHealthChange)||void 0===n||n.call(a,r),r});else{var t;E(e),null===(t=a.onHealthChange)||void 0===t||t.call(a,e)}},enemyData:[...w.map(e=>({id:"enemy-".concat(e.id),position:e.position,initialPosition:e.initialPosition,health:e.health,maxHealth:e.maxHealth})),...T&&D>0?[{id:"enemy-boss-1",position:z,initialPosition:eH,health:D,maxHealth:5184}]:[]],onDamage:a.onDamage,onEnemyDeath:()=>{console.log("Kill counted in Scene")},onFireballDamage:a.onFireballDamage,fireballManagerRef:a.fireballManagerRef,onSmiteDamage:a.onSmiteDamage};return(0,s.useEffect)(()=>{let e=w.every(e=>e.health<=0),t=g&&y>m;e&&t&&c>=24&&!T?G(!0):e&&T&&D<=0&&u()},[w,c,u,g,y,m,T,D]),(0,s.useEffect)(()=>{let e=setTimeout(()=>{j(!0)},4e3);return()=>clearTimeout(e)},[]),(0,s.useEffect)(()=>{if(!g||y>=d)return;let e=setInterval(()=>{C(t=>{if(y>=d)return clearInterval(e),t;let n=Array(p).fill(null).map((e,t)=>{let n=x();return{id:"skeleton-".concat(y+t),position:n.clone(),initialPosition:n.clone(),currentPosition:n.clone(),health:250,maxHealth:250}});return v(e=>e+p),[...t,...n]})},h);return()=>clearInterval(e)},[g,y,d,h,p]),(0,s.useEffect)(()=>{a.controlsRef.current&&(a.controlsRef.current.object.position.set(0,12,-18),a.controlsRef.current.target.set(0,0,0),a.controlsRef.current.update())},[a.controlsRef]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(eb,{}),(0,r.jsx)(eI,{}),(0,r.jsx)(ew,{}),(0,r.jsx)(M,{color:"#FFAFC5",roughness:.9,metalness:.1}),t.map((e,t)=>(0,r.jsx)(P,{position:e.position,scale:e.scale},"mountain-".concat(t))),n.map((e,t)=>(0,r.jsx)(S,{position:e.position,scale:e.scale,trunkColor:e.trunkColor,leafColor:e.leafColor},"tree-".concat(t))),i.map((e,t)=>(0,r.jsx)(I,{position:e.position,scale:e.scale},"mushroom-".concat(t))),f.map((e,t)=>(0,r.jsx)(eN,{position:e.position,scale:e.scale},"flower-".concat(t))),(0,r.jsx)("group",{ref:R,children:(0,r.jsx)(em,{...N})}),w.map(e=>(0,r.jsx)(eP,{id:e.id,initialPosition:e.initialPosition,position:e.position,health:e.health,maxHealth:e.maxHealth,onTakeDamage:B,onPositionUpdate:O,playerPosition:_,onAttackPlayer:A},e.id)),T&&(0,r.jsx)(eO,{id:"boss-1",initialPosition:eH,position:eH,health:D,maxHealth:5184,onTakeDamage:(e,t)=>{F(e=>Math.max(0,e-t))},onPositionUpdate:O,playerPosition:_,onAttackPlayer:A},"boss-1")]})}function eW(e){let{sceneProps:t,onLevelTransition:n,currentLevel:o}=e,[i,a]=(0,s.useState)(!1),l=(0,s.useCallback)(()=>{1===o&&n(1,!0)},[o,n]);return(0,s.useEffect)(()=>{2===o?a(!0):a(!1)},[o]),(0,r.jsx)(r.Fragment,{children:i?(0,r.jsx)(eQ,{...t,onLevelComplete:l}):(0,r.jsx)(eE,{...t,onLevelComplete:l})})}var eU=n(5019),eY=n.n(eU),eZ=n(9965),eV=n.n(eZ),eK=n(5831),eX=n.n(eK);function e$(e){let{damage:t,index:n,onComplete:o,timestamp:i}=e,[a,l]=(0,s.useState)(!0);(0,s.useEffect)(()=>{let e=setTimeout(()=>{l(!1),setTimeout(o,300)},1e3),t=setTimeout(()=>{o()},2e3);return()=>{clearTimeout(e),clearTimeout(t)}},[o]);let c=Math.max(0,1-(Date.now()-i)/1e3);return(0,r.jsxs)("div",{className:"".concat(eX().notification," ").concat(a?eX().visible:eX().hidden),style:{transform:"translateY(".concat(-20-25*n,"px)"),opacity:c},children:["-",t]})}var eJ=n(5190),e0=n.n(eJ);function e1(e){let{content:t,visible:n,x:s,y:o}=e;return n?(0,r.jsxs)("div",{className:e0().tooltip,style:{left:"".concat(s,"px"),top:"".concat(o,"px")},children:[(0,r.jsx)("h3",{children:t.title}),t.description.split("\n").map((e,t)=>(0,r.jsx)("p",{children:e},t))]}):null}let e2=e=>{let{size:t,strokeWidth:n,percentage:s,borderRadius:o}=e,i=n/2,a=t-n,l=4*a;return(0,r.jsx)("svg",{width:t,height:t,className:eY().roundedSquareProgress,children:(0,r.jsx)("rect",{x:i,y:i,width:a,height:a,rx:o,ry:o,stroke:"#39ff14",strokeWidth:n,fill:"none",strokeDasharray:l,strokeDashoffset:l-l*s/100,className:eY().progressForeground})})};function e5(e){let{currentWeapon:t,playerHealth:n,maxHealth:o,abilities:i,killCount:a}=e,[l,c]=(0,s.useState)([]),h=(0,s.useRef)(0),d=(0,s.useRef)(n),[m,p]=(0,s.useState)(null),[f,x]=(0,s.useState)({x:0,y:0});(0,s.useEffect)(()=>{if(n<d.current){let e=d.current-n;c(t=>[...t,{id:h.current++,damage:e,timestamp:Date.now()}].slice(-3))}d.current=n},[n]);let g=e=>{c(t=>t.filter(t=>t.id!==e))},j=e=>e<15?1:e<40?2:3,y=(e,n)=>{let r=u[t][n],s=e.currentTarget.getBoundingClientRect();p(r),x({x:s.left+s.width/2,y:s.top})},v=()=>{p(null)};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:eY().leftPanel,children:[(0,r.jsxs)("div",{className:eY().controlsSection,children:[(0,r.jsxs)("div",{className:eY().controlGroup,children:[(0,r.jsx)("div",{className:eY().controlKey,children:"W"}),(0,r.jsx)("div",{className:eY().controlKey,children:"A"}),(0,r.jsx)("div",{className:eY().controlKey,children:"S"}),(0,r.jsx)("div",{className:eY().controlKey,children:"D"}),(0,r.jsx)("div",{className:eY().controlLabel,children:"Move"})]}),(0,r.jsx)("div",{className:eY().controlDivider}),(0,r.jsxs)("div",{className:eY().controlGroup,children:[(0,r.jsx)("div",{className:eY().controlLabel,children:"Zoom"}),(0,r.jsx)("div",{className:eY().controlKey,children:"Scroll Wheel"})]})]}),(0,r.jsxs)("div",{className:eY().controlsSection,children:[(0,r.jsxs)("div",{className:eY().controlGroup,children:[(0,r.jsx)("div",{className:eY().controlKey,children:"L-Click Hold"}),(0,r.jsx)("div",{className:eY().controlLabel,children:"Auto Attack"})]}),(0,r.jsx)("div",{className:eY().controlDivider}),(0,r.jsxs)("div",{className:eY().controlGroup,children:[(0,r.jsx)("div",{className:eY().controlLabel,children:"Camera"}),(0,r.jsx)("div",{className:eY().controlKey,children:"R-Click Hold"})]})]})]}),(0,r.jsxs)("div",{className:eY().bottomPanel,children:[i[t]&&(0,r.jsx)("div",{className:eY().abilitiesSection,children:Object.entries(i[t]).map(e=>{let[t,n]=e;return(0,r.jsxs)("div",{className:"".concat(eY().ability," ").concat(n.isUnlocked?"":eY().locked),onMouseEnter:e=>y(e,t),onMouseLeave:v,children:[(0,r.jsx)("div",{className:eY().keyBind,children:n.key.toUpperCase()}),(0,r.jsx)(eV(),{src:n.icon,alt:"".concat(t," ability"),width:40,height:40,className:eY().abilityIcon}),n.currentCooldown>0&&(0,r.jsxs)("div",{className:eY().cooldownOverlay,children:[(0,r.jsx)(e2,{size:50,strokeWidth:4,percentage:n.currentCooldown/n.cooldown*100,borderRadius:8}),(0,r.jsx)("span",{className:eY().cooldownText,children:Math.ceil(n.currentCooldown)})]})]},t)})}),(0,r.jsxs)("div",{className:eY().healthBarSection,children:[l.map((e,t)=>(0,r.jsx)(e$,{damage:e.damage,index:t,timestamp:e.timestamp,onComplete:()=>g(e.id)},e.id)),(0,r.jsxs)("div",{className:eY().healthBarContainer,children:[(0,r.jsxs)("div",{className:eY().healthBar,children:[(0,r.jsx)("div",{className:eY().healthBarBackground}),(0,r.jsx)("div",{className:eY().healthBarInner,style:{width:"".concat(n/o*100,"%")}}),(0,r.jsx)("div",{className:eY().healthBarShine}),(0,r.jsx)("div",{className:eY().healthBarPulse})]}),(0,r.jsxs)("span",{className:eY().healthText,children:[(0,r.jsx)("span",{className:eY().healthCurrent,children:n}),(0,r.jsx)("span",{className:eY().healthSeparator,children:"/"}),(0,r.jsx)("span",{className:eY().healthMax,children:o})]})]}),(0,r.jsxs)("div",{className:eY().experienceBarContainer,children:[(0,r.jsx)("div",{className:eY().experienceBarOrnamentLeft,children:(0,r.jsx)("span",{className:eY().levelText,children:j(a)})}),(0,r.jsx)("div",{className:eY().experienceBar,children:(0,r.jsx)("div",{className:eY().xpFill,style:{width:"".concat((e=>{let t=j(e);return 1===t?e/15*100:2===t?(e-15)/25*100:100})(a),"%")}})}),(0,r.jsx)("div",{className:eY().experienceBarOrnamentRight,children:(0,r.jsx)("span",{className:eY().killCountText,children:a})})]})]}),(0,r.jsx)(e1,{content:m,visible:!!m,x:f.x,y:f.y})]})]})}var e3=n(6133),e8=n.n(e3);function e4(e){let{onWeaponSelect:t,selectedWeapon:n,onStart:s}=e;return(0,r.jsxs)("div",{className:e8().panel,onContextMenu:e=>e.preventDefault(),children:[(0,r.jsx)("h2",{children:"Eidolon"}),(0,r.jsxs)("div",{className:e8().iconSelection,children:[(0,r.jsx)("div",{className:"".concat(e8().icon," ").concat(n===i.SWORD?e8().selected:""),onClick:()=>t(i.SWORD),children:(0,r.jsx)("div",{className:e8().iconContent,children:(0,r.jsx)("img",{src:"/Eidolon/icons/2.svg",alt:"Sword"})})}),(0,r.jsx)("div",{className:"".concat(e8().icon," ").concat(n===i.SCYTHE?e8().selected:""),onClick:()=>t(i.SCYTHE),children:(0,r.jsx)("div",{className:e8().iconContent,children:(0,r.jsx)("img",{src:"/Eidolon/icons/1.svg",alt:"Scythe"})})}),(0,r.jsx)("div",{className:"".concat(e8().icon," ").concat(n===i.SABRES?e8().selected:""),onClick:()=>t(i.SABRES),children:(0,r.jsx)("div",{className:e8().iconContent,children:(0,r.jsx)("img",{src:"/Eidolon/icons/3.svg",alt:"Sabres"})})})]}),(0,r.jsx)("button",{className:e8().startButton,onClick:s,disabled:!n,children:"Enter"})]})}var e6=n(5151),e7=n.n(e6);function e9(e){let{onContinue:t,onSelectIcon:n,selectedIcon:o,currentWeapon:a,onAbilityUnlock:l}=e,[c,h]=(0,s.useState)(null),[d,m]=(0,s.useState)({x:0,y:0}),p=(e,t)=>{let n=u[a][t],r=e.currentTarget.getBoundingClientRect();h(n),m({x:r.left-721,y:r.top-70})},f=()=>{h(null)},x=(()=>{switch(a){case i.SCYTHE:return{r:"/Eidolon/icons/r1.svg",p:"/Eidolon/icons/p1.svg"};case i.SWORD:return{r:"/Eidolon/icons/r2.svg",p:"/Eidolon/icons/p2.svg"};case i.SABRES:return{r:"/Eidolon/icons/r3.svg",p:"/Eidolon/icons/p3.svg"};case i.SABRES2:return{r:"/Eidolon/icons/r4.svg",p:"/Eidolon/icons/p4.svg"}}})(),g=e=>{n(e),l(1===e?"r":"passive")};return(0,r.jsxs)("div",{className:e7().panel,style:{pointerEvents:"auto"},onContextMenu:e=>e.preventDefault(),children:[(0,r.jsx)("h2",{children:"Level Complete!"}),(0,r.jsx)("p",{children:"Choose an ability to unlock:"}),(0,r.jsxs)("div",{className:e7().iconSelection,children:[(0,r.jsx)("div",{className:"".concat(e7().icon," ").concat(1===o?e7().selected:""),onClick:()=>g(1),onMouseEnter:e=>p(e,"r"),onMouseLeave:f,children:(0,r.jsxs)("div",{className:e7().iconContent,children:[(0,r.jsx)("img",{src:null==x?void 0:x.r,alt:"R Ability",style:{width:"75px",height:"75px"}}),(0,r.jsx)("p",{children:"[R] Hotkey"})]})}),(0,r.jsx)("div",{className:"".concat(e7().icon," ").concat(2===o?e7().selected:""),onClick:()=>g(2),onMouseEnter:e=>p(e,"passive"),onMouseLeave:f,children:(0,r.jsxs)("div",{className:e7().iconContent,children:[(0,r.jsx)("img",{src:null==x?void 0:x.p,alt:"Passive Ability",style:{width:"75px",height:"75px"}}),(0,r.jsx)("p",{children:"[1] Hotkey"})]})})]}),(0,r.jsx)("button",{className:e7().continueButton,onClick:t,disabled:null===o,children:"Confirm"}),(0,r.jsx)(e1,{content:c,visible:!!c,x:d.x,y:d.y})]})}var te=n(2374),tt=n.n(te);let tn=[{title:"The Darkness Claims Another",subtitle:"Your soul joins the eternal dance..."},{title:"Fallen to Shadow",subtitle:"The necropolis grows stronger..."},{title:"Death's Embrace",subtitle:"The bones welcome their kin..."},{title:"The Last Stand",subtitle:"Your light fades into the abyss..."},{title:"Eternal Rest",subtitle:"The skeleton army claims victory..."},{title:"Denied Ascension",subtitle:"The dragons turn their backs on another unworthy soul..."},{title:"Draconic Disappointment",subtitle:"Your flames were not strong enough to join their ranks..."},{title:"Failed Wyrm",subtitle:"The ancient dragons scoff at your weakness..."},{title:"Wingless One",subtitle:"You'll never know the freedom of dragon flight..."},{title:"Mortal Chains",subtitle:"Forever bound to walk while dragons soar above..."},{title:"Lost Heritage",subtitle:"The dragon blood within you grows cold..."},{title:"Fading Ember",subtitle:"Your draconic spark extinguishes in darkness..."},{title:"Rejected by Fire",subtitle:"The dragon's flame finds you unworthy..."}];function tr(e){let{playerHealth:t,onReset:n,killCount:o}=e,[i,a]=(0,s.useState)(!1),[l,c]=(0,s.useState)(null);return(0,s.useEffect)(()=>{t<=0&&!i&&(c(tn[Math.floor(Math.random()*tn.length)]),a(!0),window.dispatchEvent(new CustomEvent("gameOver")))},[t,i]),(0,r.jsx)(r.Fragment,{children:i&&l&&(0,r.jsxs)("div",{className:tt().gameOverContainer,onClick:e=>e.stopPropagation(),onMouseDown:e=>e.stopPropagation(),children:[(0,r.jsx)("h1",{className:tt().gameOverTitle,children:l.title}),(0,r.jsx)("p",{className:tt().gameOverSubtitle,children:l.subtitle}),(0,r.jsx)("button",{className:tt().retryButton,onClick:()=>{console.log("Behavior: Reset triggered"),a(!1),c(null),window.dispatchEvent(new CustomEvent("gameReset")),n()},children:"RETRY"}),(0,r.jsxs)("div",{className:tt().killCounter,children:["Skeletons Defeated: ",o]})]})})}function ts(e){let{sceneProps:t,currentWeapon:n,onWeaponSelect:i,playerHealth:a,maxHealth:l,abilities:c,onReset:u,killCount:h,onAbilityUnlock:d}=e,[m,p]=(0,s.useState)(!1),[f,x]=(0,s.useState)(!1),[g,v]=(0,s.useState)(null),[M,P]=(0,s.useState)(1),w=(0,s.useCallback)((e,t)=>{P(e),x(t)},[]),S=(0,s.useCallback)(()=>{P(2),x(!1),v(null)},[]),I=(0,s.useCallback)(()=>{console.log("GameWrapper: Reset triggered"),p(!1),P(1),x(!1),v(null),u()},[u]);return(0,s.useEffect)(()=>{let e=e=>{"Space"===e.code&&e.preventDefault()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{style:{width:"100vw",height:"100vh",overflow:"hidden",position:"fixed",top:0,left:0,touchAction:"none"},children:(0,r.jsxs)(j.Hl,{children:[(0,r.jsx)("ambientLight",{intensity:.2}),m&&(0,r.jsx)(eW,{sceneProps:{...t,onReset:I},onAbilityUnlock:d,onLevelTransition:w,currentLevel:M}),(0,r.jsx)(y.N,{ref:t.unitProps.controlsRef,enablePan:!1,maxPolarAngle:Math.PI/2.25,maxDistance:21,mouseButtons:{LEFT:void 0,MIDDLE:void 0,RIGHT:o.kBv.ROTATE},minDistance:7,rotateSpeed:.75,enableDamping:!0,dampingFactor:.075,zoomSpeed:1.5,position:[0,15,20],target:[0,0,0]})]})}),(0,r.jsx)(tr,{playerHealth:a,onReset:I,killCount:h,onEnemiesDefeated:()=>{},maxSkeletons:15}),(0,r.jsx)("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:!m||f?"auto":"none",zIndex:1e3},children:m?f?(0,r.jsx)(e9,{onContinue:S,onSelectIcon:v,selectedIcon:g,currentWeapon:n,onAbilityUnlock:d}):(0,r.jsx)(e5,{currentWeapon:n,onWeaponSelect:()=>{},playerHealth:a,maxHealth:l,abilities:c,onReset:u,killCount:h}):(0,r.jsx)(e4,{onWeaponSelect:i,selectedWeapon:n,onStart:()=>{console.log("handleStart called, currentWeapon:",n),n&&p(!0)}})})]})}let to=()=>{let e=Math.random()*Math.PI*2,t=15*Math.sqrt(Math.random());return new o.Pq0(Math.cos(e)*t,0,Math.sin(e)*t)};function ti(){let[e,t]=(0,s.useState)(null),n=(0,s.useRef)(null),[a,u]=(0,s.useState)(200),[x,j]=(0,s.useState)(200),[y,v]=(0,s.useState)(0),[M,P]=(0,s.useState)(()=>l),[w,S]=(0,s.useState)({r:!1,passive:!1}),I=(0,s.useMemo)(()=>({mainTree:new o.Pq0(0,2,-5)}),[]),C=(0,s.useMemo)(()=>m(),[]),b=(0,s.useMemo)(()=>p(),[]),E=(0,s.useMemo)(()=>f(),[]),R=(0,s.useMemo)(()=>g(),[]),[_,k]=(0,s.useState)(),[T,G]=(0,s.useState)();(0,s.useEffect)(()=>{k(new o.Q1f(h[Math.floor(Math.random()*h.length)])),G(new o.Q1f(d[Math.floor(Math.random()*d.length)]))},[]);let D=e=>{t(e)},F=(0,s.useCallback)((e,t)=>{let n=Date.now();if(n-y>100){if(e.startsWith("skeleton-")){let n=parseInt(e.split("-")[1]);B(e=>{let r=[...e];return r[n]=Math.max(0,e[n]-t),r})}v(n)}},[y]),z=(e,t)=>{P(n=>{let r={...n};return r[e][t].currentCooldown=c(e,t,n),r})};(0,s.useEffect)(()=>{let e=setInterval(()=>{P(e=>{let t={...e};return Object.keys(t).forEach(e=>{["q","e","r","passive"].forEach(n=>{t[e][n].currentCooldown>0&&(t[e][n].currentCooldown-=.15)})}),t})},150);return()=>clearInterval(e)},[]);let[q]=(0,s.useState)(new o.Pq0(0,0,0)),[,B]=(0,s.useState)(()=>[,,,,,].fill(175)),[A,L]=(0,s.useState)(()=>Array.from({length:5},(e,t)=>{let n=to();return{id:"skeleton-".concat(t),initialPosition:n,position:n.clone(),health:175,maxHealth:175,onTakeDamage:(e,t)=>{L(n=>n.map(n=>n.id===e?{...n,health:Math.max(0,n.health-t)}:n))}}})),[O,N]=(0,s.useState)(0),H=(0,s.useCallback)(()=>{console.log("Enemy death registered in HomePage"),N(e=>{let t=e+1;return console.log("Kill count updated:",t),j(200+t),u(e=>e+1),t})},[]),Q=(0,s.useCallback)((e,t,n)=>{L(n=>n.map(n=>n.id===e?{...n,health:Math.max(0,n.health-t)}:n)),n&&console.log("Critical hit on ".concat(e," for ").concat(t," damage!"))},[]),W=(0,s.useCallback)((e,t,n,r)=>{console.log("Smite hit ".concat(e," for ").concat(t," damage (Critical: ").concat(n,") at position:"),r),F(e,t)},[F]),U=(0,s.useRef)(null),Y=()=>{console.log("HomePage: Reset triggered"),j(200),u(200),B([,,,,,].fill(175)),P(e=>{let t={...e};return Object.keys(t).forEach(e=>{["q","e"].forEach(n=>{t[e][n].currentCooldown=0})}),t}),v(0),N(0),t(null),S({r:!1,passive:!1})},Z=(0,s.useCallback)(e=>{u(t=>Math.min(x,t+e))},[x]),V={mountainData:C,treeData:b,mushroomData:E,treePositions:I,interactiveTrunkColor:_,interactiveLeafColor:T,onReset:Y,unitProps:{onFireballDamage:Q,onSmiteDamage:W,onHit:F,controlsRef:n,currentWeapon:e||i.SCYTHE,onWeaponSelect:D,health:a,maxHealth:x,isPlayer:!0,abilities:{...M,...e?{[e]:{...M[e],r:{...M[e].r,isUnlocked:w.r},passive:{...M[e].passive,isUnlocked:w.passive}}}:{}},onAbilityUse:(t,n)=>{e&&z(t,n)},onPositionUpdate:e=>{q.copy(e)},enemyData:A.map(e=>({id:e.id,position:e.position,initialPosition:e.initialPosition,currentPosition:e.position.clone(),health:e.health,maxHealth:e.maxHealth})),onDamage:e=>{u(t=>Math.max(0,t-e))},onEnemyDeath:H,fireballManagerRef:U,onHealthChange:Z},skeletonProps:A,killCount:O,onFireballDamage:Q,onWeaponSelect:D,flowerData:R};return(0,s.useEffect)(()=>{let e=e=>{"Space"===e.code&&e.preventDefault()};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[]),(0,r.jsx)("div",{style:{width:"100vw",height:"100vh",overflow:"hidden",position:"fixed",top:0,left:0},children:(0,r.jsx)(ts,{sceneProps:V,currentWeapon:e,onWeaponSelect:D,playerHealth:a,maxHealth:x,abilities:M,onReset:Y,killCount:O,onAbilityUnlock:t=>{console.log("Unlocking ".concat(t," ability")),S(e=>({...e,[t]:!0})),P(n=>{let r={...n};return e&&(r[e][t].isUnlocked=!0),r})}})})}},5831:e=>{e.exports={notification:"DamageNotification_notification__f3Yeu",floatUp:"DamageNotification_floatUp__Myim4",visible:"DamageNotification_visible__jYt6g",hidden:"DamageNotification_hidden__l4PWe"}},5151:e=>{e.exports={panel:"LevelCompletionPanel_panel__dcef3",iconSelection:"LevelCompletionPanel_iconSelection__jS9NE",icon:"LevelCompletionPanel_icon__lRABe",selected:"LevelCompletionPanel_selected__PqyOR",continueButton:"LevelCompletionPanel_continueButton__xlmot",iconContent:"LevelCompletionPanel_iconContent__DqvWS"}},5019:e=>{e.exports={bottomPanel:"Panel_bottomPanel__E_GFV",weaponSection:"Panel_weaponSection__zIJl0",weaponIcon:"Panel_weaponIcon__iLPYg",levelBadge:"Panel_levelBadge__XHoiD",badgePulse:"Panel_badgePulse__tCaHu",statsSection:"Panel_statsSection__cewg2",healthBarContainer:"Panel_healthBarContainer___xHn5",healthBarInner:"Panel_healthBarInner__B2SSK",experienceBar:"Panel_experienceBar__G5pO5",abilitiesSection:"Panel_abilitiesSection__LVE1_",ability:"Panel_ability__vWpFg",healthBarSection:"Panel_healthBarSection__Lc4_u",healthBarDecoration:"Panel_healthBarDecoration__ok97A",healthBarOrnamentLeft:"Panel_healthBarOrnamentLeft__l_eLO",healthBarOrnamentRight:"Panel_healthBarOrnamentRight__DlmuW",healthBar:"Panel_healthBar__Md85Z",healthBarBackground:"Panel_healthBarBackground__jdRKY",healthBarShine:"Panel_healthBarShine__88Hkf",shine:"Panel_shine__uI8op",healthBarPulse:"Panel_healthBarPulse__CZkcb",pulse:"Panel_pulse__tyA5r",healthText:"Panel_healthText__1fCQl",healthCurrent:"Panel_healthCurrent__7n6qI",healthSeparator:"Panel_healthSeparator__aVnh_",healthMax:"Panel_healthMax__tYk8m",abilityContainer:"Panel_abilityContainer__sN6a4",abilityIcon:"Panel_abilityIcon__3DloH",weaponIcons:"Panel_weaponIcons__FW360",weaponSlot:"Panel_weaponSlot__dVwz7",keyBind:"Panel_keyBind__D5m1t",activeWeapon:"Panel_activeWeapon__uZq6r",cooldownOverlay:"Panel_cooldownOverlay__GJ3zY",cooldownText:"Panel_cooldownText__kVTtb",roundedSquareProgress:"Panel_roundedSquareProgress__1eZW_",progressForeground:"Panel_progressForeground__Acr3c",gameOverOverlay:"Panel_gameOverOverlay__Bud_o",gameOverTitle:"Panel_gameOverTitle__zo4Jg",gameOverSubtitle:"Panel_gameOverSubtitle__qVO8v",retryButton:"Panel_retryButton__GOTn9",killCounter:"Panel_killCounter__iC_Sg",killCountText:"Panel_killCountText__hQyjQ",xpFill:"Panel_xpFill__RXvNL",levelText:"Panel_levelText__SgUXR",experienceBarContainer:"Panel_experienceBarContainer__9mese",experienceBarOrnamentLeft:"Panel_experienceBarOrnamentLeft__JvEOr",experienceBarOrnamentRight:"Panel_experienceBarOrnamentRight__can19",locked:"Panel_locked__Anu5g",tooltip:"Panel_tooltip__tY4zh",abilityTooltip:"Panel_abilityTooltip__QPsMI",controlsSection:"Panel_controlsSection__V2l2S",controlGroup:"Panel_controlGroup__ZKwO3",controlKey:"Panel_controlKey__NC_tm",controlLabel:"Panel_controlLabel__7c5bl",controlDivider:"Panel_controlDivider__R4TV2",leftPanel:"Panel_leftPanel___5GQG",weaponPulse:"Panel_weaponPulse__fP758",glowPulse:"Panel_glowPulse__Ye37n"}},5190:e=>{e.exports={tooltip:"Tooltip_tooltip__7tEfC"}},6133:e=>{e.exports={panel:"WeaponSelectionPanel_panel__XVTME",iconContent:"WeaponSelectionPanel_iconContent__0raLR",icon:"WeaponSelectionPanel_icon__s7G0N",startButton:"WeaponSelectionPanel_startButton__zI16Y",iconSelection:"WeaponSelectionPanel_iconSelection__b3lef",selected:"WeaponSelectionPanel_selected__yqwcS",spinHex:"WeaponSelectionPanel_spinHex__23BFC",pulseGlow:"WeaponSelectionPanel_pulseGlow__6GI0P"}},2374:e=>{e.exports={gameOverContainer:"Behavior_gameOverContainer__wiKZW",gameOverTitle:"Behavior_gameOverTitle__B0h2R",gameOverSubtitle:"Behavior_gameOverSubtitle____YXI",retryButton:"Behavior_retryButton__N9g61",killCounter:"Behavior_killCounter__Vm3B2"}}},e=>{var t=t=>e(e.s=t);e.O(0,[624,438,84,111,636,593,792],()=>t(2022)),_N_E=e.O()}]);