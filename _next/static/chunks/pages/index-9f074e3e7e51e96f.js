(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[332],{2022:(e,t,r)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return r(625)}])},625:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>tZ});var n=r(4848),s=r(6540),o=r(4922),i=function(e){return e.SCYTHE="scythe",e.SWORD="sword",e.SABRES="sabres",e.SABRES2="sabres2",e.STAFF="staff",e}({});let a={sword:{normal:31,range:5.325,maxHitsPerSwing:1},scythe:{normal:23,range:4.275,maxHitsPerSwing:1},sabres:{normal:17,range:4.05,maxHitsPerSwing:2},sabres2:{normal:11,range:4,maxHitsPerSwing:2},staff:{normal:15,range:4,maxHitsPerSwing:1}},l={scythe:{q:{type:"q",key:"q",cooldown:.725,currentCooldown:0,icon:"/Eidolon/icons/q1.svg",maxCooldown:1,name:"Scythe Q",isUnlocked:!0},e:{type:"e",key:"e",cooldown:.75,currentCooldown:0,icon:"/Eidolon/icons/e1.svg",maxCooldown:.6675,name:"Scythe E",isUnlocked:!0},r:{type:"r",key:"r",cooldown:1.95,currentCooldown:0,icon:"/Eidolon/icons/r1.svg",maxCooldown:1.8,name:"Boneclaw",isUnlocked:!1},passive:{type:"passive",key:"1",cooldown:.75,currentCooldown:0,icon:"/Eidolon/icons/p1.svg",maxCooldown:0,name:"Reanimate",isUnlocked:!1},active:{type:"active",key:"2",cooldown:4.5,currentCooldown:0,icon:"/Eidolon/icons/a1.svg",maxCooldown:4.5,name:"Summon Skeleton",isUnlocked:!1}},sword:{q:{type:"q",key:"q",cooldown:.95,currentCooldown:0,icon:"/Eidolon/icons/q2.svg",maxCooldown:1.08,name:"Sword Q",isUnlocked:!0},e:{type:"e",key:"e",cooldown:4,currentCooldown:0,icon:"/Eidolon/icons/e2.svg",maxCooldown:4,name:"Sword E",isUnlocked:!0},r:{type:"r",key:"r",cooldown:1.25,currentCooldown:0,icon:"/Eidolon/icons/r2.svg",maxCooldown:1.75,name:"Oathstrike",isUnlocked:!1},passive:{type:"passive",key:"1",cooldown:0,currentCooldown:0,icon:"/Eidolon/icons/p2.svg",maxCooldown:0,name:"Crusader Aura",isUnlocked:!1},active:{type:"active",key:"2",cooldown:0,currentCooldown:0,icon:"/Eidolon/icons/a2.svg",maxCooldown:0,name:"Sword Active",isUnlocked:!1}},sabres:{q:{type:"q",key:"q",cooldown:.625,currentCooldown:0,icon:"/Eidolon/icons/q3.svg",maxCooldown:.9,name:"Sabres Q",isUnlocked:!0},e:{type:"e",key:"e",cooldown:.51,currentCooldown:0,icon:"/Eidolon/icons/e3.svg",maxCooldown:1,name:"Sabres E",isUnlocked:!0},r:{type:"r",key:"r",cooldown:10,currentCooldown:0,icon:"/Eidolon/icons/r3.svg",maxCooldown:10,name:"Blizzard",isUnlocked:!1},passive:{type:"passive",key:"1",cooldown:0,currentCooldown:0,icon:"/Eidolon/icons/p3.svg",maxCooldown:0,name:"Frost Lance",isUnlocked:!1},active:{type:"active",key:"2",cooldown:0,currentCooldown:0,icon:"/Eidolon/icons/a3.svg",maxCooldown:0,name:"Orb Shield",isUnlocked:!1}},sabres2:{q:{type:"q",key:"q",cooldown:.7,currentCooldown:0,icon:"/Eidolon/icons/q4.svg",maxCooldown:1.5,name:"Sabres2 Q",isUnlocked:!0},e:{type:"e",key:"e",cooldown:1.5,currentCooldown:0,icon:"/Eidolon/icons/e4.svg",maxCooldown:6,name:"Firebeam",isUnlocked:!0},r:{type:"r",key:"r",cooldown:15,currentCooldown:0,icon:"/Eidolon/icons/r4.svg",maxCooldown:15,name:"Blizzard",isUnlocked:!1},passive:{type:"passive",key:"1",cooldown:.5,currentCooldown:0,icon:"/Eidolon/icons/p1.svg",maxCooldown:0,name:"Reanimate",isUnlocked:!1},active:{type:"active",key:"2",cooldown:0,currentCooldown:0,icon:"/Eidolon/icons/s4.svg",maxCooldown:0,name:"Sabres2 Active",isUnlocked:!1}},staff:{q:{type:"q",key:"q",cooldown:.8,currentCooldown:0,icon:"/Eidolon/icons/q4.svg",maxCooldown:1,name:"Staff Q",isUnlocked:!0},e:{type:"e",key:"e",cooldown:2,currentCooldown:0,icon:"/Eidolon/icons/e4.svg",maxCooldown:0,name:"Firebeam",isUnlocked:!0},r:{type:"r",key:"r",cooldown:15,currentCooldown:0,icon:"/Eidolon/icons/r4.svg",maxCooldown:15,name:"Blizzard",isUnlocked:!1},passive:{type:"passive",key:"1",cooldown:.5,currentCooldown:0,icon:"/Eidolon/icons/p1.svg",maxCooldown:0,name:"Reanimate",isUnlocked:!1},active:{type:"active",key:"2",cooldown:0,currentCooldown:0,icon:"/Eidolon/icons/s4.svg",maxCooldown:0,name:"Staff Active",isUnlocked:!1}}},c=(e,t,r)=>{let n=l[e][t];return"sword"===e&&"q"===t&&r.sword.passive.isUnlocked?.69:n.cooldown},h={scythe:{q:{title:"Reap",description:"A swift scythe attack in an arc - Cooldown: 0.75 seconds - Range: 4.2 feet",cost:"Cooldown: 0.75 seconds",range:"Range: 4.2 feet",damage:"Damage: 17"},e:{title:"Chaos Bolt",description:"Consumes 1 Orb Charge to fire a long range bolt to a single enemy.",cost:"Consumes 1 Orb Charge",range:"Range: 80 feet",damage:"Damage: 53"},r:{title:"Bone Claw",description:"Summon skeletal lazer claws - Cooldown: 1.8 seconds - Range: 4.0-8.0 feet",cost:"Cooldown: 2.5 seconds",range:"Range: 8.0 feet",damage:"Damage: 67"},passive:{title:"Reanimate",description:"Consumes 1 Orb Charge to heal for health. 0.75 second cooldown."},active:{title:"Chaos Totem",description:"Active: Summon a totem that fights by your side, shooting rapid bolts at enemies within range.",cost:"Cooldown: 15 seconds"}},sword:{q:{title:"Swordstrike",description:"A powerful sword strike in an arc - Cooldown: 1.1 seconds - Range: 6.5 feet",cost:"1.1",range:"6.5",damage:"29"},e:{title:"Smite",description:"Strikes enemies with a extra swing that will call down a powerful divine smite, damaging all nearby enemies if the initial strike is successful.",cost:"30",range:"4.0",damage:"35"},r:{title:"Oathstrike",description:"Active: Consumes 4 Orb Charges to unleash an invigorating strike that heals while damaging enemies in an arc.",cost:"50",range:"7.0",damage:"65"},passive:{title:"Crusader Aura",description:"Passive: Increases attack speed by 35% and gives attacks a 65% chance to trigger chain lightning that deals 25 initial damage."},active:{title:"Chain Lightning",description:"Passive: Sword attacks conduct electricity, dealing lightning damage bouncing between enemie."}},sabres:{q:{title:"Double Slash",description:"Quick dual-wielding attack",cost:"12",range:"3.8",damage:"13"},e:{title:"Etherbow Shot",description:"Damage scales with charge time: 1.75 secondsRange: 80+ feet",cost:"Consumes 1 Orb Charge",range:"Range: 80 feet",damage:"Damage: 53"},r:{title:"Blizzard",description:"Unleash a devastating ice storm to nearby enemies for 6 seconds - 10 second cooldown.",cost:"60",range:"12.0",damage:"85"},passive:{title:"Frost Lance",description:"Consumes 1 Orb Charge to fire a beam of ice that piereces through all enemies in a line."},active:{title:"Avalanche",description:"Melee attacks passively consume orb charges to extra damage based on the number of charges available."}},sabres2:{q:{title:"Test",description:"Test ability"},e:{title:"Test",description:"Test ability"},r:{title:"Test",description:"Test ability"},passive:{title:"Test",description:"Test ability"},active:{title:"Test",description:"Test ability"}},staff:{q:{title:"Test",description:"Test ability"},e:{title:"Test",description:"Test ability"},r:{title:"Test",description:"Test ability"},passive:{title:"Test",description:"Test ability"},active:{title:"Test",description:"Test ability"}}},d=["#E8D5C4","#DEC8B5","#F1E4D6","#E6D5C5","#F2E6D8"],u=["#53BADF","#5E9F49","#E780CC","#FF98B7","#74893A","#ACBF85","#ACBF85","#DFFF9F","#90C956"],m=()=>{let e=[];for(let t=0;t<32;t++){let r=t/32*Math.PI*2,n=54+(4*Math.random()-2),s=Math.cos(r)*n,i=Math.sin(r)*n,a=.75+.4*Math.random();e.push({position:new o.Pq0(s,0,i),scale:a});let l=r+Math.PI/32,c=42*Math.cos(l),h=42*Math.sin(l);e.push({position:new o.Pq0(c,0,h),scale:.9*a})}return e},p=()=>[{position:new o.Pq0(-15,0,-5),scale:1.3,trunkColor:new o.Q1f(d[1]),leafColor:new o.Q1f(u[1])},{position:new o.Pq0(-25,0,-10.5),scale:.75,trunkColor:new o.Q1f(d[1]),leafColor:new o.Q1f(u[1])},{position:new o.Pq0(-12,0,-8),scale:1.25,trunkColor:new o.Q1f(d[1]),leafColor:new o.Q1f(u[1])},{position:new o.Pq0(-12,0,-13.5),scale:.8,trunkColor:new o.Q1f(d[1]),leafColor:new o.Q1f(u[1])},{position:new o.Pq0(30,0,5),scale:1.3,trunkColor:new o.Q1f(d[1]),leafColor:new o.Q1f(u[1])},{position:new o.Pq0(16,0,-10),scale:.75,trunkColor:new o.Q1f(d[1]),leafColor:new o.Q1f(u[1])},{position:new o.Pq0(12,0,8),scale:1.25,trunkColor:new o.Q1f(d[1]),leafColor:new o.Q1f(u[1])},{position:new o.Pq0(-11,0,5),scale:1.3,trunkColor:new o.Q1f(d[1]),leafColor:new o.Q1f(u[1])},{position:new o.Pq0(-12,0,-28.5),scale:.75,trunkColor:new o.Q1f(d[1]),leafColor:new o.Q1f(u[1])},{position:new o.Pq0(12,0,-8),scale:1.25,trunkColor:new o.Q1f(d[1]),leafColor:new o.Q1f(u[1])},{position:new o.Pq0(-12,0,23.5),scale:.8,trunkColor:new o.Q1f(d[1]),leafColor:new o.Q1f(u[1])},{position:new o.Pq0(18,0,-8),scale:1.1,trunkColor:new o.Q1f(d[2]),leafColor:new o.Q1f(u[2])},{position:new o.Pq0(17.5,0,-10),scale:.9,trunkColor:new o.Q1f(d[2]),leafColor:new o.Q1f(u[2])},{position:new o.Pq0(15,0,-11.5),scale:1.1,trunkColor:new o.Q1f(d[2]),leafColor:new o.Q1f(u[2])},{position:new o.Pq0(16.5,0,-6.5),scale:.75,trunkColor:new o.Q1f(d[2]),leafColor:new o.Q1f(u[2])},{position:new o.Pq0(-20,0,-20),scale:1.2,trunkColor:new o.Q1f(d[0]),leafColor:new o.Q1f(u[0])},{position:new o.Pq0(-10,0,-22),scale:.9,trunkColor:new o.Q1f(d[1]),leafColor:new o.Q1f(u[1])},{position:new o.Pq0(0,0,-23),scale:.95,trunkColor:new o.Q1f(d[2]),leafColor:new o.Q1f(u[2])},{position:new o.Pq0(10,0,-22),scale:1.4,trunkColor:new o.Q1f(d[0]),leafColor:new o.Q1f(u[0])},{position:new o.Pq0(20,0,-20),scale:.95,trunkColor:new o.Q1f(d[1]),leafColor:new o.Q1f(u[1])},{position:new o.Pq0(-12,0,12),scale:.8,trunkColor:new o.Q1f(d[2]),leafColor:new o.Q1f(u[2])},{position:new o.Pq0(12,0,12),scale:.8,trunkColor:new o.Q1f(d[0]),leafColor:new o.Q1f(u[0])},{position:new o.Pq0(-5,0,-15),scale:.85,trunkColor:new o.Q1f(d[1]),leafColor:new o.Q1f(u[1])},{position:new o.Pq0(5,0,-18),scale:.85,trunkColor:new o.Q1f(d[2]),leafColor:new o.Q1f(u[2])}],x=()=>{let e=[];for(let t=0;t<60;t++){let t;let r=Math.random()*Math.PI*2,n=48*Math.random(),s=n*Math.cos(r),i=n*Math.sin(r),a=.45+.175*Math.random(),l=100*Math.random();t=l<60?"pink":l<90?"green":"blue",e.push({position:new o.Pq0(s,0,i),scale:a,variant:t})}return e},f=()=>{let e=Math.random()*Math.PI*2,t=22.5*Math.random(),r=Math.cos(e)*t,n=Math.sin(e)*t;return new o.Pq0(r,0,n)},g=()=>{let e=[];for(let t=0;t<35;t++){let t=Math.random()*Math.PI*2,r=44*Math.random(),n=Math.cos(t)*r,s=Math.sin(t)*r,i=.6+.4*Math.random();e.push({position:new o.Pq0(n,0,s),scale:i})}return e},j=()=>{let e=[];e.push({position:new o.Pq0(15,-.2,10),rotation:new o.O9p(-(.05*Math.PI),1.2*Math.PI,0),type:"submerged"});for(let t=0;t<1+Math.floor(Math.random());t++)e.push({position:new o.Pq0((Math.random()-.5)*100,0,(Math.random()-.5)*100),rotation:new o.O9p(0,Math.random()*Math.PI*2,0),type:"plate",scale:.8+.4*Math.random()});let t=20+Math.floor(20*Math.random());for(let r=0;r<t;r++)e.push({position:new o.Pq0((Math.random()-.5)*100,0,(Math.random()-.5)*100),rotation:new o.O9p(0,Math.random()*Math.PI*2,0),type:"bones"});let r=10+Math.floor(10*Math.random());for(let t=0;t<r;t++)e.push({position:new o.Pq0((Math.random()-.5)*100,0,(Math.random()-.5)*100),rotation:new o.O9p(.3*Math.random(),Math.random()*Math.PI*2,.3*Math.random()),type:"shoulder"});return e};var y=r(8875),M=r(2805);function v(e){let{color:t="#FFCAE5",roughness:r=.5,metalness:i=.1}=e,a=(0,s.useRef)(null),l=(0,s.useRef)(null),c=(0,s.useRef)(new o.BKk({uniforms:{time:{value:0},scale:{value:20},elevation:{value:.3},groundScale:{value:0},patchScale:{value:.1},baseColor:{value:new o.Q1f(t)},roughnessValue:{value:r},metalnessValue:{value:i},crackIntensity:{value:2},glowStrength:{value:.8}},vertexShader:"\n      varying vec2 vUv;\n      varying vec3 vNormal;\n      \n      void main() {\n        vUv = uv;\n        vNormal = normal;\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n      }\n    ",fragmentShader:"\n      uniform float time;\n      uniform float scale;\n      uniform float elevation;\n      uniform float groundScale;\n      uniform float patchScale;\n      \n      varying vec2 vUv;\n      varying vec3 vNormal;\n      \n      // Simplex noise function\n      vec3 mod289(vec3 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }\n      vec2 mod289(vec2 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }\n      vec3 permute(vec3 x) { return mod289(((x*34.0)+1.0)*x); }\n      \n      float snoise(vec2 v) {\n        const vec4 C = vec4(0.211324865405187,\n                           0.366025403784439,\n                          -0.577350269189626,\n                           0.024390243902439);\n        vec2 i  = floor(v + dot(v, C.yy) );\n        vec2 x0 = v -   i + dot(i, C.xx);\n        vec2 i1;\n        i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\n        vec4 x12 = x0.xyxy + C.xxzz;\n        x12.xy -= i1;\n        i = mod289(i);\n        vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))\n                         + i.x + vec3(0.0, i1.x, 1.0 ));\n        vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);\n        m = m*m ;\n        m = m*m ;\n        vec3 x = 2.0 * fract(p * C.www) - 1.0;\n        vec3 h = abs(x) - 0.5;\n        vec3 ox = floor(x + 0.5);\n        vec3 a0 = x - ox;\n        m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );\n        vec3 g;\n        g.x  = a0.x  * x0.x  + h.x  * x0.y;\n        g.yz = a0.yz * x12.xz + h.yz * x12.yw;\n        return 130.0 * dot(m, g);\n      }\n      \n      uniform float crackIntensity;\n      uniform float glowStrength;\n\n      float getCrackPattern(vec2 uv) {\n        // Create sharp, vein-like cracks\n        float noise1 = abs(snoise(uv * 3.0));\n        float noise2 = abs(snoise(uv * 6.0 + 1234.5));\n        \n        // Combine noises to create crack pattern\n        float crack = smoothstep(0.7, 0.8, noise1 * noise2);\n        return crack;\n      }\n\n      void main() {\n        // Create brown patches\n        vec2 patchUv = vUv * patchScale;\n        float patchPattern = snoise(patchUv + time * 0.01);\n        float patchPattern2 = snoise(patchUv * 1.5 + time * 0.015); // Second noise for third color\n        \n        // Add a third noise pattern for light blue patches\n        vec2 lightPatchUv = vUv * 0.1; // Larger scale for light patches\n        float lightPattern = smoothstep(0.4, 0.6, snoise(lightPatchUv + time * 0.007));\n        \n        // Base colors - muted blue fantasy theme with light accents\n        vec3 grassColor = vec3(0.2, 0.265, 0.6);      // Deeper muted blue\n        vec3 brownColor = vec3(0.20, 0.3, 0.7);    // Medium muted blue\n        vec3 lightBrownColor = vec3(0.3, 0.4, 0.8); // Lighter muted blue\n        vec3 accentColor = vec3(0.5, 0.6, 0.95);    // Very light blue accent\n        \n        // Mix colors based on noise patterns\n        vec3 baseGroundColor = mix(grassColor, brownColor, patchPattern * 0.6);\n        baseGroundColor = mix(baseGroundColor, lightBrownColor, patchPattern2 * 0.4);\n        // Add light blue accents\n        baseGroundColor = mix(baseGroundColor, accentColor, lightPattern * 0.3);\n        \n        // Add noise detail\n        vec2 uv = vUv * scale;\n        float n = snoise(uv) * 0.5;\n        n += snoise(uv * 2.0) * 0.25;\n        \n        // Apply detail to final color\n        vec3 finalColor = mix(baseGroundColor, baseGroundColor * 1.2, n * 0.3);\n        \n        // Add cracks\n        vec2 crackUv = vUv * crackIntensity + time * 0.05;\n        float crackPattern = getCrackPattern(crackUv);\n        \n        // Create glowing effect for cracks\n        vec3 glowColor = vec3(0.2, 0.8, 0.3); // Green gas color\n        float glow = smoothstep(0.2, 0.8, crackPattern) * glowStrength;\n        \n        // Pulse the glow\n        float pulse = sin(time * 2.0) * 0.5 + 0.5;\n        glow *= 0.8 + 0.2 * pulse;\n        \n        // Mix the crack glow with the base terrain\n        finalColor = mix(finalColor, glowColor, glow * 0.6);\n        \n        // Add extra brightness to crack centers\n        float crackCenter = smoothstep(0.85, 0.95, crackPattern);\n        finalColor += glowColor * crackCenter * 0.5;\n\n        gl_FragColor = vec4(finalColor, 1.0);\n      }\n    ",side:o.$EB})).current;return s.useEffect(()=>{if(!l.current){let e=new o.ypk;for(let t=0;t<8;t++){let r=t/8*Math.PI*2,n=50*Math.cos(r),s=50*Math.sin(r);0===t?e.moveTo(n,s):e.lineTo(n,s)}e.closePath(),l.current=e}},[]),(0,n.jsx)("group",{children:(0,n.jsxs)("mesh",{ref:a,rotation:[-Math.PI/2,0,0],receiveShadow:!0,children:[l.current&&(0,n.jsx)("shapeGeometry",{args:[l.current]}),(0,n.jsx)("primitive",{object:c,attach:"material"})]})})}let P=e=>{let{position:t,scale:r=1,isInteractive:o=!1,health:i=100}=e,a=(0,s.useRef)(null);return((0,s.useEffect)(()=>{if(o&&i<=0&&a.current){var e;null===(e=a.current.parent)||void 0===e||e.remove(a.current)}},[i,o]),o&&i<=0)?null:(0,n.jsxs)("group",{name:"mountain",position:t,scale:r,children:[(0,n.jsxs)("mesh",{ref:a,castShadow:!0,receiveShadow:!0,children:[(0,n.jsx)("coneGeometry",{args:[23,35,8]}),(0,n.jsx)("meshPhysicalMaterial",{color:"#2a2a2a",metalness:.1,roughness:1,emissive:"#222222",flatShading:!0,clearcoat:.1,clearcoatRoughness:.8})]}),(0,n.jsxs)("mesh",{position:[-4,-5,-2],rotation:[0,.5,.1],castShadow:!0,children:[(0,n.jsx)("coneGeometry",{args:[24,28,7]}),(0,n.jsx)("meshPhysicalMaterial",{color:"#252525",metalness:.05,roughness:1,flatShading:!0,clearcoat:.1,clearcoatRoughness:.9})]}),(0,n.jsxs)("mesh",{position:[0,14,0],castShadow:!0,children:[(0,n.jsx)("coneGeometry",{args:[5,8,8]}),(0,n.jsx)("meshPhysicalMaterial",{color:"#ffffff",metalness:.1,roughness:.3,flatShading:!0,clearcoat:.4,clearcoatRoughness:.2,envMapIntensity:1.5})]})]})},w=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1,r=new o.Q1f(e);return r.r=o.cj9.clamp(r.r+(Math.random()-.5)*t,0,1),r.g=o.cj9.clamp(r.g+(Math.random()-.5)*t,0,1),r.b=o.cj9.clamp(r.b+(Math.random()-.5)*t,0,1),r},S=s.memo(e=>{let{position:t=new o.Pq0(0,2,-5),scale:r=.8,leafColor:i}=e,a=(0,s.useMemo)(()=>w(i),[i]),l=.25*r,c=4*r,h=1.35*r,d=1.7*r;return(0,n.jsx)("group",{name:"tree",position:t,scale:.9*r,children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[l,1.225*l,c,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#FFBD83",roughness:.8,metalness:.1}),(0,n.jsxs)("mesh",{position:[0,.56*c,0],name:"tree-top",children:[(0,n.jsx)("coneGeometry",{args:[h,d,8]}),(0,n.jsx)("meshStandardMaterial",{color:a,roughness:.4,metalness:.1,emissive:a,emissiveIntensity:.475})]}),(0,n.jsxs)("mesh",{position:[0,.69*c,0],name:"tree-top",children:[(0,n.jsx)("coneGeometry",{args:[.8*h,.8*d,8]}),(0,n.jsx)("meshStandardMaterial",{color:a,roughness:.4,metalness:.1,emissive:a,emissiveIntensity:.45})]}),(0,n.jsxs)("mesh",{position:[0,.85*c,0],name:"tree-top-2",children:[(0,n.jsx)("coneGeometry",{args:[.56*h,.8*d,8]}),(0,n.jsx)("meshStandardMaterial",{color:a.clone().multiplyScalar(1.1),roughness:.4,metalness:.1,emissive:a,emissiveIntensity:.49})]}),(0,n.jsxs)("mesh",{position:[0,.905*c,0],name:"tree-top-3",children:[(0,n.jsx)("coneGeometry",{args:[.525*h,.45*d,8]}),(0,n.jsx)("meshStandardMaterial",{color:a.clone().multiplyScalar(1.15),roughness:.4,metalness:.1,emissive:a,emissiveIntensity:.485})]})]})})});var I=r(3421);let b=e=>{let{position:t,scale:r,variant:i="pink"}=e,a=(0,s.useRef)(null),l=(0,s.useMemo)(()=>{switch(i){case"green":return new o.Q1f("#00FFFF");case"blue":return new o.Q1f("#FF9058");default:return new o.Q1f("#F096CC")}},[i]),c=(0,s.useMemo)(()=>{switch(i){case"green":return new o.Q1f("#2eb82e");case"blue":return new o.Q1f("#0000FF");default:return new o.Q1f("#9b4f96")}},[i]);return(0,I.F)(e=>{a.current&&(a.current.position.y=t.y+.05*Math.sin(e.clock.getElapsedTime()))}),(0,n.jsxs)("group",{position:t,scale:.8*r,children:[(0,n.jsxs)("mesh",{ref:a,children:[(0,n.jsx)("cylinderGeometry",{args:[.1,.12,.8,16]}),(0,n.jsx)("meshStandardMaterial",{color:l.clone().multiplyScalar(.9),roughness:.4,metalness:.1,emissive:l,emissiveIntensity:.25})]}),(0,n.jsxs)("mesh",{position:[0,.4,0],children:[(0,n.jsx)("sphereGeometry",{args:[.3,32,32,0,2*Math.PI,0,Math.PI/2]}),(0,n.jsx)("meshStandardMaterial",{color:l,roughness:.4,metalness:.1,emissive:l,emissiveIntensity:.375})]}),[...Array(6)].map((e,t)=>(0,n.jsxs)("mesh",{position:[.15*Math.sin(t*Math.PI/3),.3,.15*Math.cos(t*Math.PI/3)],rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("circleGeometry",{args:[.04,16]}),(0,n.jsx)("meshStandardMaterial",{color:c,emissive:c,emissiveIntensity:.25})]},t))]})},C=e=>{let{color:t,size:r,meshRef:i,opacity:a=1}=e,l=(0,s.useRef)(null),c=(0,s.useRef)(new Float32Array(120)),h=(0,s.useRef)(new Float32Array(40)),d=(0,s.useRef)(new Float32Array(40)),u=(0,s.useRef)(!1);return(0,s.useEffect)(()=>{if(i.current&&!u.current){let{x:e,y:t,z:r}=i.current.position;for(let n=0;n<40;n++)c.current[3*n]=e,c.current[3*n+1]=t,c.current[3*n+2]=r,h.current[n]=0,d.current[n]=0;u.current=!0}},[i]),(0,I.F)(()=>{var e;if(!(null===(e=l.current)||void 0===e?void 0:e.parent)||!i.current||!u.current)return;let{x:t,y:n,z:s}=i.current.position;for(let e=39;e>0;e--)c.current[3*e]=c.current[(e-1)*3],c.current[3*e+1]=c.current[(e-1)*3+1],c.current[3*e+2]=c.current[(e-1)*3+2],h.current[e]=.6*Math.pow(1-e/40,2)*a,d.current[e]=.5*r*Math.pow(1-e/40,.5);if(c.current[0]=t,c.current[1]=n,c.current[2]=s,h.current[0]=.6*a,d.current[0]=1.3*r,l.current){let e=l.current.geometry;e.attributes.position.array=c.current,e.attributes.position.needsUpdate=!0,e.attributes.opacity&&(e.attributes.opacity.array=h.current,e.attributes.opacity.needsUpdate=!0),e.attributes.scale&&(e.attributes.scale.array=d.current,e.attributes.scale.needsUpdate=!0)}}),(0,n.jsxs)("points",{ref:l,children:[(0,n.jsxs)("bufferGeometry",{children:[(0,n.jsx)("bufferAttribute",{attach:"attributes-position",count:40,array:c.current,itemSize:3}),(0,n.jsx)("bufferAttribute",{attach:"attributes-opacity",count:40,array:h.current,itemSize:1}),(0,n.jsx)("bufferAttribute",{attach:"attributes-scale",count:40,array:d.current,itemSize:1})]}),(0,n.jsx)("shaderMaterial",{transparent:!0,depthWrite:!1,blending:o.EZo,vertexShader:"\n          attribute float opacity;\n          attribute float scale;\n          varying float vOpacity;\n          void main() {\n            vOpacity = opacity;\n            vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n            gl_Position = projectionMatrix * mvPosition;\n            gl_PointSize = scale * 20.0 * (300.0 / -mvPosition.z);\n          }\n        ",fragmentShader:"\n          varying float vOpacity;\n          uniform vec3 uColor;\n          void main() {\n            float d = length(gl_PointCoord - vec2(0.5));\n            float strength = smoothstep(0.5, 0.1, d);\n            vec3 glowColor = mix(uColor, vec3(1.0), 0.4);\n            gl_FragColor = vec4(glowColor, vOpacity * strength);\n          }\n        ",uniforms:{uColor:{value:t}}})]})};function F(e){let{position:t,direction:r,onImpact:i}=e,a=(0,s.useRef)(null),l=(0,s.useRef)(new o.zD7),c=(0,s.useRef)(t.clone()),{scene:h}=(0,I.D)(),d=new o.Q1f("#00ff44"),u=(0,s.useRef)(null),m=(0,s.useRef)(null),p=(0,s.useRef)(null),x=e=>{let t=new o.tBo,r=e.clone().sub(c.current).normalize();t.set(c.current,r);let n=h.children.filter(e=>"mountain"===e.name&&e instanceof o.YJl||"tree"===e.name&&e instanceof o.YJl).flatMap(e=>{let t=[];return e.traverse(e=>{e instanceof o.eaF&&t.push(e)}),t}),s=t.intersectObjects(n,!0);if(s.length>0){let t=s[0],r=c.current.distanceTo(e);if(t.distance<=r)return console.log("Collision detected:",t.point),!0}return!1},f=e=>{p.current&&(p.current.position.copy(e),p.current.visible=!0,m.current=l.current.getElapsedTime())};return(0,I.F)((e,t)=>{if(!a.current)return;if(l.current.getElapsedTime()>10){a.current.removeFromParent();return}let n=r.clone().multiplyScalar(.3*t*60),s=c.current.clone().add(n);if(x(s)?(a.current&&(f(c.current),a.current.removeFromParent()),i()):(c.current.copy(s),a.current.position.copy(c.current)),null!==m.current&&p.current){let e=(l.current.getElapsedTime()-m.current)/.3;if(e>=1)p.current.visible=!1,m.current=null;else{let t=.8*(1+e);p.current.scale.set(t,t,t);let r=1-e;p.current.children.forEach(e=>{e instanceof o.eaF&&e.material instanceof o._4j&&(e.material.opacity=r)})}}}),(0,n.jsxs)("group",{name:"fireball-group",children:[(0,n.jsxs)("mesh",{ref:a,position:c.current,children:[(0,n.jsx)("sphereGeometry",{args:[.28,32,32]}),(0,n.jsx)("meshStandardMaterial",{emissive:d,emissiveIntensity:2,toneMapped:!1}),(0,n.jsx)("pointLight",{color:d,intensity:5,distance:12})]}),(0,n.jsx)("group",{ref:u,visible:!1,children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.35000000000000003,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:d,emissive:d,emissiveIntensity:2,transparent:!0,opacity:1,depthWrite:!1,blending:o.EZo})]})}),(0,n.jsx)(C,{color:d,size:.28,meshRef:a,opacity:1}),(0,n.jsxs)("group",{ref:p,visible:!1,children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.5,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:d,emissive:d,emissiveIntensity:3,transparent:!0,opacity:1,depthWrite:!1,blending:o.EZo})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.8,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:d,emissive:d,emissiveIntensity:2,transparent:!0,opacity:.5,depthWrite:!1,blending:o.EZo})]}),(0,n.jsx)("pointLight",{color:d,intensity:8,distance:4,decay:2})]})]})}function E(e){let{isSwinging:t,onSwingComplete:r}=e,i=(0,s.useRef)(null),a=(0,s.useRef)(0),l=[-1.175,.9,.3];return(0,I.F)((e,n)=>{if(t&&i.current){a.current+=6.5*n;let e=Math.min(a.current/Math.PI/1.5,1);if(a.current>=.85*Math.PI){a.current=0,i.current.rotation.set(0,0,0),i.current.position.set(...l),r();return}let t=e<=.25?2*e:.75-(e-.125)*1.675,s=l[0]+2.5*Math.sin(t*Math.PI),o=l[1]+-1.5*Math.sin(t*Math.PI),c=l[2]+1.1*Math.cos(t*Math.PI);i.current.position.set(s,o,c);let h=-.75*Math.sin(t*Math.PI)+.3,d=Math.sin(t*Math.PI)*Math.PI,u=Math.PI/3*Math.sin(t*Math.PI);i.current.rotation.set(h,d,u)}else!t&&i.current&&(i.current.rotation.x*=.85,i.current.rotation.y*=.85,i.current.rotation.z*=.85,i.current.position.x+=(l[0]-i.current.position.x)*.2,i.current.position.y+=(l[1]-i.current.position.y)*.2,i.current.position.z+=(l[2]-i.current.position.z)*.2)}),(0,n.jsxs)("group",{ref:i,position:[l[0],l[1],l[2]],rotation:[0,0,Math.PI],scale:[1,1,1],children:[(0,n.jsxs)("group",{position:[0,-.4,0],rotation:[0,0,Math.PI+.3],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.04,.04,2.3,12]}),(0,n.jsx)("meshStandardMaterial",{color:"#a86432",roughness:.7})]}),[...Array(10)].map((e,t)=>(0,n.jsxs)("mesh",{position:[0,1-.2*t,0],rotation:[Math.PI/2,0,0],children:[" ",(0,n.jsx)("torusGeometry",{args:[.07,.01,8,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#a86432",metalness:.3,roughness:.7})]},t))]}),(0,n.jsxs)("group",{position:[-.305,.6,0],rotation:[Math.PI/1,0,Math.PI-.3],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.08,.08,.3,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#2c1810",roughness:.6})]}),(0,n.jsx)("group",{"rotation-x":(0,I.F)(e=>2*e.clock.getElapsedTime()),children:(0,n.jsxs)("mesh",{"position-y":-.11,rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("torusGeometry",{args:[.14,.02,16,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#39ff14",emissive:"#39ff14",emissiveIntensity:1.25,transparent:!0,opacity:.7})]})}),(0,n.jsx)("group",{"rotation-x":(0,I.F)(e=>-(2*e.clock.getElapsedTime())),children:(0,n.jsxs)("mesh",{"position-y":-.005,rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("torusGeometry",{args:[.155,.02,16,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#39ff14",emissive:"#39ff14",emissiveIntensity:1.25,transparent:!0,opacity:.7})]})}),(0,n.jsx)("group",{"rotation-x":(0,I.F)(e=>-(2*e.clock.getElapsedTime())),children:(0,n.jsxs)("mesh",{"position-y":.1,rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("torusGeometry",{args:[.17,.02,16,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#39ff14",emissive:"#39ff14",emissiveIntensity:1.25,transparent:!0,opacity:.7})]})}),(0,n.jsx)("group",{"rotation-x":(0,I.F)(e=>-(2*e.clock.getElapsedTime())),children:(0,n.jsxs)("mesh",{"position-y":-.35,rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("torusGeometry",{args:[.075,.02,16,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#39ff14",emissive:"#39ff14",emissiveIntensity:1,transparent:!0,opacity:.7})]})}),(0,n.jsx)("group",{"rotation-x":(0,I.F)(e=>-(2*e.clock.getElapsedTime())),children:(0,n.jsxs)("mesh",{"position-y":-.54,rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("torusGeometry",{args:[.075,.02,16,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#39ff14",emissive:"#39ff14",emissiveIntensity:1.25,transparent:!0,opacity:.7})]})}),(0,n.jsx)("group",{"rotation-x":(0,I.F)(e=>-(2*e.clock.getElapsedTime())),children:(0,n.jsxs)("mesh",{"position-y":-.74,rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("torusGeometry",{args:[.075,.02,16,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#39ff14",emissive:"#39ff14",emissiveIntensity:1.25,transparent:!0,opacity:.7})]})}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.13,.11,.32,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#39ff14",emissive:"#39ff14",emissiveIntensity:1.5,transparent:!0,opacity:.3})]})]}),(0,n.jsx)("group",{position:[.37,.8,.775],rotation:[.2,-Math.PI/3.6,Math.PI-.175],scale:[1,.55,1],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("extrudeGeometry",{args:[(()=>{let e=new o.ypk;return e.moveTo(0,0),e.lineTo(.4,-.13),e.bezierCurveTo(.8,.22,1.33,.5,1.6,.515),e.lineTo(1.125,.75),e.bezierCurveTo(.5,.2,.225,0,.1,.7),e.lineTo(0,0),e})(),{steps:1,depth:1e-4,bevelEnabled:!0,bevelThickness:.03,bevelSize:.035,bevelSegments:1,curveSegments:16,depth:.03}]}),(0,n.jsx)("meshStandardMaterial",{color:"#39ff14",emissive:"#39ff14",emissiveIntensity:1.3,metalness:.8,roughness:.1,opacity:1,transparent:!0,side:o.$EB})]})})]})}function R(e){let{isSwinging:t,isSmiting:r,isOathstriking:i,onSwingComplete:a,onSmiteComplete:l,onOathstrikeComplete:c,hasChainLightning:h=!1}=e,d=(0,s.useRef)(null),u=(0,s.useRef)(0),m=(0,s.useRef)(0),p=[-1.18,.225,.3],x=(0,s.useRef)([]);(0,I.F)((e,n)=>{if(d.current){if(i){u.current+=8.2*n;let e=Math.min(u.current/Math.PI/1.6,1),t=p[0]+2.5*Math.sin(e*Math.PI),r=p[1]+-1*Math.sin(e*Math.PI),s=p[2]+1*Math.cos(e*Math.PI);d.current.position.set(t,r,s);let o=Math.sin(e*Math.PI)*Math.PI,i=Math.PI/2.5*Math.sin(e*Math.PI*1.275);d.current.rotation.set(1.275,o,i),u.current>=Math.PI&&(u.current=0,d.current.rotation.set(0,0,0),d.current.position.set(...p),null==c||c());return}if(r){let e,t,r,s,o;m.current+=n*(m.current<Math.PI/2?3:6);let i=Math.min(m.current/Math.PI,1);if(i<.5){let n=.45*i;e=-Math.PI/3-n*Math.PI/3,t=n*Math.PI/4,r=p[0]+1.5*n,s=p[1]+1.5*n,o=p[2]-1.5*n}else{let n=(i-.5)*2;e=-2*Math.PI/3+3*n*Math.PI/2,t=Math.PI/4*(1-n),r=p[0]+1.5*(1-n),s=p[1]+(1.5-2*n),o=p[2]-(1.5-3*n)}d.current.position.set(r,s,o),d.current.rotation.set(e,t,0),m.current>=Math.PI&&(m.current=0,d.current.rotation.set(0,0,0),d.current.position.set(...p),null==l||l());return}if(t){u.current+=4.5*n;let e=Math.min(u.current/Math.PI/1.5,1);if(u.current>=.55*Math.PI){u.current=0,d.current.rotation.set(0,0,0),d.current.position.set(...p),null==a||a();return}let t=e<=.25?2*e:.65-(e-.125)*1.7,r=p[0]+2.5*Math.sin(t*Math.PI),s=p[1]+-2*Math.sin(t*Math.PI),o=p[2]+1.1*Math.cos(t*Math.PI);d.current.position.set(r,s,o);let i=-.75*Math.sin(t*Math.PI)+1.5,l=Math.sin(t*Math.PI)*Math.PI,c=Math.PI/3*Math.sin(t*Math.PI);d.current.rotation.set(i,l,c),u.current>=Math.PI&&(u.current=0,d.current.rotation.set(0,0,0),d.current.position.set(...p),null==a||a())}else t||r||(d.current.rotation.x*=.85,d.current.rotation.y*=.85,d.current.rotation.z*=.85,d.current.position.x+=(p[0]-d.current.position.x)*.2,d.current.position.y+=(p[1]-d.current.position.y)*.2,d.current.position.z+=(p[2]-d.current.position.z)*.2);if(h&&d.current){if(.8>Math.random())for(let e=0;e<3;e++){let e=2.2*Math.random(),t=new o.Pq0((Math.random()-.5)*.4,e,(Math.random()-.5)*.4);x.current.push({position:t,velocity:new o.Pq0((Math.random()-.5)*4,(Math.random()-.2)*4,(Math.random()-.5)*4).multiplyScalar(.8),life:1,scale:.015*Math.random()+.005})}x.current.forEach(e=>{e.velocity.x+=Math.sin(.01*Date.now())*n*.5,e.velocity.z+=Math.cos(.01*Date.now())*n*.5,e.position.add(e.velocity.clone().multiplyScalar(n)),e.life-=1.5*n,e.velocity.y+=.5*n}),x.current.length>150&&(x.current=x.current.slice(-150)),x.current=x.current.filter(e=>e.life>0)}}});let f=()=>{let e=new o.ypk;return e.moveTo(0,0),e.lineTo(-.25,.25),e.lineTo(-.15,-.15),e.lineTo(0,0),e.lineTo(.25,.25),e.lineTo(.15,-.15),e.lineTo(0,0),e.lineTo(0,.08),e.lineTo(.2,.2),e.quadraticCurveTo(.8,.15,1.5,.18),e.quadraticCurveTo(2,.1,2.2,0),e.quadraticCurveTo(2,-.1,1.5,-.18),e.quadraticCurveTo(.8,-.15,.2,-.2),e.lineTo(0,-.08),e.lineTo(0,0),e},g={steps:2,depth:.05,bevelEnabled:!0,bevelThickness:.014,bevelSize:.02,bevelOffset:.04,bevelSegments:2},j={...g,depth:.06,bevelThickness:.02,bevelSize:.02,bevelOffset:0,bevelSegments:6};return(0,n.jsx)("group",{rotation:[-.575,0,.2],children:(0,n.jsxs)("group",{ref:d,position:[p[0],p[1],p[2]],rotation:[0,0,Math.PI],scale:[.8,.8,.7],children:[(0,n.jsxs)("group",{position:[-.025,-.05,.35],rotation:[0,0,-Math.PI],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.03,.04,.9,12]}),(0,n.jsx)("meshStandardMaterial",{color:"#2a3b4c",roughness:.7})]}),[...Array(8)].map((e,t)=>(0,n.jsxs)("mesh",{position:[0,.35-.11*t,0],rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("torusGeometry",{args:[.045,.016,8,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#1a2b3c",metalness:.6,roughness:.4})]},t))]}),(0,n.jsxs)("group",{position:[-.025,.7,.35],rotation:[Math.PI,1.5,Math.PI],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("torusGeometry",{args:[.26,.07,16,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#4a5b6c",metalness:.9,roughness:.1})]}),[...Array(8)].map((e,t)=>(0,n.jsxs)("mesh",{position:[.25*Math.cos(t*Math.PI/4),.25*Math.sin(t*Math.PI/4),0],rotation:[0,0,t*Math.PI/4-Math.PI/2],children:[(0,n.jsx)("coneGeometry",{args:[.07,.55,3]}),(0,n.jsx)("meshStandardMaterial",{color:"#4a5b6c",metalness:.9,roughness:.1})]},"spike-".concat(t))),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.155,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:new o.Q1f(0xffff00),emissive:new o.Q1f(0xff6f00),emissiveIntensity:2,transparent:!0,opacity:1})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.1,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:new o.Q1f(0xffff00),emissive:new o.Q1f(0xffff00),emissiveIntensity:40,transparent:!0,opacity:.8})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.145,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:new o.Q1f(0xffff00),emissive:new o.Q1f(0xff6f00),emissiveIntensity:35,transparent:!0,opacity:.6})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.175,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:new o.Q1f(0xffff00),emissive:new o.Q1f(0xff6f00),emissiveIntensity:30,transparent:!0,opacity:.4})]}),(0,n.jsx)("pointLight",{color:new o.Q1f(0xff6f00),intensity:2,distance:.5,decay:2})]}),(0,n.jsxs)("group",{position:[0,1,.35],rotation:[0,-Math.PI/2,Math.PI/2],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("extrudeGeometry",{args:[f(),g]}),(0,n.jsx)("meshStandardMaterial",{color:new o.Q1f(0xff6f00),emissive:new o.Q1f(0xff6f00),emissiveIntensity:2.5,metalness:.3,roughness:.1})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("extrudeGeometry",{args:[(()=>{let e=new o.ypk;return e.moveTo(0,0),e.lineTo(0,.06),e.lineTo(.15,.15),e.quadraticCurveTo(1.2,.12,1.5,.15),e.quadraticCurveTo(2,.08,2.15,0),e.quadraticCurveTo(2,-.08,1.5,-.15),e.quadraticCurveTo(1.2,-.12,.15,-.15),e.lineTo(0,-.05),e.lineTo(0,0),e})(),j]}),(0,n.jsx)("meshStandardMaterial",{color:new o.Q1f(0xffb700),emissive:new o.Q1f(0xff6f00),emissiveIntensity:5,metalness:.2,roughness:.1,opacity:.8,transparent:!0})]})]}),(0,n.jsx)("group",{children:h&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("group",{position:[0,1,.35],rotation:[0,-Math.PI/2,Math.PI/2],scale:[1.0625,1.25,1.05],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("extrudeGeometry",{args:[f(),{...g,depth:.07}]}),(0,n.jsx)("meshStandardMaterial",{color:new o.Q1f(0xffd700),emissive:new o.Q1f(0xffa500),emissiveIntensity:1.5,transparent:!0,opacity:.3,blending:o.EZo})]})}),x.current.map((e,t)=>(0,n.jsxs)("mesh",{position:e.position.toArray(),scale:[e.scale,e.scale,e.scale],children:[(0,n.jsx)("sphereGeometry",{args:[1.25,6,6]}),(0,n.jsx)("meshStandardMaterial",{color:new o.Q1f(0xffd700),emissive:new o.Q1f(0xffa500),emissiveIntensity:3*e.life,transparent:!0,opacity:.6*e.life,blending:o.EZo})]},t))]})})]})})}let k=(e,t,r)=>e*(1-r)+t*r;function G(e){let{isSwinging:t,onSwingComplete:r,onLeftSwingStart:i,onRightSwingStart:a,isBowCharging:l,hasActiveAbility:c=!1,leftTargetPosition:h=null,rightTargetPosition:d=null}=e,u=(0,s.useRef)(null),m=(0,s.useRef)(0),p=(0,s.useRef)(null),x=(0,s.useRef)(0),f=[-.8,.75,.65],g=[.8,.75,.65],j=(0,s.useRef)(0),y=(0,s.useRef)(!1),M=(0,s.useRef)(0),v=(0,s.useRef)(null),P=(0,s.useRef)(null),[w,S]=(0,s.useState)([]);(0,I.F)((e,n)=>{if(u.current&&p.current){if(l)u.current.position.x+=(-.8-u.current.position.x)*.3,u.current.position.y+=(-.2-u.current.position.y)*.3,u.current.position.z+=(.5-u.current.position.z)*.3,p.current.position.x+=(.8-p.current.position.x)*.3,p.current.position.y+=(-.2-p.current.position.y)*.3,p.current.position.z+=(.5-p.current.position.z)*.3,u.current.rotation.x=k(1.05*u.current.rotation.x,.37*Math.PI,.3),u.current.rotation.z=k(u.current.rotation.z,1.7*Math.PI,.2),p.current.rotation.x=k(1.05*p.current.rotation.x,.37*Math.PI,.3),p.current.rotation.z=k(p.current.rotation.z,-(1.7*Math.PI),.2),m.current=0,x.current=0,M.current=0,j.current=0,y.current=!1;else if(t){if(0===m.current&&0===x.current&&(y.current=!1),u.current){if(M.current<.175)M.current+=n;else{0===m.current&&i(),m.current+=9*n;let e=Math.min(m.current/Math.PI,1),t=f[0]+1.2*Math.sin(e*Math.PI)-.45,r=f[1]+-.25*Math.sin(e*Math.PI*2),s=f[2]+2*Math.sin(e*Math.PI);u.current.position.set(t,r,s);let o=.65*Math.PI*Math.sin(e*Math.PI),a=.3*Math.PI*Math.sin(e*Math.PI),l=-.1*Math.PI*Math.sin(e*Math.PI);u.current.rotation.set(o,a,l),m.current>=Math.PI&&(m.current=0,M.current=0,u.current.rotation.set(0,0,0),u.current.position.set(...f))}}if(p.current){0===x.current&&a(),x.current+=9*n;let e=Math.min(x.current/Math.PI,1),t=g[0]-1.2*Math.sin(e*Math.PI)+.45,s=g[1]+-.25*Math.sin(e*Math.PI*2),o=g[2]+2*Math.sin(e*Math.PI);p.current.position.set(t,s,o);let i=.5*Math.PI*Math.sin(e*Math.PI),l=-(.3*Math.PI*Math.sin(e*Math.PI)),c=.2*Math.PI*Math.sin(e*Math.PI);p.current.rotation.set(i,l,c),x.current>=Math.PI&&(x.current=0,j.current=0,p.current.rotation.set(0,0,0),p.current.position.set(...g),y.current=!0,r())}}else u.current.position.x+=(f[0]-u.current.position.x)*.2,u.current.position.y+=(f[1]-u.current.position.y)*.2,u.current.position.z+=(f[2]-u.current.position.z)*.2,p.current.position.x+=(g[0]-p.current.position.x)*.2,p.current.position.y+=(g[1]-p.current.position.y)*.2,p.current.position.z+=(g[2]-p.current.position.z)*.2,u.current.rotation.x*=.85,u.current.rotation.y*=.85,u.current.rotation.z*=.85,p.current.rotation.x*=.85,p.current.rotation.y*=.85,p.current.rotation.z*=.85,t||(m.current=0,x.current=0,M.current=0,j.current=0,y.current=!1)}});let b=()=>{let e=new o.ypk;return e.moveTo(0,0),e.lineTo(-.15,.1),e.lineTo(-.2,0),e.lineTo(-.2,-.05),e.lineTo(0,0),e.lineTo(.15,.1),e.lineTo(.2,0),e.lineTo(.3,0),e.lineTo(0,0),e.lineTo(0,.05),e.quadraticCurveTo(.3,.15,.5,.2),e.quadraticCurveTo(.7,.25,.9,.15),e.quadraticCurveTo(1,.1,1.1,0),e.quadraticCurveTo(1,-.05,.8,-.1),e.lineTo(.7,-.15),e.lineTo(.65,-.1),e.quadraticCurveTo(.4,-.08,.2,-.05),e.quadraticCurveTo(.1,-.02,0,0),e},F=()=>{let e=new o.ypk;return e.moveTo(0,0),e.lineTo(-.13,.08),e.lineTo(-.18,0),e.lineTo(-.08,-.04),e.lineTo(0,0),e.lineTo(.13,.08),e.lineTo(.18,0),e.lineTo(.08,-.04),e.lineTo(0,0),e.lineTo(0,.04),e.quadraticCurveTo(.28,.13,.48,.18),e.quadraticCurveTo(.68,.23,.88,.13),e.quadraticCurveTo(.98,.08,1.08,0),e.quadraticCurveTo(.98,-.04,.78,-.08),e.lineTo(.68,-.13),e.lineTo(.63,-.08),e.quadraticCurveTo(.38,-.06,.18,-.04),e.quadraticCurveTo(.08,-.02,0,0),e},E={steps:2,depth:.02,bevelEnabled:!0,bevelThickness:.004,bevelSize:.01,bevelSegments:3},R={...E,depth:.025,bevelThickness:.003,bevelSize:.004,bevelOffset:0};return(0,s.useEffect)(()=>{c&&h&&m.current>0&&S(e=>[...e,{id:Math.random(),position:h}])},[c,h]),(0,s.useEffect)(()=>{c&&d&&x.current>0&&S(e=>[...e,{id:Math.random(),position:d}])},[c,d]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("group",{position:[0,-.6,.5],rotation:[-.55,0,0],scale:[.875,.8,.8],children:[(0,n.jsxs)("group",{ref:u,position:[f[0],f[1],f[2]],rotation:[0,0,Math.PI],scale:[1,1,.875],children:[(0,n.jsxs)("group",{position:[.2,-.125,0],rotation:[0,0,-Math.PI],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.015,.02,.45,12]}),(0,n.jsx)("meshStandardMaterial",{color:"#2a3b4c",roughness:.7})]}),[void 0,void 0,void 0,void 0].map((e,t)=>(0,n.jsxs)("mesh",{position:[0,.175-.065*t,0],children:[(0,n.jsx)("torusGeometry",{args:[.0225,.004,8,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#1a2b3c",metalness:.6,roughness:.4})]},t))]}),(0,n.jsxs)("group",{position:[.2,.3,0],rotation:[0,Math.PI/2,Math.PI/2],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("extrudeGeometry",{args:[b(),E]}),(0,n.jsx)("meshStandardMaterial",{color:"#0066ff",emissive:"#0088ff",emissiveIntensity:3,metalness:.9,roughness:.2,opacity:.9,transparent:!0})]}),(0,n.jsxs)("mesh",{position:[0,0,-.02],children:["  ",(0,n.jsx)("extrudeGeometry",{args:[F(),{...R,depth:.06}]}),(0,n.jsx)("meshStandardMaterial",{color:"#0033ff",emissive:"#0066ff",emissiveIntensity:8,metalness:.7,roughness:.1,opacity:.4,transparent:!0})]}),(0,n.jsx)("pointLight",{color:"#0088ff",intensity:5,distance:2,decay:2}),c&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("mesh",{ref:v,position:[-.15,0,0],children:[(0,n.jsx)("sphereGeometry",{args:[.06,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#0066ff",emissive:"#0088ff",emissiveIntensity:3,transparent:!0,opacity:.9})]}),(0,n.jsx)(C,{meshRef:v,color:new o.Q1f("#0088ff"),size:.04,opacity:.6})]})]})]}),(0,n.jsxs)("group",{ref:p,position:[g[0],g[1],g[2]],rotation:[0,0,Math.PI],scale:[1,1,.875],children:[(0,n.jsxs)("group",{position:[-.2,-.125,0],rotation:[0,0,-Math.PI],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.015,.02,.45,12]}),(0,n.jsx)("meshStandardMaterial",{color:"#2a3b4c",roughness:.7})]}),[void 0,void 0,void 0,void 0].map((e,t)=>(0,n.jsxs)("mesh",{position:[0,.175-.065*t,0],children:[(0,n.jsx)("torusGeometry",{args:[.0225,.004,8,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#1a2b3c",metalness:.6,roughness:.4})]},t))]}),(0,n.jsxs)("group",{position:[-.2,.3,0],rotation:[0,Math.PI/2,Math.PI/2],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("extrudeGeometry",{args:[b(),E]}),(0,n.jsx)("meshStandardMaterial",{color:"#0066ff",emissive:"#0088ff",emissiveIntensity:2,metalness:.9,roughness:.2,opacity:.9,transparent:!0})]}),(0,n.jsxs)("mesh",{position:[0,0,-.02],children:["  ",(0,n.jsx)("extrudeGeometry",{args:[F(),{...R,depth:.06}]}),(0,n.jsx)("meshStandardMaterial",{color:"#0033ff",emissive:"#0066ff",emissiveIntensity:3.5,metalness:.7,roughness:.1,opacity:.4,transparent:!0})]}),(0,n.jsx)("pointLight",{color:"#0088ff",intensity:1.5,distance:2,decay:2}),c&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("mesh",{ref:P,position:[-.15,0,0],children:[(0,n.jsx)("sphereGeometry",{args:[.06,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#0066ff",emissive:"#0088ff",emissiveIntensity:3,transparent:!0,opacity:.9})]}),(0,n.jsx)(C,{meshRef:P,color:new o.Q1f("#0088ff"),size:.04,opacity:.6})]})]})]})]}),w.map(e=>(0,n.jsx)(T,{position:e.position,onComplete:()=>{S(t=>t.filter(t=>t.id!==e.id))}},e.id))]})}let T=e=>{let{position:t,onComplete:r}=e,[i,a]=(0,s.useState)(()=>Array(15).fill(null).map(()=>({position:new o.Pq0(t.x+(Math.random()-.5)*.2,t.y,t.z+(Math.random()-.5)*.2),velocity:new o.Pq0((Math.random()-.5)*2,3*Math.random(),(Math.random()-.5)*2),scale:.3*Math.random()+.1,life:1})));return(0,I.F)((e,t)=>{a(e=>{let n=e.map(e=>(e.velocity.y-=5*t,e.position.add(e.velocity.multiplyScalar(t)),e.life-=1.5*t,e)).filter(e=>e.life>0);return 0===n.length&&r(),n})}),(0,n.jsx)("group",{children:i.map((e,t)=>(0,n.jsxs)("mesh",{position:e.position.toArray(),scale:[e.scale,e.scale,e.scale],children:[(0,n.jsx)("icosahedronGeometry",{args:[1,0]}),(0,n.jsx)("meshStandardMaterial",{color:"#A5F3FC",emissive:"#A5F3FC",emissiveIntensity:1.5,transparent:!0,opacity:.7*e.life,depthWrite:!1,blending:o.EZo})]},t))})};function D(e){let{position:t,direction:r,chargeProgress:i,isCharging:a,onRelease:l}=e,c=(0,s.useRef)(null),h=(0,s.useRef)(a),d=(0,s.useRef)(null);return(0,s.useEffect)(()=>{if(c.current){let e=Math.atan2(r.x,r.z);c.current.rotation.set(0,e,0)}},[r]),(0,I.F)(()=>{!h.current&&a&&(d.current=Date.now()),h.current&&!a&&(l(Math.min((d.current?(Date.now()-d.current)/1e3:0)/2,1)),d.current=null),h.current=a}),(0,n.jsxs)("group",{ref:c,position:t.toArray(),children:[(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("tubeGeometry",{args:[new o.B6O([new o.Pq0(-.875,0,0),new o.Pq0(-.85,.2,0),new o.Pq0(-.25,.5,0),new o.Pq0(-.4,.35,0),new o.Pq0(.4,.35,0),new o.Pq0(.25,.5,0),new o.Pq0(.85,.2,0),new o.Pq0(.875,0,0)]),64,.035,8,!1]}),(0,n.jsx)("meshStandardMaterial",{color:"#00ffff",emissive:"#00ffff",emissiveIntensity:1,transparent:!0,opacity:.8})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("tubeGeometry",{args:[(e=>{let t=1.35*e;return new o.s0K(new o.Pq0(-.8,0,0),new o.Pq0(0,0,-t),new o.Pq0(0,0,-t),new o.Pq0(.8,0,0))})(i),16,.02,8,!1]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",emissive:"#ffffff",emissiveIntensity:1,transparent:!0,opacity:.6})]}),(0,n.jsxs)("group",{children:[(0,n.jsxs)("mesh",{position:[-.4,0,.475],rotation:[Math.PI/2,0,Math.PI/6],children:[(0,n.jsx)("boxGeometry",{args:[.6,.02,.05]}),(0,n.jsx)("meshStandardMaterial",{color:"#00ffff",emissive:"#00ffff",emissiveIntensity:1,transparent:!0,opacity:.8})]}),(0,n.jsxs)("mesh",{position:[.4,0,.475],rotation:[Math.PI/2,0,-Math.PI/6],children:[(0,n.jsx)("boxGeometry",{args:[.6,.02,.05]}),(0,n.jsx)("meshStandardMaterial",{color:"#00ffff",emissive:"#00ffff",emissiveIntensity:1,transparent:!0,opacity:.8})]})]}),a&&(0,n.jsxs)("group",{position:[0,0,.8-1.35*i],rotation:[Math.PI/2,0,0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.015,.02,.9,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#00ffff",emissive:"#00ffff",emissiveIntensity:3,transparent:!0,opacity:.9})]}),(0,n.jsxs)("mesh",{position:[0,.35,0],children:[(0,n.jsx)("coneGeometry",{args:[.03,.175,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#00ffff",emissive:"#00ffff",emissiveIntensity:3,transparent:!0,opacity:.9})]})]}),a&&(0,n.jsxs)("mesh",{rotation:[0,Math.PI-2*Math.PI/2,Math.PI],position:[0,0,.65],children:[(0,n.jsx)("tubeGeometry",{args:[new o.VnP(new o.Pq0(0,0,0),new o.Pq0(0,0,20)),64,.025,8,!1]}),(0,n.jsx)("meshStandardMaterial",{color:"#00ffff",emissive:"#00ffff",emissiveIntensity:1,transparent:!0,opacity:.3*i})]})]})}function _(e){let{position:t,onComplete:r}=e,o=(0,s.useRef)(null),i=(0,s.useRef)(0),a=(0,s.useRef)(0);return(0,I.F)((e,t)=>{if(!o.current)return;if(a.current<.05){a.current+=t;return}i.current+=t;let n=Math.min(i.current/.9,1);if(n<1){o.current.position.y=40*(1-n);let e=n<.9?1:1-(n-.9)/.1;o.current.scale.set(e,e,e)}else r()}),(0,n.jsxs)("group",{ref:o,position:[t.x,25,t.z],visible:a.current>=.05,children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.105,.105,20,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#FF7300",emissive:"#FFD500",emissiveIntensity:50,transparent:!0,opacity:.995})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.25,.25,20,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#FF7300",emissive:"#FFD500",emissiveIntensity:25,transparent:!0,opacity:.675})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.42,.42,20,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#FF7300",emissive:"#FFD500",emissiveIntensity:5,transparent:!0,opacity:.625})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.6,.6,20,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#FF7300",emissive:"#FFD500",emissiveIntensity:2.5,transparent:!0,opacity:.55})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.75,.6,20,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#FF7300",emissive:"#FF8812",emissiveIntensity:2.5,transparent:!0,opacity:.425})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.825,.9,20,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#FF7300",emissive:"#FF8812",emissiveIntensity:1,transparent:!0,opacity:.325})]}),[void 0,void 0,void 0].map((e,t)=>(0,n.jsxs)("mesh",{rotation:[Math.PI/4,t*Math.PI/1.5,Math.PI],children:[(0,n.jsx)("torusGeometry",{args:[1.175,.1,8,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#FF0000",emissive:"#FF8812",emissiveIntensity:25,transparent:!0,opacity:.5})]},t)),[...Array(16)].map((e,t)=>(0,n.jsxs)("mesh",{rotation:[0,t*Math.PI/1.5,0],position:[0,7.45,0],children:[(0,n.jsx)("torusGeometry",{args:[1,.1,32,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#FF0000",emissive:"#FF8812",emissiveIntensity:25,transparent:!0,opacity:.4})]},t)),[...Array(8)].map((e,t)=>(0,n.jsxs)("mesh",{position:[1*Math.cos(t*Math.PI/4),(t-4)*2,1*Math.sin(t*Math.PI/4)],children:[(0,n.jsx)("sphereGeometry",{args:[.15,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#FF0000",emissive:"#FF8812",emissiveIntensity:25,transparent:!0,opacity:.665})]},t)),(0,n.jsx)("pointLight",{position:[0,-10,0],color:"#ff8800",intensity:20,distance:12}),(0,n.jsx)("pointLight",{position:[0,0,0],color:"#ffaa00",intensity:10,distance:6})]})}var A=r(2027);function z(e){let{damage:t,position:r,isCritical:o=!1,isLightning:i=!1,isBlizzard:a=!1,isHealing:l=!1,isBoneclaw:c=!1,isOathstrike:h=!1,isFirebeam:d=!1,isOrbShield:u=!1,isChainLightning:m=!1,isFireball:p=!1,isSummon:x=!1,onComplete:f}=e;console.log("DamageNumber props:",{damage:t,isCritical:o,isBlizzard:a,isLightning:i,isHealing:l,isBoneclaw:c,isOrbShield:u,isChainLightning:m});let g=(0,s.useRef)(null),j=(0,s.useRef)(Date.now()),y=r.y+3.5,{camera:M}=(0,I.D)(),v=Date.now()%1e3/1e3,P=.3*Math.sin(v*Math.PI*2),w=.2*Math.cos(v*Math.PI*2);(0,I.F)(()=>{if(!g.current)return;let e=(Date.now()-j.current)/1e3;if(e>=1.5){f();return}g.current.quaternion.copy(M.quaternion);let t=e/1.5,n=y+1.2*(1-Math.pow(1-t,3)),s=r.x+P;g.current.position.set(s,n+w,r.z),g.current.material.opacity=Math.min(1,3*(1-t))});let S=()=>l?"#338C66":m?"#ffff00":u?"#13F3FF":o?"#FF2D22":x?"#B999FF":c?"#00FF11":i?"#FFD000":h?"#FF9441":d?"#00FFE5":a?"#00B7FF":p?"#00C946":"#EBEBEB";return console.log("Text color:",S(),"isHealing:",l),(0,n.jsx)(A.E,{ref:g,position:[r.x,y,r.z],fontSize:.6,color:S(),anchorX:"center",anchorY:"middle",outlineWidth:.05,outlineColor:"#000000","material-transparent":!0,"material-depthTest":!1,children:l?"+".concat(t):t})}function q(e){let{children:t,position:r=[0,0,0],lockX:i=!1,lockY:a=!1,lockZ:l=!1}=e,c=(0,s.useRef)(null);return(0,I.F)(e=>{let{camera:t}=e;if(!c.current)return;let r=c.current.position,n=t.position,s=new o.Pq0().subVectors(n,r),h=c.current.rotation.clone();a||(h.y=Math.atan2(s.x,s.z)),i||(h.x=Math.atan2(-s.y,Math.sqrt(s.x*s.x+s.z*s.z))),l||(h.z=0),c.current.rotation.set(h.x,h.y,h.z)}),(0,n.jsx)("group",{ref:c,position:r,children:t})}function B(e){let{parentRef:t,weaponType:r}=e,a=(0,s.useRef)([]),l=(0,s.useRef)([]),[c,h]=(0,s.useState)(!1);(0,s.useEffect)(()=>{if(t.current){let e=t.current.position.clone();l.current=Array(27).fill(0).map(()=>e.clone()),h(!0)}},[t]);let d=()=>{switch(r){case i.SCYTHE:return"#00FF37";case i.SWORD:return"#FFB300";case i.SABRES:return"#00BFFF"}};return((0,I.F)(()=>{if(!t.current||!c)return;let e=t.current.position.clone();l.current.unshift(e),l.current=l.current.slice(0,27),a.current.forEach((e,t)=>{e&&l.current[t]&&(e.position.copy(l.current[t]),e.scale.setScalar(1-t/27*.6),e.material&&e.material instanceof o.V9B&&(e.material.opacity=(1-t/27)*.2))})}),c)?(0,n.jsx)(n.Fragment,{children:Array.from({length:27}).map((e,t)=>(0,n.jsxs)("mesh",{ref:e=>{e&&(a.current[t]=e)},children:[(0,n.jsx)("sphereGeometry",{args:[.43,32,32]}),(0,n.jsx)("meshBasicMaterial",{color:new o.Q1f(d()),transparent:!0,opacity:.3,depthWrite:!1})]},t))}):null}function L(e){let{collectedBones:t,isLeftWing:r}=e,i=(0,s.useRef)(null),a=[{pos:new o.Pq0(r?-.3:.3,.275,0),rot:new o.O9p(0,0,r?-Math.PI/5:Math.PI/5),scale:1.2},{pos:new o.Pq0(r?-.5:.5,.45,0),rot:new o.O9p(0,0,r?-Math.PI/3.5:Math.PI/3.5),scale:1.4},{pos:new o.Pq0(r?-.65:.65,.6,0),rot:new o.O9p(0,0,r?-Math.PI/2.5:Math.PI/2.5),scale:1},{pos:new o.Pq0(r?-.85:.85,.72,.1),rot:new o.O9p(.1,0,r?-Math.PI/2.2:Math.PI/2.2),scale:1},{pos:new o.Pq0(r?-1.05:1.05,.8,.2),rot:new o.O9p(.2,0,r?-Math.PI/2:Math.PI/2),scale:.9},{pos:new o.Pq0(r?-1.2:1.2,.9,.2),rot:new o.O9p(.2,0,r?-Math.PI/1.8:Math.PI/1.8),scale:.8},{pos:new o.Pq0(r?-1.3:1.3,.75,.2),rot:new o.O9p(.05,0,r?-(-Math.PI/.475):-(Math.PI/.475)),scale:1},{pos:new o.Pq0(r?-1.13:1.13,.445,.17),rot:new o.O9p(.2,0,r?-(-Math.PI/.45):-(Math.PI/.45)),scale:.8}],l=()=>(0,n.jsxs)("group",{children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.023,.0175,.32,3]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("mesh",{position:new o.Pq0(0,.2,0),children:[(0,n.jsx)("sphereGeometry",{args:[.035,4,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]})]});return(0,n.jsx)("group",{ref:i,rotation:new o.O9p(0,Math.PI,0),position:new o.Pq0(0,-.3,0),children:a.slice(0,Math.min(15,t)).map((e,t)=>(0,n.jsx)("group",{position:e.pos,rotation:e.rot,scale:e.scale,children:l()},"bone-".concat(t)))})}let O=()=>(0,n.jsxs)("group",{rotation:[Math.PI/4,0,0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.0175,.0175,.175,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",roughness:.4,metalness:.3})]}),(0,n.jsxs)("mesh",{position:new o.Pq0(0,.1,0),rotation:new o.O9p(0,0,Math.PI/6),children:[(0,n.jsx)("sphereGeometry",{args:[.03,4,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",roughness:.5,metalness:.2})]}),(0,n.jsxs)("mesh",{position:new o.Pq0(0,-.1,0),rotation:new o.O9p(0,0,-Math.PI/6),children:[(0,n.jsx)("sphereGeometry",{args:[.0325,4,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#a4a4a4",roughness:.5,metalness:.2})]})]});function W(e){let{parentRef:t}=e,r=(0,s.useRef)([]),o=(0,s.useRef)(null);return(0,I.F)(()=>{if(!t.current||!o.current)return;let e=t.current.position;o.current.position.set(e.x,0,e.z),r.current.forEach((e,t)=>{let r=t/16*Math.PI*2+.001*Date.now(),n=-(.465*Math.cos(r)*1.1),s=.465*Math.sin(r)*1.1,o=.02*Math.sin(.002*Date.now()+t);e.position.set(n,o+.13,s),e.rotation.y=r+Math.PI/3})}),(0,n.jsx)("group",{ref:o,children:Array.from({length:16}).map((e,t)=>(0,n.jsx)("mesh",{ref:e=>{e&&(r.current[t]=e)},children:O()},t))})}let H=()=>{let e=(0,s.useRef)(null),t=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(0,n.jsxs)("group",{position:[0,e,0],scale:t,children:[(0,n.jsxs)("group",{rotation:[0,0,-Math.PI/3],children:[(0,n.jsxs)("mesh",{position:[.085,.05,.08],rotation:[.3,Math.PI/2,-.5],children:[(0,n.jsx)("torusGeometry",{args:[.2,.022,8,12,1.1*Math.PI]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("mesh",{position:[0,0,-.1],children:[(0,n.jsx)("sphereGeometry",{args:[.0375,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]})]}),(0,n.jsxs)("group",{rotation:[0,0,Math.PI/3],children:[(0,n.jsxs)("mesh",{position:[-.085,.05,.08],rotation:[.3,-Math.PI/2,0],children:[(0,n.jsx)("torusGeometry",{args:[.2,.022,8,12,1.1*Math.PI]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("mesh",{position:[-.3,-.15,0],children:[(0,n.jsx)("sphereGeometry",{args:[.02,4,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.06,.05,.075,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]})]})};return(0,n.jsx)("group",{ref:e,position:[0,.04,-0],rotation:[.25,Math.PI+Math.PI,0],children:(0,n.jsxs)("group",{children:[(0,n.jsxs)("group",{children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.04,.04,.9,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),[-.3,-.15,0,.15,.3].map((e,t)=>(0,n.jsxs)("group",{position:[0,e,0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.06,.06,.04,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]}),(0,n.jsxs)("mesh",{position:[0,0,-.125],children:[(0,n.jsx)("boxGeometry",{args:[.0175,.06,.075]}),(0,n.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]})]},t))]}),(0,n.jsxs)("group",{position:[0,0,0],children:[t(.45,.7),t(.3,.8),t(.15,.9),t(0,1),t(-.15,.9),t(-.3,.8),t(-.45,.7)]})]})})},U=e=>{let{movementDirection:t=new o.Pq0}=e,r=(0,s.useRef)(null),[i,a]=(0,s.useState)({x:0,y:0});(0,I.F)(e=>{let{clock:n}=e;if(!r.current)return;let s=n.getElapsedTime(),o=.035*Math.sin(.7*s),i=.175*Math.sin(.5*s),l=1.2*t.length(),c=-(.45*t.z)*l,h=-(.125*t.x)*l,d=Math.min(1.5*l,1),u=o*(1-d)+c*d,m=i*(1-d)+h*d;a({x:u,y:m}),r.current.rotation.x=.1+u,r.current.rotation.y=m});let l=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1?arguments[1]:void 0,r=1.8*Math.pow(t/20,5),s=.8*Math.pow((t+1)/15,2.2),o=Math.max(0,1-t/15),a=i.x*o,l=i.y*Math.pow(o,1.2),c=Math.PI,h=Math.atan2(s-r,.4*(1-t/20))+(0===t?c:0)+a*(1-t/15);return(0,n.jsxs)("group",{position:[0,-r+.325,-(.2*t)*(1-t/40-.1)],scale:e,rotation:[-h+.85*a,l*(1-t/2),0],children:[(0,n.jsxs)("mesh",{rotation:[-(Math.PI/4),0,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.04,.055,.125,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("group",{rotation:[Math.PI/2,0,Math.PI/2],children:[(0,n.jsxs)("mesh",{position:[0,.08,0],children:[(0,n.jsx)("coneGeometry",{args:[.02,.06,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]}),(0,n.jsxs)("mesh",{position:[.08,0,0],rotation:[0,0,Math.PI/2],children:[(0,n.jsx)("coneGeometry",{args:[.015,.25,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]}),(0,n.jsxs)("mesh",{position:[-.085,0,0],rotation:[0,0,-(Math.PI/2)],children:[(0,n.jsx)("coneGeometry",{args:[.015,.2,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]})]}),(0,n.jsxs)("group",{rotation:[Math.PI/24,0,-Math.PI/2],children:[(0,n.jsxs)("mesh",{position:[0,.08,0],children:[(0,n.jsx)("coneGeometry",{args:[.02,.06,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]}),(0,n.jsxs)("mesh",{position:[.05,0,0],rotation:[0,0,2*Math.PI],children:[(0,n.jsx)("coneGeometry",{args:[.0125,.04,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]}),(0,n.jsxs)("mesh",{position:[-.085,0,0],rotation:[0,0,Math.PI/2],children:[(0,n.jsx)("coneGeometry",{args:[.015,.04,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]})]}),(0,n.jsxs)("mesh",{position:[0,.025,.06],rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("sphereGeometry",{args:[.025,6,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]})]})};return(0,n.jsx)("group",{ref:r,position:[0,-.7,-.25],rotation:[-.1,0,0],children:[...Array(15)].map((e,t)=>l(1-.04*t,t))})},N=e=>{switch(e){case i.SCYTHE:return"#5EFF00";case i.SWORD:return"#FF9748";case i.SABRES:case i.SABRES2:return"#00AAFF";default:return"#00ff44"}},Q=e=>{let t=N(e);return(0,n.jsxs)("group",{children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("boxGeometry",{args:[.1075,.02,.025]}),(0,n.jsx)("meshStandardMaterial",{color:t,transparent:!0,opacity:.6,emissive:t,emissiveIntensity:.55})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.035,9,9]}),(0,n.jsx)("meshStandardMaterial",{color:t,emissive:t,emissiveIntensity:.7,transparent:!0,opacity:.4})]})]})};function Y(e){let{parentRef:t,weaponType:r}=e,i=(0,s.useRef)([]),a=(0,s.useRef)(null);return(0,I.F)(e=>{let{clock:r}=e;if(!t.current||!a.current)return;let n=t.current.position;a.current.position.set(n.x,0,n.z),i.current.forEach((e,t)=>{if(!e)return;let n=r.getElapsedTime(),s=t/32*.625,o=t/32*Math.PI*4+2*n,i=.45*(1-.875*s),a=Math.cos(o)*i,l=Math.sin(o)*i;e.position.set(a,s,l),e.rotation.y=o+Math.PI/2,e.rotation.x=Math.PI/6,e.rotation.z=.1*Math.sin(3*n+t);let c=e.children[0];c&&c.material&&(c.material.opacity=Math.max(.1,1-2*s))})}),(0,n.jsxs)("group",{ref:a,children:[(0,n.jsxs)("mesh",{position:[0,-.05,0],children:[(0,n.jsx)("sphereGeometry",{args:[.55,16,16]}),(0,n.jsx)("meshBasicMaterial",{color:N(r),transparent:!0,opacity:.06,blending:o.EZo,depthWrite:!1})]}),(0,n.jsx)("pointLight",{color:N(r),intensity:2,distance:1.3,position:[0,.15,0]}),(0,n.jsx)("pointLight",{color:N(r),intensity:1,distance:2,position:[0,.1,0],decay:2}),Array.from({length:32}).map((e,t)=>(0,n.jsx)("group",{ref:e=>{e&&(i.current[t]=e)},children:Q(r)},t))]})}function Z(e){let t=.11>Math.random();return{damage:t?2*e:e,isCritical:t}}let V=Math.PI;function K(e){let{position:t,direction:r,onComplete:i}=e,a=(0,s.useRef)(null),l=(0,s.useRef)(0),c=(0,s.useRef)(0),h=new o.Q1f("#39ff14"),d=(0,s.useRef)(null),u=(0,s.useRef)(0),m=new o.Pq0(t.x+5*r.x,0,t.z+5*r.z),p=new o.Pq0(-r.z,0,r.x).normalize(),x=m.clone().add(p.clone().multiplyScalar(-1.35)),f=m.clone().add(p.clone().multiplyScalar(1.35));(0,I.F)((e,t)=>{if(!a.current)return;if(c.current<.125){c.current+=t;return}l.current+=t,u.current+=t;let r=Math.min(l.current/1.2,1),n=Math.min(u.current/2.5,1);if(r<1){a.current.position.y=3.5*(1-r);let e=r<.9?1:1-(r-.9)/.2;a.current.scale.set(e,e,e)}else i();d.current&&(d.current.scale.set(Math.min(1.2*n,1),1,Math.min(1.2*n,1)),d.current.children[0].material.opacity=.6*(n>.7?1-(n-.7)/.3:1))});let g=(e,t)=>(0,n.jsxs)("group",{position:[e.x,0,e.z],rotation:[Math.PI/6,Math.atan2(r.x,r.z),0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.1,.1,15,16]}),(0,n.jsx)("shaderMaterial",{transparent:!0,depthWrite:!1,blending:o.EZo,vertexShader:"\n            varying vec2 vUv;\n            void main() {\n              vUv = uv;\n              gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n            }\n          ",fragmentShader:"\n            uniform vec3 uColor;\n            varying vec2 vUv;\n            void main() {\n              float strength = 1.0 - length(vUv - vec2(0.5));\n              vec3 glowColor = mix(uColor, vec3(1.0), 0.3);\n              gl_FragColor = vec4(glowColor, strength * 0.95);\n            }\n          ",uniforms:{uColor:{value:h}}})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.175,.175,15,16]}),(0,n.jsx)("shaderMaterial",{transparent:!0,depthWrite:!1,blending:o.EZo,vertexShader:"\n            varying vec2 vUv;\n            void main() {\n              vUv = uv;\n              gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n            }\n          ",fragmentShader:"\n            uniform vec3 uColor;\n            varying vec2 vUv;\n            void main() {\n              float strength = 1.0 - length(vUv - vec2(0.5));\n              vec3 glowColor = mix(uColor, vec3(1.0), 0.4);\n              gl_FragColor = vec4(glowColor, strength * 0.8);\n            }\n          ",uniforms:{uColor:{value:h}}})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.25,.25,15,16]}),(0,n.jsx)("shaderMaterial",{transparent:!0,depthWrite:!1,blending:o.EZo,vertexShader:"\n            varying vec2 vUv;\n            void main() {\n              vUv = uv;\n              gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n            }\n          ",fragmentShader:"\n            uniform vec3 uColor;\n            varying vec2 vUv;\n            void main() {\n              float strength = 1.0 - length(vUv - vec2(0.5));\n              vec3 glowColor = mix(uColor, vec3(1.0), 0.5);\n              gl_FragColor = vec4(glowColor, strength * 0.6);\n            }\n          ",uniforms:{uColor:{value:h}}})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.375,.375,15,16]}),(0,n.jsx)("shaderMaterial",{transparent:!0,depthWrite:!1,blending:o.EZo,vertexShader:"\n            varying vec2 vUv;\n            void main() {\n              vUv = uv;\n              gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n            }\n          ",fragmentShader:"\n            uniform vec3 uColor;\n            varying vec2 vUv;\n            void main() {\n              float strength = 1.0 - length(vUv - vec2(0.5));\n              vec3 glowColor = mix(uColor, vec3(1.0), 0.6);\n              gl_FragColor = vec4(glowColor, strength * 0.4);\n            }\n          ",uniforms:{uColor:{value:h}}})]}),[...Array(16)].map((e,t)=>(0,n.jsxs)("mesh",{rotation:[0,t*Math.PI/1.5,0],position:[0,7.45,0],children:[(0,n.jsx)("torusGeometry",{args:[.5,.08,32,32]}),(0,n.jsx)("meshStandardMaterial",{color:h,emissive:h,emissiveIntensity:3,transparent:!0,opacity:.4})]},t)),[...Array(20)].map((e,t)=>(0,n.jsxs)("mesh",{position:[.5*Math.cos(t*Math.PI/4),(t-4)*.5,.5*Math.sin(t*Math.PI/4)],children:[(0,n.jsx)("sphereGeometry",{args:[.04,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:h,emissive:h,emissiveIntensity:12,transparent:!0,opacity:.6})]},t)),(0,n.jsx)("pointLight",{position:[0,0,0],color:h,intensity:20,distance:6}),(0,n.jsx)("pointLight",{position:[0,0,0],color:h,intensity:15,distance:3})]});return(0,n.jsxs)("group",{ref:a,visible:c.current>=.125,children:[g(x,!1),g(m,!0),g(f,!1)]})}let X=e=>{let{position:t}=e,r=(0,s.useRef)(null),i=(0,s.useRef)(0);return(0,I.F)((e,t)=>{if(!r.current)return;i.current+=1*t;let n=Math.min(i.current,1),s=Math.cos(n*Math.PI/2),a=.775+1.5*n;r.current.scale.set(a,a,a),r.current.position.y=.5+.8*n,r.current.rotation.y+=5*t,r.current.traverse(e=>{e instanceof o.eaF&&e.material instanceof o._4j&&(e.material.opacity=s)})}),(0,n.jsxs)("group",{ref:r,position:t,children:[[...Array(12)].map((e,t)=>{let r=t/12*Math.PI*2,s=.4*Math.sin(1*t);return(0,n.jsxs)("group",{position:[.7*Math.cos(r),s,.7*Math.sin(r)],rotation:[Math.random()*Math.PI,r,Math.random()*Math.PI/2],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.04,.03,.25,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",emissive:"#39ff14",emissiveIntensity:.5,transparent:!0,opacity:.9})]}),(0,n.jsxs)("mesh",{position:[.03,.05,0],children:[(0,n.jsx)("coneGeometry",{args:[.02,.06,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#d4d4d4",emissive:"#39ff14",emissiveIntensity:.3,transparent:!0,opacity:.9})]})]},t)}),[void 0,void 0,void 0].map((e,t)=>(0,n.jsxs)("mesh",{rotation:[0,t*Math.PI/3,.3*t],children:[(0,n.jsx)("torusGeometry",{args:[.625,.0625,5,24]}),(0,n.jsx)("meshStandardMaterial",{color:"#39ff14",emissive:"#39ff14",emissiveIntensity:1,transparent:!0,opacity:.6})]},t)),(0,n.jsx)("pointLight",{color:"#39ff14",intensity:6,distance:4,decay:2}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.2,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#39ff14",emissive:"#39ff14",emissiveIntensity:1,transparent:!0,opacity:.6})]}),[...Array(16)].map((e,t)=>{let r=t/16*Math.PI*2,s=.3+.4*Math.random();return(0,n.jsxs)("mesh",{position:[Math.cos(r)*s,.6*Math.random(),Math.sin(r)*s],children:[(0,n.jsx)("sphereGeometry",{args:[.03+.04*Math.random(),8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#39ff14",emissive:"#39ff14",emissiveIntensity:2,transparent:!0,opacity:.7})]},t)})]})};function $(e){let{position:t,direction:r,onComplete:i,parentRef:a,onHitTarget:l,enemyData:c,onSwingComplete:h}=e,d=(0,s.useRef)(null),u=(0,s.useRef)(0),m=(0,s.useRef)(!1),p=(0,s.useRef)(!1),x=(e,t)=>(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[t,.9*t,e,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#d6cfc7",roughness:.9,metalness:.1})]}),f=e=>(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[1.1*e,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#d6cfc7",roughness:.9,metalness:.1})]}),g=(e,t)=>(0,n.jsxs)("group",{children:[(0,n.jsx)("group",{position:[t/2,0,0],children:x(e,.06)}),(0,n.jsx)("group",{position:[-t/2,0,0],children:x(e,.06)}),(0,n.jsx)("group",{position:[0,e/2,0],children:f(.135)}),(0,n.jsx)("group",{position:[0,-e/2,0],children:f(.155)})]}),j=()=>{let e=new o.ypk;return e.moveTo(0,0),e.lineTo(.25,-.08),e.bezierCurveTo(.4,.3,1.05,.32,1.1,.23),e.lineTo(.84,.47),e.bezierCurveTo(.35,.13,.15,0,.07,.44),e.lineTo(0,0),e},y={steps:1,depth:1e-4,bevelEnabled:!0,bevelThickness:.015,bevelSize:.0175,bevelSegments:1,curveSegments:16},M=e=>(0,n.jsx)("group",{position:[.025*(e-2),-.3,0],rotation:[-Math.PI,Math.PI/2,Math.PI-Math.PI/4+e*Math.PI/10],scale:[.7,.7,.7],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("extrudeGeometry",{args:[j(),y]}),(0,n.jsx)("meshStandardMaterial",{color:"#39ff14",emissive:"#39ff14",emissiveIntensity:1.3,metalness:.8,roughness:.1,opacity:.85,transparent:!0,side:o.$EB})]})}),v=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return(0,n.jsxs)("group",{scale:[e,e,e],children:[(0,n.jsxs)("mesh",{position:[0,0,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.06,.02,.12,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("mesh",{position:[0,.1,.02],rotation:[.05,0,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.025,.025,.12,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("mesh",{position:[0,.2,.04],rotation:[.1,0,0],children:[(0,n.jsx)("coneGeometry",{args:[.03,.15,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#d4d4d4",roughness:.3,metalness:.5})]}),[0,Math.PI/4,1*Math.PI/2,Math.PI,3*Math.PI/2,5*Math.PI/4].map((e,t)=>(0,n.jsx)("group",{rotation:[0,e,0],children:(0,n.jsxs)("mesh",{position:[.04,.05,0],children:[(0,n.jsx)("boxGeometry",{args:[.01,.12,.02]}),(0,n.jsx)("meshStandardMaterial",{color:"#d4d4d4",roughness:.5,metalness:.3})]})},t))]})};return(0,I.F)((e,t)=>{if(!d.current||!(null==a?void 0:a.current))return;u.current+=5*t;let n=Math.min(u.current/Math.PI,1);if(n>=1){u.current=0,null==h||h(d.current.position.clone(),r),i();return}let s=a.current.position.clone(),o=a.current.rotation.y,x=-(2.5*Math.sin(n*Math.PI))+3,f=Math.cos(n*Math.PI)+3.75,g=2*Math.sin(n*Math.PI)+.75,j=x*Math.cos(o)+g*Math.sin(o),y=-x*Math.sin(o)+g*Math.cos(o);d.current.position.set(s.x+j,s.y+f,s.z+y);let M=Math.cos(n*Math.PI)/(1.5*Math.PI),v=o+Math.PI/2-n*Math.PI/2,P=-(Math.PI/3.5*Math.sin(n*Math.PI));d.current.rotation.set(M,v,P),.1>Math.abs(n-.1)&&!m.current&&(m.current=!0,p.current=!0,(function(e,t,r){let n=[];return r.forEach(r=>{if(r.health<=0)return;let s=r.position.clone().sub(e);if(s.length()>8.625||(s.normalize(),Math.acos(s.dot(t))>V/2))return;let{damage:o,isCritical:i}=Z(71);n.push({targetId:r.id,damage:o,isCritical:i,position:r.position.clone()})}),n})(d.current.position,r,c).forEach(e=>{null==l||l(e.targetId,e.damage,e.isCritical,e.position,!0)}))}),(0,n.jsxs)(n.Fragment,{children:[p.current&&(0,n.jsx)(K,{position:t,direction:r,onComplete:()=>{p.current=!1}}),a.current&&(0,n.jsx)(X,{position:a.current.position.clone()}),(0,n.jsx)("group",{ref:d,position:t,rotation:[0,Math.atan2(r.x,r.z),Math.PI/3],scale:1.25,children:(0,n.jsxs)("group",{children:[g(1.15,.15),(0,n.jsxs)("group",{position:[-.22,-.85,.21],children:["   ",(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.12,12,12]}),(0,n.jsx)("meshStandardMaterial",{color:"#d6cfc7",roughness:.9,metalness:.1})]}),(0,n.jsxs)("group",{rotation:[-.7,-0,-Math.PI/5],children:[g(.8,.12),(0,n.jsxs)("group",{position:[0,-.5,0],rotation:[0,0,1-Math.PI/4],children:[f(.125),(0,n.jsxs)("group",{position:[0,-.1,0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("boxGeometry",{args:[.2,.15,.08]}),(0,n.jsx)("meshStandardMaterial",{color:"#d6cfc7",roughness:.9,metalness:.1})]}),x(.5,.02),(0,n.jsxs)("group",{position:[.025,-.3,0],rotation:[0,0,Math.PI+Math.PI/16],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("coneGeometry",{args:[.03,.3,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#c4bdb6",roughness:.9,metalness:.1})]}),[0,1,2,3,4].map(e=>M(e))]})]})]})]})]}),(0,n.jsx)("group",{position:[0,.7,0],rotation:[-1,1,1],scale:.5,children:[-.03,-.01,0,.01,.03].map((e,t)=>(0,n.jsx)("group",{position:[e,.1,0],rotation:[0,0,(t-2)*Math.PI/5],children:(0,n.jsxs)("group",{position:[0,.3,0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.075,.5,.2,4,1,!1,0,2*Math.PI]}),(0,n.jsx)("meshStandardMaterial",{color:"#d6cfc7",roughness:.9,metalness:.1})]}),(0,n.jsxs)("group",{position:[0,.25,0],children:[(0,n.jsx)("group",{position:[0,0,0],rotation:[0,0,0],children:v(2)}),(0,n.jsx)("group",{position:[0,-.05,.15],rotation:[-.1,0,0],children:v(.9)}),(0,n.jsx)("group",{position:[0,-.05,-.15],rotation:[.1,0,0],children:v(.9)}),(0,n.jsx)("group",{position:[0,-.1,.25],rotation:[-.2,0,0],children:v(.7)}),(0,n.jsx)("group",{position:[0,-.1,-.25],rotation:[.2,0,0],children:v(.7)})]})]})},t))})]})})]})}function J(e){let{initialPosition:t,onComplete:r,type:o}=e,i=(0,s.useRef)(null),a=(0,s.useRef)(1.5*Math.random()+3.65),l=(0,s.useRef)({x:1.5*Math.random(),y:.25*Math.random(),z:1*Math.random()}),c=(0,s.useRef)(Math.min(t.length(),2.7)),h=(0,s.useRef)(Math.atan2(t.z,t.x));return(0,I.F)((e,t)=>{i.current&&("falling"===o?(i.current.position.y-=a.current*t,i.current.position.y<0&&r()):(h.current+=t,i.current.position.x=Math.cos(h.current)*c.current,i.current.position.z=Math.sin(h.current)*c.current,h.current>2*Math.PI&&r()),i.current.rotation.x+=l.current.x,i.current.rotation.y+=l.current.y,i.current.rotation.z+=l.current.z)}),(0,n.jsxs)("mesh",{ref:i,position:t,children:[(0,n.jsx)("tetrahedronGeometry",{args:[.0775]}),(0,n.jsx)("meshStandardMaterial",{color:"#80ffff",emissive:"#40a0ff",emissiveIntensity:1,transparent:!0,opacity:.7})]})}function ee(e){let{onComplete:t}=e,r=(0,s.useRef)(null),o=(0,s.useRef)(0),i=(0,s.useRef)({x:.2*Math.random(),y:2*Math.random(),z:.3*Math.random()});return(0,I.F)((e,n)=>{if(!r.current)return;o.current+=n,r.current.rotation.x+=i.current.x*n,r.current.rotation.y+=i.current.y*n,r.current.rotation.z+=i.current.z*n;let s=.1*Math.sin(2*o.current)+1;r.current.scale.setScalar(s),o.current>6&&t()}),(0,n.jsxs)("mesh",{ref:r,children:[(0,n.jsx)("torusGeometry",{args:[.8,.075,8,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#80ffff",emissive:"#40a0ff",emissiveIntensity:2,transparent:!0,opacity:.3})]})}function et(e){let{onComplete:t,enemyData:r=[],onHitTarget:i,parentRef:a}=e,l=(0,s.useRef)(null),c=(0,s.useRef)(0),h=(0,s.useRef)(0),d=(0,s.useRef)([]),u=(0,s.useRef)([]);return(0,I.F)((e,n)=>{if(!l.current||!(null==a?void 0:a.current))return;let s=a.current.position;if(l.current.position.copy(s),c.current+=n,c.current>=6.5){t();return}if(l.current.rotation.y+=4*n,.2>Math.random()){let e=Math.random()*Math.PI*2,t=.8*Math.random()/50,r=new o.Pq0(Math.cos(e)*t,2.35+1.7*Math.random(),Math.sin(e)*t);d.current.push({id:Date.now()+Math.random(),position:r,type:"orbital"})}if(Math.random()>.2){let e=Math.random()*Math.PI*2,t=2.5*Math.random(),r=new o.Pq0(Math.cos(e)*t,1.2+3*Math.random(),Math.sin(e)*t);d.current.push({id:Date.now()+Math.random(),position:r,type:"falling"})}.1>Math.random()&&u.current.push({id:Date.now()+Math.random()});let m=Date.now();m-h.current>=1e3&&(h.current=m,r&&i&&(function(e,t){let r=[];return t.forEach(t=>{if(!(t.health<=0)&&5.25>=t.position.distanceTo(e)){let{damage:e,isCritical:n}=Z(29);r.push({targetId:t.id,damage:e,isCritical:n,position:t.position.clone()})}}),r})(s,r).forEach(e=>{i(e.targetId,e.damage,e.isCritical,e.position,!0)}))}),(0,n.jsxs)("group",{ref:l,children:[d.current.map(e=>(0,n.jsx)(J,{initialPosition:e.position,type:e.type,onComplete:()=>{d.current=d.current.filter(t=>t.id!==e.id)}},e.id)),u.current.map(e=>(0,n.jsx)(ee,{onComplete:()=>{u.current=u.current.filter(t=>t.id!==e.id)}},e.id))]})}let er=e=>{let{parentRef:t}=e,[r,n]=(0,s.useState)(!1);return{isActive:r,activateFirebeam:(0,s.useCallback)(()=>{if(!t.current)return;let e=t.current.position.clone();e.y+=1;let r=new o.Pq0(0,0,1).applyQuaternion(t.current.quaternion);return n(!0),{position:e,direction:r,onComplete:()=>n(!1),damage:47}},[t]),deactivateFirebeam:(0,s.useCallback)(()=>{n(!1)},[])}};function en(e){let{parentRef:t,charges:r,orbitRadius:a=.55,orbitSpeed:l=.8,particleSize:c=.08,particleCount:h=8,weaponType:d}=e,u=(0,s.useRef)([]),m=(()=>{switch(d){case i.SCYTHE:return"#00FF37";case i.SWORD:return"#FF831D";case i.SABRES:case i.SABRES2:return"#0091FF";default:return"#00ff44"}})();return(0,I.F)(()=>{t.current&&u.current.forEach((e,t)=>{let r=t/h*Math.PI*2+.001*Date.now()*l,n=Math.cos(r)*a,s=Math.sin(r)*a,o=.05*Math.sin(.002*Date.now()+t);e.position.set(n,o,s)})}),(0,n.jsx)(n.Fragment,{children:Array.from({length:h}).map((e,t)=>{let s=r[t];return(0,n.jsxs)("group",{ref:e=>{e&&(u.current[t]=e)},children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[c,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:(null==s?void 0:s.available)?m:"#333333",emissive:(null==s?void 0:s.available)?m:"#333333",emissiveIntensity:(null==s?void 0:s.available)?1.25:.4,transparent:!0,opacity:(null==s?void 0:s.available)?.8:.4})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[1.225*c,32,32]}),(0,n.jsx)("meshStandardMaterial",{color:(null==s?void 0:s.available)?m:"#333333",emissive:(null==s?void 0:s.available)?m:"#333333",emissiveIntensity:(null==s?void 0:s.available)?.5:.1,transparent:!0,opacity:(null==s?void 0:s.available)?.4:.15,depthWrite:!1,side:o.$EB,blending:o.EZo})]})]},t)})})}let es=e=>{let{parentRef:t,onHit:r,enemyData:n,setActiveEffects:i,charges:a,setCharges:l,setDamageNumbers:c,nextDamageNumberId:h}=e,d=(0,s.useRef)(0),u=(0,s.useRef)(null),m=(0,s.useRef)(0),{isActive:p,activateFirebeam:x,deactivateFirebeam:f}=er({onHit:r,parentRef:t}),g=(0,s.useCallback)(()=>{null!==u.current&&(i(e=>e.filter(e=>e.id!==u.current)),u.current=null),f()},[f,i]),j=(0,s.useCallback)(()=>{let e=a.findIndex(e=>e.available);return -1!==e&&(l(t=>t.map((t,r)=>r===e?{...t,available:!1,cooldownStartTime:Date.now()}:t)),setTimeout(()=>{l(t=>t.map((t,r)=>r===e?{...t,available:!0,cooldownStartTime:null}:t))},7850),!0)},[a,l]),y=(0,s.useCallback)(()=>{let e=Date.now();if(e-m.current<600||!j())return;let t=x();if(!t)return;let{position:s,direction:a,damage:l}=t,p=d.current++;u.current=p,m.current=e,i(e=>[...e,{id:p,type:"firebeam",position:s,direction:a}]),n.forEach(e=>{if(e.health<=0)return;let t=new o.Pq0(s.x,0,s.z),n=new o.Pq0(e.position.x,0,e.position.z),i=a.clone().setY(0).normalize(),d=n.clone().sub(t).dot(i);if(d<=0||d>20)return;let u=t.clone().add(i.multiplyScalar(d));1.375>n.distanceTo(u)&&(r(e.id,l),c(t=>[...t,{id:h.current++,damage:l,position:e.position.clone(),isCritical:!1,isFirebeam:!0}]))}),setTimeout(()=>{g()},6e3)},[h,c,x,n,r,i,j,g]);return(0,s.useEffect)(()=>()=>{g()},[g]),{isActive:p,startFirebeam:y,stopFirebeam:g}},eo=e=>{let{beamRef:t}=e,r=(0,s.useRef)(0),n=(0,s.useRef)(!0),o=(0,s.useRef)(!1);return(0,s.useEffect)(()=>{let e=t.current;return()=>{n.current=!1,e&&(o.current=!0,setTimeout(()=>{e&&(e.scale.z=0)},75e5))}},[t]),(0,I.F)((e,n)=>{if(t.current){if(o.current)r.current-=n/2500,r.current>0&&(t.current.scale.z=r.current);else if(r.current<1){r.current+=n/0;let e=Math.min(r.current,1);t.current.scale.z=e}}}),{reset:()=>{r.current=0,n.current=!1,o.current=!0,setTimeout(()=>{t.current&&(t.current.scale.z=0),o.current=!1},5e6)}}};function ei(e){let{position:t,direction:r,onComplete:o}=e,i=(0,s.useRef)(null);(0,s.useEffect)(()=>{let e=i.current;return()=>{e&&(e.scale.z=0),o()}},[o]);let{reset:a}=eo({beamRef:i,position:t,direction:r});return(0,s.useEffect)(()=>()=>{a()},[a]),(0,n.jsxs)("group",{ref:i,position:t.toArray(),rotation:[0,Math.atan2(r.x,r.z),0],children:[(0,n.jsxs)("group",{position:[0,-1.1,0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.65,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#58FCEC",emissive:"#00E5FF",emissiveIntensity:2.5,transparent:!0,opacity:.65})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.825,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#58FCEC",emissive:"#00E5FF",emissiveIntensity:.7,transparent:!0,opacity:.65})]}),[void 0,void 0,void 0].map((e,t)=>(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,t*Math.PI/3],children:[(0,n.jsx)("torusGeometry",{args:[.875,.075,8,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#58FCEC",emissive:"#00E5FF",emissiveIntensity:.8,transparent:!0,opacity:.9})]},"ring-".concat(t))),(0,n.jsx)("pointLight",{color:"#58FCEC",intensity:20,distance:3})]}),(0,n.jsxs)("group",{position:[0,-1.1,10.7],children:[(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.1,.1,20,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#58FCEC",emissive:"#00E5FF",emissiveIntensity:15,transparent:!0,opacity:.95})]}),(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.25,.275,20,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#58FCEC",emissive:"#00E5FF",emissiveIntensity:5,transparent:!0,opacity:.7})]}),(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.3,.375,20,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#58FCEC",emissive:"#00E5FF",emissiveIntensity:1,transparent:!0,opacity:.6})]}),(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.35,.375,20,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#58FCEC",emissive:"#00E5FF",emissiveIntensity:.75,transparent:!0,opacity:.6})]}),[void 0,void 0,void 0,void 0,void 0].map((e,t)=>(0,n.jsxs)("mesh",{rotation:[-Math.PI/4,0,-(t*Math.PI/1.5)],position:[0,0,10],children:[(0,n.jsx)("torusGeometry",{args:[.35,.05,8,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#58FCEC",emissive:"#00E5FF",emissiveIntensity:1,transparent:!0,opacity:.3})]},t)),[...Array(24)].map((e,t)=>(0,n.jsxs)("mesh",{position:[(Math.random()-.5)*1.75,(Math.random()-.5)*1.75,10*Math.random()],rotation:[Math.random()*Math.PI*2,Math.random()*Math.PI*2,Math.random()*Math.PI*2],children:[(0,n.jsx)("boxGeometry",{args:[.05,.05,.1]})," ",(0,n.jsx)("meshStandardMaterial",{color:"#58FCEC",emissive:"#00E5FF",emissiveIntensity:2,transparent:!0,opacity:.75})]},"spark-".concat(t))),(0,n.jsx)("pointLight",{position:[0,0,18.5],color:"#00E5FF",intensity:12,distance:4})]})]})}let ea=e=>{let{position:t,onComplete:r}=e,[o,i]=(0,s.useState)(0);(0,I.F)((e,t)=>{i(e=>{let n=e+t;return n>=1.5&&r(),n})});let a=o/1.5,l=Math.sin(a*Math.PI),c=1+2*a;return(0,n.jsxs)("group",{position:t.toArray(),children:[[void 0,void 0,void 0].map((e,t)=>(0,n.jsxs)("mesh",{position:[0,2*a+.5*t,0],rotation:[Math.PI/2,0,2*o],children:[(0,n.jsx)("torusGeometry",{args:[.8-.2*t,.05,16,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#00ff88",emissive:"#00ff88",emissiveIntensity:1.5,transparent:!0,opacity:l*(1-.2*t)})]},"ring-".concat(t))),(0,n.jsxs)("mesh",{scale:[c,c,c],children:[(0,n.jsx)("sphereGeometry",{args:[.5,32,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#5EFF00",emissive:"#5EFF00",emissiveIntensity:2,transparent:!0,opacity:.3*l})]}),[...Array(12)].map((e,t)=>{let r=t/12*Math.PI*2,s=.75+a;return(0,n.jsxs)("mesh",{position:[Math.cos(r+2*o)*s/1.1,2*a+.5*Math.sin(3*o+t),Math.sin(r+2*o)*s/1.1],children:[(0,n.jsx)("sphereGeometry",{args:[.095,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#5EFF00",emissive:"#5EFF00",emissiveIntensity:2.5,transparent:!0,opacity:.8*l})]},"particle-".concat(t))}),(0,n.jsx)("pointLight",{color:"#00ff88",intensity:2*l,distance:5,decay:2})]})},el=(0,s.forwardRef)((e,t)=>{let{parentRef:r,onHealthChange:a,charges:c,setCharges:h,setDamageNumbers:d,nextDamageNumberId:u}=e,[m,p]=(0,s.useState)(!1),{castReanimate:x}=function(e){let{charges:t,setCharges:r,onHealthChange:n,parentRef:a,setDamageNumbers:c,nextDamageNumberId:h}=e,d=(0,s.useRef)(0),u=1e3*l[i.SCYTHE].passive.cooldown;return{castReanimate:(0,s.useCallback)(()=>{let e=Date.now();if(e-d.current<u)return console.log("Reanimate is on cooldown"),!1;let s=t.findIndex(e=>e.available);if(-1===s)return console.log("No charges available for Reanimate"),!1;d.current=e,r(e=>e.map((e,t)=>t===s?{...e,available:!1,cooldownStartTime:Date.now()}:e));let i=null==a?void 0:a.current;return i&&c(e=>[...e,{id:h.current++,damage:7,position:i.position.clone().add(new o.Pq0(0,2,0)),isCritical:!1,isHealing:!0}]),n(7),setTimeout(()=>{r(e=>e.map((e,t)=>t===s?{...e,available:!0,cooldownStartTime:null}:e))},7850),console.log("Reanimate casted. Healed for ".concat(7," points.")),!0},[t,r,n,a,c,h,u])}}({parentRef:r,charges:c,setCharges:h,onHealthChange:a,setDamageNumbers:d,nextDamageNumberId:u}),f=(0,s.useCallback)(()=>{let e=x();return e&&p(!0),e},[x]);return(0,s.useImperativeHandle)(t,()=>({castReanimate:f})),m&&r.current?(0,n.jsx)(ea,{position:r.current.position.clone().add(new o.Pq0(0,0,0)),onComplete:()=>p(!1)}):null});el.displayName="Reanimate";let ec=e=>{let{effectRef:t,parentRef:r}=e,n=(0,s.useRef)(0),i=(0,s.useRef)(!0);return(0,s.useEffect)(()=>{let e=t.current;return()=>{i.current=!1,e&&e.scale.set(0,0,0)}},[t]),(0,I.F)((e,s)=>{if(!t.current||!i.current||!r.current)return;n.current+=s;let a=n.current/.2;if(a<=1){let e=r.current.quaternion,n=new o.Pq0(0,0,2);n.applyQuaternion(e),t.current.position.copy(r.current.position).add(n).setY(.1);let s=new o.PTz().setFromAxisAngle(new o.Pq0(-1,0,0),-Math.PI/2);t.current.quaternion.copy(e).multiply(s);let i=1.5*Math.sin(a*Math.PI);t.current.scale.set(i,i,.5*i),t.current.traverse(e=>{let t=e.material;(null==t?void 0:t.opacity)!==void 0&&(t.opacity=Math.sin(a*Math.PI))})}else i.current=!1,t.current&&t.current.scale.set(0,0,0)}),{reset:()=>{n.current=0,i.current=!0,t.current&&t.current.scale.set(0,0,0)}}};function eh(e){let{position:t,direction:r,onComplete:o,parentRef:i}=e,a=(0,s.useRef)(null);(0,s.useEffect)(()=>()=>{o()},[o]);let{reset:l}=ec({effectRef:a,position:t,direction:r,parentRef:i});return(0,s.useEffect)(()=>()=>{l()},[l]),(0,n.jsx)("group",{ref:a,position:t.toArray(),rotation:[Math.PI/2,Math.atan2(r.x,r.z),0],children:(0,n.jsxs)("group",{position:[0,0,0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("torusGeometry",{args:[3,.8,8,32,Math.PI]}),(0,n.jsx)("meshStandardMaterial",{color:"#FF9748",emissive:"#FF6F00",emissiveIntensity:2,transparent:!0,opacity:.9})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("torusGeometry",{args:[3,.4,16,32,Math.PI]}),(0,n.jsx)("meshStandardMaterial",{color:"#FF9748",emissive:"#FF6F00",emissiveIntensity:1,transparent:!0,opacity:.7})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("torusGeometry",{args:[2,.9,16,32,Math.PI]}),(0,n.jsx)("meshStandardMaterial",{color:"#FF9748",emissive:"#FF6F00",emissiveIntensity:1.3,transparent:!0,opacity:.5})]}),[...Array(12)].map((e,t)=>(0,n.jsxs)("mesh",{position:[1.5*Math.cos(t*Math.PI/6),1.5*Math.sin(t*Math.PI/6),0],children:[(0,n.jsx)("sphereGeometry",{args:[.15,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#FF9748",emissive:"#FF6F00",emissiveIntensity:1.5,transparent:!0,opacity:.6})]},t)),(0,n.jsx)("pointLight",{color:"#FF9748",intensity:15,distance:8}),(0,n.jsx)("pointLight",{color:"#FF6F00",intensity:10,distance:12})]})})}let ed=e=>{let{currentHealth:t,maxHealth:r,onHealthChange:n,setDamageNumbers:o,nextDamageNumberId:i,healAmount:a=10}=e;return{processHealing:(0,s.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a,s=arguments.length>1?arguments[1]:void 0,l=Math.min(e,r-t);l>0&&(n(l),o&&i&&o(e=>[...e,{id:i.current++,damage:l,position:s,isCritical:!1,isHealing:!0}]))},[t,r,n,o,i,a])}},eu=e=>{let{parentRef:t,onHit:r,charges:n,setCharges:i,enemyData:a,onHealthChange:l,setDamageNumbers:c,nextDamageNumberId:h,currentHealth:d,maxHealth:u}=e,[m,p]=(0,s.useState)(!1),{processHealing:x}=ed({currentHealth:d,maxHealth:u,onHealthChange:l,setDamageNumbers:c,nextDamageNumberId:h,healAmount:5}),f=(0,s.useCallback)(()=>{let e=n.filter(e=>e.available);if(e.length<4)return console.log("Not enough charges available for Oathstrike"),!1;i(t=>t.map((t,r)=>r===e[0].id-1||r===e[1].id-1||r===e[2].id-1||r===e[3].id-1?{...t,available:!1,cooldownStartTime:Date.now()}:t));for(let t=0;t<4;t++)e[t].id&&setTimeout(()=>{i(r=>r.map((r,n)=>n===e[t].id-1?{...r,available:!0,cooldownStartTime:null}:r))},7850);return!0},[n,i]);return{isActive:m,activateOathstrike:(0,s.useCallback)(()=>{if(!t.current||!f())return null;let e=t.current.position.clone();e.y+=1;let n=new o.Pq0(0,0,1).applyQuaternion(t.current.quaternion);p(!0),x(5,e);let s=n.clone(),i=.6*Math.PI;return a.forEach(t=>{if(t.health<=0)return;let n=t.position.clone().sub(e);if(5.5>=n.length()&&Math.abs(s.angleTo(n))<=i/2){let{damage:e,isCritical:n}=Z(43);r(t.id,e),c(r=>[...r,{id:h.current++,damage:e,position:t.position.clone(),isCritical:n,isOathstrike:!0}])}}),{position:e,direction:n,onComplete:()=>{p(!1)}}},[h,c,t,f,a,r,x])}},em=e=>{let{onHealthChange:t,parentRef:r,setDamageNumbers:n,nextDamageNumberId:i,currentHealth:a,maxHealth:l}=e,[c,h]=(0,s.useState)(!1),{processHealing:d}=ed({currentHealth:a,maxHealth:l,onHealthChange:t,setDamageNumbers:n,nextDamageNumberId:i,healAmount:3});return{processHealingChance:(0,s.useCallback)(()=>{r.current&&.25>Math.random()&&(d(3,r.current.position.clone().add(new o.Pq0(0,2,0))),h(!0))},[d,r,.25,3]),showHealingEffect:c,setShowHealingEffect:h}},ep=e=>{let{position:t,onComplete:r}=e,[o,i]=(0,s.useState)(0);(0,I.F)((e,t)=>{i(e=>{let n=e+t;return n>=1.5&&r(),n})});let a=o/1.5,l=Math.sin(a*Math.PI),c=1+2*a;return(0,n.jsxs)("group",{position:t.toArray(),children:[[void 0,void 0,void 0].map((e,t)=>(0,n.jsxs)("mesh",{position:[0,2*a+.5*t,0],rotation:[Math.PI/2,0,2*o],children:[(0,n.jsx)("torusGeometry",{args:[.8-.2*t,.05,16,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffaa00",emissive:"#ff8800",emissiveIntensity:2,transparent:!0,opacity:l*(1-.2*t)})]},"ring-".concat(t))),(0,n.jsxs)("mesh",{scale:[c,c,c],children:[(0,n.jsx)("sphereGeometry",{args:[.5,32,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffaa00",emissive:"#ff8800",emissiveIntensity:3,transparent:!0,opacity:.3*l})]}),[...Array(12)].map((e,t)=>{let r=t/12*Math.PI*2,s=1+a;return(0,n.jsxs)("mesh",{position:[Math.cos(r+2*o)*s,2*a+.5*Math.sin(3*o+t),Math.sin(r+2*o)*s],children:[(0,n.jsx)("sphereGeometry",{args:[.1,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffaa00",emissive:"#ff8800",emissiveIntensity:2,transparent:!0,opacity:.8*l})]},"particle-".concat(t))}),(0,n.jsx)("pointLight",{color:"#ff8800",intensity:4*l,distance:5,decay:2})]})},ex=(0,s.forwardRef)((e,t)=>{let{parentRef:r,onHealthChange:i,setDamageNumbers:a,nextDamageNumberId:l,currentHealth:c,maxHealth:h}=e,d=(0,s.useRef)(null),{processHealingChance:u,showHealingEffect:m,setShowHealingEffect:p}=em({onHealthChange:i,parentRef:r,setDamageNumbers:a,nextDamageNumberId:l,currentHealth:c,maxHealth:h});return(0,s.useImperativeHandle)(t,()=>({processHealingChance:u})),(0,I.F)(()=>{if(d.current&&r.current){let e=r.current.position;d.current.position.set(e.x,.015,e.z),d.current.rotation.y+=.0012}}),(0,n.jsxs)(n.Fragment,{children:[m&&r.current&&(0,n.jsx)(ep,{position:r.current.position.clone().add(new o.Pq0(0,0,0)),onComplete:()=>p(!1)}),(0,n.jsxs)("group",{ref:d,children:[(0,n.jsx)("group",{rotation:[0,0,0],position:[0,.005,0],children:[0,Math.PI/2,Math.PI,1.5*Math.PI].map((e,t)=>(0,n.jsxs)("mesh",{rotation:[-Math.PI/2,0,e+8e-4*Date.now()],children:[(0,n.jsx)("ringGeometry",{args:[.85,1,3]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffaa00",emissive:"#ff8800",emissiveIntensity:2,transparent:!0,opacity:.6,depthWrite:!1})]},t))}),(0,n.jsxs)("mesh",{position:[0,.1,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.925,.5,-.175,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#ff8800",emissive:"#ff6600",emissiveIntensity:1,transparent:!0,opacity:.55,depthWrite:!1})]})]})]})});ex.displayName="CrusaderAura";let ef=()=>(0,n.jsxs)("group",{rotation:[Math.PI/4,0,0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.12,.12,1.8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",roughness:.4,metalness:.3})]}),(0,n.jsxs)("mesh",{position:new o.Pq0(0,.5,0),rotation:new o.O9p(0,0,Math.PI/6),children:[(0,n.jsx)("sphereGeometry",{args:[.12,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",roughness:.5,metalness:.2})]}),(0,n.jsxs)("mesh",{position:new o.Pq0(0,.15,0),rotation:new o.O9p(0,0,-Math.PI/6),children:[(0,n.jsx)("sphereGeometry",{args:[.12,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#a4a4a4",roughness:.5,metalness:.2})]})]});function eg(e){let{parentRef:t}=e,r=(0,s.useRef)([]),o=(0,s.useRef)(null);return(0,I.F)(()=>{if(!t.current||!o.current)return;let e=t.current.position;o.current.position.set(e.x,.4,e.z),r.current.forEach((e,t)=>{let r=t/20*Math.PI*2+.001*Date.now(),n=-(1.75*Math.cos(r)),s=1.75*Math.sin(r),o=.15*Math.sin(.002*Date.now()+t);e.position.set(n,o-.3,s),e.rotation.y=r+Math.PI/3})}),(0,n.jsx)("group",{ref:o,children:Array.from({length:20}).map((e,t)=>(0,n.jsx)("mesh",{ref:e=>{e&&(r.current[t]=e)},children:ef()},t))})}function ej(e){let{parentRef:t}=e,r=(0,s.useRef)(null);return(0,I.F)(()=>{if(r.current&&t.current){let e=t.current.position;r.current.position.set(e.x,.015,e.z),r.current.rotation.y+=96e-5}}),(0,n.jsxs)("group",{ref:r,scale:1.45,children:[(0,n.jsxs)("mesh",{rotation:[-Math.PI/2,0,0],position:[0,.01,0],children:[(0,n.jsx)("ringGeometry",{args:[2.4,2.8,128,1]}),(0,n.jsx)("meshStandardMaterial",{color:"#00ff88",emissive:"#00ff88",emissiveIntensity:1.5,transparent:!0,opacity:.3,depthWrite:!1})]}),(0,n.jsx)("group",{position:[0,.02,0],children:[...Array(8)].map((e,t)=>(0,n.jsxs)("mesh",{rotation:[-Math.PI/2,0,t/8*Math.PI*2+.001*Date.now()],position:[0,0,0],children:[(0,n.jsx)("planeGeometry",{args:[.4,2.6]}),(0,n.jsx)("meshStandardMaterial",{color:"#00ff88",emissive:"#00ff88",emissiveIntensity:2,transparent:!0,opacity:.4+.2*Math.sin(.003*Date.now()+t),depthWrite:!1})]},t))}),(0,n.jsx)("group",{position:[0,.03,0],children:[void 0,void 0,void 0,void 0,void 0].map((e,t)=>{let r=t/5*Math.PI*2;return(0,n.jsxs)("mesh",{position:[1.2*Math.cos(r+.001*Date.now()),0,1.2*Math.sin(r+.001*Date.now())],rotation:[-Math.PI/2,0,r+Math.PI/2],children:[(0,n.jsx)("planeGeometry",{args:[.6,.6]}),(0,n.jsx)("meshStandardMaterial",{color:"#00cc66",emissive:"#00ff88",emissiveIntensity:2,transparent:!0,opacity:.3+.2*Math.sin(.002*Date.now()+.5*t),depthWrite:!1})]},t)})}),(0,n.jsx)("group",{position:[0,.01,0],children:[...Array(12)].map((e,t)=>{let r=t/12*Math.PI*2,s=1.8+.2*Math.sin(.002*Date.now()+t);return(0,n.jsxs)("mesh",{position:[Math.cos(r)*s,0,Math.sin(r)*s],rotation:[-Math.PI/2,0,r+.0015*Date.now()],children:[(0,n.jsx)("planeGeometry",{args:[.2,.8]}),(0,n.jsx)("meshStandardMaterial",{color:"#004433",emissive:"#00ff88",emissiveIntensity:3,transparent:!0,opacity:.2+.1*Math.sin(.004*Date.now()+t),depthWrite:!1})]},t)})}),(0,n.jsxs)("mesh",{position:[0,.02,0],rotation:[-Math.PI/2,0,0],children:[(0,n.jsx)("ringGeometry",{args:[.2,1,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#002211",emissive:"#00ff88",emissiveIntensity:1.5,transparent:!0,opacity:.4,depthWrite:!1})]}),(0,n.jsxs)("mesh",{position:[0,.01,0],rotation:[-Math.PI/2,0,0],children:[(0,n.jsx)("ringGeometry",{args:[2.4,2.55,128,1]}),(0,n.jsx)("meshStandardMaterial",{color:"#00ff88",emissive:"#00ff88",emissiveIntensity:.3,transparent:!0,opacity:.6,depthWrite:!1})]})]})}function ey(e){let{isAttacking:t}=e,r=(0,s.useRef)(null);return(0,n.jsxs)("group",{ref:r,scale:.475,position:[0,-.75,0],children:[(0,n.jsxs)("mesh",{position:[0,2,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.6,.8,4,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#D2B48C",roughness:1,metalness:0})]}),[...Array(12)].map((e,t)=>(0,n.jsx)("group",{rotation:[0,-Math.PI*t/12,.25*Math.PI],position:[0,2.5,0],children:(0,n.jsxs)("mesh",{position:[.7,.5*Math.sin(3*t),0],rotation:[Math.PI/3,0,-(.25*Math.PI)],children:[(0,n.jsx)("coneGeometry",{args:[.2,.8+.5*Math.random(),4]}),(0,n.jsx)("meshStandardMaterial",{color:"#BC8F8F",roughness:1,metalness:0})]})},t)),[.5,1.5,2.5,3.5].map((e,r)=>(0,n.jsxs)("group",{position:[0,e,0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("torusGeometry",{args:[.7,.05,16,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#00ff88",emissive:"#00ff88",emissiveIntensity:t?3:1,transparent:!0,opacity:.9})]}),[void 0,void 0,void 0,void 0].map((e,r)=>(0,n.jsxs)("mesh",{position:[.7*Math.cos(2*Math.PI*r/4),.1*Math.sin(.001*Date.now()+r),.7*Math.sin(2*Math.PI*r/4)],children:[(0,n.jsx)("planeGeometry",{args:[.2,.2]}),(0,n.jsx)("meshStandardMaterial",{color:"#00ff88",emissive:"#00ff88",emissiveIntensity:t?4:2,transparent:!0,opacity:.8,side:2})]},r))]},r)),(0,n.jsxs)("group",{position:[0,4,0],children:[[...Array(8)].map((e,t)=>(0,n.jsxs)("mesh",{position:[.5*Math.cos(2*Math.PI*t/8),.3,.5*Math.sin(2*Math.PI*t/8)],rotation:[.2*Math.random(),2*Math.PI*t/8,.15*Math.PI],children:[(0,n.jsx)("coneGeometry",{args:[.15,1.2,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#DEB887",roughness:1,metalness:0})]},t)),(0,n.jsxs)("mesh",{position:[0,.5,0],children:[(0,n.jsx)("sphereGeometry",{args:[.3,32,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#00ff88",emissive:"#00ff88",emissiveIntensity:t?5:3})]})]}),(0,n.jsxs)("mesh",{position:[0,.3,0],children:[(0,n.jsx)("cylinderGeometry",{args:[1,1.2,.6,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#D2B48C",roughness:1,metalness:0})]}),t&&[void 0,void 0,void 0,void 0].map((e,t)=>(0,n.jsxs)("mesh",{position:[1*Math.cos(2*Math.PI*t/4),2,1*Math.sin(2*Math.PI*t/4)],children:[(0,n.jsx)("sphereGeometry",{args:[.1,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#00ff88",emissive:"#00ff88",emissiveIntensity:5,transparent:!0,opacity:.8})]},t)),(0,n.jsx)(eg,{parentRef:r}),(0,n.jsx)(ej,{parentRef:r})]})}function eM(e){let{position:t,enemyData:r,onDamage:i,onComplete:a,onStartCooldown:l,setActiveEffects:c,activeEffects:h,setDamageNumbers:d,nextDamageNumberId:u}=e,m=(0,s.useRef)(null),[p,x]=(0,s.useState)(null),f=(0,s.useRef)(0),g=(0,s.useRef)(Date.now()),j=(0,s.useRef)(!1),y=(0,s.useRef)(Date.now()),M=(0,s.useRef)(Date.now()),v=(0,s.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!m.current)return null;let t=m.current.position,n=r.filter(r=>!(r.health<=0)&&!r.isDying&&!r.deathStartTime&&!!r.position&&(!e||!p||r.id!==p.id)&&40>=new o.Pq0(r.position.x-t.x,0,r.position.z-t.z).length());return n.length>0?n[Math.floor(Math.random()*n.length)]:null},[r,40,p]),P=(0,s.useCallback)(e=>{if(!e||e.health<=0||e.isDying||e.deathStartTime||!e.position)return;let t=e.id.startsWith("boss-")||e.id.startsWith("enemy-boss-")?13:37,n=e.position.clone().setY(1.5),s=r.find(t=>t.id===e.id);if(!s||s.health<=0)return;i(e.id,t,n,!0),d(e=>[...e,{id:u.current++,damage:t,position:n.clone(),isCritical:!1,isSummon:!0}]);let a=Date.now(),l=new o.Pq0;m.current&&m.current.getWorldPosition(l);let h=n.clone().sub(l);c(t=>[...t.filter(e=>"summonExplosion"!==e.type||e.startTime&&Date.now()-e.startTime<400),{id:a,type:"summonExplosion",position:h,direction:new o.Pq0,duration:.4,startTime:Date.now(),summonId:y.current,targetId:e.id}]),setTimeout(()=>{c(e=>e.filter(e=>e.id!==a))},550)},[37,i,c,d,u,r]);return(0,I.F)(()=>{if(Date.now()-g.current>12e3&&!j.current){j.current=!0,a(),l();return}let e=Date.now();if(e-M.current>=2400){let t=v(!0);t&&x(t),M.current=e}p&&p.health>0&&!p.isDying&&!p.deathStartTime?e-f.current>=600&&(p&&p.health>0&&!p.isDying&&!p.deathStartTime&&p?(P(p),f.current=e):x(v())):x(v())}),(0,s.useEffect)(()=>{let e=y.current;return()=>{c(t=>t.filter(t=>"summonExplosion"!==t.type||t.summonId!==e))}},[c]),(0,n.jsxs)("group",{ref:m,position:t.toArray(),children:[(0,n.jsx)(ey,{isAttacking:!!p}),h.map(e=>{if("summonExplosion"===e.type){let t=e.startTime?(Date.now()-e.startTime)/1e3:0,s=Math.max(0,1-t/(e.duration||.2)),i=e.targetId?r.find(t=>t.id===e.targetId):null;if(i&&m.current){let r=new o.Pq0;m.current.getWorldPosition(r);let a=i.position.clone().setY(1.5).sub(r);return(0,n.jsxs)("group",{position:a.toArray(),children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.35*(1+2*t),32,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#8800ff",emissive:"#9933ff",emissiveIntensity:.5*s,transparent:!0,opacity:.8*s,depthWrite:!1,blending:o.EZo})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.25*(1+3*t),24,24]}),(0,n.jsx)("meshStandardMaterial",{color:"#aa66ff",emissive:"#ffffff",emissiveIntensity:.5*s,transparent:!0,opacity:.9*s,depthWrite:!1,blending:o.EZo})]}),[.45,.65,.85,1.05].map((e,r)=>(0,n.jsxs)("mesh",{rotation:[Math.random()*Math.PI,Math.random()*Math.PI,Math.random()*Math.PI],children:[(0,n.jsx)("torusGeometry",{args:[e*(1+3*t),.045,16,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#8800ff",emissive:"#9933ff",emissiveIntensity:1*s,transparent:!0,opacity:.6*s*(1-.2*r),depthWrite:!1,blending:o.EZo})]},r)),[...Array(8)].map((e,r)=>{let i=r/8*Math.PI*2,a=.5*(1+2*t);return(0,n.jsxs)("mesh",{position:[Math.sin(i)*a,Math.cos(i)*a,0],children:[(0,n.jsx)("sphereGeometry",{args:[.05,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#aa66ff",emissive:"#ffffff",emissiveIntensity:2*s,transparent:!0,opacity:.8*s,depthWrite:!1,blending:o.EZo})]},"spark-".concat(r))}),(0,n.jsx)("pointLight",{color:"#8800ff",intensity:2*s,distance:4,decay:2}),(0,n.jsx)("pointLight",{color:"#aa66ff",intensity:1*s,distance:6,decay:1})]},e.id)}}return null})]})}let ev=e=>{let{parentRef:t,enemies:r,onEnemyDamage:n,setDamageNumbers:i,nextDamageNumberId:a}=e,[l,c]=(0,s.useState)([]),[h,d]=(0,s.useState)(!1);return{processChainLightning:(0,s.useCallback)(()=>{if(h)return;if(d(!0),Math.random()>=1){console.log("Chain Lightning failed random check"),d(!1);return}let e=(e,t)=>{let n=null,s=1/0,o="";return r.forEach(r=>{if(r.isDying||!r.position||r.health<=0||t.has(r.id))return;let i=e.distanceTo(r.position);i<s&&i<10.5&&(s=i,n=r.position,o=r.id)}),n?{position:n,id:o}:null},s=e=>[17,13,11,7][e],l=new Set,u=e(t.current.position.clone(),l);if(!u){d(!1);return}l.add(u.id);let m=[u.position];n(u.id,17,!1,u.position,!0),i(e=>[...e,{id:a.current++,damage:17,position:u.position.clone().add(new o.Pq0(0,1.5,0)),isCritical:!1,isChainLightning:!0}]);let p=u.position;for(let t=1;t<Math.min(r.length,4);t++){let r=e(p,l);if(!r)break;let c=s(t);console.log("Chain Lightning jump ".concat(t,": Damage=").concat(c)),m.push(r.position),l.add(r.id),setTimeout(()=>{n(r.id,c,!1,r.position,!0),i(e=>[...e,{id:a.current++,damage:c,position:r.position.clone().add(new o.Pq0(0,1.5,0)),isCritical:!1,isChainLightning:!0}])},100*t),p=r.position}m.length>0&&(c(m),setTimeout(()=>{c([]),d(!1)},500))},[t,r,n,i,a,h]),lightningTargets:l,isProcessing:h}},eP=e=>{let{startPosition:t,targetPositions:r}=e,[i,a]=(0,s.useState)(0),[l,c]=(0,s.useState)(1);(0,I.F)((e,t)=>{a(e=>Math.min(e+t,.5)),c(.5*Math.random()+.5)});let h=i/.5,d=(e,t)=>new o.Pq0((Math.random()-.5)*t+Math.sin(e*Math.PI*8+30*i)*t,(Math.random()-.5)*t+Math.cos(e*Math.PI*8+30*i)*t+2,(Math.random()-.5)*t+Math.sin(e*Math.PI*8+30*i)*t),u=new o.Q1f("#FFD700"),m=new o.Q1f("#FFA500");return(0,n.jsx)("group",{children:r.map((e,s)=>{let i=0===s?t:r[s-1],a=Math.ceil(8*e.clone().sub(i).length());return(0,n.jsxs)("group",{children:[[...Array(a)].map((t,r)=>{let s=r/a,c=d(s,.15),p=i.clone().lerp(e,s).add(c).add(new o.Pq0(0,.5*Math.sin(s*Math.PI),0)),x=.025*Math.random()+.04;return(0,n.jsxs)("group",{children:[(0,n.jsxs)("mesh",{position:p.toArray(),children:[(0,n.jsx)("sphereGeometry",{args:[x,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:u,emissive:u,emissiveIntensity:5*l,transparent:!0,opacity:.7*(1-h)*l})]}),.2>Math.random()&&(0,n.jsxs)("mesh",{position:p.clone().add(d(s,.25)),children:[(0,n.jsx)("sphereGeometry",{args:[.35*x,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:m,emissive:m,emissiveIntensity:4*l,transparent:!0,opacity:.75*(1-h)*l})]})]},r)}),(0,n.jsxs)("mesh",{position:e.toArray(),children:[(0,n.jsx)("sphereGeometry",{args:[.4,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:u,emissive:u,emissiveIntensity:3*l,transparent:!0,opacity:.6*(1-h)*l})]}),(0,n.jsx)("pointLight",{position:e.toArray(),color:m,intensity:15*(1-h)*l,distance:4,decay:2})]},s)})})},ew=(0,s.forwardRef)((e,t)=>{let{parentRef:r,enemies:o,onEnemyDamage:i,setDamageNumbers:a,nextDamageNumberId:l}=e,{processChainLightning:c,lightningTargets:h}=ev({parentRef:r,enemies:o,onEnemyDamage:i,setDamageNumbers:a,nextDamageNumberId:l});return(0,s.useImperativeHandle)(t,()=>({processChainLightning:c})),(0,n.jsx)(n.Fragment,{children:h.length>0&&(0,n.jsx)(eP,{startPosition:r.current.position,targetPositions:h})})});ew.displayName="ChainLightning";let eS={1:7,2:11,3:17,4:23,5:29,6:43,7:59,8:73},eI=e=>{let{position:t}=e,[r,i]=s.useState(()=>Array(15).fill(null).map(()=>({offset:new o.Pq0((Math.random()-.5)*.8,0,(Math.random()-.5)*.8),speed:new o.Pq0((Math.random()-.5)*.55,(Math.random()-.5)*.05,(Math.random()-.5)*.55),life:1,orbit:{radius:.2+.3*Math.random(),speed:(Math.random()+.5)*2,phase:Math.random()*Math.PI*2}})));return(0,I.F)((e,t)=>{i(e=>e.map(e=>{let r=.001*Date.now()*e.orbit.speed+e.orbit.phase;return(e.offset.x=Math.cos(r)*e.orbit.radius+e.speed.x,e.offset.z=Math.sin(r)*e.orbit.radius+e.speed.z,e.offset.y=e.speed.y,e.speed.add(new o.Pq0((Math.random()-.5)*.01,(Math.random()-.5)*.001,(Math.random()-.5)*.01)),e.speed.multiplyScalar(.8),e.life-=1*t,e.life<=0)?{offset:new o.Pq0((Math.random()-.5)*.4,0,(Math.random()-.5)*.4),speed:new o.Pq0((Math.random()-.5)*.15,(Math.random()-.5)*.05,(Math.random()-.5)*.15),life:1,orbit:{radius:.4+.3*Math.random(),speed:(Math.random()+.5)*2,phase:Math.random()*Math.PI*2}}:e}))}),(0,n.jsx)("group",{position:t,children:r.map((e,t)=>(0,n.jsxs)("mesh",{position:e.offset.toArray(),children:[(0,n.jsx)("sphereGeometry",{args:[.0125,4,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#4488ff",emissive:"#4488ff",emissiveIntensity:3,transparent:!0,opacity:.8*e.life,depthWrite:!1,blending:o.EZo})]},t))})},eb=(0,s.forwardRef)((e,t)=>{let{parentRef:r,charges:i,setCharges:a}=e,l=(0,s.useRef)(null),{calculateBonusDamage:c,consumeOrb:h}=function(e){let{charges:t,setCharges:r}=e;return{calculateBonusDamage:(0,s.useCallback)(()=>eS[t.filter(e=>e.available).length]||0,[t]),consumeOrb:(0,s.useCallback)(()=>{let e=t.filter(e=>e.available);if(0===e.length)return;let n=e[0];r(e=>e.map(e=>e.id===n.id?{...e,available:!1,cooldownStartTime:Date.now()+200}:e)),setTimeout(()=>{r(e=>e.map(e=>e.id===n.id?{...e,available:!0,cooldownStartTime:null}:e))},8050)},[t,r])}}({charges:i,setCharges:a});if((0,s.useImperativeHandle)(t,()=>({calculateBonusDamage:c,consumeOrb:h})),(0,I.F)(()=>{l.current&&r.current&&l.current.position.copy(r.current.position)}),!r.current||!i.some(e=>e.available))return null;let d=i.length;return(0,n.jsx)("group",{ref:l,children:i.map((e,t)=>{if(!e.available)return null;let r=Math.acos(-1+2*t/d),s=Math.sqrt(d*Math.PI)*r,i=.05*Math.sin(r)*Math.cos(s),a=.05*Math.sin(r)*Math.sin(s+.001*Date.now()),l=.05*Math.cos(r);return(0,n.jsx)(eI,{position:new o.Pq0(i,a,l)},e.id)})})});eb.displayName="OrbShield";let eC=e=>{let{position:t,onComplete:r}=e,i=(0,s.useRef)(Date.now()),a=(0,s.useRef)(!1);(0,s.useEffect)(()=>{let e=setTimeout(()=>{a.current||(a.current=!0,null==r||r())},2850);return()=>clearTimeout(e)},[r]);let[l,c]=(0,s.useState)(()=>Array(40).fill(null).map(()=>({position:new o.Pq0(t.x+(Math.random()-.5)*1.65,t.y+3+2*Math.random(),t.z+(Math.random()-.5)*2),velocity:new o.Pq0((Math.random()-.5)*3,-(5*Math.random())-3,(Math.random()-.5)*3),scale:.1*Math.random()+.02,rotation:Math.random()*Math.PI,rotationSpeed:(Math.random()-.5)*5,life:1})));return(0,I.F)((e,t)=>{c(e=>{let n=e.map(e=>({...e,velocity:e.velocity.clone().add(new o.Pq0(0,-(8*t),0)),position:e.position.clone().add(e.velocity.clone().multiplyScalar(t)),rotation:e.rotation+e.rotationSpeed*t,life:e.life-t})).filter(e=>e.life>0),s=Date.now()-i.current;return!a.current&&0===n.length&&s>=1250&&(a.current=!0,null==r||r()),n})}),(0,n.jsx)("group",{children:l.map((e,t)=>(0,n.jsxs)("mesh",{position:e.position.toArray(),scale:[e.scale,e.scale,e.scale],rotation:[e.rotation,e.rotation,e.rotation],children:[(0,n.jsx)("icosahedronGeometry",{args:[1,0]}),(0,n.jsx)("meshStandardMaterial",{color:"#E5F7FF",emissive:"#E5F7FF",emissiveIntensity:1,transparent:!0,opacity:.45*e.life,depthWrite:!1,blending:o.EZo})]},t))})};function eF(e){let{isLeft:t=!1}=e,r=1.75*Math.PI;return(0,n.jsx)("group",{rotation:[-.45,t?-.7:.7,t?-.15:.15],children:Array.from({length:18}).map((e,s)=>{let o=s/19,i=.075*(1-.725*o),a=Math.pow(o,.2)*r,l=3.25*Math.pow(o,2.7);return(0,n.jsxs)("group",{position:[l*(t?-.15:.15),.0675*s,-(.725*l)],rotation:[-1.5*o,a,0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[i,1.5*i,.0675,10]}),(0,n.jsx)("meshStandardMaterial",{color:"rgb(".concat(139-80*o,", ").concat(0+20*o,", ").concat(0+20*o,")"),roughness:.7,metalness:.4})]}),Array.from({length:6}).map((e,t)=>(0,n.jsx)("group",{rotation:[0,t*Math.PI/2,0],children:(0,n.jsxs)("mesh",{position:[.95*i,0,0],children:[(0,n.jsx)("boxGeometry",{args:[.3*i,.259375,1.5*i]}),(0,n.jsx)("meshStandardMaterial",{color:"rgb(".concat(159-100*o,", ").concat(20+20*o,", ").concat(20+20*o,")"),roughness:.8,metalness:.3})]})},t))]},s)})})}function eE(e){var t,r;let{onHit:l,controlsRef:c,currentWeapon:h,health:d,maxHealth:u,isPlayer:m=!1,abilities:p,onAbilityUse:x,onPositionUpdate:f,enemyData:g,onHealthChange:j,fireballManagerRef:y}=e,M=(0,s.useRef)(null),[v,P]=(0,s.useState)(!1),[w,S]=(0,s.useState)([]),b=(0,s.useRef)(0),{camera:C}=(0,I.D)(),[k,T]=(0,s.useState)(!1),{keys:A}=function(e){let{groupRef:t,controlsRef:r,camera:n,speed:i=.065,onPositionUpdate:a,health:l,isCharging:c=!1,onMovementUpdate:h}=e,d=(0,s.useRef)({w:!1,a:!1,s:!1,d:!1,shift:!1}),u=(0,s.useRef)(!1);return(0,s.useEffect)(()=>{l<=0?(u.current=!0,d.current={w:!1,a:!1,s:!1,d:!1,shift:!1}):u.current=!1},[l]),(0,s.useEffect)(()=>{let e=()=>{u.current=!0,d.current={w:!1,a:!1,s:!1,d:!1,shift:!1}},t=()=>{u.current=!1};return window.addEventListener("gameOver",e),window.addEventListener("gameReset",t),()=>{window.removeEventListener("gameOver",e),window.removeEventListener("gameReset",t)}},[]),(0,I.F)(()=>{if(!t.current||u.current)return;let e=new o.Pq0;if(n.getWorldDirection(e),e.y=0,e.normalize(),r.current&&!d.current.shift){let r=Math.atan2(e.x,e.z);t.current.rotation.y=r}let s=t.current.rotation.y,l=Math.atan2(e.x,e.z);t.current.rotation.y=s+(l-s)*.05;let m=new o.Pq0(-e.z,0,e.x),p=new o.Pq0(0,0,0);if(d.current.w&&p.add(e),d.current.s&&p.sub(e),d.current.a&&p.sub(m),d.current.d&&p.add(m),r.current){let r=Math.atan2(e.x,e.z);t.current.rotation.y=r}if(p.length()>0){p.normalize(),h&&h(p);let r=p.dot(e),n=c?.001:i,s=t.current.position.clone().add(p.multiplyScalar(r<0?.7*n:n));if(29.75>Math.sqrt(s.x*s.x+s.z*s.z))t.current.position.copy(s);else{let e=Math.atan2(s.z,s.x);t.current.position.x=29.75*Math.cos(e),t.current.position.z=29.75*Math.sin(e)}}else h&&h(new o.Pq0);if(r.current){let e=t.current.position;r.current.target.set(e.x,e.y,e.z)}a(t.current.position.clone())}),(0,s.useEffect)(()=>{let e=e=>{if(u.current)return;let t=e.key.toLowerCase();"shift"===t?d.current.shift=!0:t in d.current&&(d.current[t]=!0)},t=e=>{let t=e.key.toLowerCase();"shift"===t?d.current.shift=!1:t in d.current&&(d.current[t]=!1)};return window.addEventListener("keydown",e),window.addEventListener("keyup",t),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",t)}},[]),{keys:d}}({groupRef:M,controlsRef:c,camera:C,onPositionUpdate:f,health:d,isCharging:k,onMovementUpdate:e=>{e_.copy(e)}}),[O,N]=(0,s.useState)(!1),[Q,V]=(0,s.useState)([]),K=(0,s.useRef)(0),[X,J]=(0,s.useState)([]),ee=(0,s.useRef)(0),[er,eo]=(0,s.useState)({}),[ea,ec]=(0,s.useState)(0),ed=(0,s.useRef)(null),em=(0,s.useRef)(0),[ep,ef]=(0,s.useState)([]),[eg,ej]=(0,s.useState)([{id:1,available:!0,cooldownStartTime:null},{id:2,available:!0,cooldownStartTime:null},{id:3,available:!0,cooldownStartTime:null},{id:4,available:!0,cooldownStartTime:null},{id:5,available:!0,cooldownStartTime:null},{id:6,available:!0,cooldownStartTime:null},{id:7,available:!0,cooldownStartTime:null},{id:8,available:!0,cooldownStartTime:null}]),[ey]=(0,s.useState)(15),ev=(0,s.useRef)(new Set),[eP,eS]=(0,s.useState)([]),[eI,eE]=(0,s.useState)(!1),[eR,ek]=(0,s.useState)(!1),eG=(0,s.useRef)(null),[eT,eD]=(0,s.useState)(0),[e_]=(0,s.useState)(()=>new o.Pq0),eA=(0,s.useRef)(null),ez=(0,s.useCallback)(()=>{if(!M.current)return;let e=eg.findIndex(e=>e.available);if(-1===e)return;let t=M.current.position.clone();t.y+=1;let r=new o.Pq0(0,0,1);r.applyQuaternion(M.current.quaternion),ej(t=>t.map((t,r)=>r===e?{...t,available:!1,cooldownStartTime:Date.now()}:t)),S(e=>[...e,{id:b.current++,position:t.clone(),startPosition:t.clone(),direction:r.normalize(),maxDistance:35}])},[M,eg]),eq=(e,t)=>{if(t){let e=Date.now();eS(r=>[...r,{id:e,type:"unitFireballExplosion",position:t,direction:new o.Pq0,duration:.2,startTime:e}])}S(t=>t.filter(t=>t.id!==e))},eB=(0,s.useRef)({}),eL=e=>{if(!M.current||!v)return;let t=Date.now();if(t-(eB.current[e]||0)<250)return;eB.current[e]=t;let r=g.find(t=>t.id===e);if(!r)return;eo(e=>({...e,[r.id]:(e[r.id]||0)+1,["".concat(r.id,"_time")]:t}));let n=r.id.startsWith("enemy");if(!n)return;let s=n&&h===i.SABRES?2:1,c=er[r.id]||0;if(!(c>=s)&&M.current.position.distanceTo(r.position)<=a[h].range){var d,u;if(h===i.SABRES){let e=new o.Pq0().subVectors(r.position,M.current.position).normalize(),t=new o.Pq0(0,0,.25).applyQuaternion(M.current.quaternion);if(Math.abs(e.angleTo(t))>Math.PI/4.5)return}let t=a[h].normal;if(O&&h===i.SWORD){let e=ev.current;if(e.has(r.id)||r.health<=0)return;e.add(r.id);let{damage:t,isCritical:n}=Z(13);l(r.id,t),J(e=>[...e,{id:ee.current++,damage:t,position:r.position.clone(),isCritical:n}]),setTimeout(()=>{let t=g.find(e=>e.id===r.id);if(!t||t.health<=0){e.delete(r.id);return}let{damage:n,isCritical:s}=Z(41);l(r.id,n),J(e=>[...e,{id:ee.current++,damage:n,position:t.position.clone(),isCritical:s,isLightning:!0}]),e.delete(r.id)},300)}let{damage:n,isCritical:s}=Z(t),m=n;if(h===i.SABRES&&eV.current&&p[i.SABRES].active.isUnlocked){let t=eV.current.calculateBonusDamage();if(t>0){m+=t,J(e=>(console.log("Creating OrbShield damage number:",{damage:t,isOrbShield:!0}),[...e,{id:ee.current++,damage:t,position:new o.Pq0(r.position.x+(0===c?-.4:.4),r.position.y+.8,r.position.z),isCritical:!1,isOrbShield:!0}]));let n=M.current.position.clone(),s=new o.Pq0(0,0,1).applyQuaternion(M.current.quaternion).multiplyScalar(2);eS(e=>[...e,{id:Date.now(),type:"frostExplosion",position:n.add(s),direction:new o.Pq0,duration:.5}]),er[e]||eV.current.consumeOrb()}}l(r.id,m);let x=r.health-m;if(h!==i.SWORD||!p[i.SWORD].passive.isUnlocked||O||eI||eR||!(x>0)||(null===(d=eG.current)||void 0===d||d.processHealingChance(),ek(!0)),x>0){if(h===i.SABRES){let e=0===c?-.4:.4;J(t=>[...t,{id:ee.current++,damage:n,position:new o.Pq0(r.position.x+e,r.position.y,r.position.z),isCritical:s}])}else J(e=>[...e,{id:ee.current++,damage:n,position:r.position.clone(),isCritical:s}])}h!==i.SWORD||!p[i.SWORD].active.isUnlocked||O||eI||null===(u=eA.current)||void 0===u||u.processChainLightning()}},eO=()=>{P(!1),eo({}),N(!1),ek(!1)};(0,I.F)((e,t)=>{if(M.current){if(v&&M.current&&g.forEach(e=>{eL(e.id)}),k&&null!==ed.current){let e=Math.min((Date.now()-ed.current)/1e3/1.65,1);ec(e),eD(e);let r=em.current;em.current+=(e-r)*t*15,e>=1&&eU(1)}ef(e=>e.map(e=>{if(e.position.distanceTo(e.startPosition)<e.maxDistance){let t=e.power>=1?.5:.35;return e.position.add(e.direction.clone().multiplyScalar(t)),g.forEach(t=>{let r=new o.Pq0(e.position.x,0,e.position.z),n=new o.Pq0(t.position.x,0,t.position.z);1.375>r.distanceTo(n)&&eJ(e.id,t.id,e.power,e.position)}),e}return null}).filter(Boolean)),S(e=>e.filter(e=>{if(e.position.distanceTo(e.startPosition)<e.maxDistance){for(let t of(e.position.add(e.direction.clone().multiplyScalar(.4)),g)){if(t.health<=0)continue;let r=t.position.clone();if(r.y=1.5,1.5>e.position.distanceTo(r))return e0(e.id,t.id,e.position.clone()),eq(e.id,e.position.clone()),!1}return!0}return eq(e.id),!1})),ej(e=>e.map(e=>!e.available&&e.cooldownStartTime&&Date.now()-e.cooldownStartTime>=7850?{...e,available:!0,cooldownStartTime:null}:e)),eS(e=>e.filter(e=>"boneclaw"===e.type||"blizzard"===e.type||!e.duration||!e.startTime||(Date.now()-e.startTime)/1e3<e.duration))}});let[eW,eH]=(0,s.useState)(0),eU=(0,s.useCallback)(e=>{if(!M.current)return;let t=Date.now();if(t-eW<500)return;eH(t);let r=M.current.position.clone();r.y+=1;let n=new o.Pq0(0,0,1);n.applyQuaternion(M.current.quaternion);let s=r.clone();ef(t=>[...t,{id:Date.now(),position:s.clone(),direction:n.clone(),power:e,startTime:Date.now(),maxDistance:40,startPosition:s.clone()}]),T(!1),ec(0),ed.current=null,x(h,"e")},[h,M,ef,x,eW]),{startFirebeam:eN,stopFirebeam:eQ}=es({parentRef:M,onHit:l,enemyData:g,setActiveEffects:eS,charges:eg,setCharges:ej,setDamageNumbers:J,nextDamageNumberId:ee}),eY=(0,s.useRef)(null),eZ=(0,s.useCallback)(e=>{j&&j(e)},[j]),eV=(0,s.useRef)(null),{activateOathstrike:eK}=eu({parentRef:M,onHit:l,charges:eg,setCharges:ej,enemyData:g,onHealthChange:eZ,setDamageNumbers:J,nextDamageNumberId:ee,currentHealth:d,maxHealth:u});!function(e){let{keys:t,groupRef:r,currentWeapon:n,abilities:a,isSwinging:l,isSmiting:c,isBowCharging:h,bowChargeProgress:d,nextSmiteId:u,setIsSwinging:m,setIsSmiting:p,setIsBowCharging:x,setBowChargeStartTime:f,setSmiteEffects:g,setActiveEffects:j,onAbilityUse:y,shootFireball:M,releaseBowShot:v,startFirebeam:P,stopFirebeam:w,castReanimate:S,health:I,maxHealth:b,onHealthChange:C,activateOathstrike:F,setIsOathstriking:E,orbShieldRef:R}=e,k=(0,s.useRef)(0),G=(0,s.useRef)(!1),T=(0,s.useRef)(0),D=(0,s.useCallback)(()=>{let e=Date.now();e-T.current<250||!(a[n].q.currentCooldown<=0)||l||(T.current=e,k.current=e,m(!0),y(n,"q"))},[a,n,l,y,m]);(0,s.useEffect)(()=>{I<=0?G.current=!0:G.current=!1},[I]),(0,s.useEffect)(()=>{let e=e=>{if(G.current)return;let s=e.key.toLowerCase();if(!(s in t.current)||!t.current[s]){if(s in t.current&&(t.current[s]=!0),"q"===s&&D(),"e"===s&&a[n].e.currentCooldown<=0){if(n!==i.SWORD||c)(n===i.SABRES2||n===i.STAFF)&&P&&w?(P(),y(n,"e")):n!==i.SABRES||h?n===i.SCYTHE&&(M(),y(n,"e")):(x(!0),f(Date.now()));else{if(Date.now()-k.current<625){console.log("Cannot use Smite so soon after a normal attack");return}p(!0),m(!0);let e=r.current.position.clone();e.add(new o.Pq0(0,0,3.5).applyQuaternion(r.current.quaternion)),g(t=>[...t,{id:u.current++,position:e}]),y(n,"e")}}if("1"===s&&a[n].passive.isUnlocked&&(n===i.SCYTHE?S():n===i.SABRES&&P&&w&&(P(),y(n,"passive"))),"2"===s){let e=a[n].active;if(e.isUnlocked&&e.currentCooldown<=0&&n===i.SCYTHE){let e=Date.now();console.log("Creating new summon with ID:",e),j(t=>t.some(e=>"summon"===e.type)?t:[...t.filter(e=>"summon"!==e.type),{id:e,type:"summon",position:r.current.position.clone(),direction:new o.Pq0(0,0,1).applyQuaternion(r.current.quaternion),onComplete:()=>{console.log("Summon completed, ID:",e),y(n,"active"),j(t=>t.filter(t=>t.id!==e&&("summonExplosion"!==t.type||t.summonId!==e)))},onStartCooldown:()=>{console.log("Starting cooldown for summon:",e)}}])}}if("r"===s){let e=a[n].r;if(e.isUnlocked&&e.currentCooldown<=0)switch(n){case i.SWORD:let t=F();t&&(E(!0),j(e=>[...e,{id:Math.random(),type:"oathstrike",position:t.position,direction:t.direction}]),y(n,"r"));break;case i.SABRES:case i.SABRES2:j(e=>[...e,{id:Math.random(),type:"blizzard",position:r.current.position.clone(),direction:new o.Pq0(0,0,0)}]),y(n,"r");break;case i.SCYTHE:j(e=>[...e,{id:Math.random(),type:"boneclaw",position:r.current.position.clone(),direction:new o.Pq0(0,0,1).applyQuaternion(r.current.quaternion)}]),y(n,"r")}}}},s=e=>{if(G.current)return;let r=e.key.toLowerCase();r in t.current&&(t.current[r]=!1),"e"===r&&h&&v(d)};return window.addEventListener("keydown",e),window.addEventListener("keyup",s),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",s)}},[t,D,r,n,a,l,c,h,d,m,p,x,g,j,y,M,v,u,f,P,w,S,I,b,C,E,F,R]),(0,s.useEffect)(()=>{let e=e=>{G.current||0!==e.button||(t.current.mouse0=!0)},r=e=>{G.current||0!==e.button||(t.current.mouse0=!1)};return window.addEventListener("mousedown",e),window.addEventListener("mouseup",r),()=>{window.removeEventListener("mousedown",e),window.removeEventListener("mouseup",r)}},[t]),(0,s.useEffect)(()=>{let e=setInterval(()=>{!G.current&&t.current&&t.current.mouse0&&D()},50);return()=>clearInterval(e)},[D,t,a,n,l,y]),(0,s.useEffect)(()=>{let e=()=>{G.current=!0},t=()=>{G.current=!1};return window.addEventListener("gameOver",e),window.addEventListener("gameReset",t),()=>{window.removeEventListener("gameOver",e),window.removeEventListener("gameReset",t)}},[])}({keys:A,groupRef:M,currentWeapon:h,abilities:p,isSwinging:v,isSmiting:O,isBowCharging:k,bowChargeProgress:ea,nextSmiteId:K,setIsSwinging:P,setIsSmiting:N,setIsBowCharging:T,setBowChargeStartTime:e=>{ed.current=e},setSmiteEffects:V,setActiveEffects:eS,onAbilityUse:x,shootFireball:ez,releaseBowShot:eU,startFirebeam:eN,stopFirebeam:eQ,castReanimate:()=>{var e;null===(e=eY.current)||void 0===e||e.castReanimate()},reanimateRef:eY,health:d,maxHealth:u,onHealthChange:j,activateOathstrike:eK,setIsOathstriking:eE,orbShieldRef:eV});let eX=e=>{V(t=>t.filter(t=>t.id!==e))},e$=e=>{J(t=>t.filter(t=>t.id!==e))};(0,s.useEffect)(()=>{h===i.SABRES&&eo({})},[h]);let eJ=(e,t,r,n)=>{if(!t.startsWith("enemy"))return;let s=g.find(e=>e.id===t);if(!s)return;let i="".concat(e,"_").concat(t);if(er[i])return;let a=new o.Pq0(n.x,0,n.z),c=new o.Pq0(s.position.x,0,s.position.z);if(a.distanceTo(c)>1.4)return;eo(e=>({...e,[i]:1}));let h=Math.floor(11+r*r*40)+(r>=.99?67:0);l(t,h),s.health-h>0&&J(e=>[...e,{id:ee.current++,damage:h,position:s.position.clone(),isCritical:r>=.99}])},e0=(e,t,r)=>{if(!t.startsWith("enemy"))return;let n=g.find(e=>e.id===t);if(!n)return;let{damage:s,isCritical:i}=Z(53);l(t,s),n.health-s>0&&J(e=>[...e,{id:ee.current++,damage:s,position:n.position.clone(),isCritical:i,isFireball:!0}]),r&&eS(e=>[...e,{id:Date.now(),type:"fireballExplosion",position:r,direction:new o.Pq0,duration:.2,startTime:Date.now()}]),eq(e)};return(0,I.F)(()=>{M.current&&f(M.current.position.clone())}),(0,s.useEffect)(()=>{let e=ev.current;return()=>{e.clear()}},[]),(0,I.F)(()=>{ef(e=>e.filter(e=>e.position.distanceTo(e.startPosition)<e.maxDistance))}),(0,s.useEffect)(()=>{let e=setInterval(()=>{eS(e=>e.filter(e=>"unitFireballExplosion"!==e.type||!!e.startTime&&Date.now()-e.startTime<1e3*e.duration))},100);return()=>{clearInterval(e),eS(e=>e.filter(e=>"unitFireballExplosion"!==e.type))}},[]),(0,s.useEffect)(()=>()=>{eS(e=>e.filter(e=>"fireballExplosion"!==e.type))},[]),(0,s.useEffect)(()=>{y&&(y.current={shootFireball:ez,cleanup:()=>{S([]),eS([]),ev.current.clear(),ej(e=>e.map(e=>({...e,available:!0,cooldownStartTime:null})))}})},[y,ez]),(0,s.useEffect)(()=>()=>{S([]),ej(e=>e.map(e=>({...e,available:!0,cooldownStartTime:null})))},[]),(0,s.useEffect)(()=>()=>{eS(e=>e.filter(e=>"boneclaw"===e.type||"blizzard"===e.type))},[]),(0,s.useEffect)(()=>{let e=Date.now();eS(t=>t.filter(t=>!t.startTime||!t.duration||e-t.startTime<t.duration))},[]),(0,s.useEffect)(()=>{let e=setInterval(()=>{eS(e=>e.filter(e=>"fireballExplosion"!==e.type||(e.startTime?(Date.now()-e.startTime)/1e3:0)<(e.duration||.2)))},100);return()=>clearInterval(e)},[eS]),(0,s.useEffect)(()=>{let e=setInterval(()=>{eS(e=>e.filter(e=>"frostExplosion"!==e.type||(e.startTime?(Date.now()-e.startTime)/1e3:0)<(e.duration||.2)))},100);return()=>clearInterval(e)},[eS]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("group",{ref:M,position:[0,1,0],children:[(0,n.jsx)("group",{scale:[.335,.335,.335],position:[-.05,.215,.35],rotation:[.15,0,-5],children:(0,n.jsx)(eF,{isLeft:!0})}),(0,n.jsx)("group",{scale:[.335,.335,.335],position:[.05,.215,.35],rotation:[.15,0,5],children:(0,n.jsx)(eF,{isLeft:!1})}),(0,n.jsxs)("mesh",{scale:1.085,children:[(0,n.jsx)("sphereGeometry",{args:[.415,32,32]}),(0,n.jsx)("meshBasicMaterial",{color:"#ffffff",transparent:!0,opacity:.125,depthWrite:!1})]}),(0,n.jsxs)("group",{position:[0,.2,-.2],children:[(0,n.jsx)("group",{rotation:[0,Math.PI/5.5,0],children:(0,n.jsx)(L,{collectedBones:ey,isLeftWing:!0,parentRef:M})}),(0,n.jsx)("group",{rotation:[0,-Math.PI/5.5,0],children:(0,n.jsx)(L,{collectedBones:ey,isLeftWing:!1,parentRef:M})})]}),(0,n.jsx)(en,{parentRef:M,charges:eg,weaponType:h}),(0,n.jsx)("group",{scale:[.8,.55,.8],position:[0,.04,-.015],rotation:[.4,0,0],children:(0,n.jsx)(H,{})}),(0,n.jsx)("group",{scale:[.85,.85,.85],position:[0,.05,.1],children:(0,n.jsx)(U,{movementDirection:e_})}),h===i.SABRES?(0,n.jsx)(G,{isSwinging:v,onSwingComplete:eO,onLeftSwingStart:()=>{},onRightSwingStart:()=>{},isBowCharging:k,hasActiveAbility:p[i.SABRES].active.isUnlocked}):h===i.SCYTHE?(0,n.jsx)(E,{parentRef:M,isSwinging:v,onSwingComplete:eO}):(0,n.jsx)(R,{isSwinging:v,isSmiting:O,isOathstriking:eI,onSwingComplete:eO,onSmiteComplete:()=>{N(!1),P(!1),eo({})},onOathstrikeComplete:()=>{eE(!1),P(!1),eo({})},hasChainLightning:p[i.SWORD].active.isUnlocked}),!m&&(0,n.jsxs)(q,{position:[0,2,0],lockX:!1,lockY:!1,lockZ:!1,children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("planeGeometry",{args:[1,.1]}),(0,n.jsx)("meshBasicMaterial",{color:"#333333"})]}),(0,n.jsx)("mesh",{position:[.5+d/u*.5,0,.001],children:(0,n.jsx)("planeGeometry",{args:[d/u,.08]})})]})]}),(0,n.jsx)(B,{parentRef:M,weaponType:h}),w.map(e=>(0,n.jsx)(F,{position:e.position,direction:e.direction,onImpact:t=>eq(e.id,t)},e.id)),Q.map(e=>(0,n.jsx)(_,{weaponType:h,position:e.position,onComplete:()=>eX(e.id)},e.id)),X.map(e=>(0,n.jsx)(z,{damage:e.damage,position:e.position,isCritical:e.isCritical,isLightning:e.isLightning,isHealing:e.isHealing,isBlizzard:e.isBlizzard,isBoneclaw:e.isBoneclaw,isOathstrike:e.isOathstrike,isFirebeam:e.isFirebeam,isOrbShield:e.isOrbShield,isChainLightning:e.isChainLightning,isFireball:e.isFireball,isSummon:e.isSummon,onComplete:()=>e$(e.id)},e.id)),h===i.SABRES&&k&&(0,n.jsx)(D,{position:(null===(t=M.current)||void 0===t?void 0:t.position.clone().add(new o.Pq0(0,.8,0)))||new o.Pq0,direction:new o.Pq0(0,0,1).applyQuaternion((null===(r=M.current)||void 0===r?void 0:r.quaternion)||new o.PTz),chargeProgress:ea,isCharging:k,onRelease:eU}),ep.map(e=>(0,n.jsxs)("group",{children:[(0,n.jsxs)("group",{position:e.position.toArray(),rotation:[0,Math.atan2(e.direction.x,e.direction.z),0],children:[(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.03,.125,2.1,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#00ffff",emissive:"#00ffff",emissiveIntensity:1,transparent:!0,opacity:1})]}),[void 0,void 0,void 0,void 0,void 0].map((e,t)=>(0,n.jsxs)("mesh",{position:[0,0,-(.45*t)+.5],rotation:[Math.PI,0,.003*Date.now()+t*Math.PI/3],children:[(0,n.jsx)("torusGeometry",{args:[.125+.04*t,.05,8,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#00ffff",emissive:"#00ffff",emissiveIntensity:3,transparent:!0,opacity:.9-.125*t,blending:o.EZo})]},"ring-".concat(t))),(0,n.jsx)("pointLight",{color:"#00ffff",intensity:3,distance:4,decay:2}),(0,n.jsx)("pointLight",{color:"#80ffff",intensity:1.7,distance:6,decay:1})]}),e.power>=1&&e.position.distanceTo(e.startPosition)<e.maxDistance&&!e.hasCollided&&(0,n.jsxs)("group",{position:e.position.toArray(),rotation:[0,Math.atan2(e.direction.x,e.direction.z),0],children:[(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.15,.35,2,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#EAC4D5",emissive:"#EAC4D5",emissiveIntensity:1.5,transparent:!0,opacity:.7})]}),[...Array(8)].map((e,t)=>{let r=t/8*Math.PI*2;return(0,n.jsx)("group",{position:[.4*Math.sin(r+.003*Date.now()),.4*Math.cos(r+.003*Date.now()),-1.4],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.125,4,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#00ffff",emissive:"#00ffff",emissiveIntensity:1,transparent:!0,opacity:.5,blending:o.EZo})]})},"ghost-trail-".concat(t))}),[...Array(8)].map((e,t)=>{let r=t/8*Math.PI*2;return(0,n.jsx)("group",{position:[.4*Math.sin(r+.003*Date.now()),.4*Math.cos(r+.003*Date.now()),-2],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.125,4,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#00ffff",emissive:"#00ffff",emissiveIntensity:1,transparent:!0,opacity:.4,blending:o.EZo})]})},"ghost-trail-".concat(t))}),[...Array(12)].map((e,t)=>(0,n.jsx)("group",{position:[0,0,-(.3*t)-1.5],rotation:[0,.001*Date.now()+t,0],children:(0,n.jsxs)("mesh",{scale:1-.015*t,children:[(0,n.jsx)("torusGeometry",{args:[.4,.1,3,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#00ffff",emissive:"#00ffff",emissiveIntensity:1,transparent:!0,opacity:.3,blending:o.EZo})]})},"wisp-".concat(t))),(0,n.jsx)("pointLight",{color:"#EAC4D5",intensity:3,distance:4,decay:2}),(0,n.jsx)("pointLight",{color:"#ffffff",intensity:1,distance:6,decay:1})]})]},e.id)),(0,n.jsx)(Y,{parentRef:M,weaponType:h}),(0,n.jsx)(W,{parentRef:M}),eP.map(e=>"boneclaw"===e.type?(0,n.jsx)($,{position:e.position,direction:e.direction,parentRef:M,enemyData:g,onComplete:()=>{eS(t=>t.filter(t=>t.id!==e.id))},onHitTarget:(e,t,r,n,s)=>{l(e,t),J(e=>[...e,{id:ee.current++,damage:t,position:n.clone(),isCritical:r,isBoneclaw:s}])}},e.id):"blizzard"===e.type?(0,n.jsx)(et,{position:e.position,enemyData:g,parentRef:M,onHitTarget:(e,t,r,n,s)=>{l(e,t),J(e=>[...e,{id:ee.current++,damage:t,position:n.clone(),isCritical:r,isBlizzard:s}])},onComplete:()=>{eS(t=>t.filter(t=>t.id!==e.id))}},e.id):"firebeam"===e.type?(0,n.jsx)(ei,{position:e.position,direction:e.direction,onComplete:()=>{eS(t=>t.filter(t=>t.id!==e.id))}},e.id):"oathstrike"===e.type?(0,n.jsx)(eh,{position:e.position,direction:e.direction,onComplete:()=>{eS(t=>t.filter(t=>t.id!==e.id))},parentRef:M},e.id):"summon"===e.type?(0,n.jsx)(eM,{position:e.position,enemyData:g,onDamage:(e,t,r)=>{l(e,t);let n=g.find(t=>t.id===e);n&&n.position&&J(e=>[...e,{id:ee.current++,damage:t,position:r||n.position.clone(),isCritical:!1,isSummon:!0}])},id:e.id.toString(),onComplete:()=>{eS(t=>t.filter(t=>t.id!==e.id))},onStartCooldown:()=>{x(h,"active")},setActiveEffects:eS,activeEffects:eP,setDamageNumbers:J,nextDamageNumberId:ee},e.id):"frostExplosion"===e.type?(0,n.jsx)(eC,{position:e.position,onComplete:()=>{eS(t=>t.filter(t=>t.id!==e.id))}},e.id):null),(0,n.jsx)(el,{ref:eY,parentRef:M,onHealthChange:eZ,charges:eg,setCharges:ej,setDamageNumbers:J,nextDamageNumberId:ee,currentHealth:d,maxHealth:u}),h===i.SWORD&&p[i.SWORD].passive.isUnlocked&&(0,n.jsx)(ex,{ref:eG,parentRef:M,onHealthChange:eZ,setDamageNumbers:J,nextDamageNumberId:ee,currentHealth:d,maxHealth:u}),eP.map(e=>{if("unitFireballExplosion"===e.type){let t=e.startTime?(Date.now()-e.startTime)/1e3:0,r=Math.max(0,1-t/(e.duration||.2));return(0,n.jsxs)("group",{position:e.position,children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.3*(1+2*t),32,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#00ff44",emissive:"#33ff66",emissiveIntensity:2*r,transparent:!0,opacity:.8*r,depthWrite:!1,blending:o.EZo})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.2*(1+3*t),24,24]}),(0,n.jsx)("meshStandardMaterial",{color:"#66ff88",emissive:"#ffffff",emissiveIntensity:3*r,transparent:!0,opacity:.9*r,depthWrite:!1,blending:o.EZo})]}),[.4,.6,.8,1].map((e,s)=>(0,n.jsxs)("mesh",{rotation:[Math.random()*Math.PI,Math.random()*Math.PI,Math.random()*Math.PI],children:[(0,n.jsx)("torusGeometry",{args:[e*(1+3*t),.045,16,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#00ff44",emissive:"#33ff66",emissiveIntensity:.8*r,transparent:!0,opacity:.5*r*(1-.2*s),depthWrite:!1,blending:o.EZo})]},s)),[...Array(8)].map((e,s)=>{let i=s/8*Math.PI*2,a=.5*(1+2*t);return(0,n.jsxs)("mesh",{position:[Math.sin(i)*a,Math.cos(i)*a,0],children:[(0,n.jsx)("sphereGeometry",{args:[.05,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#66ff88",emissive:"#ffffff",emissiveIntensity:2*r,transparent:!0,opacity:.8*r,depthWrite:!1,blending:o.EZo})]},"spark-".concat(s))}),(0,n.jsx)("pointLight",{color:"#00ff44",intensity:2*r,distance:4,decay:2}),(0,n.jsx)("pointLight",{color:"#66ff88",intensity:1*r,distance:6,decay:1})]},e.id)}return null}),k&&(0,n.jsxs)("group",{position:M.current?(()=>{let e=new o.Pq0(0,0,1).applyQuaternion(M.current.quaternion).multiplyScalar(2);return[M.current.position.x+e.x,.01,M.current.position.z+e.z]})():[0,.015,0],ref:e=>{e&&(null==M?void 0:M.current)&&(e.rotation.y=M.current.rotation.y)},children:[(0,n.jsxs)("mesh",{rotation:[-Math.PI/2,0,0],position:[0,.15,15*eT-4.5],children:[(0,n.jsx)("planeGeometry",{args:[.4,30*eT-4]}),(0,n.jsx)("meshStandardMaterial",{color:"#00ffff",emissive:"#00ffff",emissiveIntensity:1,transparent:!0,opacity:.3+.4*eT,blending:o.EZo,depthWrite:!1})]}),[-.4,.4].map((e,t)=>(0,n.jsxs)("mesh",{position:[e,.1,7.5*eT+3.5],rotation:[-Math.PI/2,0,0],children:[(0,n.jsx)("planeGeometry",{args:[.125,15*eT+10]}),(0,n.jsx)("meshStandardMaterial",{color:"#80ffff",emissive:"#80ffff",emissiveIntensity:2,transparent:!0,opacity:.6*eT,blending:o.EZo,depthWrite:!1})]},t)),[...Array(10)].map((e,t)=>(0,n.jsxs)("mesh",{position:[0,.1,2.5*t*eT+(3*eT-2)],rotation:[-Math.PI/2,0,0],children:[(0,n.jsx)("planeGeometry",{args:[1,.1]}),(0,n.jsx)("meshStandardMaterial",{color:"#00ffff",emissive:"#00ffff",emissiveIntensity:1.5,transparent:!0,opacity:.4*eT*(1-.07*t),blending:o.EZo,depthWrite:!1})]},t))]}),h===i.SWORD&&p[i.SWORD].active.isUnlocked&&(0,n.jsx)(ew,{ref:eA,parentRef:M,enemies:g,onEnemyDamage:l,setDamageNumbers:J,nextDamageNumberId:ee}),h===i.SABRES&&p[i.SABRES].active.isUnlocked&&(0,n.jsx)(eb,{ref:eV,parentRef:M,charges:eg,setCharges:ej})]})}var eR=r(2433);function ek(){let e=(e,t)=>(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[t,.8*t,e,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),t=e=>(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[e,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),r=(r,s)=>(0,n.jsxs)("group",{children:[(0,n.jsx)("group",{position:[s/2,0,0],children:e(r,.04)}),(0,n.jsx)("group",{position:[-s/2,0,0],children:e(r,.04)}),(0,n.jsx)("group",{position:[0,r/2,0],children:t(.06)}),(0,n.jsx)("group",{position:[0,-r/2,0],children:t(.06)})]});return(0,n.jsx)("group",{children:(0,n.jsxs)("group",{children:[r(.65,.05),(0,n.jsxs)("group",{position:[0,-.35,0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.08,12,12]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("group",{position:[0,-.15,0],children:[r(.7,.06),(0,n.jsxs)("group",{position:[0,-.25,0],rotation:[Math.PI/2,0,0],children:[t(.06),(0,n.jsxs)("group",{position:[0,-.015,.1],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("boxGeometry",{args:[.15,.02,.4]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),[-.05,0,.05].map((e,t)=>(0,n.jsx)("group",{position:[e,.15,.25],rotation:[-Math.PI,0,0],children:(0,n.jsxs)("group",{children:[r(.15,.02),(0,n.jsx)("group",{position:[0,-.1,0],rotation:[Math.PI/6,0,0],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("coneGeometry",{args:[.02,.15,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#d4d4d4",roughness:.3,metalness:.4})]})})]})},t))]})]})]})]})]})})}function eG(e){let{isLeftHand:t=!1}=e,r=(e,t)=>(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[t,.8*t,e,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),s=e=>(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[e,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),o=(e,t)=>(0,n.jsxs)("group",{children:[(0,n.jsx)("group",{position:[t/2,0,0],children:r(e,.06)}),(0,n.jsx)("group",{position:[-t/2,0,0],children:r(e,.06)}),(0,n.jsx)("group",{position:[0,e/2,0],children:s(.08)}),(0,n.jsx)("group",{position:[0,-e/2,0],children:s(.08)})]});return(0,n.jsx)("group",{children:(0,n.jsxs)("group",{children:[o(1.3,.15),(0,n.jsxs)("group",{position:[.25,-.85,.21],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.12,12,12]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("group",{rotation:[-.7,-0,Math.PI/5],children:[o(.8,.12),(0,n.jsxs)("group",{position:[0,-.5,0],rotation:[0,0,Math.PI/5.5],children:[s(.09),(0,n.jsxs)("group",{position:[0,-.1,0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("boxGeometry",{args:[.2,.15,.08]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4})]}),[-.08,-.04,0,.04,.08].map((e,t)=>(0,n.jsxs)("group",{position:[e,-.1,0],rotation:[0,0,(t-2)*Math.PI/10],children:[r(.5,.02),(0,n.jsx)("group",{position:[.025,-.3,0],rotation:[0,0,Math.PI+Math.PI/16],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("coneGeometry",{args:[.03,.3,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#d4d4d4",roughness:.3,metalness:.4})]})})]},t)),!t&&(0,n.jsx)("group",{position:[0,-.2,.3],rotation:[Math.PI/2,0,0],scale:[.8,.8,.8],children:(0,n.jsx)(eT,{})})]})]})]})]})]})})}function eT(){let e={color:"#FF4C4C",emissive:"#4ECB7E",emissiveIntensity:.5,roughness:.4,metalness:.6};return(0,n.jsxs)("group",{rotation:[0,-1.05,-Math.PI/2.5],position:[.3,-.1,.75],scale:[.9,.9,1.2],children:[(0,n.jsxs)("mesh",{position:[0,0,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.125,.125,3.35,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#8b0000",roughness:.4,metalness:.3})]}),(0,n.jsxs)("mesh",{position:[0,-.25,0],rotation:[Math.PI/2,-Math.PI/2,Math.PI/2],children:[(0,n.jsx)("cylinderGeometry",{args:[.3,.3,.125]}),(0,n.jsx)("meshStandardMaterial",{color:"#4ECB7E",roughness:.4,metalness:.5})]}),(0,n.jsxs)("mesh",{position:[0,1,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.325,.125,2.9,4]}),(0,n.jsx)("meshStandardMaterial",{...e})]}),(0,n.jsxs)("mesh",{position:[0,3.45,0],children:[(0,n.jsx)("coneGeometry",{args:[.325,2,4]}),(0,n.jsx)("meshStandardMaterial",{...e})]}),(0,n.jsx)("pointLight",{color:"#FF4D00",intensity:.5,distance:2,decay:2})]})}function eD(){return(0,n.jsx)("group",{children:(0,n.jsxs)("group",{children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.123,.19,.175,6,1,!1,0,2*Math.PI]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),[0,1,2,3,4,5].map(e=>(0,n.jsxs)("group",{rotation:[0,e*Math.PI/3,0],children:[(0,n.jsxs)("mesh",{position:[.11,0,0],rotation:[0,Math.PI/6,0],children:[(0,n.jsx)("boxGeometry",{args:[.12,.19,.02]}),(0,n.jsx)("meshStandardMaterial",{color:"#d4d4d4",roughness:.5,metalness:.4})]}),(0,n.jsxs)("mesh",{position:[.07,.05,0],rotation:[0,Math.PI/6,0],children:[(0,n.jsx)("boxGeometry",{args:[.035,.24,.015]}),(0,n.jsx)("meshStandardMaterial",{color:"#c0c0c0",roughness:.3,metalness:.5})]})]},e)),(0,n.jsxs)("mesh",{position:[0,.22,0],rotation:[Math.PI/2,Math.PI,Math.PI/2],children:[(0,n.jsx)("torusGeometry",{args:[.065,.02,3,5]}),(0,n.jsx)("meshStandardMaterial",{color:"#d4d4d4",roughness:.3,metalness:.5})]}),(0,n.jsxs)("mesh",{position:[0,0,0],rotation:[Math.PI/2,Math.PI,Math.PI/2],children:[(0,n.jsx)("torusGeometry",{args:[.16,.02,4,5]}),(0,n.jsx)("meshStandardMaterial",{color:"#d4d4d4",roughness:.3,metalness:.5})]}),(0,n.jsxs)("mesh",{position:[0,-.1,0],rotation:[Math.PI/2,Math.PI,Math.PI/2],children:[(0,n.jsx)("torusGeometry",{args:[.2,.02,4,5]}),(0,n.jsx)("meshStandardMaterial",{color:"#d4d4d4",roughness:.3,metalness:.5})]}),(0,n.jsxs)("mesh",{position:[0,.1,0],rotation:[Math.PI/2,Math.PI,Math.PI/2],children:[(0,n.jsx)("torusGeometry",{args:[.125,.0175,6,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#d4d4d4",roughness:.3,metalness:.5})]})]})})}function e_(e){let{position:t,isAttacking:r,isWalking:o,onHit:i}=e,a=(0,s.useRef)(null),[l,c]=(0,s.useState)(0),[h,d]=(0,s.useState)(0),u=(0,s.useRef)();return(0,I.F)((e,n)=>{if(a.current){if(o){c(e=>(e+4*n)%(2*Math.PI));let e=Math.abs(.1*Math.sin(l));a.current&&(a.current.position.y=t[1]-e),["LeftLeg","RightLeg"].forEach(e=>{var t,r;let n=null===(t=a.current)||void 0===t?void 0:t.getObjectByName(e);if(n){let t=e.includes("Right")?l:l+Math.PI,s=.4*Math.sin(t);n.rotation.x=s;let o=null===(r=n.children[0])||void 0===r?void 0:r.children[1];if(o){let e=Math.max(0,Math.sin(t+Math.PI/4));o.rotation.x=.2+.8*e;let r=.1*Math.sin(t);o.rotation.y=r}let i=.05*Math.sin(t);n.rotation.y=i}}),["LeftArm","RightArm"].forEach(e=>{var t;let r=null===(t=a.current)||void 0===t?void 0:t.getObjectByName(e);if(r){let t=.1*Math.sin(e.includes("Right")?l+Math.PI:l);r.rotation.x=t}})}if(r){d(e=>e+3*n);let e=Math.sin(Math.min(h,Math.PI/2))*Math.PI,t=a.current.getObjectByName("RightArm");t&&(t.rotation.x=-e),h>Math.PI/4&&i&&!u.current&&(u.current=setTimeout(()=>{u.current=void 0},0)),h>Math.PI/2&&d(0)}else u.current&&(clearTimeout(u.current),u.current=void 0)}}),(0,s.useEffect)(()=>()=>{u.current&&clearTimeout(u.current)},[]),(0,n.jsxs)("group",{ref:a,position:[t[0],t[1]+1,t[2]],children:[(0,n.jsx)("group",{name:"Body",position:[0,1.15,0],scale:[.95,.8,.8],rotation:[-.2,0,0],children:(0,n.jsx)(H,{})}),(0,n.jsxs)("group",{name:"Head",position:[0,1.775,.1],scale:[.75,.8,.8],children:[(0,n.jsxs)("group",{children:[(0,n.jsxs)("mesh",{position:[0,0,-.05],children:[(0,n.jsx)("sphereGeometry",{args:[.22,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("mesh",{position:[0,-.02,.12],children:[(0,n.jsx)("boxGeometry",{args:[.28,.28,.1]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("group",{children:[(0,n.jsxs)("mesh",{position:[.12,-.08,.1],children:[(0,n.jsx)("boxGeometry",{args:[.08,.12,.15]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("mesh",{position:[-.12,-.08,.1],children:[(0,n.jsx)("boxGeometry",{args:[.08,.12,.15]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]})]}),(0,n.jsx)("group",{position:[0,-.15,.05],children:(0,n.jsxs)("mesh",{position:[0,-.08,.08],rotation:[0,Math.PI/5,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.08,.08,.2,5]}),(0,n.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]})}),(0,n.jsx)("group",{position:[.025,-.25,.2175],children:[-.03,-.06,-.09,-0,.03].map((e,t)=>(0,n.jsx)("group",{position:[e,0,0],rotation:[.5,0,0],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("coneGeometry",{args:[.03,.075,3]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.3,metalness:.4})]})},t))}),(0,n.jsx)("group",{position:[0,-.18,.2],children:[-.06,-.02,.02,.06].map((e,t)=>(0,n.jsx)("group",{position:[e,0,0],rotation:[2.5,0,0],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("coneGeometry",{args:[.01,.08,3]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.3,metalness:.4})]})},t))})]}),(0,n.jsxs)("group",{position:[0,.05,.14],children:[(0,n.jsxs)("group",{position:[-.07,0,0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.02,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#2FFF00",emissive:"#2FFF00",emissiveIntensity:3})]}),(0,n.jsxs)("mesh",{scale:1.2,children:[(0,n.jsx)("sphereGeometry",{args:[.035,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#2FFF00",emissive:"#2FFF00",emissiveIntensity:1,transparent:!0,opacity:.75})]}),(0,n.jsxs)("mesh",{scale:1.4,children:[(0,n.jsx)("sphereGeometry",{args:[.05,6.5,2]}),(0,n.jsx)("meshStandardMaterial",{color:"#2FFF00",emissive:"#2FFF00",emissiveIntensity:1,transparent:!0,opacity:.7})]}),(0,n.jsx)("pointLight",{color:"#FF4C4C",intensity:.5,distance:1,decay:2})]}),(0,n.jsxs)("group",{position:[.07,0,0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.02,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#2FFF00",emissive:"#2FFF00",emissiveIntensity:3})]}),(0,n.jsxs)("mesh",{scale:1.2,children:[(0,n.jsx)("sphereGeometry",{args:[.035,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#2FFF00",emissive:"#2FFF00",emissiveIntensity:1,transparent:!0,opacity:.75})]}),(0,n.jsxs)("mesh",{scale:1.4,children:[(0,n.jsx)("sphereGeometry",{args:[.05,6.5,2]}),(0,n.jsx)("meshStandardMaterial",{color:"#2FFF00",emissive:"#2FFF00",emissiveIntensity:1,transparent:!0,opacity:.7})]}),(0,n.jsx)("pointLight",{color:"#FF4C4C",intensity:.5,distance:1,decay:1})]})]})]}),(0,n.jsx)("group",{position:[-.34,1.475,0],rotation:[-.35,-Math.PI-.4,-.35],children:(0,n.jsx)(eD,{})}),(0,n.jsx)("group",{position:[.34,1.475,0],rotation:[-.35,Math.PI-.4,.35],children:(0,n.jsx)(eD,{})}),(0,n.jsx)("group",{name:"LeftArm",position:[-.35,1.325,0],scale:[-.45,.45,.45],rotation:[0,Math.PI/3,0],children:(0,n.jsx)(eG,{isLeftHand:!0})}),(0,n.jsx)("group",{name:"RightArm",position:[.35,1.525,.1],scale:[.45,.45,.45],rotation:[0,-Math.PI/2.5,0],children:(0,n.jsx)(eG,{isLeftHand:!1})}),(0,n.jsxs)("group",{position:[0,.7,0],scale:[1.4,1,.8],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.21,.2,.2,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]}),(0,n.jsx)("group",{position:[0,.15,-.16],rotation:[.1,0,0],children:[.15,.27,.39,.51,.63].map((e,t)=>(0,n.jsxs)("mesh",{position:[0,e,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.0225,.0225,.03,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]},t))}),[-1,1].map(e=>(0,n.jsx)("group",{position:[.15*e,-.1,0],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.075,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]})},e))]}),(0,n.jsx)("group",{name:"LeftLeg",position:[.2,.3,0],children:(0,n.jsx)(ek,{})}),(0,n.jsx)("group",{name:"RightLeg",position:[-.2,.3,0],children:(0,n.jsx)(ek,{})}),(0,n.jsx)("group",{position:[0,1.2,0],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.04,.04,.2,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]})})]})}let eA=()=>(0,n.jsx)("group",{children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.03,.025,.3,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#E13F3F",transparent:!0,opacity:.55,emissive:"#F33FAE",emissiveIntensity:.75})]})});function ez(e){let{position:t,onComplete:r,isSpawning:o=!1,scale:i=1}=e,a=(0,s.useRef)([]),l=1.15*i,c=2.75*i,h=(0,s.useRef)(null),d=(0,s.useRef)(Date.now());return(0,I.F)(()=>{if(!h.current)return;let e=Date.now()-d.current,n=Math.min(e/1500,1),s=o?1-n:n;h.current.position.copy(t),a.current.forEach((t,r)=>{let n=Math.floor(r/10)/15,o=l*n*(s<.5?2*s:2-2*s),i=r%10/10*Math.PI*2+.006*(1+3*n)*e,a=Math.cos(i+2*n)*o,h=Math.sin(i+2*n)*o,d=(1-n)*c*(1+.1*Math.sin(.002*e));t.position.set(a,d,h),t.rotation.y=i+Math.PI/2,t.rotation.z=Math.PI/2+.8*n,t.rotation.x=.2*Math.sin(.004*e+r);let u=t.material;u.opacity=Math.max(0,.7-.4*n-(s>.7?(s-.7)*3:0)),u.emissiveIntensity=.5+.3*Math.sin(.004*e+r);let m=1+.2*Math.sin(.003*e+.5*r);t.scale.set(m,m,m)}),1===n&&r&&r()}),(0,n.jsx)("group",{ref:h,children:Array.from({length:160}).map((e,t)=>(0,n.jsx)("mesh",{ref:e=>{e&&(a.current[t]=e)},children:eA()},t))})}let eq=e=>{switch(e){case i.SCYTHE:return"#00FF4D";case i.SWORD:return"#FFC200";case i.SABRES:case i.SABRES2:return"#00BBFF";default:return"#00ff44"}},eB=e=>{let t=eq(e);return(0,n.jsx)("group",{children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.03,.025,.3,8]}),(0,n.jsx)("meshStandardMaterial",{color:t,transparent:!0,opacity:.525,emissive:t,emissiveIntensity:.75})]})})};function eL(e){let{position:t,onComplete:r,isSpawning:o=!1,weaponType:i}=e,a=(0,s.useRef)([]),l=(0,s.useRef)(null),c=(0,s.useRef)(Date.now());return(0,I.F)(()=>{if(!l.current)return;let e=Date.now()-c.current,n=Math.min(e/1500,1),s=o?1-n:n;l.current.position.set(t.x,0,t.z),a.current.forEach((t,r)=>{let n=Math.floor(r/10)/15,o=1.15*n*(s<.5?2*s:2-2*s),i=r%10/10*Math.PI*2+.006*(1+3*n)*e,a=Math.cos(i+2*n)*o,l=Math.sin(i+2*n)*o,c=(1-n)*2.75*(1+.1*Math.sin(.002*e));t.position.set(a,c,l),t.rotation.y=i+Math.PI/2,t.rotation.z=Math.PI/2+.8*n,t.rotation.x=.2*Math.sin(.004*e+r);let h=t.material;h.opacity=Math.max(0,.7-.4*n-(s>.7?(s-.7)*3:0)),h.emissiveIntensity=.5+.3*Math.sin(.004*e+r);let d=1+.2*Math.sin(.003*e+.5*r);t.scale.set(d,d,d)}),1===n&&r&&r()}),(0,n.jsx)("group",{ref:l,children:Array.from({length:160}).map((e,t)=>(0,n.jsx)("mesh",{ref:e=>{e&&(a.current[t]=e)},children:eB(i)},t))})}let eO=s.memo(function(e){let{id:t,initialPosition:r,position:a,health:l,maxHealth:c,onTakeDamage:h,onPositionUpdate:d,playerPosition:u,onAttackPlayer:m,weaponType:p}=e,x=(0,s.useRef)(null),f=(0,s.useRef)(Date.now()+2e3),[g,j]=(0,s.useState)(!1),[y,M]=(0,s.useState)(!1),[v,P]=(0,s.useState)(!1),[w,S]=(0,s.useState)(!0),[b,C]=(0,s.useState)(!1),[F,E]=(0,s.useState)(!1),R=(0,s.useRef)(r.clone().setY(0)),k=(0,s.useRef)(r.clone().setY(0)),G=(0,s.useRef)(Date.now()),T=(0,s.useRef)(l);(0,s.useEffect)(()=>{T.current=l},[l]);let D=(0,s.useCallback)((e,r)=>{if(T.current<=0)return;let n=Math.max(0,T.current-e);h("enemy-".concat(t),e),0===n&&T.current>0&&(P(!0),M(!0)),r.type===i.SABRES&&r.hasActiveAbility&&E(!0)},[t,h]);return(0,s.useEffect)(()=>{a&&(R.current.copy(a),R.current.y=0,k.current.copy(R.current),x.current&&x.current.position.copy(R.current))},[a]),(0,I.F)((e,r)=>{if(!x.current||T.current<=0||!u){C(!1);return}let n=R.current.distanceTo(u);if(n>2.35&&T.current>0){var s;j(!1),C(!0);let e=new o.Pq0().subVectors(u,R.current).normalize(),n=(null===(s=x.current.parent)||void 0===s?void 0:s.children.filter(e=>e!==x.current&&e.position&&1.25>e.position.distanceTo(R.current)))||[],i=new o.Pq0;n.forEach(e=>{let t=R.current.clone().setY(0),r=e.position.clone().setY(0),n=new o.Pq0().subVectors(t,r).normalize().multiplyScalar(.155/Math.max(.1,r.distanceTo(t)));i.add(n)});let l=e.add(i).normalize();l.y=0;let c=l.multiplyScalar(.1925*r*60);k.current.copy(R.current).add(c),k.current.y=0,R.current.lerp(k.current,.1925),R.current.y=0,x.current.position.copy(R.current);let h=new o.Pq0().copy(u).setY(R.current.y);x.current.lookAt(h);let m=Date.now();m-G.current>=50&&R.current.distanceTo(a)>.1&&(d(t,R.current.clone()),G.current=m)}else C(!1),k.current.copy(R.current);if(n<=2.35&&T.current>0){let e=Date.now();if(e-f.current>=2250){j(!0);let t=R.current.clone();setTimeout(()=>{let e=R.current.distanceTo(u);T.current>0&&e<=2.35&&.75>t.distanceTo(R.current)&&m(8)},865),f.current=e,setTimeout(()=>{j(!1)},500)}}}),(0,s.useEffect)(()=>{0===l&&!v&&(P(!0),M(!0),x.current&&(x.current.visible=!0))},[l,v]),(0,s.useEffect)(()=>{if(v){let e=setTimeout(()=>{var e;M(!1),(null===(e=x.current)||void 0===e?void 0:e.parent)&&x.current.parent.remove(x.current)},3e3);return()=>clearTimeout(e)}},[v]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("group",{ref:x,visible:!w&&T.current>0,position:R.current,onClick:e=>{e.stopPropagation()},children:[(0,n.jsx)(e_,{position:[0,.795,0],isAttacking:g,isWalking:b&&T.current>0,onHit:e=>D(e,{type:p})}),(0,n.jsx)(eR.Q,{position:[0,3.5,0],follow:!0,lockX:!1,lockY:!1,lockZ:!1,children:T.current>0&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("mesh",{position:[0,0,0],children:[(0,n.jsx)("planeGeometry",{args:[2,.25]}),(0,n.jsx)("meshBasicMaterial",{color:"#333333",opacity:.8,transparent:!0})]}),(0,n.jsxs)("mesh",{position:[-1+T.current/c,0,.001],children:[(0,n.jsx)("planeGeometry",{args:[T.current/c*2,.23]}),(0,n.jsx)("meshBasicMaterial",{color:"#ff3333",opacity:.9,transparent:!0})]}),(0,n.jsx)(A.E,{position:[0,0,.002],fontSize:.2,color:"#ffffff",anchorX:"center",anchorY:"middle",fontWeight:"bold",children:"".concat(Math.ceil(T.current),"/").concat(c)})]})})]}),w&&(0,n.jsx)(ez,{position:R.current,onComplete:()=>{S(!1)},isSpawning:!0}),y&&(0,n.jsx)(eL,{position:R.current,onComplete:()=>{M(!1)},isSpawning:!1,weaponType:p}),F&&(0,n.jsx)(eC,{position:a,onComplete:()=>E(!1)})]})},(e,t)=>e.health===t.health&&e.position.equals(t.position)&&e.playerPosition.equals(t.playerPosition)),eW=()=>{let e=(0,I.H)(o.Tap,"/textures/ring-alpha.jpg"),t=(0,s.useRef)(null);return(0,s.useEffect)(()=>{let e=setInterval(()=>{t.current&&(t.current.rotation.z+=1e-4)},16);return()=>clearInterval(e)},[]),(0,n.jsxs)("group",{position:[100,80,-150],scale:[28,28,28],rotation:[1,.1,.1],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[1,32,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#B8E0D2",roughness:.7,metalness:.2,emissive:"#B8E0D2",emissiveIntensity:.675})]}),(0,n.jsxs)("mesh",{ref:t,rotation:[Math.PI/2.8,0,0],children:[(0,n.jsx)("ringGeometry",{args:[1.4,2.1,64]}),(0,n.jsx)("meshStandardMaterial",{map:e,color:"#A8DBFF",transparent:!0,opacity:1,side:o.$EB,alphaMap:e,roughness:.7,metalness:.2,emissive:"#77FFC0",emissiveIntensity:1.1})]}),(0,n.jsxs)("mesh",{scale:[1.05,1.05,1.05],children:[(0,n.jsx)("sphereGeometry",{args:[1,32,32]}),(0,n.jsx)("meshBasicMaterial",{color:"#4dff90",transparent:!0,opacity:.5})]}),(0,n.jsxs)("mesh",{scale:[1.1,1.1,1.1],children:[(0,n.jsx)("sphereGeometry",{args:[1,32,32]}),(0,n.jsx)("meshBasicMaterial",{color:"#4dff90",transparent:!0,opacity:.2,side:o.hsX})]})]})},eH={uniforms:{topColor:{value:new o.Q1f("#1500FF")},middleColor:{value:new o.Q1f("#FF79AF")},bottomColor:{value:new o.Q1f("#FFCDA2")},offset:{value:33},exponent:{value:.6}},vertexShader:"\n    varying vec3 vWorldPosition;\n    \n    void main() {\n      vec4 worldPosition = modelMatrix * vec4(position, 1.0);\n      vWorldPosition = worldPosition.xyz;\n      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n    }\n  ",fragmentShader:"\n    uniform vec3 topColor;\n    uniform vec3 middleColor;\n    uniform vec3 bottomColor;\n    uniform float offset;\n    uniform float exponent;\n    \n    varying vec3 vWorldPosition;\n    \n    void main() {\n      float h = normalize(vWorldPosition + vec3(0.0, offset, 0.0)).y;\n      float mixStrength = max(pow(max(h, 0.0), exponent), 0.0);\n      vec3 color = mix(middleColor, topColor, mixStrength);\n      color = mix(bottomColor, color, smoothstep(0.0, 1.0, h));\n      gl_FragColor = vec4(color, 1.0);\n    }\n  "},eU=()=>{let e=(0,s.useMemo)(()=>({uniforms:eH.uniforms,vertexShader:eH.vertexShader,fragmentShader:eH.fragmentShader,side:o.hsX}),[]);return(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[500,32,32]}),(0,n.jsx)("shaderMaterial",{attach:"material",args:[e]})]})},eN=()=>{let e=document.createElement("canvas");e.width=308,e.height=308;let t=e.getContext("2d");if(t){t.clearRect(0,0,308,308);let e=t.createRadialGradient(154,154,0,154,154,154);e.addColorStop(0,"rgba(255, 255, 255, 0.6)"),e.addColorStop(.2,"rgba(255, 255, 255, 0.3)"),e.addColorStop(.5,"rgba(255, 255, 255, 0.1)"),e.addColorStop(.8,"rgba(255, 255, 255, 0.05)"),e.addColorStop(1,"rgba(255, 255, 255, 0)"),t.fillStyle=e,t.beginPath(),t.arc(154,154,154,0,2*Math.PI),t.fill()}let r=new o.gPd(e);return r.needsUpdate=!0,r},eQ=e=>{let{count:t=2e3,radius:r=100}=e,i=(0,s.useMemo)(()=>eN(),[]),a=(0,s.useMemo)(()=>{let e=new Float32Array(3*t),n=new Float32Array(3*t),s=new Float32Array(t);for(let i=0;i<t;i++){let t=2*Math.PI*Math.random(),a=Math.acos(2*Math.random()-1),l=r*Math.cbrt(Math.random());e[3*i]=l*Math.sin(a)*Math.cos(t),e[3*i+1]=l*Math.sin(a)*Math.sin(t),e[3*i+2]=l*Math.cos(a);let c=new o.Q1f;c.setHSL(.33+.02*Math.random(),1,.8+.2*Math.random()),n[3*i]=.3*c.r,n[3*i+1]=1.5*c.g,n[3*i+2]=.3*c.b,s[i]=8*Math.random()+4}return{positions:e,colors:n,sizes:s}},[t,r]),l=s.useRef(null);return(0,I.F)(e=>{let{clock:t}=e;l.current&&(l.current.rotation.y=.05*t.getElapsedTime())}),(0,n.jsxs)("points",{ref:l,children:[(0,n.jsxs)("bufferGeometry",{children:[(0,n.jsx)("bufferAttribute",{attach:"attributes-position",count:t,array:a.positions,itemSize:3}),(0,n.jsx)("bufferAttribute",{attach:"attributes-color",count:t,array:a.colors,itemSize:3}),(0,n.jsx)("bufferAttribute",{attach:"attributes-size",count:t,array:a.sizes,itemSize:1,normalized:!0})]}),(0,n.jsx)("pointsMaterial",{size:1,vertexColors:!0,transparent:!0,opacity:.6,sizeAttenuation:!0,blending:o.EZo,depthWrite:!1,map:i})]})};function eY(e){let{mountainData:t,treeData:r,mushroomData:i,unitProps:{controlsRef:a,...l},onLevelComplete:c,spawnInterval:h=2e3,maxSkeletons:d=13,initialSkeletons:u=4,killCount:m,boneDoodadData:p}=e,[x,g]=(0,s.useState)(()=>Array.from({length:u},(e,t)=>{let r=f();return r.y=0,{id:"skeleton-".concat(t),position:r.clone(),initialPosition:r.clone(),health:196,maxHealth:196,ref:s.createRef()}})),[j,y]=(0,s.useState)(u),[M,w]=(0,s.useState)(l.health),I=(0,s.useRef)(null),[C,F]=(0,s.useState)(new o.Pq0(0,0,0)),E=(0,s.useCallback)((e,t)=>{g(r=>{let n=[...r],s=n.findIndex(t=>t.id===e.replace("enemy-",""));if(-1!==s){let e=Math.max(0,n[s].health-t);if(0===e&&n[s].health>0){var o;n[s]={...n[s],health:e,isDying:!0,deathStartTime:Date.now()},null===(o=l.onEnemyDeath)||void 0===o||o.call(l)}else n[s]={...n[s],health:e}}return n})},[l]),R=(0,s.useCallback)(e=>{var t;null===(t=l.onDamage)||void 0===t||t.call(l,e)},[l]),k=(0,s.useCallback)(e=>{F(e)},[]),G=(0,s.useCallback)((e,t)=>{g(r=>r.map(r=>r.id===e.replace("enemy-","")?{...r,position:t.clone()}:r))},[]),T={onHit:E,controlsRef:a,currentWeapon:l.currentWeapon,onWeaponSelect:l.onWeaponSelect,health:M,maxHealth:l.maxHealth,isPlayer:l.isPlayer,abilities:l.abilities,onAbilityUse:l.onAbilityUse,onPositionUpdate:k,onHealthChange:e=>{if("function"==typeof e)w(t=>{var r;let n=e(t);return null===(r=l.onHealthChange)||void 0===r||r.call(l,n),n});else{var t;w(e),null===(t=l.onHealthChange)||void 0===t||t.call(l,e)}},enemyData:x.map(e=>({id:"enemy-".concat(e.id),position:e.position,initialPosition:e.initialPosition,health:e.health,maxHealth:e.maxHealth})),onDamage:l.onDamage,onEnemyDeath:()=>{console.log("Kill counted in Scene")},onFireballDamage:l.onFireballDamage,fireballManagerRef:l.fireballManagerRef,onSmiteDamage:l.onSmiteDamage},[D,_]=(0,s.useState)(0);(0,s.useEffect)(()=>{if(j>=d)return;let e=setInterval(()=>{m<1&&0===D||m<3&&1===D||m<7&&2===D||g(e=>{let t=d-j;if(t<=0)return e;let r=Math.min(3,t),n=Array.from({length:r},(e,t)=>{let r=f();return{id:"skeleton-".concat(j+t),position:r.clone(),initialPosition:r.clone(),health:225,maxHealth:225,isDying:!1}});return y(e=>e+r),_(e=>e+1),[...e,...n]})},h);return()=>clearInterval(e)},[j,d,h,D,m]),(0,s.useEffect)(()=>{let e=x.every(e=>e.health<=0),t=j>=d;e&&t&&c()},[x,j,d,c]),(0,s.useEffect)(()=>{a.current&&(a.current.object.position.set(0,12,-18),a.current.target.set(0,0,0),a.current.update())},[a]),(0,s.useEffect)(()=>{g(e=>{let t=Date.now();return e.filter(e=>e.isDying&&e.deathStartTime?t-e.deathStartTime<1500:e.health>0)})},[x]),(0,s.useEffect)(()=>{let e=I.current;return()=>{g([]),e&&e.clear(),F(new o.Pq0(0,0,0)),y(u)}},[u]),(0,s.useEffect)(()=>{let e=[],t=[];return()=>{e.forEach(e=>e.dispose()),t.forEach(e=>e.dispose())}},[]);let A=()=>{g(e=>(e.forEach(e=>{var t,r;(null===(r=e.ref)||void 0===r?void 0:null===(t=r.current)||void 0===t?void 0:t.parent)&&(e.ref.current.parent.remove(e.ref.current),e.ref.current.traverse(e=>{if("geometry"in e&&e.geometry instanceof o.LoY&&e.geometry.dispose(),"material"in e){let t=e.material;Array.isArray(t)?t.forEach(e=>e.dispose()):null==t||t.dispose()}}))}),[]))};return(0,s.useEffect)(()=>A,[]),(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("group",{children:[(0,n.jsx)(eQ,{}),(0,n.jsx)(eU,{}),(0,n.jsx)(eW,{}),(0,n.jsx)(v,{color:"#FFAFC5",roughness:.5,metalness:.1,doodadData:p}),t.map((e,t)=>(0,n.jsx)(P,{position:e.position,scale:e.scale},"mountain-".concat(t))),r.map((e,t)=>(0,n.jsx)(S,{position:e.position,scale:e.scale,trunkColor:e.trunkColor,leafColor:e.leafColor},"tree-".concat(t))),i.map((e,t)=>(0,n.jsx)(b,{position:e.position,scale:e.scale,variant:e.variant},"mushroom-".concat(t))),(0,n.jsx)("group",{ref:I,children:(0,n.jsx)(eE,{...T})}),x.map(e=>(0,n.jsx)(eO,{id:e.id,initialPosition:e.initialPosition,position:e.position,health:e.health,maxHealth:e.maxHealth,isDying:e.isDying,onTakeDamage:E,onPositionUpdate:G,playerPosition:C,onAttackPlayer:R,weaponType:l.currentWeapon},e.id))]})})}function eZ(){let e=(e,t)=>(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[t,.8*t,e,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),t=e=>(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[e,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),r=(r,s)=>(0,n.jsxs)("group",{children:[(0,n.jsx)("group",{position:[s/2,0,0],children:e(r,.04)}),(0,n.jsx)("group",{position:[-s/2,0,0],children:e(r,.04)}),(0,n.jsx)("group",{position:[0,r/2,0],children:t(.06)}),(0,n.jsx)("group",{position:[0,-r/2,0],children:t(.06)})]});return(0,n.jsx)("group",{children:(0,n.jsxs)("group",{children:[r(.65,.05),(0,n.jsxs)("group",{position:[0,-.35,0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.08,12,12]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("group",{position:[0,-.15,0],children:[r(.7,.06),(0,n.jsxs)("group",{position:[0,-.25,0],rotation:[Math.PI/2,0,0],children:[t(.06),(0,n.jsxs)("group",{position:[0,-.015,.1],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("boxGeometry",{args:[.15,.02,.4]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),[-.05,0,.05].map((e,t)=>(0,n.jsx)("group",{position:[e,.15,.25],rotation:[-Math.PI,0,0],children:(0,n.jsxs)("group",{children:[r(.15,.02),(0,n.jsx)("group",{position:[0,-.1,0],rotation:[Math.PI/6,0,0],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("coneGeometry",{args:[.02,.15,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#d4d4d4",roughness:.3,metalness:.4})]})})]})},t))]})]})]})]})]})})}function eV(e){let{isLeftHand:t=!1}=e,r=(e,t)=>(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[t,.8*t,e,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),s=e=>(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[e,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),o=(e,t)=>(0,n.jsxs)("group",{children:[(0,n.jsx)("group",{position:[t/2,0,0],children:r(e,.06)}),(0,n.jsx)("group",{position:[-t/2,0,0],children:r(e,.06)}),(0,n.jsx)("group",{position:[0,e/2,0],children:s(.08)}),(0,n.jsx)("group",{position:[0,-e/2,0],children:s(.08)})]});return(0,n.jsx)("group",{children:(0,n.jsxs)("group",{children:[o(1.3,.15),(0,n.jsxs)("group",{position:[.25,-.85,.21],scale:[.8,.8,1.1],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.12,12,12]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("group",{rotation:[-.7,-0,Math.PI/5],children:[o(.8,.12),(0,n.jsxs)("group",{position:[0,-.5,0],rotation:[0,0,Math.PI/5.5],children:[s(.09),(0,n.jsxs)("group",{position:[0,-.1,0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("boxGeometry",{args:[.2,.15,.08]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4})]}),[-.08,-.04,0,.04,.08].map((e,t)=>(0,n.jsxs)("group",{position:[e,-.1,0],rotation:[0,0,(t-2)*Math.PI/10],children:[r(.5,.02),(0,n.jsx)("group",{position:[.025,-.3,0],rotation:[0,0,Math.PI+Math.PI/16],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("coneGeometry",{args:[.03,.3,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#d4d4d4",roughness:.3,metalness:.4})]})})]},t)),!t&&(0,n.jsx)("group",{position:[0,0,.1],rotation:[Math.PI,Math.PI/4,Math.PI/1.65],scale:[2.5,2.5,2.5],children:(0,n.jsx)(eX,{isLeftHand:!0})})]})]})]})]})]})})}function eK(){return(0,n.jsx)("group",{children:(0,n.jsxs)("group",{children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.123,.19,.175,6,1,!1,0,2*Math.PI]}),(0,n.jsx)("meshStandardMaterial",{color:"#97EFFF",roughness:.4,metalness:.3})]}),[0,1,2,3,4,5].map(e=>(0,n.jsxs)("group",{rotation:[0,e*Math.PI/3,0],children:[(0,n.jsxs)("mesh",{position:[.11,0,0],rotation:[0,Math.PI/6,0],children:[(0,n.jsx)("boxGeometry",{args:[.12,.19,.02]}),(0,n.jsx)("meshStandardMaterial",{color:"#97EFFF",roughness:.5,metalness:.4})]}),(0,n.jsxs)("mesh",{position:[.07,.05,0],rotation:[0,Math.PI/6,0],children:[(0,n.jsx)("boxGeometry",{args:[.035,.24,.015]}),(0,n.jsx)("meshStandardMaterial",{color:"#c0c0c0",roughness:.3,metalness:.5})]})]},e)),(0,n.jsxs)("mesh",{position:[0,.22,0],rotation:[0,.25,Math.PI/2],children:[(0,n.jsx)("torusGeometry",{args:[.2,.035,3,5]}),(0,n.jsx)("meshStandardMaterial",{color:"#97EFFF",roughness:.3,metalness:.5})]}),(0,n.jsxs)("mesh",{position:[0,0,0],rotation:[Math.PI/2,Math.PI,Math.PI/2],children:[(0,n.jsx)("torusGeometry",{args:[.16,.02,4,5]}),(0,n.jsx)("meshStandardMaterial",{color:"#00D9FF",roughness:.3,metalness:.5})]}),(0,n.jsxs)("mesh",{position:[0,-.1,0],rotation:[Math.PI/2,Math.PI,Math.PI/2],children:[(0,n.jsx)("torusGeometry",{args:[.2,.02,4,5]}),(0,n.jsx)("meshStandardMaterial",{color:"#00D9FF",roughness:.3,metalness:.5})]}),(0,n.jsxs)("mesh",{position:[0,.1,0],rotation:[Math.PI/2,Math.PI,Math.PI/2],children:[(0,n.jsx)("torusGeometry",{args:[.175,.0175,6,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#00D9FF",roughness:.3,metalness:.5})]})]})})}function eX(e){let{isLeftHand:t=!1}=e;return(0,n.jsxs)("group",{rotation:[0,0,t?Math.PI:-Math.PI/3],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.03,.04,2.8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#4a2105",roughness:.6,metalness:.2})]}),[.3,.6,.9].map((e,t)=>(0,n.jsx)("group",{position:[0,e,0],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("torusGeometry",{args:[.075,.03,3,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#c0c0c0",metalness:.7,roughness:.3})]})},t)),(0,n.jsxs)("group",{position:[0,1.25,0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("octahedronGeometry",{args:[.2]}),(0,n.jsx)("meshStandardMaterial",{color:"#4169E1",emissive:"#4169E1",emissiveIntensity:1.75,transparent:!0,opacity:.875})]}),(0,n.jsx)("pointLight",{color:"#4169E1",intensity:1,distance:3,decay:2}),[0,1,2,3].map(e=>{let t=2*Math.PI*e/4;return(0,n.jsx)("group",{rotation:[0,t,0],position:[.3*Math.cos(t),.1*Math.sin(e*Math.PI),.3*Math.sin(t)],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("octahedronGeometry",{args:[.045]}),(0,n.jsx)("meshStandardMaterial",{color:"#4169E1",emissive:"#4169E1",emissiveIntensity:1.5,transparent:!0,opacity:.7})]})},e)})]})]})}function e$(){return(0,n.jsxs)("group",{children:[(0,n.jsxs)("mesh",{position:[0,-.15,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.17,.45,1.65,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#896BFF",roughness:.7,transparent:!0,opacity:.7})]}),(0,n.jsxs)("mesh",{position:[0,0,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.285,.285,.135,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#6b0fb3",metalness:.3,roughness:.6})]}),[-1,1].map(e=>(0,n.jsx)("group",{position:[.3*e,.5,0],rotation:[0,5,.1*e],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.1,.125,.3,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#2a0845",roughness:.7,transparent:!0,opacity:.75})]})},e))]})}function eJ(e){let{position:t,isAttacking:r,isWalking:o,onHit:i}=e,a=(0,s.useRef)(null),[l,c]=(0,s.useState)(0),[h,d]=(0,s.useState)(0),u=(0,s.useRef)();return(0,I.F)((e,n)=>{if(a.current){if(o){c(e=>(e+3*n)%(2*Math.PI));let e=Math.abs(.1*Math.sin(l));a.current&&(a.current.position.y=t[1]-e),["LeftLeg","RightLeg"].forEach(e=>{var t,r;let n=null===(t=a.current)||void 0===t?void 0:t.getObjectByName(e);if(n){let t=e.includes("Right")?l:l+Math.PI,s=.4*Math.sin(t);n.rotation.x=s;let o=null===(r=n.children[0])||void 0===r?void 0:r.children[1];if(o){let e=Math.max(0,Math.sin(t+Math.PI/4));o.rotation.x=.2+.8*e;let r=.1*Math.sin(t);o.rotation.y=r}let i=.05*Math.sin(t);n.rotation.y=i}}),["LeftArm","RightArm"].forEach(e=>{var t;let r=null===(t=a.current)||void 0===t?void 0:t.getObjectByName(e);if(r){let t=.3*Math.sin(e.includes("Right")?l+Math.PI:l);r.rotation.x=t}})}if(r){d(e=>e+.6*n);let e=Math.sin(Math.min(h,Math.PI/4))*Math.PI,t=a.current.getObjectByName("RightArm");t&&(t.rotation.x=-e),h>Math.PI/4&&i&&!u.current&&(u.current=setTimeout(()=>{u.current=void 0},0)),h>Math.PI/4&&d(0)}else u.current&&(clearTimeout(u.current),u.current=void 0)}}),(0,s.useEffect)(()=>()=>{u.current&&clearTimeout(u.current)},[]),(0,n.jsxs)("group",{ref:a,position:[t[0],t[1],t[2]],scale:[.925,.935,.8],children:[(0,n.jsx)("group",{position:[0,.775,.025],children:(0,n.jsx)(e$,{})}),(0,n.jsx)("group",{name:"Body",position:[0,1.15,0],scale:[.9,.75,.775],rotation:[-.2,0,0],children:(0,n.jsx)(H,{})}),(0,n.jsx)("group",{children:[0,1,2].map(e=>(0,n.jsx)("group",{rotation:[0,2*Math.PI*e/3,0],position:[0,1.3,0],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("ringGeometry",{args:[.575,.7,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#4169E1",emissive:"#4169E1",emissiveIntensity:1.5,transparent:!0,opacity:.4})]})},e))}),Array.from({length:8}).map((e,t)=>(0,n.jsxs)("group",{position:[.2*Math.sin(t*Math.PI/4),1.25+.3*Math.cos(t*Math.PI/2),.5*Math.cos(t*Math.PI/4)],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.01,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#4169E1",emissive:"#4169E1",emissiveIntensity:2,transparent:!0,opacity:.7})]}),(0,n.jsx)("pointLight",{color:"#4169E1",intensity:.5,distance:1,decay:2})]},t)),(0,n.jsxs)("group",{name:"Head",position:[0,1.7,.1],scale:[.75,.8,.8],children:[(0,n.jsxs)("group",{children:[(0,n.jsxs)("mesh",{position:[0,0,-.05],children:[(0,n.jsx)("sphereGeometry",{args:[.22,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("mesh",{position:[0,-.02,.12],children:[(0,n.jsx)("boxGeometry",{args:[.28,.28,.1]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("group",{children:[(0,n.jsxs)("mesh",{position:[.12,-.08,.1],children:[(0,n.jsx)("boxGeometry",{args:[.08,.12,.15]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("mesh",{position:[-.12,-.08,.1],children:[(0,n.jsx)("boxGeometry",{args:[.08,.12,.15]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]})]}),(0,n.jsx)("group",{position:[0,-.15,.05],children:(0,n.jsxs)("mesh",{position:[0,-.08,.08],rotation:[0,Math.PI/5,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.08,.08,.2,5]}),(0,n.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]})}),(0,n.jsx)("group",{position:[.025,-.25,.2175],children:[-.03,-.06,-.09,-0,.03].map((e,t)=>(0,n.jsx)("group",{position:[e,0,0],rotation:[.5,0,0],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("coneGeometry",{args:[.03,.075,3]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.3,metalness:.4})]})},t))}),(0,n.jsx)("group",{position:[0,-.18,.2],children:[-.06,-.02,.02,.06].map((e,t)=>(0,n.jsx)("group",{position:[e,0,0],rotation:[2.5,0,0],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("coneGeometry",{args:[.01,.08,3]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.3,metalness:.4})]})},t))})]}),(0,n.jsxs)("group",{position:[0,.05,.14],children:[(0,n.jsxs)("group",{position:[-.07,0,0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.02,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#2FFF00",emissive:"#2FFF00",emissiveIntensity:3})]}),(0,n.jsxs)("mesh",{scale:1.2,children:[(0,n.jsx)("sphereGeometry",{args:[.035,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#2FFF00",emissive:"#2FFF00",emissiveIntensity:1,transparent:!0,opacity:.75})]}),(0,n.jsxs)("mesh",{scale:1.4,children:[(0,n.jsx)("sphereGeometry",{args:[.05,6.5,2]}),(0,n.jsx)("meshStandardMaterial",{color:"#2FFF00",emissive:"#2FFF00",emissiveIntensity:1,transparent:!0,opacity:.7})]}),(0,n.jsx)("pointLight",{color:"#FF4C4C",intensity:.5,distance:1,decay:2})]}),(0,n.jsxs)("group",{position:[.07,0,0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.02,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#2FFF00",emissive:"#2FFF00",emissiveIntensity:3})]}),(0,n.jsxs)("mesh",{scale:1.2,children:[(0,n.jsx)("sphereGeometry",{args:[.035,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#2FFF00",emissive:"#2FFF00",emissiveIntensity:1,transparent:!0,opacity:.75})]}),(0,n.jsxs)("mesh",{scale:1.4,children:[(0,n.jsx)("sphereGeometry",{args:[.05,6.5,2]}),(0,n.jsx)("meshStandardMaterial",{color:"#2FFF00",emissive:"#2FFF00",emissiveIntensity:1,transparent:!0,opacity:.7})]}),(0,n.jsx)("pointLight",{color:"#FF4C4C",intensity:.5,distance:1,decay:1})]})]})]}),(0,n.jsx)("group",{position:[-.36,1.475,0],rotation:[-.15,-Math.PI-.4,-.35],children:(0,n.jsx)(eK,{})}),(0,n.jsx)("group",{position:[.36,1.475,0],rotation:[-.15,Math.PI-.4,.35],children:(0,n.jsx)(eK,{})}),(0,n.jsx)("group",{name:"LeftArm",position:[-.35,1.325,0],scale:[-.4,.4,.4],rotation:[0,Math.PI/3,0],children:(0,n.jsx)(eV,{isLeftHand:!0})}),(0,n.jsx)("group",{name:"RightArm",position:[.35,1.325,.1],scale:[.4,.4,.4],rotation:[0,-Math.PI/2.5,0],children:(0,n.jsx)(eV,{isLeftHand:!1})}),(0,n.jsxs)("group",{position:[0,.7,0],scale:[1.4,1,.8],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.21,.2,.2,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]}),(0,n.jsx)("group",{position:[0,.15,-.16],rotation:[.1,0,0],children:[.15,.27,.39,.51,.63].map((e,t)=>(0,n.jsxs)("mesh",{position:[0,e,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.0225,.0225,.03,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]},t))}),[-1,1].map(e=>(0,n.jsx)("group",{position:[.15*e,-.1,0],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.075,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]})},e))]}),(0,n.jsx)("group",{name:"LeftLeg",position:[.2,.36,0],children:(0,n.jsx)(eZ,{})}),(0,n.jsx)("group",{name:"RightLeg",position:[-.2,.36,0],children:(0,n.jsx)(eZ,{})}),(0,n.jsx)("group",{position:[0,1.2,0],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.04,.04,.2,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]})})]})}let e0=e=>{let{color:t,size:r,meshRef:i,opacity:a=1}=e,l=(0,s.useRef)(null),c=(0,s.useRef)(new Float32Array(120)),h=(0,s.useRef)(new Float32Array(40)),d=(0,s.useRef)(new Float32Array(40)),u=(0,s.useRef)(!1);return(0,s.useEffect)(()=>{if(i.current&&!u.current){let{x:e,y:t,z:r}=i.current.position;for(let n=0;n<40;n++)c.current[3*n]=e,c.current[3*n+1]=t,c.current[3*n+2]=r,h.current[n]=0,d.current[n]=0;u.current=!0}},[i]),(0,I.F)(()=>{var e;if(!(null===(e=l.current)||void 0===e?void 0:e.parent)||!i.current||!u.current)return;let{x:t,y:n,z:s}=i.current.position;for(let e=39;e>0;e--)c.current[3*e]=c.current[(e-1)*3],c.current[3*e+1]=c.current[(e-1)*3+1],c.current[3*e+2]=c.current[(e-1)*3+2],h.current[e]=.8*Math.pow(1-e/40,1.5)*a,d.current[e]=.6*r*Math.pow(1-e/40,.8);if(c.current[0]=t,c.current[1]=n,c.current[2]=s,h.current[0]=.8*a,d.current[0]=1.5*r,l.current){let e=l.current.geometry;e.attributes.position.array=c.current,e.attributes.position.needsUpdate=!0,e.attributes.opacity&&(e.attributes.opacity.array=h.current,e.attributes.opacity.needsUpdate=!0),e.attributes.scale&&(e.attributes.scale.array=d.current,e.attributes.scale.needsUpdate=!0)}}),(0,n.jsxs)("points",{ref:l,children:[(0,n.jsxs)("bufferGeometry",{children:[(0,n.jsx)("bufferAttribute",{attach:"attributes-position",count:40,array:c.current,itemSize:3}),(0,n.jsx)("bufferAttribute",{attach:"attributes-opacity",count:40,array:h.current,itemSize:1}),(0,n.jsx)("bufferAttribute",{attach:"attributes-scale",count:40,array:d.current,itemSize:1})]}),(0,n.jsx)("shaderMaterial",{transparent:!0,depthWrite:!1,blending:o.EZo,vertexShader:"\n          attribute float opacity;\n          attribute float scale;\n          varying float vOpacity;\n          void main() {\n            vOpacity = opacity;\n            vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n            gl_Position = projectionMatrix * mvPosition;\n            gl_PointSize = scale * 25.0 * (300.0 / -mvPosition.z);\n          }\n        ",fragmentShader:"\n          varying float vOpacity;\n          uniform vec3 uColor;\n          void main() {\n            float d = length(gl_PointCoord - vec2(0.5));\n            float strength = smoothstep(0.5, 0.1, d);\n            vec3 glowColor = mix(uColor, vec3(1.0), 0.5);\n            gl_FragColor = vec4(glowColor, vOpacity * strength);\n          }\n        ",uniforms:{uColor:{value:t}}})]})};function e1(e){let{position:t,target:r,onHit:i,playerPosition:a}=e,l=(0,s.useRef)(null),c=(0,s.useRef)(null),h=r.clone().sub(t).normalize(),[d,u]=(0,s.useState)(!1),[m,p]=(0,s.useState)(null),[,x]=(0,s.useState)({}),f=(0,s.useRef)(!1);return(0,I.F)(()=>{if(l.current){if(d){x({}),f.current||(f.current=!0,i(!0)),m&&Date.now()-m>200&&i(!1);return}if(l.current.position.add(h.clone().multiplyScalar(.275)),.75>l.current.position.distanceTo(a)){u(!0),p(Date.now());return}if(.5>l.current.position.distanceTo(r)){.5>a.distanceTo(r)?(u(!0),p(Date.now())):i(!1);return}l.current.position.distanceTo(t)>60&&i(!1)}}),(0,n.jsx)("group",{ref:l,position:t,children:d?(0,n.jsx)(n.Fragment,{children:(()=>{let e=m?(Date.now()-m)/1e3:0,t=Math.max(0,1-e/.2);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.45*(1+2*e),32,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#ff3333",emissive:"#ff4444",emissiveIntensity:2*t,transparent:!0,opacity:.8*t,depthWrite:!1,blending:o.EZo})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.4*(1+3*e),24,24]}),(0,n.jsx)("meshStandardMaterial",{color:"#ff6666",emissive:"#ffffff",emissiveIntensity:3*t,transparent:!0,opacity:.9*t,depthWrite:!1,blending:o.EZo})]}),[.45,.675,.9,1.175].map((r,s)=>(0,n.jsxs)("mesh",{rotation:[Math.random()*Math.PI,Math.random()*Math.PI,Math.random()*Math.PI],children:[(0,n.jsx)("torusGeometry",{args:[r*(1+3*e),.045,16,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#ff3333",emissive:"#ff4444",emissiveIntensity:.8*t,transparent:!0,opacity:.5*t*(1-.2*s),depthWrite:!1,blending:o.EZo})]},s)),[...Array(8)].map((r,s)=>{let i=s/8*Math.PI*2,a=.5*(1+2*e);return(0,n.jsxs)("mesh",{position:[Math.sin(i)*a,Math.cos(i)*a,0],children:[(0,n.jsx)("sphereGeometry",{args:[.05,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#ff6666",emissive:"#ffffff",emissiveIntensity:2*t,transparent:!0,opacity:.8*t,depthWrite:!1,blending:o.EZo})]},"spark-".concat(s))}),(0,n.jsx)("pointLight",{color:"#ff3333",intensity:2*t,distance:4,decay:2}),(0,n.jsx)("pointLight",{color:"#ff6666",intensity:1*t,distance:6,decay:1})]})})()}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("mesh",{ref:c,children:[(0,n.jsx)("sphereGeometry",{args:[.225,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#ff3333",emissive:"#ff0000",emissiveIntensity:2,transparent:!0,opacity:.9})]}),(0,n.jsx)(e0,{color:new o.Q1f("#ff3333"),size:.255,meshRef:c,opacity:.8}),(0,n.jsx)("pointLight",{color:"#ff3333",intensity:2,distance:3,decay:2})]})})}let e2=s.memo(function(e){let{id:t,initialPosition:r,position:i,health:a,maxHealth:l,onTakeDamage:c,onPositionUpdate:h,playerPosition:d,onAttackPlayer:u,weaponType:m}=e,p=(0,s.useRef)(null),[x,f]=(0,s.useState)(!1),[g,j]=(0,s.useState)(!1),[y,M]=(0,s.useState)(!0),[v,P]=(0,s.useState)(!1),[w,S]=(0,s.useState)(!1),b=(0,s.useRef)(Date.now()+2e3),[C,F]=(0,s.useState)([]),E=(0,s.useRef)(r.clone()),R=(0,s.useRef)(r.clone()),k=(0,s.useRef)(Date.now()),G=(0,s.useRef)(a);(0,s.useEffect)(()=>{G.current=a},[a]);let T=(0,s.useCallback)(e=>{if(G.current<=0)return;let r=Math.max(0,G.current-e);c("enemy-".concat(t),e),0===r&&G.current>0&&(j(!0),f(!0))},[t,c]);(0,s.useEffect)(()=>{i&&(E.current.copy(i),R.current.copy(i),p.current&&p.current.position.copy(i))},[i]);let D=(0,s.useCallback)(()=>{w||g||(S(!0),setTimeout(()=>{if(p.current){let e=E.current.clone();e.y+=1.5,F(t=>[...t,{id:Date.now(),position:e,target:d.clone()}])}setTimeout(()=>{S(!1)},500)},1e3))},[w,g,d]);return(0,I.F)((e,r)=>{if(!p.current||G.current<=0)return;let n=Date.now(),s=E.current.distanceTo(d);if(n-b.current>=4250&&s<=17){let e=new o.Pq0().copy(d).setY(E.current.y);p.current.lookAt(e),D(),b.current=n}if(s<.5&&G.current>0){P(!0);let e=new o.Pq0().subVectors(E.current,d).normalize(),t=E.current.clone().add(e.multiplyScalar(.15));E.current.lerp(t,.15),p.current.position.copy(E.current);let r=new o.Pq0().copy(d).setY(E.current.y);p.current.lookAt(r)}else if(s>17&&G.current>0){var a;P(!0);let e=new o.Pq0().subVectors(d,E.current).normalize(),n=(null===(a=p.current.parent)||void 0===a?void 0:a.children.filter(e=>e!==p.current&&e.position&&.95>e.position.distanceTo(E.current)))||[],s=new o.Pq0;n.forEach(e=>{let t=E.current.clone().setY(0),r=e.position.clone().setY(0),n=new o.Pq0().subVectors(t,r).normalize().multiplyScalar(.125/Math.max(.1,r.distanceTo(t)));s.add(n)});let l=e.add(s).normalize();l.y=0;let c=l.multiplyScalar(.15*r*60);R.current.copy(E.current).add(c),R.current.y=0,E.current.lerp(R.current,.15),E.current.y=0,p.current.position.copy(E.current);let u=new o.Pq0().copy(d).setY(E.current.y);p.current.lookAt(u);let m=Date.now();m-k.current>=50&&E.current.distanceTo(i)>.1&&(h(t,E.current.clone()),k.current=m)}else P(!1)}),(0,s.useEffect)(()=>{0===a&&!g&&(j(!0),f(!0),p.current&&(p.current.visible=!0))},[a,g]),(0,s.useEffect)(()=>{if(g){let e=setTimeout(()=>{var e;f(!1),(null===(e=p.current)||void 0===e?void 0:e.parent)&&p.current.parent.remove(p.current)},3e3);return()=>clearTimeout(e)}},[g]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("group",{ref:p,visible:!y&&G.current>0,position:E.current,onClick:e=>{e.stopPropagation()},children:[(0,n.jsx)(eJ,{position:[0,.76,0],isAttacking:w,isWalking:v&&G.current>0,onHit:T}),w&&(0,n.jsxs)("group",{position:[.4,2.265,0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.125,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#ff3333",emissive:"#ff0000",emissiveIntensity:1,transparent:!0,opacity:.8})]}),(0,n.jsx)("pointLight",{color:"#ff3333",intensity:2,distance:3})]}),w&&(0,n.jsxs)("group",{position:[-.4,2.265,-.05],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.125,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#ff3333",emissive:"#ff0000",emissiveIntensity:2,transparent:!0,opacity:.7})]}),(0,n.jsx)("pointLight",{color:"#ff3333",intensity:2,distance:3})]}),(0,n.jsx)(eR.Q,{position:[0,3.5,0],follow:!0,lockX:!1,lockY:!1,lockZ:!1,children:G.current>0&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("mesh",{position:[0,0,0],children:[(0,n.jsx)("planeGeometry",{args:[2,.25]}),(0,n.jsx)("meshBasicMaterial",{color:"#333333",opacity:.8,transparent:!0})]}),(0,n.jsxs)("mesh",{position:[-1+G.current/l,0,.001],children:[(0,n.jsx)("planeGeometry",{args:[G.current/l*2,.23]}),(0,n.jsx)("meshBasicMaterial",{color:"#ff3333",opacity:.9,transparent:!0})]}),(0,n.jsx)(A.E,{position:[0,0,.002],fontSize:.2,color:"#ffffff",anchorX:"center",anchorY:"middle",fontWeight:"bold",children:"".concat(Math.ceil(G.current),"/").concat(l)})]})})]}),y&&(0,n.jsx)(ez,{position:E.current,onComplete:()=>{M(!1)},isSpawning:!0}),x&&(0,n.jsx)(eL,{position:E.current,onComplete:()=>{f(!1)},isSpawning:!1,weaponType:m}),C.map(e=>(0,n.jsx)(e1,{position:e.position,target:e.target,playerPosition:d,onHit:t=>{F(t=>t.filter(t=>t.id!==e.id)),t&&u(16)}},e.id))]})},(e,t)=>e.health===t.health&&e.position.equals(t.position)&&e.playerPosition.equals(t.playerPosition)),e5=e=>{let{parentRef:t}=e,r=(0,s.useRef)(null),i=(0,s.useRef)(new Float32Array(54)),a=(0,s.useRef)(new Float32Array(18)),l=(0,s.useRef)(new Float32Array(18)),c=(0,s.useRef)(0);return(0,I.F)((e,n)=>{var s;if(!(null===(s=r.current)||void 0===s?void 0:s.parent)||!t.current)return;c.current+=n;let o=t.current.position;for(let e=0;e<18;e++){let t=Math.acos(-1+2*e/18),r=Math.sqrt(18*Math.PI)*t+c.current,n=.8+.1*Math.sin(2*c.current+.2*e);i.current[3*e]=o.x+n*Math.cos(r)*Math.sin(t),i.current[3*e+1]=o.y+n*Math.sin(r)*Math.sin(t),i.current[3*e+2]=o.z+n*Math.cos(t),a.current[e]=.3*Math.pow(1-e/18,1.2),l.current[e]=.4*Math.pow(1-e/18,.5)}if(r.current){let e=r.current.geometry;e.attributes.position.needsUpdate=!0,e.attributes.opacity.needsUpdate=!0,e.attributes.scale.needsUpdate=!0}}),(0,n.jsxs)("points",{ref:r,children:[(0,n.jsxs)("bufferGeometry",{children:[(0,n.jsx)("bufferAttribute",{attach:"attributes-position",count:18,array:i.current,itemSize:3}),(0,n.jsx)("bufferAttribute",{attach:"attributes-opacity",count:18,array:a.current,itemSize:1}),(0,n.jsx)("bufferAttribute",{attach:"attributes-scale",count:18,array:l.current,itemSize:1})]}),(0,n.jsx)("shaderMaterial",{transparent:!0,depthWrite:!1,blending:o.EZo,vertexShader:"\n          attribute float opacity;\n          attribute float scale;\n          varying float vOpacity;\n          void main() {\n            vOpacity = opacity;\n            vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n            gl_Position = projectionMatrix * mvPosition;\n            gl_PointSize = scale * 25.0 * (300.0 / -mvPosition.z); // Larger point size\n          }\n        ",fragmentShader:"\n          varying float vOpacity;\n          void main() {\n            float d = length(gl_PointCoord - vec2(0.5));\n            float strength = smoothstep(0.5, 0.1, d);\n            vec3 glowColor = mix(vec3(0.5, 0.0, 0.5), vec3(0.8, 0.0, 0.8), 0.4); // Purple color\n            gl_FragColor = vec4(glowColor, vOpacity * strength);\n          }\n        "})]})};function e3(){return(0,n.jsxs)("group",{children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.08,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("group",{rotation:[.3,0,0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.07,.06,.4,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("group",{position:[0,-.2,0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.09,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("group",{position:[0,0,-.5],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.06,.04,.8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("group",{position:[0,-.4,0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.05,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("group",{position:[0,0,0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.04,.03,.9,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("group",{position:[0,-.45,0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.04,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("group",{position:[0,0,0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.03,.02,.7,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsx)("group",{position:[0,-.35,0],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("coneGeometry",{args:[.02,.1,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#d4d4d4",roughness:.3,metalness:.4})]})})]})]})]})]})]})]})]})]})}function e8(e){let{isLeftHand:t=!1}=e,r=(e,t)=>(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[t,.8*t,e,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),s=e=>(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[e,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),i=(e,t)=>(0,n.jsxs)("group",{children:[(0,n.jsx)("group",{position:[t/2,0,0],children:r(e,.06)}),(0,n.jsx)("group",{position:[-t/2,0,0],children:r(e,.06)}),(0,n.jsx)("group",{position:[0,e/2,0],children:s(.08)}),(0,n.jsx)("group",{position:[0,-e/2,0],children:s(.08)})]});return(0,n.jsx)("group",{children:(0,n.jsxs)("group",{children:[i(1.3,.15),(0,n.jsxs)("group",{position:[.25,-.85,.21],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.12,12,12]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("group",{rotation:[-.7,-0,Math.PI/5],children:[i(.8,.12),(0,n.jsxs)("group",{position:[0,-.5,0],rotation:[0,0,Math.PI/5.5],children:[s(.09),(0,n.jsxs)("group",{position:[0,-.1,0],children:[(0,n.jsxs)("group",{position:[-0,-.2,0],rotation:[1.7+Math.PI/4,0,2.675*Math.PI+.75],scale:[1.5,.55,1.5],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("extrudeGeometry",{args:[(()=>{let e=new o.ypk;return e.moveTo(0,0),e.lineTo(.4,-.13),e.bezierCurveTo(.8,.22,1.33,.5,1.6,.515),e.lineTo(1.125,.75),e.bezierCurveTo(.5,.2,.225,0,.1,.7),e.lineTo(0,0),e})(),{steps:1,depth:1e-4,bevelEnabled:!0,bevelThickness:.03,bevelSize:.035,bevelSegments:1,curveSegments:16,depth:.03}]}),(0,n.jsx)("meshStandardMaterial",{color:"#9c27b0",emissive:"#9c27b0",emissiveIntensity:1.3,metalness:.8,roughness:.1,opacity:1,transparent:!0,side:o.$EB})]}),(0,n.jsx)("pointLight",{color:"#9c27b0",intensity:1,distance:2,decay:2})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("boxGeometry",{args:[.2,.15,.08]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4})]}),[-.08,-.04,0,.04,.08].map((e,t)=>(0,n.jsxs)("group",{position:[e,-.1,0],rotation:[0,0,(t-2)*Math.PI/10],children:[r(.5,.02),(0,n.jsx)("group",{position:[.025,-.3,0],rotation:[0,0,Math.PI+Math.PI/16],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("coneGeometry",{args:[.03,.3,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#d4d4d4",roughness:.3,metalness:.4})]})})]},t)),!t&&(0,n.jsx)("group",{position:[0,-.2,.3],rotation:[Math.PI/2,0,0],scale:[.8,.8,.8]})]})]})]})]})]})})}function e4(){let e=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return(0,n.jsxs)("group",{scale:[e,e,e],position:[0,-.125,0],children:[(0,n.jsxs)("mesh",{position:[0,0,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.06,.06,.115,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("mesh",{position:[0,.1,.0275],rotation:[0,0,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.04,.03,.12,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("mesh",{position:[0,.2,.04],rotation:[.2,0,0],children:[(0,n.jsx)("coneGeometry",{args:[.04,.175,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#d4d4d4",roughness:.3,metalness:.5})]}),[0,Math.PI/3,2*Math.PI/3,Math.PI,4*Math.PI/3,5*Math.PI/3].map((e,t)=>(0,n.jsx)("group",{rotation:[0,e,0],children:(0,n.jsxs)("mesh",{position:[.04,.05,0],children:[(0,n.jsx)("boxGeometry",{args:[.01,.12,.02]}),(0,n.jsx)("meshStandardMaterial",{color:"#d4d4d4",roughness:.5,metalness:.3})]})},t))]})};return(0,n.jsxs)("group",{children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.185,.2,.225,6,1,!1,0,2*Math.PI]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("group",{position:[0,.25,0],rotation:[2*Math.PI,Math.PI/3,0],children:[(0,n.jsx)("group",{position:[0,0,0],rotation:[0,0,0],children:e(1.5)}),(0,n.jsx)("group",{position:[0,-.05,.15],rotation:[-.2,0,0],children:e(1.1)}),(0,n.jsx)("group",{position:[0,-.05,-.15],rotation:[.2,0,0],children:e(1.1)}),(0,n.jsx)("group",{position:[0,-.1,.15],rotation:[-.4,0,0],children:e(1.1)}),(0,n.jsx)("group",{position:[0,-.1,-.15],rotation:[.4,0,0],children:e(1.1)})]})]})}function e6(e){let{isLeft:t=!1}=e,r=1.2*Math.PI;return(0,n.jsx)("group",{rotation:[-.25,t?-.3:.3,t?-.4:.4],children:Array.from({length:14}).map((e,s)=>{let o=s/13,i=.15*(1-.8*o),a=Math.pow(o,1.2)*r,l=1.4*Math.pow(o,1.3);return(0,n.jsxs)("group",{position:[l*(t?-.15:.15),.12*s,-(.6*l)],rotation:[-.8*o,a,0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[i,.92*i,.12,6]}),(0,n.jsx)("meshStandardMaterial",{color:"rgb(".concat(139-80*o,", ").concat(0+20*o,", ").concat(0+20*o,")"),roughness:.7,metalness:.4})]}),Array.from({length:6}).map((e,t)=>(0,n.jsx)("group",{rotation:[0,t*Math.PI*2/6,0],children:(0,n.jsxs)("mesh",{position:[.95*i,0,0],children:[(0,n.jsx)("boxGeometry",{args:[.4*i,.132,.2*i]}),(0,n.jsx)("meshStandardMaterial",{color:"rgb(".concat(159-100*o,", ").concat(20+20*o,", ").concat(20+20*o,")"),roughness:.8,metalness:.3})]})},t))]},s)})})}function e7(e){let{position:t,isAttacking:r,isWalking:o}=e,i=(0,s.useRef)(null),[a,l]=(0,s.useState)(0),[c,h]=(0,s.useState)(0),d=(0,s.useRef)(),u=[{left:"LeftFrontLeg",right:"RightFrontLeg",baseRotation:{x:.2,y:-.6,z:.6},rightBaseRotation:{x:.2,y:.6,z:-.6},phase:0},{left:"LeftMiddleFrontLeg",right:"RightMiddleFrontLeg",baseRotation:{x:.25,y:-.8,z:.7},rightBaseRotation:{x:.25,y:.8,z:-.7},phase:Math.PI},{left:"LeftMiddleBackLeg",right:"RightMiddleBackLeg",baseRotation:{x:.5,y:-1,z:.7},rightBaseRotation:{x:.5,y:1,z:-.7},phase:0},{left:"LeftBackLeg",right:"RightBackLeg",baseRotation:{x:1,y:-1.2,z:.6},rightBaseRotation:{x:1,y:1.2,z:-.6},phase:Math.PI}];return(0,I.F)((e,t)=>{if(i.current){if(o&&(l(e=>(e+4*t)%(2*Math.PI)),["LeftFrontLeg","RightFrontLeg","LeftMiddleFrontLeg","RightMiddleFrontLeg","LeftMiddleBackLeg","RightMiddleBackLeg","LeftBackLeg","RightBackLeg"].forEach((e,t)=>{var r,n,s;let o=null===(r=i.current)||void 0===r?void 0:r.getObjectByName(e);if(o){e.includes("Right");let r=a+(t%2==0?0:Math.PI),i=.3*Math.max(0,Math.sin(r)),l=.2*Math.cos(r);o.rotation.x=l,o.position.y=.6+i;let c=null===(n=o.children[0])||void 0===n?void 0:n.children[1],h=null==c?void 0:null===(s=c.children[1])||void 0===s?void 0:s.children[1];if(c&&h){let e=r+Math.PI/4;c.rotation.x=.4*Math.sin(e)-.2,h.rotation.x=-(.6*Math.sin(e))-.3}}})),r){h(e=>e+2*t);let e=[{left:"LeftLowerBackArm",right:"RightLowerBackArm",startTime:.85,rotationRange:.5*Math.PI},{left:"LeftMiddleBackArm",right:"RightMiddleBackArm",startTime:1,rotationRange:.5*Math.PI},{left:"LeftUpperBackArm",right:"RightUpperBackArm",startTime:1.15,rotationRange:.5*Math.PI},{left:"LeftFrontArm",right:"RightFrontArm",startTime:1.3,rotationRange:.5*Math.PI}];e.forEach(e=>{var t,r;let{left:n,right:s,startTime:o,rotationRange:a}=e,l=null===(t=i.current)||void 0===t?void 0:t.getObjectByName(n),h=null===(r=i.current)||void 0===r?void 0:r.getObjectByName(s);if(l&&h){let e=Math.max(0,Math.min(1,(c-o)*1)),t=Math.sin(e*Math.PI)*a,r=.5*Math.sin(e*Math.PI);l.rotation.y=4*Math.PI+t,h.rotation.y=4*Math.PI-t,l.rotation.z=r,h.rotation.z=r}}),c>1.75&&(h(0),e.forEach(e=>{var t,r;let{left:n,right:s}=e,o=null===(t=i.current)||void 0===t?void 0:t.getObjectByName(n),a=null===(r=i.current)||void 0===r?void 0:r.getObjectByName(s);o&&a&&(o.rotation.z=0,a.rotation.z=0)}))}else[{left:"LeftLowerBackArm",right:"RightLowerBackArm",y:4.2*Math.PI},{left:"LeftMiddleBackArm",right:"RightMiddleBackArm",y:4.1*Math.PI},{left:"LeftUpperBackArm",right:"RightUpperBackArm",y:4*Math.PI},{left:"LeftFrontArm",right:"RightFrontArm",y:4.9*Math.PI}].forEach(e=>{var t,r;let{left:n,right:s,y:o}=e,a=null===(t=i.current)||void 0===t?void 0:t.getObjectByName(n),l=null===(r=i.current)||void 0===r?void 0:r.getObjectByName(s);a&&l&&(a.rotation.y=o,l.rotation.y=-o)});r||u.forEach(t=>{var r,n;let{left:s,right:o,baseRotation:a,rightBaseRotation:l,phase:c}=t,h=null===(r=i.current)||void 0===r?void 0:r.getObjectByName(s),d=null===(n=i.current)||void 0===n?void 0:n.getObjectByName(o);if(h&&d){let t=3*e.clock.getElapsedTime(),r=Math.sin(t+c),n=Math.sin(t+c+Math.PI);h.rotation.set(a.x+.15*r,a.y+.045*r,a.z+.075*r),d.rotation.set(l.x+.15*n,l.y+.045*n,l.z+.075*n)}})}}),(0,s.useEffect)(()=>{let e=d.current;return()=>{e&&clearTimeout(e)}},[]),(0,n.jsxs)("group",{ref:i,position:[t[0],t[1],t[2]],scale:[1.625,1.625,1.625],children:[(0,n.jsx)("group",{position:[0,.15,-0],children:(0,n.jsx)(e5,{parentRef:i})}),(0,n.jsx)("group",{name:"Body",position:[0,1.2,-.25],scale:[1.8,1.4,1.65],rotation:[.25,0,0],children:(0,n.jsx)(H,{})}),(0,n.jsx)("group",{scale:[.65,.5,1],position:[0,1,-.15],rotation:[.7,0,-4.25],children:(0,n.jsx)(e6,{isLeft:!0})}),(0,n.jsx)("group",{scale:[.65,.5,1],position:[0,1,-.15],rotation:[.7,0,4.25],children:(0,n.jsx)(e6,{isLeft:!1})}),(0,n.jsxs)("group",{name:"Head",position:[0,1.925,.2],scale:[.95,.8,.8],children:[(0,n.jsxs)("group",{children:[(0,n.jsxs)("mesh",{position:[0,0,-.05],children:[(0,n.jsx)("sphereGeometry",{args:[.22,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("mesh",{position:[0,-.02,.12],children:[(0,n.jsx)("boxGeometry",{args:[.28,.28,.1]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("group",{children:[(0,n.jsxs)("mesh",{position:[.12,-.08,.1],children:[(0,n.jsx)("boxGeometry",{args:[.08,.12,.15]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("mesh",{position:[-.12,-.08,.1],children:[(0,n.jsx)("boxGeometry",{args:[.08,.12,.15]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]})]}),(0,n.jsx)("group",{position:[0,-.15,.05],children:(0,n.jsxs)("mesh",{position:[0,-.08,.08],rotation:[0,Math.PI/5,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.08,.08,.2,5]}),(0,n.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]})}),(0,n.jsx)("group",{position:[.025,-.25,.2175],children:[-.03,-.06,-.09,-0,.03].map((e,t)=>(0,n.jsx)("group",{position:[e,0,0],rotation:[.5,0,0],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("coneGeometry",{args:[.03,.075,3]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.3,metalness:.4})]})},t))}),(0,n.jsx)("group",{position:[0,-.18,.2],children:[-.06,-.02,.02,.06].map((e,t)=>(0,n.jsx)("group",{position:[e,0,0],rotation:[2.5,0,0],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("coneGeometry",{args:[.01,.08,3]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.3,metalness:.4})]})},t))})]}),(0,n.jsxs)("group",{position:[0,.05,.14],children:[(0,n.jsxs)("group",{position:[-.07,0,0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.02,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#2FFF00",emissive:"#2FFF00",emissiveIntensity:3})]}),(0,n.jsxs)("mesh",{scale:1.2,children:[(0,n.jsx)("sphereGeometry",{args:[.035,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#2FFF00",emissive:"#2FFF00",emissiveIntensity:1,transparent:!0,opacity:.75})]}),(0,n.jsxs)("mesh",{scale:1.4,children:[(0,n.jsx)("sphereGeometry",{args:[.05,6.5,2]}),(0,n.jsx)("meshStandardMaterial",{color:"#2FFF00",emissive:"#2FFF00",emissiveIntensity:1,transparent:!0,opacity:.7})]}),(0,n.jsx)("pointLight",{color:"#FF4C4C",intensity:.5,distance:1,decay:2})]}),(0,n.jsxs)("group",{position:[.07,0,0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.02,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#2FFF00",emissive:"#2FFF00",emissiveIntensity:3})]}),(0,n.jsxs)("mesh",{scale:1.2,children:[(0,n.jsx)("sphereGeometry",{args:[.035,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#2FFF00",emissive:"#2FFF00",emissiveIntensity:1,transparent:!0,opacity:.75})]}),(0,n.jsxs)("mesh",{scale:1.4,children:[(0,n.jsx)("sphereGeometry",{args:[.05,6.5,2]}),(0,n.jsx)("meshStandardMaterial",{color:"#2FFF00",emissive:"#2FFF00",emissiveIntensity:1,transparent:!0,opacity:.7})]}),(0,n.jsx)("pointLight",{color:"#FF4C4C",intensity:.5,distance:1,decay:1})]})]})]}),(0,n.jsx)("group",{position:[-.55,1.75,.05],rotation:[-.45,-Math.PI/1.2,-.525],children:(0,n.jsx)(e4,{})}),(0,n.jsx)("group",{position:[.55,1.75,.05],rotation:[-.45,Math.PI/1.2,.525],children:(0,n.jsx)(e4,{})}),(0,n.jsx)("group",{name:"LeftFrontArm",position:[-.35,1.525,.25],scale:[-.525,.425,.525],rotation:[.2,Math.PI/3,0],children:(0,n.jsx)(e8,{isLeftHand:!0})}),(0,n.jsx)("group",{name:"RightFrontArm",position:[.35,1.525,-.25],scale:[.525,.425,.525],rotation:[.2,-Math.PI/2.5,0],children:(0,n.jsx)(e8,{isLeftHand:!1})}),(0,n.jsx)("group",{name:"LeftUpperBackArm",position:[-.55,1.6,0],scale:[-1.1,.7,.9],rotation:[0,2*Math.PI,-.4],children:(0,n.jsx)(e8,{isLeftHand:!0})}),(0,n.jsx)("group",{name:"RightUpperBackArm",position:[.55,1.6,0],scale:[1.1,.7,.9],rotation:[0,-(2*Math.PI),.4],children:(0,n.jsx)(e8,{isLeftHand:!1})}),(0,n.jsx)("group",{name:"LeftMiddleBackArm",position:[-.45,1.5,-.1],scale:[-.75,.75,.75],rotation:[.4,2.1*Math.PI,-.4],children:(0,n.jsx)(e8,{isLeftHand:!0})}),(0,n.jsx)("group",{name:"RightMiddleBackArm",position:[.45,1.5,-.1],scale:[.75,.75,.75],rotation:[.4,-(2.1*Math.PI),.4],children:(0,n.jsx)(e8,{isLeftHand:!1})}),(0,n.jsx)("group",{name:"LeftFrontLeg",position:[.4,.75,.4],rotation:[.2,-.6,.6],children:(0,n.jsx)(e3,{})}),(0,n.jsx)("group",{name:"RightFrontLeg",position:[-.4,.75,.4],rotation:[.2,.6,-.6],children:(0,n.jsx)(e3,{})}),(0,n.jsx)("group",{name:"LeftMiddleFrontLeg",position:[.6,.73,0],rotation:[.25,-.8,.7],children:(0,n.jsx)(e3,{})}),(0,n.jsx)("group",{name:"RightMiddleFrontLeg",position:[-.6,.73,0],rotation:[.25,.8,-.7],children:(0,n.jsx)(e3,{})}),(0,n.jsx)("group",{name:"LeftMiddleBackLeg",position:[.5,.71,-.35],rotation:[.5,-1,.7],children:(0,n.jsx)(e3,{})}),(0,n.jsx)("group",{name:"RightMiddleBackLeg",position:[-.5,.71,-.35],rotation:[.5,1,-.7],children:(0,n.jsx)(e3,{})}),(0,n.jsx)("group",{name:"LeftBackLeg",position:[.4,.7,-.725],rotation:[1,-1.2,.6],children:(0,n.jsx)(e3,{})}),(0,n.jsx)("group",{name:"RightBackLeg",position:[-.4,.7,-.725],rotation:[1,1.2,-.6],children:(0,n.jsx)(e3,{})}),(0,n.jsxs)("group",{position:[0,1.925,.245],scale:[.405,.425,.275],children:[(0,n.jsx)("group",{position:[.2,.2,0],rotation:[-.4,.5,-.2],children:(0,n.jsx)(e6,{isLeft:!0})}),(0,n.jsx)("group",{position:[-.2,.2,0],rotation:[-.3,-.5,.3],children:(0,n.jsx)(e6,{isLeft:!1})})]}),(0,n.jsxs)("group",{position:[0,.5,-.25],scale:[1.9,1,1.75],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.35,.34,.27,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]}),(0,n.jsx)("group",{position:[0,.15,-.16],rotation:[.1,0,0],children:[.15,.27,.39,.51,.63].map((e,t)=>(0,n.jsxs)("mesh",{position:[0,e,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.0225,.0225,.03,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]},t))}),[-1,1].map(e=>(0,n.jsx)("group",{position:[.15*e,-.1,0],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.075,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]})},e))]})]})}let e9=s.memo(function(e){let{id:t,initialPosition:r,position:i,health:a,maxHealth:l,onTakeDamage:c,onPositionUpdate:h,playerPosition:d,onAttackPlayer:u,weaponType:m}=e,p=(0,s.useRef)(null),x=(0,s.useRef)(Date.now()+2e3),[f,g]=(0,s.useState)(!1),[j,y]=(0,s.useState)(!1),[M,v]=(0,s.useState)(!1),[P,w]=(0,s.useState)(!0),[S,b]=(0,s.useState)(!1),C=(0,s.useRef)(r.clone()),F=(0,s.useRef)(r.clone()),E=(0,s.useRef)(Date.now()),R=(0,s.useRef)(a);(0,s.useEffect)(()=>{R.current=a},[a]);let k=(0,s.useCallback)(e=>{if(R.current<=0)return;let r=Math.max(0,R.current-e);c("enemy-".concat(t),e),0===r&&R.current>0&&(v(!0),y(!0))},[t,c]);return(0,s.useEffect)(()=>{i&&(C.current.copy(i),F.current.copy(i),p.current&&p.current.position.copy(i))},[i]),(0,I.F)((e,r)=>{if(!p.current||R.current<=0||!d){b(!1);return}let n=C.current.distanceTo(d);if(n>2.75&&R.current>0){var s;g(!1),b(!0);let e=new o.Pq0().subVectors(d,C.current).normalize(),n=(null===(s=p.current.parent)||void 0===s?void 0:s.children.filter(e=>e!==p.current&&e.position&&4>e.position.distanceTo(C.current)))||[],a=new o.Pq0;n.forEach(e=>{let t=C.current.clone().setY(0),r=e.position.clone().setY(0),n=new o.Pq0().subVectors(t,r).normalize().multiplyScalar(.15/Math.max(.1,r.distanceTo(t)));a.add(n)});let l=e.add(a).normalize();l.y=0;let c=l.multiplyScalar(.185*r*60);F.current.copy(C.current).add(c),F.current.y=0,C.current.lerp(F.current,.185),C.current.y=0,p.current.position.copy(C.current);let u=new o.Pq0().copy(d).setY(C.current.y);p.current.lookAt(u);let m=Date.now();m-E.current>=50&&C.current.distanceTo(i)>.1&&(h(t,C.current.clone()),E.current=m)}else b(!1),F.current.copy(C.current);if(n<=2.75&&R.current>0){let e=Date.now();if(e-x.current>=2e3){g(!0);let t=C.current.clone();for(let e=0;e<6;e++)setTimeout(()=>{let e=C.current.distanceTo(d);R.current>0&&e<=2.75&&.65>t.distanceTo(C.current)&&u(6)},850+150*e);x.current=e,setTimeout(()=>{g(!1)},1950)}}}),(0,s.useEffect)(()=>{0===a&&!M&&(v(!0),y(!0),p.current&&(p.current.visible=!0))},[a,M]),(0,s.useEffect)(()=>{if(M){let e=setTimeout(()=>{var e;y(!1),(null===(e=p.current)||void 0===e?void 0:e.parent)&&p.current.parent.remove(p.current)},3e3);return()=>clearTimeout(e)}},[M]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("group",{ref:p,visible:!P&&R.current>0,position:C.current,onClick:e=>{e.stopPropagation()},children:[(0,n.jsx)(e7,{position:[0,.765,0],isAttacking:f,isWalking:S&&R.current>0,onHit:k}),(0,n.jsx)(eR.Q,{position:[0,5.5,0],follow:!0,lockX:!1,lockY:!1,lockZ:!1,children:R.current>0&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("mesh",{position:[0,0,0],children:[(0,n.jsx)("planeGeometry",{args:[2,.25]}),(0,n.jsx)("meshBasicMaterial",{color:"#333333",opacity:.8,transparent:!0})]}),(0,n.jsxs)("mesh",{position:[-1+R.current/l,0,.001],children:[(0,n.jsx)("planeGeometry",{args:[R.current/l*2,.23]}),(0,n.jsx)("meshBasicMaterial",{color:"#ff3333",opacity:.9,transparent:!0})]}),(0,n.jsx)(A.E,{position:[0,0,.002],fontSize:.2,color:"#ffffff",anchorX:"center",anchorY:"middle",fontWeight:"bold",children:"".concat(Math.ceil(R.current),"/").concat(l)})]})})]}),P&&(0,n.jsx)(ez,{position:C.current,onComplete:()=>{w(!1)},isSpawning:!0,scale:1.75}),j&&(0,n.jsx)(eL,{position:C.current,onComplete:()=>{y(!1)},isSpawning:!1,weaponType:m,scale:1.75})]})},(e,t)=>e.health===t.health&&e.position.equals(t.position)&&e.playerPosition.equals(t.playerPosition));function te(e){let{mountainData:t,treeData:r,mushroomData:i,unitProps:{controlsRef:a,...l},onLevelComplete:c,spawnInterval:h=1e3,maxSkeletons:d=17,initialSkeletons:u=6,killCount:m,boneDoodadData:p}=e,[x,g]=(0,s.useState)(()=>Array.from({length:u},(e,t)=>{let r=f();return{id:"skeleton-".concat(t),position:r.clone(),initialPosition:r.clone(),health:324,maxHealth:324,ref:s.createRef()}})),[j,y]=(0,s.useState)(u),[M,w]=(0,s.useState)(l.health),I=(0,s.useRef)(null),[C,F]=(0,s.useState)(new o.Pq0(0,0,0)),E=(0,s.useCallback)((e,t)=>{g(r=>{let n=[...r],s=n.findIndex(t=>t.id===e.replace("enemy-",""));if(-1!==s){let e=Math.max(0,n[s].health-t);if(0===e&&n[s].health>0){var o;n[s]={...n[s],health:e,isDying:!0,deathStartTime:Date.now()},null===(o=l.onEnemyDeath)||void 0===o||o.call(l)}else n[s]={...n[s],health:e}}return n})},[l]),R=(0,s.useCallback)(e=>{var t;null===(t=l.onDamage)||void 0===t||t.call(l,e)},[l]),k=(0,s.useCallback)(e=>{F(e)},[]),G=(0,s.useCallback)((e,t)=>{g(r=>r.map(r=>r.id===e.replace("enemy-","")?{...r,position:t.clone()}:r))},[]),T={onHit:E,controlsRef:a,currentWeapon:l.currentWeapon,onWeaponSelect:l.onWeaponSelect,health:M,maxHealth:l.maxHealth,isPlayer:l.isPlayer,abilities:l.abilities,onAbilityUse:l.onAbilityUse,onPositionUpdate:k,onHealthChange:e=>{if("function"==typeof e)w(t=>{var r;let n=e(t);return null===(r=l.onHealthChange)||void 0===r||r.call(l,n),n});else{var t;w(e),null===(t=l.onHealthChange)||void 0===t||t.call(l,e)}},enemyData:x.filter(e=>!e.isDying&&e.health>0).map(e=>({id:"enemy-".concat(e.id),position:e.position.clone(),initialPosition:e.initialPosition.clone(),health:e.health,maxHealth:e.maxHealth,type:e.type})),onDamage:l.onDamage,onEnemyDeath:()=>{console.log("Kill counted in Scene")},onFireballDamage:l.onFireballDamage,fireballManagerRef:l.fireballManagerRef,onSmiteDamage:l.onSmiteDamage},[D,_]=(0,s.useState)(0);(0,s.useEffect)(()=>{if(j>=d)return;let e=setInterval(()=>{m<14&&0===D||m<16&&1===D||m<20&&2===D||g(e=>{let t=d-j;if(t<=0)return e;if(1===t){let t=f();return y(e=>e+1),_(e=>e+1),[...e,{id:"abomination-".concat(j),position:t.clone(),initialPosition:t.clone(),health:841,maxHealth:841,isDying:!1,type:"abomination",ref:s.createRef()}]}let r=Math.min(3,t-1),n=Array.from({length:r},(e,t)=>{let n=f();return t===r-1?{id:"mage-".concat(j+t),position:n.clone(),initialPosition:n.clone(),health:289,maxHealth:289,isDying:!1,type:"mage",ref:s.createRef()}:{id:"skeleton-".concat(j+t),position:n.clone(),initialPosition:n.clone(),health:324,maxHealth:324,isDying:!1,type:"regular",ref:s.createRef()}});return y(e=>e+r),_(e=>e+1),[...e,...n]})},h);return()=>clearInterval(e)},[j,d,h,m,D]),(0,s.useEffect)(()=>{a.current&&(a.current.object.position.set(0,12,-18),a.current.target.set(0,0,0),a.current.update())},[a]),(0,s.useEffect)(()=>{g(e=>{let t=Date.now();return e.filter(e=>e.isDying&&e.deathStartTime?t-e.deathStartTime<1500:e.health>0)})},[x]),(0,s.useEffect)(()=>{let e=I.current;return()=>{g([]),e&&e.clear(),F(new o.Pq0(0,0,0)),y(u)}},[u]),(0,s.useEffect)(()=>{let e=[],t=[];return()=>{e.forEach(e=>e.dispose()),t.forEach(e=>e.dispose())}},[]);let A=()=>{g(e=>(e.forEach(e=>{var t,r;(null===(r=e.ref)||void 0===r?void 0:null===(t=r.current)||void 0===t?void 0:t.parent)&&(e.ref.current.parent.remove(e.ref.current),e.ref.current.traverse(e=>{if("geometry"in e&&e.geometry instanceof o.LoY&&e.geometry.dispose(),"material"in e){let t=e.material;Array.isArray(t)?t.forEach(e=>e.dispose()):null==t||t.dispose()}}))}),[]))};return(0,s.useEffect)(()=>A,[]),(0,s.useEffect)(()=>{let e=x.every(e=>e.health<=0),t=j>=d;e&&t&&c()},[x,j,d,c]),(0,s.useEffect)(()=>{console.log("Enemy Data:",x.map(e=>({id:e.id,position:e.position,health:e.health})))},[x]),(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("group",{children:[(0,n.jsx)(eQ,{}),(0,n.jsx)(eU,{}),(0,n.jsx)(eW,{}),(0,n.jsx)(v,{color:"#FFAFC5",roughness:.5,metalness:.1,doodadData:p}),t.map((e,t)=>(0,n.jsx)(P,{position:e.position,scale:e.scale},"mountain-".concat(t))),r.map((e,t)=>(0,n.jsx)(S,{position:e.position,scale:e.scale,trunkColor:e.trunkColor,leafColor:e.leafColor},"tree-".concat(t))),i.map((e,t)=>(0,n.jsx)(b,{position:e.position,scale:e.scale,variant:e.variant},"mushroom-".concat(t))),(0,n.jsx)("group",{ref:I,children:(0,n.jsx)(eE,{...T})}),x.map(e=>"abomination"===e.type?(0,n.jsx)(e9,{id:e.id,initialPosition:e.initialPosition,position:e.position,health:e.health,maxHealth:e.maxHealth,onTakeDamage:E,onPositionUpdate:G,playerPosition:C,onAttackPlayer:R,weaponType:l.currentWeapon},e.id):"mage"===e.type?(0,n.jsx)(e2,{id:e.id,initialPosition:e.initialPosition,position:e.position,health:e.health,maxHealth:e.maxHealth,onTakeDamage:E,onPositionUpdate:G,playerPosition:C,onAttackPlayer:R,weaponType:l.currentWeapon},e.id):(0,n.jsx)(eO,{id:e.id,initialPosition:e.initialPosition,position:e.position,health:e.health,maxHealth:e.maxHealth,onTakeDamage:E,onPositionUpdate:G,playerPosition:C,onAttackPlayer:R,weaponType:l.currentWeapon},e.id))]})})}let tt=()=>(0,n.jsxs)("group",{children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("boxGeometry",{args:[.055,.015,.015]}),(0,n.jsx)("meshStandardMaterial",{color:"#ff0000",transparent:!0,opacity:.35,emissive:"#ff0000",emissiveIntensity:.4})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.0285,6,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#ff0000",emissive:"#ff0000",emissiveIntensity:.9,transparent:!0,opacity:.6})]})]});function tr(e){let{parentRef:t}=e,r=(0,s.useRef)([]),o=(0,s.useRef)(null);return(0,I.F)(e=>{let{clock:n}=e;if(!t.current||!o.current)return;let s=t.current.position;o.current.position.set(s.x,0,s.z),r.current.forEach((e,t)=>{if(!e)return;let r=n.getElapsedTime(),s=t/25*.65,o=t/25*Math.PI*4+2*r,i=.45*(1.1-1.575*s),a=Math.cos(o)*i,l=Math.sin(o)*i;e.position.set(a,s,l),e.rotation.y=o+Math.PI/2,e.rotation.x=Math.PI/6,e.rotation.z=.1*Math.sin(3*r+t);let c=e.children[0];c&&c.material&&(c.material.opacity=Math.max(.1,1-2*s))})}),(0,n.jsxs)("group",{ref:o,children:[Array.from({length:25}).map((e,t)=>(0,n.jsx)("group",{ref:e=>{e&&(r.current[t]=e)},children:tt()},t)),(0,n.jsx)("pointLight",{color:"#ff0000",intensity:1.5,distance:8,decay:2,position:[0,.5,0]})]})}function tn(){let e={roughness:.4,metalness:.3,transparent:!0,opacity:.95};return(0,n.jsx)("group",{children:[-.89,.89].map(t=>(0,n.jsxs)("group",{position:[.56*t,.625,-.75],rotation:[-1.35,0,3.025*t],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.08,.0125,1]}),(0,n.jsx)("meshStandardMaterial",{color:"#d4d4d4",...e})]}),(0,n.jsxs)("group",{position:[0,1.35,-0],scale:1.6,rotation:[-.65,0,0],children:[[-.07,-.02,.02,.07].map((t,r)=>(0,n.jsx)("group",{position:[t,.125,-.15],rotation:[2,0,0],scale:[1,1.5,1.2],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("coneGeometry",{args:[.02,.075,3]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",...e})]})},"upper-".concat(r))),[-.08,-.015,.015,.09].map((t,r)=>(0,n.jsx)("group",{position:[t,.01075,0],rotation:[-.45,0,0],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("coneGeometry",{args:[.025*(0===r||3===r?1.3:1),.095*(0===r||3===r?1.5:1),3]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",...e})]})},"lower-".concat(r)))]}),(0,n.jsxs)("group",{position:[0,.4,.2],rotation:[-.05,0,.3*t],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.08,.008,.8,32,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#c4c4c4",...e})]}),[void 0,void 0,void 0,void 0,void 0].map((r,s)=>(0,n.jsx)("group",{position:[.02*t,.095*s,.07],rotation:[Math.PI/1.5,0,0],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("coneGeometry",{args:[.0325,.1,32,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#b4b4b4",...e})]})},s))]}),(0,n.jsx)("group",{position:[0,1.0225,.3],rotation:[-.925,0,.5*t],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.07,.0075,.6,5]}),(0,n.jsx)("meshStandardMaterial",{color:"#b4b4b4",...e})]})})]},t))})}let ts=e=>{let{parentRef:t}=e,r=(0,s.useRef)(null),i=(0,s.useRef)(new Float32Array(84)),a=(0,s.useRef)(new Float32Array(28)),l=(0,s.useRef)(new Float32Array(28)),c=(0,s.useRef)(0);return(0,I.F)((e,n)=>{var s;if(!(null===(s=r.current)||void 0===s?void 0:s.parent)||!t.current)return;c.current+=n;let o=t.current.position;for(let e=0;e<28;e++){let t=e/28*Math.PI*2+c.current,r=.1*+Math.sin(2*c.current+.2*e);i.current[3*e]=o.x+Math.cos(t)*r,i.current[3*e+1]=o.y+1e-4*Math.sin(c.current+.1*e),i.current[3*e+2]=o.z+Math.sin(t)*r,a.current[e]=.25*Math.pow(1-e/28,1.5),l.current[e]=.4*Math.pow(1-e/28,.6)}if(r.current){let e=r.current.geometry;e.attributes.position.needsUpdate=!0,e.attributes.opacity.needsUpdate=!0,e.attributes.scale.needsUpdate=!0}}),(0,n.jsxs)("points",{ref:r,children:[(0,n.jsxs)("bufferGeometry",{children:[(0,n.jsx)("bufferAttribute",{attach:"attributes-position",count:28,array:i.current,itemSize:3}),(0,n.jsx)("bufferAttribute",{attach:"attributes-opacity",count:28,array:a.current,itemSize:1}),(0,n.jsx)("bufferAttribute",{attach:"attributes-scale",count:28,array:l.current,itemSize:1})]}),(0,n.jsx)("shaderMaterial",{transparent:!0,depthWrite:!1,blending:o.EZo,vertexShader:"\n          attribute float opacity;\n          attribute float scale;\n          varying float vOpacity;\n          void main() {\n            vOpacity = opacity;\n            vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n            gl_Position = projectionMatrix * mvPosition;\n            gl_PointSize = scale * 20.0 * (300.0 / -mvPosition.z);\n          }\n        ",fragmentShader:"\n          varying float vOpacity;\n          void main() {\n            float d = length(gl_PointCoord - vec2(0.5));\n            float strength = smoothstep(0.5, 0.1, d);\n            vec3 glowColor = mix(vec3(0.8, 0.1, 0.1), vec3(1.0, 0.3, 0.3), 0.4);\n            gl_FragColor = vec4(glowColor, vOpacity * strength);\n          }\n        "})]})};function to(e){let{isSwinging:t,onSwingComplete:r}=e,i=(0,s.useRef)(null),a=(0,s.useRef)(0),l=[-1.055,1.1,.35];return(0,I.F)((e,n)=>{if(t&&i.current){a.current+=2.7*n;let e=Math.min(a.current/Math.PI/1.5,1);if(a.current>=.5*Math.PI){a.current=0,i.current.rotation.set(0,0,0),i.current.position.set(...l),r();return}let t=e<=.25?2*e:.5-(e-.25),s=l[0]+-2*Math.sin(t*Math.PI),o=l[1]+-1.2*Math.sin(t*Math.PI),c=l[2]+.9*Math.cos(t*Math.PI);i.current.position.set(s,o,c);let h=Math.PI/4*Math.sin(t*Math.PI),d=Math.PI/2*Math.sin(t*Math.PI),u=Math.PI/4*Math.sin(t*Math.PI);i.current.rotation.set(h,d,u)}else!t&&i.current&&(i.current.rotation.x*=.85,i.current.rotation.y*=.85,i.current.rotation.z*=.85,i.current.position.x+=(l[0]-i.current.position.x)*.2,i.current.position.y+=(l[1]-i.current.position.y)*.2,i.current.position.z+=(l[2]-i.current.position.z)*.2)}),(0,n.jsxs)("group",{ref:i,position:[l[0],l[1],l[2]],rotation:[0,0,Math.PI],scale:[1,1,1],children:[(0,n.jsxs)("group",{position:[0,-.7,0],rotation:[0,0,-Math.PI],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.05,.05,2.5,12]}),(0,n.jsx)("meshStandardMaterial",{color:"#2c1810",roughness:.7,transparent:!0,opacity:.5})]}),[...Array(7)].map((e,t)=>(0,n.jsxs)("mesh",{position:[0,.81-.3*t,0],rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("torusGeometry",{args:[.06,.01,8,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#8B4513",metalness:.3,roughness:.7,transparent:!0,opacity:.5})]},t))]}),(0,n.jsxs)("group",{position:[0,.35,0],rotation:[Math.PI/1,0,Math.PI],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.08,.08,.3,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#2c1810",roughness:.6})]}),(0,n.jsx)("group",{"rotation-x":(0,I.F)(e=>2*e.clock.getElapsedTime()),children:(0,n.jsxs)("mesh",{"position-y":-.075,rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("torusGeometry",{args:[.145,.02,16,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#ff3300",emissive:"#ff3300",emissiveIntensity:1.5,transparent:!0,opacity:.7})]})}),(0,n.jsx)("group",{"rotation-x":(0,I.F)(e=>-(2*e.clock.getElapsedTime())),children:(0,n.jsxs)("mesh",{"position-y":.03,rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("torusGeometry",{args:[.175,.02,16,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#ff0000",emissive:"#ff0000",emissiveIntensity:1.5,transparent:!0,opacity:.7})]})}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.13,.11,.32,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#ff1a1a",emissive:"#ff1a1a",emissiveIntensity:1.5,transparent:!0,opacity:.3})]})]}),(0,n.jsx)("group",{position:[0,.375,1.175],rotation:[-1,-Math.PI/2,Math.PI/2.2],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("extrudeGeometry",{args:[(()=>{let e=new o.ypk;return e.moveTo(0,0),e.lineTo(.15,-.23),e.bezierCurveTo(.8,.22,1.13,.5,1.6,.6),e.lineTo(1.125,.75),e.bezierCurveTo(.5,.2,.225,0,.1,.7),e.lineTo(0,0),e})(),{steps:1,depth:1e-4,bevelEnabled:!0,bevelThickness:.03,bevelSize:.035,bevelSegments:1,curveSegments:16,depth:.03}]}),(0,n.jsx)("meshStandardMaterial",{color:"#ff0000",emissive:"#ff0000",emissiveIntensity:1.25,metalness:.8,roughness:.1,opacity:.5,transparent:!0,side:o.$EB})]})})]})}function ti(e){let{isSwinging:t,onSwingComplete:r}=e,i=(0,s.useRef)(null),a=(0,s.useRef)(0),l=[-1.055,1.1,.35];return(0,I.F)((e,n)=>{if(t&&i.current){a.current+=2.7*n;let e=Math.min(a.current/Math.PI/1.5,1);if(a.current>=.5*Math.PI){a.current=0,i.current.rotation.set(0,0,0),i.current.position.set(...l),r();return}let t=e<=.25?2*e:.5-(e-.25),s=l[0]+2*Math.sin(t*Math.PI),o=l[1]+-1.2*Math.sin(t*Math.PI),c=l[2]+.9*Math.cos(t*Math.PI);i.current.position.set(s,o,c);let h=Math.PI/4*Math.sin(t*Math.PI),d=Math.PI/2*Math.sin(t*Math.PI),u=Math.PI/4*Math.sin(t*Math.PI);i.current.rotation.set(h,d,u)}else!t&&i.current&&(i.current.rotation.x*=.85,i.current.rotation.y*=.85,i.current.rotation.z*=.85,i.current.position.x+=(l[0]-i.current.position.x)*.2,i.current.position.y+=(l[1]-i.current.position.y)*.2,i.current.position.z+=(l[2]-i.current.position.z)*.2)}),(0,n.jsxs)("group",{ref:i,position:[l[0],l[1],l[2]],rotation:[0,0,Math.PI],scale:[1,1,1],children:[(0,n.jsxs)("group",{position:[0,-.7,0],rotation:[0,0,-Math.PI],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.05,.05,2.5,12]}),(0,n.jsx)("meshStandardMaterial",{color:"#2c1810",roughness:.7,transparent:!0,opacity:.5})]}),[...Array(7)].map((e,t)=>(0,n.jsxs)("mesh",{position:[0,.81-.3*t,0],rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("torusGeometry",{args:[.06,.01,8,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#8B4513",metalness:.3,roughness:.7,transparent:!0,opacity:.5})]},t))]}),(0,n.jsxs)("group",{position:[0,.35,0],rotation:[Math.PI/1,0,Math.PI],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.08,.08,.3,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#2c1810",roughness:.6})]}),(0,n.jsx)("group",{"rotation-x":(0,I.F)(e=>2*e.clock.getElapsedTime()),children:(0,n.jsxs)("mesh",{"position-y":-.075,rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("torusGeometry",{args:[.145,.02,16,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#ff3300",emissive:"#ff3300",emissiveIntensity:1.5,transparent:!0,opacity:.7})]})}),(0,n.jsx)("group",{"rotation-x":(0,I.F)(e=>-(2*e.clock.getElapsedTime())),children:(0,n.jsxs)("mesh",{"position-y":.03,rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("torusGeometry",{args:[.175,.02,16,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#ff0000",emissive:"#ff0000",emissiveIntensity:1.5,transparent:!0,opacity:.7})]})}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.13,.11,.32,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#ff1a1a",emissive:"#ff1a1a",emissiveIntensity:1.5,transparent:!0,opacity:.3})]})]}),(0,n.jsx)("group",{position:[0,.375,1.175],rotation:[-1,-Math.PI/2,Math.PI/2.2],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("extrudeGeometry",{args:[(()=>{let e=new o.ypk;return e.moveTo(0,0),e.lineTo(.15,-.23),e.bezierCurveTo(.8,.22,1.13,.5,1.6,.6),e.lineTo(1.125,.75),e.bezierCurveTo(.5,.2,.225,0,.1,.7),e.lineTo(0,0),e})(),{steps:1,depth:1e-4,bevelEnabled:!0,bevelThickness:.03,bevelSize:.035,bevelSegments:1,curveSegments:16,depth:.03}]}),(0,n.jsx)("meshStandardMaterial",{color:"#ff0000",emissive:"#ff0000",emissiveIntensity:1.25,metalness:.8,roughness:.1,opacity:.5,transparent:!0,side:o.$EB})]})})]})}let ta=()=>(0,n.jsxs)("group",{rotation:[Math.PI/3.75,0,0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.04,.04,.7,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",roughness:.4,metalness:.3})]}),(0,n.jsxs)("mesh",{position:new o.Pq0(0,.375,0),rotation:new o.O9p(0,0,Math.PI/3),children:[(0,n.jsx)("sphereGeometry",{args:[.075,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",roughness:.5,metalness:.2})]}),(0,n.jsxs)("mesh",{position:new o.Pq0(0,-.375,0),rotation:new o.O9p(0,0,-Math.PI/3),children:[(0,n.jsx)("sphereGeometry",{args:[.075,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",roughness:.5,metalness:.2})]})]});function tl(e){let{parentRef:t}=e,r=(0,s.useRef)([]),o=(0,s.useRef)(null);return(0,I.F)(()=>{if(!t.current||!o.current)return;let e=t.current.position;o.current.position.set(e.x,.3,e.z),r.current.forEach((e,t)=>{let r=t/18*Math.PI*2+8e-4*Date.now(),n=-(.915*Math.cos(r)),s=.915*Math.sin(r),o=1e-4*Math.sin(.001*Date.now()+t);e.position.set(n,o-.2,s),e.rotation.y=r+Math.PI/3})}),(0,n.jsx)("group",{ref:o,children:Array.from({length:18}).map((e,t)=>(0,n.jsx)("mesh",{ref:e=>{e&&(r.current[t]=e)},children:ta()},t))})}let tc=e=>{let{parentRef:t,offset:r}=e,i=(0,s.useRef)(null),a=(0,s.useRef)(new Float32Array(42)),l=(0,s.useRef)(new Float32Array(14)),c=(0,s.useRef)(new Float32Array(14)),h=(0,s.useRef)(0);return(0,I.F)((e,n)=>{var s;if(!(null===(s=i.current)||void 0===s?void 0:s.parent)||!t.current)return;h.current+=n;let o=r.clone();for(let e=0;e<14;e++){let t=e/14,r=.02*Math.cos(t*Math.PI*.5+h.current),n=.02*Math.sin(h.current+.2*e),s=(1-t)*.8;a.current[3*e]=o.x+r,a.current[3*e+1]=o.y+n,a.current[3*e+2]=o.z-s,l.current[e]=.6*Math.pow(1-t,2),c.current[e]=.12*Math.pow(1-t,1.2)}if(i.current){let e=i.current.geometry;e.attributes.position.needsUpdate=!0,e.attributes.opacity.needsUpdate=!0,e.attributes.scale.needsUpdate=!0}}),(0,n.jsxs)("points",{ref:i,children:[(0,n.jsxs)("bufferGeometry",{children:[(0,n.jsx)("bufferAttribute",{attach:"attributes-position",count:14,array:a.current,itemSize:3}),(0,n.jsx)("bufferAttribute",{attach:"attributes-opacity",count:14,array:l.current,itemSize:1}),(0,n.jsx)("bufferAttribute",{attach:"attributes-scale",count:14,array:c.current,itemSize:1})]}),(0,n.jsx)("shaderMaterial",{transparent:!0,depthWrite:!1,depthTest:!1,blending:o.EZo,side:o.$EB,vertexShader:"\n          attribute float opacity;\n          attribute float scale;\n          varying float vOpacity;\n          void main() {\n            vOpacity = opacity;\n            vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n            gl_Position = projectionMatrix * mvPosition;\n            gl_PointSize = scale * 40.0 * (300.0 / -mvPosition.z);\n          }\n        ",fragmentShader:"\n          varying float vOpacity;\n          void main() {\n            float d = length(gl_PointCoord - vec2(0.5, 0.2)); // More pointed shape\n            float strength = smoothstep(0.5, 0.05, d);\n            vec3 glowColor = mix(vec3(0.8, 0.1, 0.1), vec3(1.0, 0.3, 0.3), 0.4);\n            gl_FragColor = vec4(glowColor, vOpacity * strength);\n          }\n        "})]})};function th(e){let{parentRef:t}=e,r=(0,s.useRef)(null);return(0,I.F)(()=>{if(r.current&&t.current){let e=t.current.position;r.current.position.set(e.x,.015,e.z),r.current.rotation.y+=8e-4}}),(0,n.jsxs)("group",{ref:r,scale:.75,children:["  ",(0,n.jsxs)("mesh",{rotation:[-Math.PI/2,0,0],position:[0,-.2,0],children:[(0,n.jsx)("ringGeometry",{args:[1.2,1.65,16,1]}),(0,n.jsx)("meshStandardMaterial",{color:"#ff0000",emissive:"#ff2200",emissiveIntensity:2,transparent:!0,opacity:.4,depthWrite:!1})]}),(0,n.jsx)("group",{position:[0,-.225,0],children:[...Array(10)].map((e,t)=>(0,n.jsxs)("mesh",{rotation:[-Math.PI/2,0,t/10*Math.PI*2+.001*Date.now()],position:[0,0,0],children:[(0,n.jsx)("circleGeometry",{args:[.1,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#ff0000",emissive:"#ff3300",emissiveIntensity:2.5,transparent:!0,opacity:.5+.3*Math.sin(.002*Date.now()+t),depthWrite:!1})]},t))}),(0,n.jsx)("group",{position:[0,-.25,0],children:[...Array(6)].map((e,t)=>{let r=t/6*Math.PI*2;return(0,n.jsxs)("mesh",{position:[1.4*Math.cos(r+.001*Date.now()),0,1.4*Math.sin(r+.001*Date.now())],rotation:[-Math.PI/2,0,r+Math.PI/2],children:[(0,n.jsx)("circleGeometry",{args:[.8,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#cc0000",emissive:"#ff0000",emissiveIntensity:3,transparent:!0,opacity:.4+.3*Math.sin(.002*Date.now()+.5*t),depthWrite:!1})]},t)})}),(0,n.jsxs)("mesh",{position:[0,.15,0],rotation:[-Math.PI/2,0,0],children:[(0,n.jsx)("ringGeometry",{args:[.3,1.2,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#330000",emissive:"#ff0000",emissiveIntensity:2,transparent:!0,opacity:.6,depthWrite:!1})]})]})}function td(e){let{isAttacking:t}=e,r=(0,s.useRef)(null);return(0,n.jsxs)("group",{ref:r,children:[(0,n.jsx)("group",{scale:[.7,.65,.7],position:[0,2.05,.35],rotation:[.5,0,0],children:(0,n.jsx)(tn,{})}),(0,n.jsx)("group",{scale:[1.45,1.1,1.3],position:[0,1.5,0],rotation:[.35,0,0],children:(0,n.jsx)(H,{})}),(0,n.jsxs)("group",{scale:[1.85,1.55,1.625],position:[0,1.85,0],children:[(0,n.jsxs)("group",{rotation:[0,Math.PI/7,0],children:[(0,n.jsx)(L,{collectedBones:15,isLeftWing:!0,parentRef:r}),(0,n.jsx)(tc,{parentRef:r,offset:new o.Pq0(-.6,.25,-.15)}),(0,n.jsx)(tc,{parentRef:r,offset:new o.Pq0(-.425,-.05,.25)})]}),(0,n.jsxs)("group",{rotation:[0,-Math.PI/7,0],children:[(0,n.jsx)(L,{collectedBones:15,isLeftWing:!1,parentRef:r}),(0,n.jsx)(tc,{parentRef:r,offset:new o.Pq0(.6,.25,-.15)}),(0,n.jsx)(tc,{parentRef:r,offset:new o.Pq0(.425,-.05,.25)})]})]}),(0,n.jsxs)("group",{scale:[.625,.625,.625],position:[0,1.6,0],children:[(0,n.jsx)("group",{position:[-.775,.15,.1],rotation:[0,-(Math.PI/2),0],children:(0,n.jsx)(tu,{})}),(0,n.jsx)("group",{position:[.775,.15,.1],rotation:[0,-Math.PI/6,0],children:(0,n.jsx)(tu,{})})]}),(0,n.jsx)("group",{scale:[1.5,1.5,1.5],position:[0,1.7,.16],children:(0,n.jsx)(U,{})}),(0,n.jsx)("group",{position:[0,1.4,0],scale:[1.25,1.25,1.25],children:(0,n.jsx)(ts,{parentRef:r})}),(0,n.jsx)("group",{position:[0,2.15,.275],scale:[.525,.525,.525],children:(0,n.jsx)(ts,{parentRef:r})}),(0,n.jsxs)("group",{scale:[2.1,2.25,2.1],position:[0,-.325,0],children:[(0,n.jsx)("group",{position:[0,0,.11],rotation:[0,0,0],children:(0,n.jsx)(tr,{parentRef:r})}),(0,n.jsx)("group",{position:[0,0,-.11],rotation:[0,Math.PI,0],children:(0,n.jsx)(tr,{parentRef:r})}),(0,n.jsx)("group",{position:[.11,0,0],rotation:[0,Math.PI/2,0],children:(0,n.jsx)(tr,{parentRef:r})}),(0,n.jsx)("group",{position:[-.11,0,0],rotation:[0,-Math.PI/2,0],children:(0,n.jsx)(tr,{parentRef:r})})]}),(0,n.jsx)("group",{position:[.5,2.6,.2],rotation:[Math.PI/3+.2,1+Math.PI+1.15,1.45],scale:[.6,.6,.6],children:(0,n.jsx)(ti,{isSwinging:t,onSwingComplete:()=>{},parentRef:r})}),(0,n.jsx)("group",{position:[-.5,2.31,-1],rotation:[Math.PI/3+.2,-(1+Math.PI+1.15),-1.45],scale:[.6,.6,.6],children:(0,n.jsx)(to,{isSwinging:t,onSwingComplete:()=>{},parentRef:r})}),(0,n.jsx)("group",{position:[0,0,0],children:(0,n.jsx)(tl,{parentRef:r})}),(0,n.jsx)("group",{position:[0,0,0],children:(0,n.jsx)(th,{parentRef:r})})]})}function tu(){let e=(e,t)=>(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[t,.8*t,e,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),t=e=>(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[e,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),r=(r,s)=>(0,n.jsxs)("group",{children:[(0,n.jsx)("group",{position:[s/2,0,0],children:e(r,.06)}),(0,n.jsx)("group",{position:[-s/2,0,0],children:e(r,.06)}),(0,n.jsx)("group",{position:[0,r/2,0],children:t(.17)}),(0,n.jsx)("group",{position:[0,-r/2,0],children:t(.075)})]}),s=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return(0,n.jsxs)("group",{scale:[e,e,e],children:[(0,n.jsxs)("mesh",{position:[0,0,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.06,.02,.12,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("mesh",{position:[0,.1,.02],rotation:[.05,0,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.025,.025,.12,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("mesh",{position:[0,.2,.04],rotation:[.1,0,0],children:[(0,n.jsx)("coneGeometry",{args:[.03,.15,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#d4d4d4",roughness:.3,metalness:.5})]}),[0,Math.PI/4,1*Math.PI/2,Math.PI,3*Math.PI/2,5*Math.PI/4].map((e,t)=>(0,n.jsx)("group",{rotation:[0,e,0],children:(0,n.jsxs)("mesh",{position:[.04,.05,0],children:[(0,n.jsx)("boxGeometry",{args:[.01,.12,.02]}),(0,n.jsx)("meshStandardMaterial",{color:"#d4d4d4",roughness:.5,metalness:.3})]})},t))]})};return(0,n.jsx)("group",{children:(0,n.jsxs)("group",{children:[r(1,.15),(0,n.jsx)("group",{position:[0,.7,0],rotation:[-1,1,1],scale:.5,children:[-.03,-.01,0,.01,.03].map((e,t)=>(0,n.jsx)("group",{position:[e,-.275,-.15],rotation:[.4,0,(t-2)*Math.PI/6],children:(0,n.jsxs)("group",{position:[0,.4,0],scale:[1.35,1.35,1.35],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.075,.5,.2,4,1,!1,0,2*Math.PI]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("group",{position:[0,.25,0],children:[(0,n.jsx)("group",{position:[0,0,0],rotation:[0,0,0],children:s(2)}),(0,n.jsx)("group",{position:[0,-.05,.15],rotation:[-.1,0,0],children:s(.9)}),(0,n.jsx)("group",{position:[0,-.05,-.15],rotation:[.1,0,0],children:s(.9)}),(0,n.jsx)("group",{position:[0,-.1,.25],rotation:[-.2,0,0],children:s(.7)}),(0,n.jsx)("group",{position:[0,-.1,-.25],rotation:[.2,0,0],children:s(.7)})]})]})},t))}),(0,n.jsxs)("group",{position:[.25,-.85,.21],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.12,12,12]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("group",{rotation:[-.7,-0,Math.PI/5],children:[r(.8,.12),(0,n.jsxs)("group",{position:[0,-.5,0],rotation:[0,0,Math.PI/5.5],children:[t(.09),(0,n.jsxs)("group",{position:[0,-.1,0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("boxGeometry",{args:[.2,.15,.08]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4})]}),[-.08,-.04,0,.04,.08].map((t,r)=>(0,n.jsxs)("group",{position:[t,-.1,0],rotation:[0,0,(r-2)*Math.PI/10],children:[e(.5,.02),(0,n.jsx)("group",{position:[.025,-.3,0],rotation:[0,0,Math.PI+Math.PI/16],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("coneGeometry",{args:[.03,.3,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#d4d4d4",roughness:.3,metalness:.4})]})})]},r))]})]})]})]})]})})}function tm(e){let{color:t,size:r,meshRef:i}=e,a=(0,s.useRef)(null),l=(0,s.useRef)(new Float32Array(60)),c=(0,s.useRef)(new Float32Array(20)),h=(0,s.useRef)(new Float32Array(20)),d=(0,s.useRef)(!1);return(0,s.useEffect)(()=>{if(i.current&&!d.current){let e=i.current.position;for(let t=0;t<20;t++)l.current[3*t]=e.x,l.current[3*t+1]=e.y,l.current[3*t+2]=e.z,c.current[t]=0,h.current[t]=0;d.current=!0}},[i]),(0,I.F)(()=>{var e;if(!(null===(e=a.current)||void 0===e?void 0:e.parent)||!i.current||!d.current)return;let t=i.current.position;for(let e=19;e>0;e--)l.current[3*e]=l.current[(e-1)*3],l.current[3*e+1]=l.current[(e-1)*3+1]+.5,l.current[3*e+2]=l.current[(e-1)*3+2],c.current[e]=.9*Math.pow(1-e/20,.3),h.current[e]=r*(2-e/20*.5);if(l.current[0]=t.x,l.current[1]=t.y,l.current[2]=t.z,c.current[0]=.9,h.current[0]=8*r,a.current){let e=a.current.geometry;e.attributes.position.array=l.current,e.attributes.position.needsUpdate=!0,e.attributes.opacity&&(e.attributes.opacity.array=c.current,e.attributes.opacity.needsUpdate=!0),e.attributes.scale&&(e.attributes.scale.array=h.current,e.attributes.scale.needsUpdate=!0)}}),(0,n.jsxs)("points",{ref:a,children:[(0,n.jsxs)("bufferGeometry",{children:[(0,n.jsx)("bufferAttribute",{attach:"attributes-position",count:20,array:l.current,itemSize:3}),(0,n.jsx)("bufferAttribute",{attach:"attributes-opacity",count:20,array:c.current,itemSize:1}),(0,n.jsx)("bufferAttribute",{attach:"attributes-scale",count:20,array:h.current,itemSize:1})]}),(0,n.jsx)("shaderMaterial",{transparent:!0,depthWrite:!1,blending:o.EZo,vertexShader:"\n          attribute float opacity;\n          attribute float scale;\n          varying float vOpacity;\n          void main() {\n            vOpacity = opacity;\n            vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n            gl_Position = projectionMatrix * mvPosition;\n            gl_PointSize = scale * 45.0 * (300.0 / -mvPosition.z);\n          }\n        ",fragmentShader:"\n          varying float vOpacity;\n          uniform vec3 uColor;\n          void main() {\n            float d = length(gl_PointCoord - vec2(0.5));\n            float strength = smoothstep(0.5, 0.1, d);\n            vec3 glowColor = mix(uColor, vec3(1.0), 0.4);\n            gl_FragColor = vec4(glowColor, vOpacity * strength);\n          }\n        ",uniforms:{uColor:{value:t}}})]})}let tp=(e,t,r)=>{let s=(Date.now()-t)/1e3,i=Math.max(0,1-s/2);return i<=0?(r(),null):(0,n.jsxs)("group",{position:e,children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[1.2*(2+s),32,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#ff2200",emissive:"#ff4400",emissiveIntensity:2*i,transparent:!0,opacity:1.8*i,depthWrite:!1,blending:o.EZo})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[1,24,24]}),(0,n.jsx)("meshStandardMaterial",{color:"#ff8800",emissive:"#ffffff",emissiveIntensity:2*i,transparent:!0,opacity:1.9*i,depthWrite:!1,blending:o.EZo})]}),[2,2.15,2.3,2.5,2.7].map((e,t)=>(0,n.jsxs)("mesh",{rotation:[Math.random()*Math.PI,Math.random()*Math.PI,Math.random()*Math.PI],children:[(0,n.jsx)("torusGeometry",{args:[e*(1.325+2*s),.225,4,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#ff2200",emissive:"#ff4400",emissiveIntensity:.7*i,transparent:!0,opacity:.95*i*(1-.1*t),depthWrite:!1,blending:o.EZo})]},t)),(0,n.jsx)("pointLight",{color:"#ff2200",intensity:.8*i,distance:8*(1+s),decay:2}),(0,n.jsx)("pointLight",{color:"#ff8800",intensity:.8*i,distance:12,decay:1})]})};function tx(e){var t;let{targetPosition:r,onImpact:i,onComplete:a,playerPosition:l}=e,c=(0,s.useRef)(null),h=(0,s.useRef)(null),d=(0,s.useRef)(new o.Pq0(r.x,-5,r.z)),u=(0,s.useRef)(new o.Pq0(r.x,60,r.z)),[m,p]=(0,s.useState)(!1),[x,f]=(0,s.useState)(!1),g=(0,s.useRef)(null),[j,y]=(0,s.useState)(null),M=(0,s.useRef)(new o.Pq0().subVectors(d.current,u.current).normalize());return(0,s.useEffect)(()=>{let e=setTimeout(()=>{f(!0)},1090);return()=>clearTimeout(e)},[]),(0,I.F)((e,t)=>{if(!c.current||!x||m){m&&!j&&y(Date.now());return}let r=c.current.position;(2.95>r.distanceTo(d.current)||r.y<=.1)&&(p(!0),y(Date.now()),2.95>=new o.Pq0(l.x,0,l.z).distanceTo(new o.Pq0(d.current.x,0,d.current.z))&&i(72)),r.addScaledVector(M.current,27.75*t)}),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("group",{position:[d.current.x,.1,d.current.z],children:[(0,n.jsxs)("mesh",{ref:g,rotation:[-Math.PI/2,0,0],children:[(0,n.jsx)("ringGeometry",{args:[2.75,2.95,64]}),(0,n.jsx)("meshBasicMaterial",{color:"#ff2200",transparent:!0,opacity:.4,side:o.$EB})]}),(0,n.jsxs)("mesh",{rotation:[-Math.PI/2,0,0],scale:[1+.2*Math.sin(.005*Date.now()),1+.2*Math.sin(.005*Date.now()),1],children:[(0,n.jsx)("ringGeometry",{args:[2.95-.8,2.35,64]}),(0,n.jsx)("meshBasicMaterial",{color:"#ff4400",transparent:!0,opacity:.4+.2*Math.sin(.003*Date.now()),side:o.$EB})]}),(0,n.jsxs)("mesh",{rotation:[-Math.PI/2,.0035*Date.now(),0],children:[(0,n.jsx)("ringGeometry",{args:[2.7,2.95,64]}),(0,n.jsx)("meshBasicMaterial",{color:"#ff3300",transparent:!0,opacity:.25,side:o.$EB})]}),[...Array(15)].map((e,t)=>(0,n.jsxs)("mesh",{position:[2.45*Math.sin(.001*Date.now()+t),.5*Math.sin(.002*Date.now()+t),2.45*Math.cos(.001*Date.now()+t)],children:[(0,n.jsx)("sphereGeometry",{args:[.1,8,8]}),(0,n.jsx)("meshBasicMaterial",{color:"#ff3300",transparent:!0,opacity:.3+.2*Math.sin(.004*Date.now()+t)})]},t))]}),x&&(0,n.jsx)("group",{ref:c,position:u.current,children:(0,n.jsxs)("mesh",{ref:h,children:[(0,n.jsx)("sphereGeometry",{args:[.75,16,16]}),(0,n.jsx)("meshBasicMaterial",{color:"#ff4400"}),(0,n.jsx)("pointLight",{color:"#ff4400",intensity:5,distance:8}),(0,n.jsx)(tm,{meshRef:h,color:new o.Q1f("#ff4400"),size:.09})]})}),j&&tp((null===(t=c.current)||void 0===t?void 0:t.position)||d.current,j,a)]})}function tf(e){let{position:t,duration:r,range:i}=e,a=(0,s.useRef)(null),l=(0,s.useRef)(Date.now());return(0,I.F)(()=>{if(!a.current)return;let e=(Date.now()-l.current)/1e3,t=Math.min(e/r,1),n=1+.15*Math.sin(8*e);a.current.scale.setScalar(n),t>.7&&(a.current.material.opacity=.6*(1-(t-.7)/.3))}),(0,n.jsxs)("group",{position:[t.x,.5,t.z],children:[(0,n.jsxs)("mesh",{ref:a,rotation:[-Math.PI/2,0,0],children:[(0,n.jsx)("ringGeometry",{args:[i-.2,i,64]}),(0,n.jsx)("meshBasicMaterial",{color:"#ff3300",transparent:!0,opacity:.6,side:o.$EB})]}),(0,n.jsxs)("mesh",{rotation:[-Math.PI/2,0,0],children:[(0,n.jsx)("ringGeometry",{args:[i-.8,i-.6,64]}),(0,n.jsx)("meshBasicMaterial",{color:"#ff4400",transparent:!0,opacity:.2,side:o.$EB})]})]})}function tg(e){let{id:t,initialPosition:r,position:i,health:a,maxHealth:l,onTakeDamage:c,onPositionUpdate:h,playerPosition:d,onAttackPlayer:u,onEnrageSpawn:m}=e,p=(0,s.useRef)(null),x=(0,s.useRef)(Date.now()+2e3),f=(0,s.useRef)(Date.now()),g=(0,s.useRef)(r.clone()),j=(0,s.useRef)(d.clone()),y=(0,s.useRef)(a),[M,v]=(0,s.useState)(!1),[P,w]=(0,s.useState)(!1),[S,b]=(0,s.useState)(!0),[C,F]=(0,s.useState)(!1),[E,R]=(0,s.useState)(!1),[k,G]=(0,s.useState)(!1),T=(0,s.useRef)(3500),D=(0,s.useRef)(7500);(0,s.useEffect)(()=>{j.current.copy(d)},[d]),(0,s.useEffect)(()=>{i&&(g.current.copy(i),p.current&&p.current.position.copy(g.current))},[i]),(0,s.useEffect)(()=>{y.current=a},[a]),(0,s.useEffect)(()=>{let e=a<=l/2,t=3500===T.current;e&&t&&(null==m||m()),T.current=e?2500:3500,D.current=e?4750:7500},[a,l,m]),(0,s.useEffect)(()=>{let e=setTimeout(()=>{b(!1)},2e3);return()=>clearTimeout(e)},[]),(0,s.useEffect)(()=>{0!==a||P||(console.log("Boss ".concat(t," died")),w(!0))},[a,t,P]);let _=(0,s.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=g.current;return!(new o.Pq0(r.x-e.x,0,r.z-e.z).length()>4)&&4>=Math.abs(e.y+t-(r.y+2))},[]),z=(0,s.useCallback)((e,r)=>{!(y.current<=0)&&r&&_(r)&&(c("enemy-".concat(t),e),0===Math.max(0,y.current-e)&&y.current>0&&w(!0))},[t,c,_]),q=(0,s.useCallback)(()=>{M||k||Date.now()-x.current<T.current||(R(!0),x.current=Date.now(),G(!0),setTimeout(()=>{R(!1),v(!0),setTimeout(()=>{let e=g.current.clone();e.y=0;let t=j.current.clone();t.y=0,5>=e.distanceTo(t)&&u(24)},270),setTimeout(()=>{v(!1),setTimeout(()=>{G(!1)},T.current)},540)},1500))},[M,k,u,24,5]),B=(0,s.useCallback)(()=>{!C&&Date.now()-f.current>=D.current&&(F(!0),f.current=Date.now(),setTimeout(()=>{F(!1)},3500))},[C]);return(0,I.F)(()=>{if(!p.current||a<=0)return;let e=g.current.distanceTo(j.current);if(!C&&Date.now()-f.current>=D.current&&B(),e>3&&a>0){v(!1);let e=new o.Pq0().subVectors(j.current,g.current).normalize(),r=g.current.clone().add(e.multiplyScalar(.2));g.current.lerp(r,.2),p.current.position.copy(g.current);let n=j.current.clone();n.y=g.current.y;let s=new o.Pq0().subVectors(n,g.current).normalize(),a=Math.atan2(s.x,s.z);p.current.rotation.y=a,g.current.distanceTo(i)>.01&&h(t,g.current.clone())}else Date.now()-x.current>=T.current&&(q(),x.current=Date.now())}),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("group",{ref:p,visible:!S&&a>0,position:g.current,scale:[1.625,1.625,1.625],onClick:e=>e.stopPropagation(),children:[(0,n.jsx)(td,{isAttacking:M,isWalking:!M&&a>0,onHit:z,playerPosition:d}),(0,n.jsx)(eR.Q,{position:[0,5,0],follow:!0,lockX:!1,lockY:!1,lockZ:!1,children:y.current>0&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("mesh",{position:[0,0,0],children:[(0,n.jsx)("planeGeometry",{args:[4,.4]}),(0,n.jsx)("meshBasicMaterial",{color:"#333333",opacity:.8,transparent:!0})]}),(0,n.jsxs)("mesh",{position:[-2+y.current/l*2,0,.001],children:[(0,n.jsx)("planeGeometry",{args:[y.current/l*4,.35]}),(0,n.jsx)("meshBasicMaterial",{color:"#ff0000",opacity:.9,transparent:!0})]}),(0,n.jsx)(A.E,{position:[0,0,.002],fontSize:.3,color:"#ffffff",anchorX:"center",anchorY:"middle",fontWeight:"bold",children:"".concat(Math.ceil(y.current),"/").concat(l)})]})})]}),C&&(0,n.jsx)(tx,{targetPosition:j.current,onImpact:e=>u(e),onComplete:()=>F(!1),playerPosition:j.current}),E&&(0,n.jsx)(tf,{position:g.current,duration:1,range:5})]})}let tj=e=>{let{position:t,scale:r=1}=e;return(0,n.jsxs)("group",{position:t,scale:r,children:[(0,n.jsxs)("mesh",{position:[0,.1,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.02,.02,.8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#8783D1"})]}),[0,72,144,216,288].map((e,t)=>(0,n.jsxs)("mesh",{position:[0,.3,0],rotation:[.3,e*Math.PI/180,0],children:[(0,n.jsx)("sphereGeometry",{args:[.12,8,8,0,2*Math.PI,0,Math.PI/2]}),(0,n.jsx)("meshStandardMaterial",{color:"#8783D1",emissive:"#8783D1",emissiveIntensity:.5})]},t)),(0,n.jsxs)("mesh",{position:[0,.425,0],children:[(0,n.jsx)("sphereGeometry",{args:[.08,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffeb3b",emissive:"#ff8800",emissiveIntensity:.35})]})]})},ty=new o.Pq0(0,0,0);function tM(e){let{mountainData:t,treeData:r,mushroomData:i,unitProps:a,skeletonProps:l,killCount:c,boneDoodadData:h,onLevelComplete:d,spawnInterval:u=3e3,maxSkeletons:m=23,initialSkeletons:p=5,flowerData:x}=e,[g,j]=(0,s.useState)(!1),[y,M]=(0,s.useState)(p||5),[w,I]=(0,s.useState)(()=>l.map((e,t)=>({id:"skeleton-".concat(t),position:e.initialPosition.clone(),initialPosition:e.initialPosition.clone(),currentPosition:e.initialPosition.clone(),health:361,maxHealth:361}))),[C,F]=(0,s.useState)(a.health),E=(0,s.useRef)(null),[R,k]=(0,s.useState)(new o.Pq0(0,0,0)),[G,T]=(0,s.useState)(!1),[D,_]=(0,s.useState)(6084),[A,z]=(0,s.useState)(ty.clone()),[q,B]=(0,s.useState)(0),L=(0,s.useCallback)((e,t)=>{if(e.includes("boss")){_(Math.max(0,D-t));return}I(r=>{let n=[...r],s=n.findIndex(t=>t.id===e.replace("enemy-",""));if(-1!==s){let e=Math.max(0,n[s].health-t);if(0===e&&n[s].health>0){var o;n[s]={...n[s],health:e,isDying:!0,deathStartTime:Date.now()},null===(o=a.onEnemyDeath)||void 0===o||o.call(a)}else n[s]={...n[s],health:e}}return n})},[D,a]),O=(0,s.useCallback)(e=>{var t;null===(t=a.onDamage)||void 0===t||t.call(a,e)},[a]),W=(0,s.useCallback)(e=>{k(e)},[]),H=(0,s.useCallback)((e,t)=>{if(e.includes("boss")){z(t.clone());return}I(r=>r.map(r=>r.id===e.replace("enemy-","")?{...r,position:t.clone()}:r))},[]),U={onHit:L,controlsRef:a.controlsRef,currentWeapon:a.currentWeapon,onWeaponSelect:a.onWeaponSelect,health:C,maxHealth:a.maxHealth,isPlayer:a.isPlayer,abilities:a.abilities,onAbilityUse:a.onAbilityUse,onPositionUpdate:W,onHealthChange:e=>{if("function"==typeof e)F(t=>{var r;let n=e(t);return null===(r=a.onHealthChange)||void 0===r||r.call(a,n),n});else{var t;F(e),null===(t=a.onHealthChange)||void 0===t||t.call(a,e)}},enemyData:[...w.map(e=>({id:"enemy-".concat(e.id),position:e.position,initialPosition:e.initialPosition,health:e.health,maxHealth:e.maxHealth})),...G&&D>0?[{id:"enemy-boss-1",position:A,initialPosition:ty,health:D,maxHealth:6084}]:[]],onDamage:a.onDamage,onEnemyDeath:()=>{console.log("Kill counted in Scene")},onFireballDamage:a.onFireballDamage,fireballManagerRef:a.fireballManagerRef,onSmiteDamage:a.onSmiteDamage};(0,s.useEffect)(()=>{let e=w.every(e=>e.health<=0),t=g&&y>p;e&&t&&c>=50&&!G&&T(!0),G&&D<=0&&d()},[w,c,d,g,y,p,G,D]),(0,s.useEffect)(()=>{let e=setTimeout(()=>{j(!0)},50);return()=>clearTimeout(e)},[]),(0,s.useEffect)(()=>{if(y>=m)return;let e=setInterval(()=>{c<33||I(e=>{let t=m-y;if(t<=0)return e;if((c>=36&&0===q||c>=41&&1===q||c>=46&&2===q)&&q<3){let t=f();return M(e=>e+1),B(e=>e+1),[...e,{id:"abomination-".concat(y),position:t.clone(),initialPosition:t.clone(),health:961,maxHealth:961,isDying:!1,type:"abomination",ref:s.createRef()}]}let r=Math.min(3,t),n=Array.from({length:r},(e,t)=>{let n=f();return t===r-1?{id:"mage-".concat(y+t),position:n.clone(),initialPosition:n.clone(),health:324,maxHealth:324,isDying:!1,type:"mage",ref:s.createRef()}:{id:"skeleton-".concat(y+t),position:n.clone(),initialPosition:n.clone(),health:361,maxHealth:361,isDying:!1,type:"regular",ref:s.createRef()}});return M(e=>e+r),[...e,...n]})},u);return()=>clearInterval(e)},[y,m,u,q,c]),(0,s.useEffect)(()=>{a.controlsRef.current&&(a.controlsRef.current.object.position.set(0,12,-18),a.controlsRef.current.target.set(0,0,0),a.controlsRef.current.update())},[a.controlsRef]),(0,s.useEffect)(()=>{I(e=>{let t=Date.now();return e.filter(e=>e.isDying&&e.deathStartTime?t-e.deathStartTime<1500:e.health>0)})},[w]);let N=()=>{I(e=>(e.forEach(e=>{var t,r;(null===(r=e.ref)||void 0===r?void 0:null===(t=r.current)||void 0===t?void 0:t.parent)&&(e.ref.current.parent.remove(e.ref.current),e.ref.current.traverse(e=>{if("geometry"in e&&e.geometry instanceof o.LoY&&e.geometry.dispose(),"material"in e){let t=e.material;Array.isArray(t)?t.forEach(e=>e.dispose()):null==t||t.dispose()}}))}),[]))};return(0,s.useEffect)(()=>{let e=E.current;return()=>{I([]),e&&e.clear(),k(new o.Pq0(0,0,0)),M(p),z(ty.clone()),T(!1),_(6084)}},[p]),(0,s.useEffect)(()=>{let e=[],t=[];return()=>{e.forEach(e=>e.dispose()),t.forEach(e=>e.dispose())}},[]),(0,s.useEffect)(()=>N,[]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(eQ,{}),(0,n.jsx)(eU,{}),(0,n.jsx)(eW,{}),(0,n.jsx)(v,{color:"#FFAFC5",roughness:.9,metalness:.1,doodadData:h}),t.map((e,t)=>(0,n.jsx)(P,{position:e.position,scale:e.scale},"mountain-".concat(t))),r.map((e,t)=>(0,n.jsx)(S,{position:e.position,scale:e.scale,trunkColor:e.trunkColor,leafColor:e.leafColor},"tree-".concat(t))),i.map((e,t)=>(0,n.jsx)(b,{position:e.position,scale:e.scale,variant:e.variant},"mushroom-".concat(t))),x.map((e,t)=>(0,n.jsx)(tj,{position:e.position,scale:e.scale},"flower-".concat(t))),(0,n.jsx)("group",{ref:E,children:(0,n.jsx)(eE,{...U})}),w.map(e=>"abomination"===e.type?(0,n.jsx)(e9,{id:e.id,initialPosition:e.initialPosition,position:e.position,health:e.health,maxHealth:e.maxHealth,onTakeDamage:L,onPositionUpdate:H,playerPosition:R,onAttackPlayer:O,weaponType:a.currentWeapon},e.id):"mage"===e.type?(0,n.jsx)(e2,{id:e.id,initialPosition:e.initialPosition,position:e.position,health:e.health,maxHealth:e.maxHealth,onTakeDamage:L,onPositionUpdate:H,playerPosition:R,onAttackPlayer:O,weaponType:a.currentWeapon},e.id):(0,n.jsx)(eO,{id:e.id,initialPosition:e.initialPosition,position:e.position,health:e.health,maxHealth:e.maxHealth,onTakeDamage:L,onPositionUpdate:H,playerPosition:R,onAttackPlayer:O,weaponType:a.currentWeapon},e.id)),G&&(0,n.jsx)(tg,{id:"boss-1",initialPosition:ty,position:ty,health:D,maxHealth:6084,onTakeDamage:(e,t)=>{_(e=>Math.max(0,e-t))},onPositionUpdate:H,playerPosition:R,onAttackPlayer:O,onEnrageSpawn:()=>{let e=f();I(t=>[...t,{id:"abomination-enraged-".concat(Date.now()),position:e.clone(),initialPosition:e.clone(),health:1024,maxHealth:1024,isDying:!1,type:"abomination",ref:s.createRef()}])}},"boss-1")]})}function tv(e){let{sceneProps:t,onLevelTransition:r,currentLevel:o,onAbilityUnlock:i}=e,[a,l]=(0,s.useState)(!1),[c,h]=(0,s.useState)(!1),[d,u]=(0,s.useState)(!1),m=(0,s.useCallback)(()=>{if(d)return;let e=t.killCount||0;console.log("Checking level completion conditions:"),console.log("Level 1 condition: killCount >= 13 && currentLevel === 1: ".concat(e>=13&&1===o)),console.log("Level 2 condition: killCount >= 30 && currentLevel === 2: ".concat(e>=30&&2===o)),console.log("Level 3 condition: killCount >= 53 && currentLevel === 3: ".concat(e>=53&&3===o)),e>=13&&1===o?(console.log("Level 1 completion triggered"),r(1,!0),u(!0)):e>=30&&2===o?(console.log("Level 2 completion triggered"),r(2,!0),u(!0)):3===o&&e>=53&&(console.log("Level 3 completion triggered"),r(3,!1),u(!0))},[o,r,t.killCount,d]);return(0,s.useEffect)(()=>{console.log("Kill count changed: ".concat(t.killCount))},[t.killCount]),(0,s.useEffect)(()=>{2===o?(l(!0),h(!1)):3===o?(l(!1),h(!0)):(l(!1),h(!1)),u(!1)},[o]),(0,n.jsxs)(n.Fragment,{children:[!a&&!c&&(0,n.jsx)(eY,{...t,onLevelComplete:m,onAbilityUnlock:i,spawnInterval:1e3,maxSkeletons:13,initialSkeletons:4}),a&&!c&&(0,n.jsx)(te,{...t,onLevelComplete:m,onAbilityUnlock:i,spawnInterval:1e3,maxSkeletons:17,initialSkeletons:5,spawnCount:3}),c&&(0,n.jsx)(tM,{...t,onLevelComplete:m,onAbilityUnlock:i,spawnInterval:5500,maxSkeletons:23,initialSkeletons:5,spawnCount:4})]})}var tP=r(5019),tw=r.n(tP),tS=r(9965),tI=r.n(tS),tb=r(5831),tC=r.n(tb);function tF(e){let{damage:t,index:r,onComplete:o,timestamp:i}=e,[a,l]=(0,s.useState)(!0);(0,s.useEffect)(()=>{let e=setTimeout(()=>{l(!1),setTimeout(o,300)},1e3),t=setTimeout(()=>{o()},2e3);return()=>{clearTimeout(e),clearTimeout(t)}},[o]);let c=Math.max(0,1-(Date.now()-i)/1e3);return(0,n.jsxs)("div",{className:"".concat(tC().notification," ").concat(a?tC().visible:tC().hidden),style:{transform:"translateY(".concat(-20-25*r,"px)"),opacity:c},children:["-",t]})}var tE=r(5190),tR=r.n(tE);function tk(e){let{content:t,visible:r,x:s,y:o}=e;return r?(0,n.jsxs)("div",{className:tR().tooltip,style:{left:"".concat(s,"px"),top:"".concat(o,"px")},children:[(0,n.jsx)("h3",{children:t.title}),t.description.split("\n").map((e,t)=>(0,n.jsx)("p",{children:e},t))]}):null}let tG=e=>{let{size:t,strokeWidth:r,percentage:s,borderRadius:o}=e,i=r/2,a=t-r,l=4*a;return(0,n.jsx)("svg",{width:t,height:t,className:tw().roundedSquareProgress,children:(0,n.jsx)("rect",{x:i,y:i,width:a,height:a,rx:o,ry:o,stroke:"#39ff14",strokeWidth:r,fill:"none",strokeDasharray:l,strokeDashoffset:l-l*s/100,className:tw().progressForeground})})};function tT(e){let{currentWeapon:t,playerHealth:r,maxHealth:o,abilities:a,killCount:l,activeEffects:c}=e,[d,u]=(0,s.useState)([]),m=(0,s.useRef)(0),p=(0,s.useRef)(r),[x,f]=(0,s.useState)(null),[g,j]=(0,s.useState)({x:0,y:0});(0,s.useEffect)(()=>{if(r<p.current){let e=p.current-r;u(t=>[...t,{id:m.current++,damage:e,timestamp:Date.now()}].slice(-3))}p.current=r},[r]);let y=e=>{u(t=>t.filter(t=>t.id!==e))},M=e=>e<13?1:e<30?2:3,v=(e,r)=>{let n=h[t][r],s=e.currentTarget.getBoundingClientRect();f(n),j({x:s.left+s.width/2,y:s.top})},P=()=>{f(null)};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:tw().leftPanel,children:[(0,n.jsxs)("div",{className:tw().controlsSection,children:[(0,n.jsxs)("div",{className:tw().controlGroup,children:[(0,n.jsx)("div",{className:tw().controlKey,children:"W"}),(0,n.jsx)("div",{className:tw().controlKey,children:"A"}),(0,n.jsx)("div",{className:tw().controlKey,children:"S"}),(0,n.jsx)("div",{className:tw().controlKey,children:"D"}),(0,n.jsx)("div",{className:tw().controlLabel,children:"Move"})]}),(0,n.jsx)("div",{className:tw().controlDivider}),(0,n.jsxs)("div",{className:tw().controlGroup,children:[(0,n.jsx)("div",{className:tw().controlLabel,children:"Zoom"}),(0,n.jsx)("div",{className:tw().controlKey,children:"Scroll Wheel"})]})]}),(0,n.jsxs)("div",{className:tw().controlsSection,children:[(0,n.jsxs)("div",{className:tw().controlGroup,children:[(0,n.jsx)("div",{className:tw().controlKey,children:"L-Click Hold"}),(0,n.jsx)("div",{className:tw().controlLabel,children:"Auto Attack"})]}),(0,n.jsx)("div",{className:tw().controlDivider}),(0,n.jsxs)("div",{className:tw().controlGroup,children:[(0,n.jsx)("div",{className:tw().controlLabel,children:"Camera"}),(0,n.jsx)("div",{className:tw().controlKey,children:"R-Click Hold"})]})]})]}),(0,n.jsxs)("div",{className:tw().bottomPanel,children:[a[t]&&(0,n.jsx)("div",{className:tw().abilitiesSection,children:Object.entries(a[t]).map(e=>{let[r,s]=e;return(0,n.jsxs)("div",{className:"".concat(tw().ability," ").concat(s.isUnlocked?"":tw().locked),onMouseEnter:e=>v(e,r),onMouseLeave:P,children:[(0,n.jsx)("div",{className:tw().keyBind,children:s.key.toUpperCase()}),(0,n.jsx)(tI(),{src:s.icon,alt:"".concat(r," ability"),width:40,height:40,className:tw().abilityIcon}),"active"===r&&t===i.SCYTHE&&a[i.SCYTHE].active.isUnlocked&&a[i.SCYTHE].active.currentCooldown<=0&&(null==c?void 0:c.some(e=>"summon"===e.type))?(0,n.jsx)("div",{className:tw().activeOverlay,children:(0,n.jsx)("div",{className:tw().activeIndicator})}):s.currentCooldown>0&&(0,n.jsxs)("div",{className:tw().cooldownOverlay,children:[(0,n.jsx)(tG,{size:50,strokeWidth:4,percentage:s.currentCooldown/s.cooldown*100,borderRadius:8}),(0,n.jsx)("span",{className:tw().cooldownText,children:Math.ceil(s.currentCooldown)})]})]},r)})}),(0,n.jsxs)("div",{className:tw().healthBarSection,children:[d.map((e,t)=>(0,n.jsx)(tF,{damage:e.damage,index:t,timestamp:e.timestamp,onComplete:()=>y(e.id)},e.id)),(0,n.jsxs)("div",{className:tw().healthBarContainer,children:[(0,n.jsxs)("div",{className:tw().healthBar,children:[(0,n.jsx)("div",{className:tw().healthBarBackground}),(0,n.jsx)("div",{className:tw().healthBarInner,style:{width:"".concat(r/o*100,"%")}}),(0,n.jsx)("div",{className:tw().healthBarShine}),(0,n.jsx)("div",{className:tw().healthBarPulse})]}),(0,n.jsxs)("span",{className:tw().healthText,children:[(0,n.jsx)("span",{className:tw().healthCurrent,children:r}),(0,n.jsx)("span",{className:tw().healthSeparator,children:"/"}),(0,n.jsx)("span",{className:tw().healthMax,children:o})]})]}),(0,n.jsxs)("div",{className:tw().experienceBarContainer,children:[(0,n.jsx)("div",{className:tw().experienceBarOrnamentLeft,children:(0,n.jsx)("span",{className:tw().levelText,children:M(l)})}),(0,n.jsx)("div",{className:tw().experienceBar,children:(0,n.jsx)("div",{className:tw().xpFill,style:{width:"".concat((e=>{let t=M(e);return 1===t?e/13*100:2===t?(e-13)/17*100:(e-30)/23*100})(l),"%")}})}),(0,n.jsx)("div",{className:tw().experienceBarOrnamentRight,children:(0,n.jsx)("span",{className:tw().killCountText,children:l})})]})]}),(0,n.jsx)(tk,{content:x,visible:!!x,x:g.x,y:g.y})]})]})}var tD=r(6133),t_=r.n(tD);function tA(e){let{onWeaponSelect:t,selectedWeapon:r,onStart:s}=e;return(0,n.jsxs)("div",{className:t_().panel,onContextMenu:e=>e.preventDefault(),children:[(0,n.jsx)("h2",{children:"Eidolon"}),(0,n.jsxs)("div",{className:t_().iconSelection,children:[(0,n.jsx)("div",{className:"".concat(t_().icon," ").concat(r===i.SWORD?t_().selected:""),onClick:()=>t(i.SWORD),children:(0,n.jsx)("div",{className:t_().iconContent,children:(0,n.jsx)(tI(),{src:"/Eidolon/icons/2.svg",alt:"Sword",width:280,height:320,unoptimized:!0})})}),(0,n.jsx)("div",{className:"".concat(t_().icon," ").concat(r===i.SCYTHE?t_().selected:""),onClick:()=>t(i.SCYTHE),children:(0,n.jsx)("div",{className:t_().iconContent,children:(0,n.jsx)(tI(),{src:"/Eidolon/icons/1.svg",alt:"Scythe",width:280,height:320,unoptimized:!0})})}),(0,n.jsx)("div",{className:"".concat(t_().icon," ").concat(r===i.SABRES?t_().selected:""),onClick:()=>t(i.SABRES),children:(0,n.jsx)("div",{className:t_().iconContent,children:(0,n.jsx)(tI(),{src:"/Eidolon/icons/3.svg",alt:"Sabres",width:280,height:320,unoptimized:!0})})})]}),(0,n.jsx)("button",{className:t_().startButton,onClick:s,disabled:!r,children:"Enter"})]})}var tz=r(5151),tq=r.n(tz);function tB(e){let{onContinue:t,onSelectIcon:r,selectedIcon:o,currentWeapon:a,onAbilityUnlock:l,abilities:c}=e,[d,u]=(0,s.useState)(null),[m,p]=(0,s.useState)({x:0,y:0}),x=(e,t)=>{let r=h[a][t],n=e.currentTarget.getBoundingClientRect();u(r),p({x:n.left-721,y:n.top-70})},f=()=>{u(null)},g=(e,t)=>{t||r(e)},j=(()=>{switch(a){case i.SCYTHE:return{r:"/Eidolon/icons/r1.svg",p:"/Eidolon/icons/p1.svg",s:"/Eidolon/icons/a1.svg"};case i.SWORD:return{r:"/Eidolon/icons/r2.svg",p:"/Eidolon/icons/p2.svg",s:"/Eidolon/icons/a2.svg"};case i.SABRES:return{r:"/Eidolon/icons/r3.svg",p:"/Eidolon/icons/p3.svg",s:"/Eidolon/icons/a3.svg"};case i.SABRES2:return{r:"/Eidolon/icons/r4.svg",p:"/Eidolon/icons/p4.svg"}}})();return(0,n.jsxs)("div",{className:tq().panel,style:{pointerEvents:"auto"},onContextMenu:e=>e.preventDefault(),children:[(0,n.jsx)("h2",{children:"Level Complete!"}),(0,n.jsx)("p",{children:"Choose an ability to unlock:"}),(0,n.jsxs)("div",{className:tq().iconSelection,children:[(0,n.jsx)("div",{className:"".concat(tq().icon," \n            ").concat(1===o?tq().selected:""," \n            ").concat(c[a].r.isUnlocked?tq().disabled:""),onClick:()=>g(1,c[a].r.isUnlocked),onMouseEnter:e=>x(e,"r"),onMouseLeave:f,children:(0,n.jsxs)("div",{className:tq().iconContent,children:[(null==j?void 0:j.r)&&(0,n.jsx)(tI(),{src:j.r,alt:"R Ability",width:75,height:75,priority:!0}),(0,n.jsx)("p",{children:"[R] Hotkey"})]})}),(0,n.jsx)("div",{className:"".concat(tq().icon," \n            ").concat(2===o?tq().selected:""," \n            ").concat(c[a].passive.isUnlocked?tq().disabled:""),onClick:()=>g(2,c[a].passive.isUnlocked),onMouseEnter:e=>x(e,"passive"),onMouseLeave:f,children:(0,n.jsxs)("div",{className:tq().iconContent,children:[(null==j?void 0:j.p)&&(0,n.jsx)(tI(),{src:j.p,alt:"Passive Ability",width:75,height:75,priority:!0}),(0,n.jsx)("p",{children:"[1] Hotkey"})]})}),(a===i.SCYTHE||a===i.SABRES||a===i.SWORD)&&(0,n.jsx)("div",{className:"".concat(tq().icon," \n              ").concat(3===o?tq().selected:""," \n              ").concat(c[a].active.isUnlocked?tq().disabled:""),onClick:()=>g(3,c[a].active.isUnlocked),onMouseEnter:e=>x(e,"active"),onMouseLeave:f,children:(0,n.jsxs)("div",{className:tq().iconContent,children:[(null==j?void 0:j.s)&&(0,n.jsx)(tI(),{src:j.s,alt:"Active Ability",width:75,height:75,priority:!0}),(0,n.jsx)("p",{children:"[2] Hotkey"})]})})]}),(0,n.jsx)("button",{className:tq().continueButton,onClick:()=>{null!==o&&(l(1===o?"r":2===o?"passive":"active"),t())},disabled:null===o,children:"Confirm"}),(0,n.jsx)(tk,{content:d,visible:!!d,x:m.x,y:m.y})]})}var tL=r(2374),tO=r.n(tL);let tW=[{title:"The Darkness Claims Another",subtitle:"Your soul joins the eternal dance..."},{title:"Fallen to Shadow",subtitle:"The necropolis grows stronger..."},{title:"Death's Embrace",subtitle:"The bones welcome their kin..."},{title:"The Last Stand",subtitle:"Your light fades into the abyss..."},{title:"Eternal Rest",subtitle:"The skeleton army claims victory..."},{title:"Denied Ascension",subtitle:"The dragons turn their backs on another unworthy soul..."},{title:"Draconic Disappointment",subtitle:"Your flames were not strong enough to join their ranks..."},{title:"Failed Wyrm",subtitle:"The ancient dragons scoff at your weakness..."},{title:"Wingless One",subtitle:"You'll never know the freedom of dragon flight..."},{title:"Mortal Chains",subtitle:"Forever bound to walk while dragons soar above..."},{title:"Lost Heritage",subtitle:"The dragon blood within you grows cold..."},{title:"Fading Ember",subtitle:"Your draconic spark extinguishes in darkness..."},{title:"Rejected by Fire",subtitle:"The dragon's flame finds you unworthy..."}];function tH(e){let{playerHealth:t,onReset:r,killCount:o}=e,[i,a]=(0,s.useState)(!1),[l,c]=(0,s.useState)(null);return(0,s.useEffect)(()=>{t<=0&&!i&&(c(tW[Math.floor(Math.random()*tW.length)]),a(!0),window.dispatchEvent(new CustomEvent("gameOver")))},[t,i]),(0,n.jsx)(n.Fragment,{children:i&&l&&(0,n.jsxs)("div",{className:tO().gameOverContainer,onClick:e=>e.stopPropagation(),onMouseDown:e=>e.stopPropagation(),children:[(0,n.jsx)("h1",{className:tO().gameOverTitle,children:l.title}),(0,n.jsx)("p",{className:tO().gameOverSubtitle,children:l.subtitle}),(0,n.jsx)("button",{className:tO().retryButton,onClick:()=>{console.log("Behavior: Reset triggered"),a(!1),c(null),window.dispatchEvent(new CustomEvent("gameReset")),r()},children:"RETRY"}),(0,n.jsxs)("div",{className:tO().killCounter,children:["Skeletons Defeated: ",o]})]})})}let tU=(0,s.createContext)({isPaused:!1});function tN(e){let{children:t}=e,[r,o]=(0,s.useState)(!1);return(0,s.useEffect)(()=>{let e=()=>{o(document.hidden)},t=()=>{o(!0)},r=()=>{o(!1)};return document.addEventListener("visibilitychange",e),window.addEventListener("blur",t),window.addEventListener("focus",r),()=>{document.removeEventListener("visibilitychange",e),window.removeEventListener("blur",t),window.removeEventListener("focus",r)}},[]),(0,n.jsx)(tU.Provider,{value:{isPaused:r},children:t})}function tQ(e){let{sceneProps:t,currentWeapon:r,onWeaponSelect:i,playerHealth:a,maxHealth:l,abilities:c,onReset:h,killCount:d,onAbilityUnlock:u}=e,[m,p]=(0,s.useState)(!1),[x,f]=(0,s.useState)(!1),[g,j]=(0,s.useState)(null),[v,P]=(0,s.useState)(1),w=(0,s.useCallback)((e,t)=>{t?f(!0):P(e=>e+1)},[]),S=(0,s.useCallback)(()=>{f(!1),j(null),P(e=>e+1)},[]),I=(0,s.useCallback)(()=>{console.log("GameWrapper: Reset triggered"),p(!1),P(1),f(!1),j(null),h()},[h,,]);return(0,s.useEffect)(()=>{let e=e=>{"Space"===e.code&&e.preventDefault()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[]),(0,s.useEffect)(()=>()=>{t.unitProps.controlsRef.current&&t.unitProps.controlsRef.current.dispose(),o.l2R.clear()},[t.unitProps.controlsRef]),(0,n.jsx)(tN,{children:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{style:{width:"100vw",height:"100vh",overflow:"hidden",position:"fixed",top:0,left:0,touchAction:"none"},children:(0,n.jsxs)(y.Hl,{children:[(0,n.jsx)("ambientLight",{intensity:.175}),m&&(0,n.jsx)(s.Suspense,{fallback:null,children:(0,n.jsx)(tv,{sceneProps:{...t,onReset:I},onAbilityUnlock:u,onLevelTransition:w,currentLevel:v})}),(0,n.jsx)(M.N,{ref:t.unitProps.controlsRef,enablePan:!1,maxPolarAngle:Math.PI/2.25,maxDistance:13,mouseButtons:{LEFT:void 0,MIDDLE:void 0,RIGHT:o.kBv.ROTATE},minDistance:6.5,rotateSpeed:.5,enableDamping:!0,dampingFactor:.075,zoomSpeed:1.75,position:[0,15,20],target:[0,0,0]})]})}),(0,n.jsx)(tH,{playerHealth:a,onReset:I,killCount:d,onEnemiesDefeated:()=>{},maxSkeletons:12}),(0,n.jsx)("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:!m||x?"auto":"none",zIndex:1e3},children:m?x?(0,n.jsx)(tB,{onContinue:S,onSelectIcon:j,selectedIcon:g,currentWeapon:r,onAbilityUnlock:u,abilities:c}):(0,n.jsx)(tT,{currentWeapon:r,onWeaponSelect:()=>{},playerHealth:a,maxHealth:l,abilities:c,onReset:h,killCount:d}):(0,n.jsx)(tA,{onWeaponSelect:i,selectedWeapon:r,onStart:()=>{console.log("handleStart called, currentWeapon:",r),r&&p(!0)}})})]})})}let tY=()=>{let e=Math.random()*Math.PI*2,t=30*Math.sqrt(Math.random());return new o.Pq0(Math.cos(e)*t,0,Math.sin(e)*t)};function tZ(){let[e,t]=(0,s.useState)(null),r=(0,s.useRef)(null),[a,h]=(0,s.useState)(200),[f,y]=(0,s.useState)(200),[M,v]=(0,s.useState)(0),[P,w]=(0,s.useState)(()=>l),[S,I]=(0,s.useState)({r:!1,passive:!1,active:!1}),b=t=>{console.log("Unlocking ".concat(t," ability")),I(e=>({...e,[t]:!0})),w(r=>{let n={...r};return e&&(n[e][t]={...n[e][t],isUnlocked:!0}),n})},C=(0,s.useMemo)(()=>({mainTree:new o.Pq0(0,2,-5)}),[]),F=(0,s.useMemo)(()=>m(),[]),E=(0,s.useMemo)(()=>p(),[]),R=(0,s.useMemo)(()=>x(),[]),k=(0,s.useMemo)(()=>g(),[]),G=(0,s.useMemo)(()=>j(),[]),[T,D]=(0,s.useState)(),[_,A]=(0,s.useState)();(0,s.useEffect)(()=>{D(new o.Q1f(d[Math.floor(Math.random()*d.length)])),A(new o.Q1f(u[Math.floor(Math.random()*u.length)]))},[]);let z=e=>{t(e)},q=(0,s.useCallback)((e,t)=>{let r=Date.now();if(r-M>100){if(e.startsWith("skeleton-")){let r=parseInt(e.split("-")[1]);O(e=>{let n=[...e];return n[r]=Math.max(0,e[r]-t),n})}v(r)}},[M]),B=(e,t)=>{w(r=>{let n={...r};return n[e][t].currentCooldown=c(e,t,r),n})};(0,s.useEffect)(()=>{let e=setInterval(()=>{w(e=>{let t={...e};return Object.keys(t).forEach(e=>{["q","e","r","passive","active"].forEach(r=>{t[e][r].currentCooldown>0&&(t[e][r].currentCooldown-=.15)})}),t})},150);return()=>clearInterval(e)},[]);let[L]=(0,s.useState)(new o.Pq0(0,0,0)),[,O]=(0,s.useState)(()=>[,,,,,].fill(175)),[W,H]=(0,s.useState)(()=>Array.from({length:5},(e,t)=>{let r=tY();return{id:"skeleton-".concat(t),initialPosition:r,position:r.clone(),health:196,maxHealth:196,onTakeDamage:(e,t)=>{H(r=>r.map(r=>r.id===e?{...r,health:Math.max(0,r.health-t)}:r))}}})),[U,N]=(0,s.useState)(0),Q=(0,s.useCallback)(()=>{console.log("Enemy death registered in HomePage"),N(e=>{let t=e+1;return console.log("Kill count updated:",t),y(200+t),h(e=>e+1),t})},[]),Y=(0,s.useCallback)((e,t,r)=>{H(r=>r.map(r=>r.id===e?{...r,health:Math.max(0,r.health-t)}:r)),r&&console.log("Critical hit on ".concat(e," for ").concat(t," damage!"))},[]),Z=(0,s.useCallback)((e,t,r,n)=>{console.log("Smite hit ".concat(e," for ").concat(t," damage (Critical: ").concat(r,") at position:"),n),q(e,t)},[q]),V=(0,s.useRef)(null),K=()=>{console.log("HomePage: Reset triggered"),y(200),h(200),O([,,,,,].fill(175)),w(e=>{let t={...e};return Object.keys(t).forEach(e=>{["q","e"].forEach(r=>{t[e][r].currentCooldown=0})}),t}),v(0),N(0),t(null),I({r:!1,passive:!1,active:!1})},X=(0,s.useCallback)(e=>{h(t=>Math.min(f,t+e))},[f]),$={bossActive:!1,mountainData:F,onAbilityUnlock:b,treeData:E,mushroomData:R,treePositions:C,interactiveTrunkColor:T,interactiveLeafColor:_,onReset:K,unitProps:{onFireballDamage:Y,onSmiteDamage:Z,onHit:q,controlsRef:r,currentWeapon:e||i.SCYTHE,onWeaponSelect:z,health:a,maxHealth:f,isPlayer:!0,abilities:{...P,...e?{[e]:{...P[e],r:{...P[e].r,isUnlocked:S.r},passive:{...P[e].passive,isUnlocked:S.passive}}}:{}},onAbilityUse:(t,r)=>{e&&B(t,r)},onPositionUpdate:e=>{L.copy(e)},enemyData:W.map(e=>({id:e.id,position:e.position,initialPosition:e.initialPosition,currentPosition:e.position.clone(),health:e.health,maxHealth:e.maxHealth})),onDamage:e=>{h(t=>Math.max(0,t-e))},onEnemyDeath:Q,fireballManagerRef:V,onHealthChange:X},skeletonProps:W,killCount:U,onFireballDamage:Y,onWeaponSelect:z,flowerData:k,boneDoodadData:G};return(0,s.useEffect)(()=>{let e=e=>{"Space"===e.code&&e.preventDefault()};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[]),(0,n.jsx)("div",{style:{width:"100vw",height:"100vh",overflow:"hidden",position:"fixed",top:0,left:0},children:(0,n.jsx)(tQ,{sceneProps:$,currentWeapon:e,onWeaponSelect:z,playerHealth:a,maxHealth:f,abilities:P,onReset:K,killCount:U,onAbilityUnlock:b})})}},5831:e=>{e.exports={notification:"DamageNotification_notification__f3Yeu",floatUp:"DamageNotification_floatUp__Myim4",visible:"DamageNotification_visible__jYt6g",hidden:"DamageNotification_hidden__l4PWe"}},5151:e=>{e.exports={panel:"LevelCompletionPanel_panel__dcef3",iconSelection:"LevelCompletionPanel_iconSelection__jS9NE",icon:"LevelCompletionPanel_icon__lRABe",selected:"LevelCompletionPanel_selected__PqyOR",continueButton:"LevelCompletionPanel_continueButton__xlmot",iconContent:"LevelCompletionPanel_iconContent__DqvWS",disabled:"LevelCompletionPanel_disabled__npgST"}},5019:e=>{e.exports={bottomPanel:"Panel_bottomPanel__E_GFV",weaponSection:"Panel_weaponSection__zIJl0",weaponIcon:"Panel_weaponIcon__iLPYg",levelBadge:"Panel_levelBadge__XHoiD",badgePulse:"Panel_badgePulse__tCaHu",statsSection:"Panel_statsSection__cewg2",healthBarContainer:"Panel_healthBarContainer___xHn5",healthBarInner:"Panel_healthBarInner__B2SSK",experienceBar:"Panel_experienceBar__G5pO5",abilitiesSection:"Panel_abilitiesSection__LVE1_",ability:"Panel_ability__vWpFg",healthBarSection:"Panel_healthBarSection__Lc4_u",healthBarDecoration:"Panel_healthBarDecoration__ok97A",healthBarOrnamentLeft:"Panel_healthBarOrnamentLeft__l_eLO",healthBarOrnamentRight:"Panel_healthBarOrnamentRight__DlmuW",healthBar:"Panel_healthBar__Md85Z",healthBarBackground:"Panel_healthBarBackground__jdRKY",healthBarShine:"Panel_healthBarShine__88Hkf",shine:"Panel_shine__uI8op",healthBarPulse:"Panel_healthBarPulse__CZkcb",pulse:"Panel_pulse__tyA5r",healthText:"Panel_healthText__1fCQl",healthCurrent:"Panel_healthCurrent__7n6qI",healthSeparator:"Panel_healthSeparator__aVnh_",healthMax:"Panel_healthMax__tYk8m",abilityContainer:"Panel_abilityContainer__sN6a4",abilityIcon:"Panel_abilityIcon__3DloH",weaponIcons:"Panel_weaponIcons__FW360",weaponSlot:"Panel_weaponSlot__dVwz7",keyBind:"Panel_keyBind__D5m1t",activeWeapon:"Panel_activeWeapon__uZq6r",cooldownOverlay:"Panel_cooldownOverlay__GJ3zY",cooldownText:"Panel_cooldownText__kVTtb",roundedSquareProgress:"Panel_roundedSquareProgress__1eZW_",progressForeground:"Panel_progressForeground__Acr3c",gameOverOverlay:"Panel_gameOverOverlay__Bud_o",gameOverTitle:"Panel_gameOverTitle__zo4Jg",gameOverSubtitle:"Panel_gameOverSubtitle__qVO8v",retryButton:"Panel_retryButton__GOTn9",killCounter:"Panel_killCounter__iC_Sg",killCountText:"Panel_killCountText__hQyjQ",xpFill:"Panel_xpFill__RXvNL",levelText:"Panel_levelText__SgUXR",experienceBarContainer:"Panel_experienceBarContainer__9mese",experienceBarOrnamentLeft:"Panel_experienceBarOrnamentLeft__JvEOr",experienceBarOrnamentRight:"Panel_experienceBarOrnamentRight__can19",locked:"Panel_locked__Anu5g",tooltip:"Panel_tooltip__tY4zh",abilityTooltip:"Panel_abilityTooltip__QPsMI",controlsSection:"Panel_controlsSection__V2l2S",controlGroup:"Panel_controlGroup__ZKwO3",controlKey:"Panel_controlKey__NC_tm",controlLabel:"Panel_controlLabel__7c5bl",controlDivider:"Panel_controlDivider__R4TV2",leftPanel:"Panel_leftPanel___5GQG",activeOverlay:"Panel_activeOverlay__wG7FY",activeIndicator:"Panel_activeIndicator__qrpa9",weaponPulse:"Panel_weaponPulse__fP758",glowPulse:"Panel_glowPulse__Ye37n"}},5190:e=>{e.exports={tooltip:"Tooltip_tooltip__7tEfC"}},6133:e=>{e.exports={panel:"WeaponSelectionPanel_panel__XVTME",iconContent:"WeaponSelectionPanel_iconContent__0raLR",icon:"WeaponSelectionPanel_icon__s7G0N",startButton:"WeaponSelectionPanel_startButton__zI16Y",iconSelection:"WeaponSelectionPanel_iconSelection__b3lef",selected:"WeaponSelectionPanel_selected__yqwcS",spinHex:"WeaponSelectionPanel_spinHex__23BFC",pulseGlow:"WeaponSelectionPanel_pulseGlow__6GI0P"}},2374:e=>{e.exports={gameOverContainer:"Behavior_gameOverContainer__wiKZW",gameOverTitle:"Behavior_gameOverTitle__B0h2R",gameOverSubtitle:"Behavior_gameOverSubtitle____YXI",retryButton:"Behavior_retryButton__N9g61",killCounter:"Behavior_killCounter__Vm3B2"}}},e=>{var t=t=>e(e.s=t);e.O(0,[624,438,84,111,636,593,792],()=>t(2022)),_N_E=e.O()}]);