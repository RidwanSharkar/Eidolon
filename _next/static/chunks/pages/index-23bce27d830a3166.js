(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[332],{2022:(e,t,r)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return r(9976)}])},9976:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>nn});var n=r(4848),i=r(6540),s=function(e){return e.SCYTHE="scythe",e.SWORD="sword",e.SABRES="sabres",e.SPEAR="spear",e.BOW="bow",e}({});let o={sword:{normal:41,range:5.5,maxHitsPerSwing:1},scythe:{normal:23,range:4.65,maxHitsPerSwing:1},sabres:{normal:17,range:4,maxHitsPerSwing:2},spear:{normal:31,range:6,maxHitsPerSwing:1},bow:{normal:17,range:.125,maxHitsPerSwing:1}},a={scythe:{q:{type:"q",key:"q",cooldown:.685,currentCooldown:0,icon:"icons/q1.svg",maxCooldown:1,name:"Scythe Q",isUnlocked:!0},e:{type:"e",key:"e",cooldown:.65,currentCooldown:0,icon:"icons/e1.svg",maxCooldown:.6675,name:"Scythe E",isUnlocked:!0},r:{type:"r",key:"r",cooldown:2.05,currentCooldown:0,icon:"icons/r1.svg",maxCooldown:1.8,name:"Boneclaw",isUnlocked:!1},passive:{type:"passive",key:"1",cooldown:.725,currentCooldown:0,icon:"icons/p1.svg",maxCooldown:0,name:"Reanimate",isUnlocked:!1},active:{type:"active",key:"2",cooldown:4.5,currentCooldown:0,icon:"icons/a1.svg",maxCooldown:4.5,name:"Summon Skeleton",isUnlocked:!1}},sword:{q:{type:"q",key:"q",cooldown:1.125,currentCooldown:0,icon:"icons/q2.svg",maxCooldown:1.08,name:"Sword Q",isUnlocked:!0},e:{type:"e",key:"e",cooldown:3.85,currentCooldown:0,icon:"icons/e2.svg",maxCooldown:4,name:"Sword E",isUnlocked:!0},r:{type:"r",key:"r",cooldown:1.275,currentCooldown:0,icon:"icons/r2.svg",maxCooldown:1.75,name:"Oathstrike",isUnlocked:!1},passive:{type:"passive",key:"1",cooldown:0,currentCooldown:0,icon:"icons/p2.svg",maxCooldown:0,name:"Crusader Aura",isUnlocked:!1},active:{type:"active",key:"2",cooldown:0,currentCooldown:0,icon:"icons/a2.svg",maxCooldown:0,name:"Sword Active",isUnlocked:!1}},sabres:{q:{type:"q",key:"q",cooldown:.6125,currentCooldown:0,icon:"icons/q3.svg",maxCooldown:.9,name:"Sabres Q",isUnlocked:!0},e:{type:"e",key:"e",cooldown:5.25,currentCooldown:0,icon:"icons/e3.svg",maxCooldown:10,name:"Shadow Strike",isUnlocked:!0},r:{type:"r",key:"r",cooldown:9.5,currentCooldown:0,icon:"icons/r3.svg",maxCooldown:10,name:"Blizzard",isUnlocked:!1},passive:{type:"passive",key:"1",cooldown:0,currentCooldown:0,icon:"icons/p3.svg",maxCooldown:0,name:"Frost Lance",isUnlocked:!1},active:{type:"active",key:"2",cooldown:0,currentCooldown:0,icon:"icons/a3.svg",maxCooldown:0,name:"Orb Shield",isUnlocked:!1}},spear:{q:{type:"q",key:"q",cooldown:.625,currentCooldown:0,icon:"icons/q4.svg",maxCooldown:1,name:"Spear Q",isUnlocked:!0},e:{type:"e",key:"e",cooldown:4.5,currentCooldown:0,icon:"icons/e4.svg",maxCooldown:5,name:"Spear E",isUnlocked:!0},r:{type:"r",key:"r",cooldown:.5,currentCooldown:0,icon:"icons/r4.svg",maxCooldown:4.5,name:"Pyroclast",isUnlocked:!1},passive:{type:"passive",key:"1",cooldown:0,currentCooldown:0,icon:"icons/p4.svg",maxCooldown:0,name:"Reignite",isUnlocked:!1},active:{type:"active",key:"2",cooldown:2,currentCooldown:0,icon:"icons/a4.svg",maxCooldown:8,name:"Breach",isUnlocked:!1}},bow:{q:{type:"q",key:"q",cooldown:.25,currentCooldown:0,icon:"icons/q5.svg",maxCooldown:1,name:"Quick Shot",isUnlocked:!0},e:{type:"e",key:"e",cooldown:1,currentCooldown:0,icon:"icons/e5.svg",maxCooldown:1,name:"Power Shot",isUnlocked:!0},r:{type:"r",key:"r",cooldown:3.65,currentCooldown:0,icon:"icons/r5.svg",maxCooldown:8,name:"Vault",isUnlocked:!1},passive:{type:"passive",key:"1",cooldown:0,currentCooldown:0,icon:"icons/p5.svg",maxCooldown:0,name:"Venom Shots",isUnlocked:!1},active:{type:"active",key:"2",cooldown:5,currentCooldown:0,icon:"icons/a5.svg",maxCooldown:5,name:"Elemental Shots",isUnlocked:!1}}},l=(e,t,r)=>{let n=a[e][t];return"sword"===e&&"q"===t&&r.sword.passive.isUnlocked?.725:n.cooldown},c={scythe:{q:{title:"Scythe",description:"Swift reaping attack in an arc."},e:{title:"Entropic Bolt",description:"Consumes 1 orb charge to fire a bolt of necrotic energy at a single target."},r:{title:"Dragon Claw",description:"Active: Summons a brief draconic claw to swipe down necrotic beams of energy at enemies caught in its path."},passive:{title:"Reanimate",description:"Active: Consumes 1 Orb Charge to heal the wielder."},active:{title:"Chaos Totem",description:"Active: Summons a totem that fights by your side for 12 seconds, shooting rapid bolts at enemies within range - 5 second cooldown."}},sword:{q:{title:"Greatsword",description:"Slow powerful swing in a wide arc."},e:{title:"Divine Smite",description:"Delivers an extra instant strike that calls down a radiant bolt of energy to deal additional damage to nearby enemies."},r:{title:"Oathstrike",description:"Active: Consumes 2 Orb Charges to unleash a devastating strike in an arc that heals the wielder if at least one enemy is hit."},passive:{title:"Crusader Aura",description:"Passive: Increases attack speed by 30% and gives successfulattacks a 20% chance to heal the wielder."},active:{title:"Static Discharge",description:"Passive: Sword attacks conduct electricity, bouncing lightning damage to nearby enemies in a chain-reaction."}},sabres:{q:{title:"Twin Sabres",description:"Fast dual-wielding slashes at close range."},e:{title:"Blinding Mist - Shadowstrike",description:"Blinds enemies around you, granting invisibility for 5 seconds. Breaking stealth with an attack deals significant bonus damage. If a killing blow is landed this way, health is restored."},r:{title:"Blizzard",description:"Active: Unleash a devastating ice storm originating at the wielder, dealing frost damage to surrounding enemies."},passive:{title:"Frost Lance",description:"Active: Consumes 1 Orb Charge to fire a beam of ice that pierces through all enemies in a line."},active:{title:"Avalanche",description:"Passive: Melee attacks passively consume orb charges to deal extra frost damage scaling with the number of charges available."}},spear:{q:{title:"Spear",description:"Long-range piercing attack. Ineffective at close range; however, attacks that land at the tip of the spear are guaranteed to be critical strikes."},e:{title:"Razorwind",description:"Consumes 1 orb per second to unleashes a fiery bladestorm. Attacks that land at the tip of the spear are guaranteed to be critical strikes."},r:{title:"Inferno",description:"Active: Consumes 2 orbs per second to charge and release a volcanic missile that deals damage based on the number of orbs consumed."},passive:{title:"Reignite",description:"Passive: Restores 3 orb charges whenever you kill an enemy."},active:{title:"Breach",description:"Active: Consumes 2 orbs to quickly dash forward with the spear, dealing damage to enemies caught in the path."}},bow:{q:{title:"Quick Shots",description:"Rapidly fire bone arrows, consuming 1 orb per 6 shots."},e:{title:"Power Shot",description:"Charge a powerful shot that deals increased damage based on charge time. Fully charged shots pierce through all enemies in the arrow's path."},r:{title:"Vault",description:"Quickly dash backwards to escape danger or obtain better positioning - 4 Second Cooldown."},passive:{title:"Venom Shots",description:"Passive: Every 3rd shot that hits a target deals an additional 67 damage."},active:{title:"Elemental Shots",description:"Fully charged shots deal an additional 100-200 fire damage. Non-fully charged shots deal 30 additional lightning damage to the target. Movement speed while charging the Power-Shot is increased 1000%"}}},u={scythe:8,sword:4,sabres:6,spear:8,bow:6};var h=r(8875),d=r(2805),m=r(4922);function p(){let e=(0,i.useRef)(null),t=(0,i.useRef)(null);return(0,i.useEffect)(()=>{if(!t.current){let e=new m.ypk;for(let t=0;t<8;t++){let r=t/8*Math.PI*2,n=50*Math.cos(r),i=50*Math.sin(r);0===t?e.moveTo(n,i):e.lineTo(n,i)}e.closePath(),t.current=e}},[]),(0,n.jsx)("group",{children:(0,n.jsxs)("mesh",{ref:e,rotation:[-Math.PI/2,0,0],receiveShadow:!0,children:[t.current&&(0,n.jsx)("shapeGeometry",{args:[t.current]}),(0,n.jsx)("meshStandardMaterial",{color:"#365F4A",roughness:.7,metalness:.1,emissive:"#365F4A",emissiveIntensity:.45})]})})}var f=r(3421);let x=e=>{let{color:t,size:r,meshRef:s,opacity:o=1}=e,a=(0,i.useRef)(null),l=(0,i.useRef)(new Float32Array(72)),c=(0,i.useRef)(new Float32Array(24)),u=(0,i.useRef)(new Float32Array(24)),h=(0,i.useRef)(!1),d=(0,i.useRef)(new m.Pq0);return(0,i.useEffect)(()=>{if(s.current&&!h.current){let{x:e,y:t,z:r}=s.current.position;d.current.set(e,t,r);for(let n=0;n<24;n++)l.current[3*n]=e,l.current[3*n+1]=t,l.current[3*n+2]=r,c.current[n]=0,u.current[n]=0;h.current=!0}},[s]),(0,f.F)(()=>{var e;if(!(null===(e=a.current)||void 0===e?void 0:e.parent)||!s.current||!h.current)return;let t=s.current.position;if(t.distanceToSquared(d.current)>1e-4){d.current.copy(t);for(let e=23;e>0;e--)l.current[3*e]=l.current[(e-1)*3],l.current[3*e+1]=l.current[(e-1)*3+1],l.current[3*e+2]=l.current[(e-1)*3+2];l.current[0]=t.x,l.current[1]=t.y,l.current[2]=t.z,a.current&&(a.current.geometry.attributes.position.needsUpdate=!0)}for(let e=0;e<24;e++)c.current[e]=.6*Math.pow(1-e/24,2)*o,u.current[e]=.5*r*Math.pow(1-e/24,.5);if(a.current){let e=a.current.geometry;e.attributes.opacity.needsUpdate=!0,e.attributes.scale.needsUpdate=!0}}),(0,n.jsxs)("points",{ref:a,children:[(0,n.jsxs)("bufferGeometry",{children:[(0,n.jsx)("bufferAttribute",{attach:"attributes-position",count:24,array:l.current,itemSize:3}),(0,n.jsx)("bufferAttribute",{attach:"attributes-opacity",count:24,array:c.current,itemSize:1}),(0,n.jsx)("bufferAttribute",{attach:"attributes-scale",count:24,array:u.current,itemSize:1})]}),(0,n.jsx)("shaderMaterial",{transparent:!0,depthWrite:!1,blending:m.EZo,vertexShader:"\n          attribute float opacity;\n          attribute float scale;\n          varying float vOpacity;\n          void main() {\n            vOpacity = opacity;\n            vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n            gl_Position = projectionMatrix * mvPosition;\n            gl_PointSize = scale * 20.0 * (300.0 / -mvPosition.z);\n          }\n        ",fragmentShader:"\n          varying float vOpacity;\n          uniform vec3 uColor;\n          void main() {\n            float d = length(gl_PointCoord - vec2(0.5));\n            float strength = smoothstep(0.5, 0.1, d);\n            vec3 glowColor = mix(uColor, vec3(1.0), 0.4);\n            gl_FragColor = vec4(glowColor, vOpacity * strength);\n          }\n        ",uniforms:{uColor:{value:t}}})]})};function g(e){let{position:t,direction:r,onImpact:s}=e,o=(0,i.useRef)(null),a=(0,i.useRef)(new m.zD7),l=(0,i.useRef)(t.clone()),{scene:c}=(0,f.D)(),u=new m.Q1f("#00ff44"),h=(0,i.useRef)(null),d=(0,i.useRef)(null),p=(0,i.useRef)(null),g=e=>{let t=new m.tBo,r=e.clone().sub(l.current).normalize();t.set(l.current,r);let n=c.children.filter(e=>"mountain"===e.name&&e instanceof m.YJl||"tree"===e.name&&e instanceof m.YJl).flatMap(e=>{let t=[];return e.traverse(e=>{e instanceof m.eaF&&t.push(e)}),t}),i=t.intersectObjects(n,!0);if(i.length>0){let t=i[0],r=l.current.distanceTo(e);if(t.distance<=r)return!0}return!1},y=e=>{p.current&&(p.current.position.copy(e),p.current.visible=!0,d.current=a.current.getElapsedTime())};return(0,f.F)((e,t)=>{if(!o.current)return;if(a.current.getElapsedTime()>10){o.current.removeFromParent();return}let n=r.clone().multiplyScalar(.3*t*60),i=l.current.clone().add(n);g(i)?(o.current&&(y(l.current),o.current.removeFromParent()),s()):(l.current.copy(i),o.current.position.copy(l.current))}),(0,n.jsxs)("group",{name:"fireball-group",children:[(0,n.jsxs)("mesh",{ref:o,position:l.current,children:[(0,n.jsx)("sphereGeometry",{args:[.28,32,32]}),(0,n.jsx)("meshStandardMaterial",{emissive:u,emissiveIntensity:2,toneMapped:!1}),(0,n.jsx)("pointLight",{color:u,intensity:5,distance:12})]}),(0,n.jsx)("group",{ref:h,visible:!1}),(0,n.jsx)(x,{color:u,size:.28,meshRef:o,opacity:1}),(0,n.jsx)("pointLight",{color:u,intensity:8,distance:4,decay:2})]})}function y(e){let{isSwinging:t,onSwingComplete:r}=e,s=(0,i.useRef)(null),o=(0,i.useRef)(0);return(0,f.F)((e,n)=>{if(t&&s.current){o.current+=8*n;let e=Math.min(o.current/Math.PI/1.5,1);if(o.current>=.85*Math.PI){o.current=0,r();return}let t=e<=.3?2*e:.75-(e-.125)*1.55,i=-1.175+2.5*Math.sin(t*Math.PI),a=.9+-1.5*Math.sin(t*Math.PI),l=.3+1.1*Math.cos(t*Math.PI);s.current.position.set(i,a,l);let c=-.75*Math.sin(t*Math.PI)+.3,u=Math.sin(t*Math.PI)*Math.PI,h=Math.PI/3*Math.sin(t*Math.PI);s.current.rotation.set(c,u,h)}else!t&&s.current&&(s.current.rotation.x*=.92,s.current.rotation.y*=.92,s.current.rotation.z*=.92,s.current.position.x+=(-1.175-s.current.position.x)*.15,s.current.position.y+=(.9-s.current.position.y)*.15,s.current.position.z+=(.3-s.current.position.z)*.15)}),(0,n.jsxs)("group",{ref:s,position:[-1.175,.9,.3],rotation:[0,0,Math.PI],scale:[1,1,1],children:[(0,n.jsxs)("group",{position:[0,-.4,0],rotation:[0,0,Math.PI+.3],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.04,.04,2.3,12]}),(0,n.jsx)("meshStandardMaterial",{color:"#a86432",roughness:.7})]}),[...Array(10)].map((e,t)=>(0,n.jsxs)("mesh",{position:[0,1-.2*t,0],rotation:[Math.PI/2,0,0],children:[" ",(0,n.jsx)("torusGeometry",{args:[.07,.01,8,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#a86432",metalness:.3,roughness:.7})]},t))]}),(0,n.jsxs)("group",{position:[-.305,.6,0],rotation:[Math.PI/1,0,Math.PI-.3],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.08,.08,.3,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#2c1810",roughness:.6})]}),(0,n.jsx)("group",{"rotation-x":(0,f.F)(e=>2*e.clock.getElapsedTime()),children:(0,n.jsxs)("mesh",{"position-y":-.11,rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("torusGeometry",{args:[.14,.02,16,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#39ff14",emissive:"#39ff14",emissiveIntensity:1.25,transparent:!0,opacity:.7})]})}),(0,n.jsx)("group",{"rotation-x":(0,f.F)(e=>-(2*e.clock.getElapsedTime())),children:(0,n.jsxs)("mesh",{"position-y":-.005,rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("torusGeometry",{args:[.155,.02,16,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#39ff14",emissive:"#39ff14",emissiveIntensity:1.25,transparent:!0,opacity:.7})]})}),(0,n.jsx)("group",{"rotation-x":(0,f.F)(e=>-(2*e.clock.getElapsedTime())),children:(0,n.jsxs)("mesh",{"position-y":.1,rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("torusGeometry",{args:[.17,.02,16,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#39ff14",emissive:"#39ff14",emissiveIntensity:1.25,transparent:!0,opacity:.7})]})}),(0,n.jsx)("group",{"rotation-x":(0,f.F)(e=>-(2*e.clock.getElapsedTime())),children:(0,n.jsxs)("mesh",{"position-y":-.35,rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("torusGeometry",{args:[.075,.02,16,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#39ff14",emissive:"#39ff14",emissiveIntensity:1,transparent:!0,opacity:.7})]})}),(0,n.jsx)("group",{"rotation-x":(0,f.F)(e=>-(2*e.clock.getElapsedTime())),children:(0,n.jsxs)("mesh",{"position-y":-.54,rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("torusGeometry",{args:[.075,.02,16,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#39ff14",emissive:"#39ff14",emissiveIntensity:1.25,transparent:!0,opacity:.7})]})}),(0,n.jsx)("group",{"rotation-x":(0,f.F)(e=>-(2*e.clock.getElapsedTime())),children:(0,n.jsxs)("mesh",{"position-y":-.74,rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("torusGeometry",{args:[.075,.02,16,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#39ff14",emissive:"#39ff14",emissiveIntensity:1.25,transparent:!0,opacity:.7})]})}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.13,.11,.32,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#39ff14",emissive:"#39ff14",emissiveIntensity:1.5,transparent:!0,opacity:.3})]})]}),(0,n.jsx)("group",{position:[.37,.8,.775],rotation:[.2,-Math.PI/3.6,Math.PI-.175],scale:[1,.55,1],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("extrudeGeometry",{args:[(()=>{let e=new m.ypk;return e.moveTo(0,0),e.lineTo(.4,-.13),e.bezierCurveTo(.8,.22,1.33,.5,1.6,.515),e.lineTo(1.125,.75),e.bezierCurveTo(.5,.2,.225,0,.1,.7),e.lineTo(0,0),e})(),{steps:1,depth:1e-4,bevelEnabled:!0,bevelThickness:.03,bevelSize:.035,bevelSegments:1,curveSegments:16,depth:.03}]}),(0,n.jsx)("meshStandardMaterial",{color:"#39ff14",emissive:"#39ff14",emissiveIntensity:1.3,metalness:.8,roughness:.1,opacity:1,transparent:!0,side:m.$EB})]})})]})}function j(e){let{isSwinging:t,isSmiting:r,isOathstriking:s,onSwingComplete:o,onSmiteComplete:a,onOathstrikeComplete:l,hasChainLightning:c=!1}=e,u=(0,i.useRef)(null),h=(0,i.useRef)(0),d=(0,i.useRef)(0),p=[-1.18,.225,.3],x=(0,i.useRef)([]);(0,f.F)((e,n)=>{if(u.current){if(s){h.current+=8.2*n;let e=Math.min(h.current/Math.PI/1.6,1),t=p[0]+2.5*Math.sin(e*Math.PI),r=p[1]+-1*Math.sin(e*Math.PI),i=p[2]+1*Math.cos(e*Math.PI);u.current.position.set(t,r,i);let s=Math.sin(e*Math.PI)*Math.PI,o=Math.PI/2.5*Math.sin(e*Math.PI*1.275);u.current.rotation.set(1.275,s,o),h.current>=Math.PI&&(h.current=0,u.current.rotation.set(0,0,0),u.current.position.set(...p),null==l||l());return}if(r){let e,t,r,i,s;d.current+=n*(d.current<Math.PI/2?3:6);let o=Math.min(d.current/Math.PI,1);if(o<.5){let n=.45*o;e=-Math.PI/3-n*Math.PI/3,t=n*Math.PI/4,r=p[0]+1.5*n,i=p[1]+1.5*n,s=p[2]-1.5*n}else{let n=(o-.5)*2;e=-2*Math.PI/3+3*n*Math.PI/2,t=Math.PI/4*(1-n),r=p[0]+1.5*(1-n),i=p[1]+(1.5-2*n),s=p[2]-(1.5-3*n)}u.current.position.set(r,i,s),u.current.rotation.set(e,t,0),d.current>=Math.PI&&(d.current=0,u.current.rotation.set(0,0,0),u.current.position.set(...p),null==a||a());return}if(t){h.current+=4.5*n;let e=Math.min(h.current/Math.PI/1.5,1);if(h.current>=.55*Math.PI){h.current=0,u.current.rotation.set(0,0,0),u.current.position.set(...p),null==o||o();return}let t=e<=.25?2*e:.65-(e-.125)*1.7,r=p[0]+2.5*Math.sin(t*Math.PI),i=p[1]+-2*Math.sin(t*Math.PI),s=p[2]+1.1*Math.cos(t*Math.PI);u.current.position.set(r,i,s);let a=-.75*Math.sin(t*Math.PI)+1.5,l=Math.sin(t*Math.PI)*Math.PI,c=Math.PI/3*Math.sin(t*Math.PI);u.current.rotation.set(a,l,c),h.current>=Math.PI&&(h.current=0,u.current.rotation.set(0,0,0),u.current.position.set(...p),null==o||o())}else t||r||(u.current.rotation.x*=.85,u.current.rotation.y*=.85,u.current.rotation.z*=.85,u.current.position.x+=(p[0]-u.current.position.x)*.2,u.current.position.y+=(p[1]-u.current.position.y)*.2,u.current.position.z+=(p[2]-u.current.position.z)*.2);if(c&&u.current){if(.8>Math.random())for(let e=0;e<3;e++){let e=2.2*Math.random(),t=new m.Pq0((Math.random()-.5)*.4,e,(Math.random()-.5)*.4);x.current.push({position:t,velocity:new m.Pq0((Math.random()-.5)*4,(Math.random()-.2)*4,(Math.random()-.5)*4).multiplyScalar(.8),life:1,scale:.02*Math.random()+.005})}x.current.forEach(e=>{e.velocity.x+=Math.sin(.01*Date.now())*n*.5,e.velocity.z+=Math.cos(.01*Date.now())*n*.5,e.position.add(e.velocity.clone().multiplyScalar(n)),e.life-=1.5*n,e.velocity.y+=.5*n}),x.current.length>120&&(x.current=x.current.slice(-120)),x.current=x.current.filter(e=>e.life>0)}}});let g=()=>{let e=new m.ypk;return e.moveTo(0,0),e.lineTo(-.25,.25),e.lineTo(-.15,-.15),e.lineTo(0,0),e.lineTo(.25,.25),e.lineTo(.15,-.15),e.lineTo(0,0),e.lineTo(0,.08),e.lineTo(.2,.2),e.quadraticCurveTo(.8,.15,1.5,.18),e.quadraticCurveTo(2,.1,2.2,0),e.quadraticCurveTo(2,-.1,1.5,-.18),e.quadraticCurveTo(.8,-.15,.2,-.2),e.lineTo(0,-.08),e.lineTo(0,0),e},y={steps:2,depth:.05,bevelEnabled:!0,bevelThickness:.014,bevelSize:.02,bevelOffset:.04,bevelSegments:2},j={...y,depth:.06,bevelThickness:.02,bevelSize:.02,bevelOffset:0,bevelSegments:6};return(0,n.jsx)("group",{rotation:[-.575,0,.2],children:(0,n.jsxs)("group",{ref:u,position:[p[0],p[1],p[2]],rotation:[0,0,Math.PI],scale:[.8,.8,.7],children:[(0,n.jsxs)("group",{position:[-.025,-.05,.35],rotation:[0,0,-Math.PI],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.03,.04,.9,12]}),(0,n.jsx)("meshStandardMaterial",{color:"#2a3b4c",roughness:.7})]}),[...Array(8)].map((e,t)=>(0,n.jsxs)("mesh",{position:[0,.35-.11*t,0],rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("torusGeometry",{args:[.045,.016,8,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#1a2b3c",metalness:.6,roughness:.4})]},t))]}),(0,n.jsxs)("group",{position:[-.025,.7,.35],rotation:[Math.PI,1.5,Math.PI],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("torusGeometry",{args:[.26,.07,16,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#4a5b6c",metalness:.9,roughness:.1})]}),[...Array(8)].map((e,t)=>(0,n.jsxs)("mesh",{position:[.25*Math.cos(t*Math.PI/4),.25*Math.sin(t*Math.PI/4),0],rotation:[0,0,t*Math.PI/4-Math.PI/2],children:[(0,n.jsx)("coneGeometry",{args:[.07,.55,3]}),(0,n.jsx)("meshStandardMaterial",{color:"#4a5b6c",metalness:.9,roughness:.1})]},"spike-".concat(t))),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.155,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:new m.Q1f(0xffff00),emissive:new m.Q1f(0xff6f00),emissiveIntensity:2,transparent:!0,opacity:1})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.1,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:new m.Q1f(0xffff00),emissive:new m.Q1f(0xffff00),emissiveIntensity:40,transparent:!0,opacity:.8})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.145,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:new m.Q1f(0xffff00),emissive:new m.Q1f(0xff6f00),emissiveIntensity:35,transparent:!0,opacity:.6})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.175,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:new m.Q1f(0xffff00),emissive:new m.Q1f(0xff6f00),emissiveIntensity:30,transparent:!0,opacity:.4})]}),(0,n.jsx)("pointLight",{color:new m.Q1f(0xff6f00),intensity:2,distance:.5,decay:2})]}),(0,n.jsxs)("group",{position:[0,1,.35],rotation:[0,-Math.PI/2,Math.PI/2],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("extrudeGeometry",{args:[g(),y]}),(0,n.jsx)("meshStandardMaterial",{color:new m.Q1f(0xff6f00),emissive:new m.Q1f(0xff6f00),emissiveIntensity:2.5,metalness:.3,roughness:.1})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("extrudeGeometry",{args:[(()=>{let e=new m.ypk;return e.moveTo(0,0),e.lineTo(0,.06),e.lineTo(.15,.15),e.quadraticCurveTo(1.2,.12,1.5,.15),e.quadraticCurveTo(2,.08,2.15,0),e.quadraticCurveTo(2,-.08,1.5,-.15),e.quadraticCurveTo(1.2,-.12,.15,-.15),e.lineTo(0,-.05),e.lineTo(0,0),e})(),j]}),(0,n.jsx)("meshStandardMaterial",{color:new m.Q1f(0xffb700),emissive:new m.Q1f(0xff6f00),emissiveIntensity:5,metalness:.2,roughness:.1,opacity:.8,transparent:!0})]})]}),(0,n.jsx)("group",{children:c&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("group",{position:[0,1,.35],rotation:[0,-Math.PI/2,Math.PI/2],scale:[1.0625,1.25,1.05],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("extrudeGeometry",{args:[g(),{...y,depth:.07}]}),(0,n.jsx)("meshStandardMaterial",{color:new m.Q1f(0xffd700),emissive:new m.Q1f(0xffa500),emissiveIntensity:1.5,transparent:!0,opacity:.3,blending:m.EZo})]})}),x.current.map((e,t)=>(0,n.jsxs)("mesh",{position:e.position.toArray(),scale:[e.scale,e.scale,e.scale],children:[(0,n.jsx)("sphereGeometry",{args:[1.25,6,6]}),(0,n.jsx)("meshStandardMaterial",{color:new m.Q1f(0xffd700),emissive:new m.Q1f(0xffa500),emissiveIntensity:3*e.life,transparent:!0,opacity:.6*e.life,blending:m.EZo})]},t))]})})]})})}let M=(e,t,r)=>e*(1-r)+t*r;function v(e){let{isSwinging:t,onSwingComplete:r,onLeftSwingStart:s,onRightSwingStart:o,isBowCharging:a,hasActiveAbility:l=!1,leftTargetPosition:c=null,rightTargetPosition:u=null}=e,h=(0,i.useRef)(null),d=(0,i.useRef)(0),p=(0,i.useRef)(null),g=(0,i.useRef)(0),y=[-.8,.75,.65],j=[.8,.75,.65],v=(0,i.useRef)(0),P=(0,i.useRef)(!1),S=(0,i.useRef)(0),I=(0,i.useRef)(null),b=(0,i.useRef)(null),[F,E]=(0,i.useState)([]);(0,f.F)((e,n)=>{if(h.current&&p.current){if(a)h.current.position.x+=(-.8-h.current.position.x)*.3,h.current.position.y+=(-.2-h.current.position.y)*.3,h.current.position.z+=(.5-h.current.position.z)*.3,p.current.position.x+=(.8-p.current.position.x)*.3,p.current.position.y+=(-.2-p.current.position.y)*.3,p.current.position.z+=(.5-p.current.position.z)*.3,h.current.rotation.x=M(1.05*h.current.rotation.x,.37*Math.PI,.3),h.current.rotation.z=M(h.current.rotation.z,1.7*Math.PI,.2),p.current.rotation.x=M(1.05*p.current.rotation.x,.37*Math.PI,.3),p.current.rotation.z=M(p.current.rotation.z,-(1.7*Math.PI),.2),d.current=0,g.current=0,S.current=0,v.current=0,P.current=!1;else if(t){if(0===d.current&&0===g.current&&(P.current=!1),h.current){if(S.current<.175)S.current+=n;else{0===d.current&&s(),d.current+=9*n;let e=Math.min(d.current/Math.PI,1),t=y[0]+1.2*Math.sin(e*Math.PI)-.45,r=y[1]+-.25*Math.sin(e*Math.PI*2),i=y[2]+2*Math.sin(e*Math.PI);h.current.position.set(t,r,i);let o=.65*Math.PI*Math.sin(e*Math.PI),a=.3*Math.PI*Math.sin(e*Math.PI),l=-.1*Math.PI*Math.sin(e*Math.PI);h.current.rotation.set(o,a,l),d.current>=Math.PI&&(d.current=0,S.current=0,h.current.rotation.set(0,0,0),h.current.position.set(...y))}}if(p.current){0===g.current&&o(),g.current+=9*n;let e=Math.min(g.current/Math.PI,1),t=j[0]-1.2*Math.sin(e*Math.PI)+.45,i=j[1]+-.25*Math.sin(e*Math.PI*2),s=j[2]+2*Math.sin(e*Math.PI);p.current.position.set(t,i,s);let a=.5*Math.PI*Math.sin(e*Math.PI),l=-(.3*Math.PI*Math.sin(e*Math.PI)),c=.2*Math.PI*Math.sin(e*Math.PI);p.current.rotation.set(a,l,c),g.current>=Math.PI&&(g.current=0,v.current=0,p.current.rotation.set(0,0,0),p.current.position.set(...j),P.current=!0,r())}}else h.current.position.x+=(y[0]-h.current.position.x)*.2,h.current.position.y+=(y[1]-h.current.position.y)*.2,h.current.position.z+=(y[2]-h.current.position.z)*.2,p.current.position.x+=(j[0]-p.current.position.x)*.2,p.current.position.y+=(j[1]-p.current.position.y)*.2,p.current.position.z+=(j[2]-p.current.position.z)*.2,h.current.rotation.x*=.85,h.current.rotation.y*=.85,h.current.rotation.z*=.85,p.current.rotation.x*=.85,p.current.rotation.y*=.85,p.current.rotation.z*=.85,t||(d.current=0,g.current=0,S.current=0,v.current=0,P.current=!1)}});let C=()=>{let e=new m.ypk;return e.moveTo(0,0),e.lineTo(-.15,.1),e.lineTo(-.2,0),e.lineTo(-.2,-.05),e.lineTo(0,0),e.lineTo(.15,.1),e.lineTo(.2,0),e.lineTo(.3,0),e.lineTo(0,0),e.lineTo(0,.05),e.quadraticCurveTo(.3,.15,.5,.2),e.quadraticCurveTo(.7,.25,.9,.15),e.quadraticCurveTo(1,.1,1.1,0),e.quadraticCurveTo(1,-.05,.8,-.1),e.lineTo(.7,-.15),e.lineTo(.65,-.1),e.quadraticCurveTo(.4,-.08,.2,-.05),e.quadraticCurveTo(.1,-.02,0,0),e},R=()=>{let e=new m.ypk;return e.moveTo(0,0),e.lineTo(-.13,.08),e.lineTo(-.18,0),e.lineTo(-.08,-.04),e.lineTo(0,0),e.lineTo(.13,.08),e.lineTo(.18,0),e.lineTo(.08,-.04),e.lineTo(0,0),e.lineTo(0,.04),e.quadraticCurveTo(.28,.13,.48,.18),e.quadraticCurveTo(.68,.23,.88,.13),e.quadraticCurveTo(.98,.08,1.08,0),e.quadraticCurveTo(.98,-.04,.78,-.08),e.lineTo(.68,-.13),e.lineTo(.63,-.08),e.quadraticCurveTo(.38,-.06,.18,-.04),e.quadraticCurveTo(.08,-.02,0,0),e},k={steps:2,depth:.02,bevelEnabled:!0,bevelThickness:.004,bevelSize:.01,bevelSegments:3},T={...k,depth:.025,bevelThickness:.003,bevelSize:.004,bevelOffset:0};return(0,i.useEffect)(()=>{l&&c&&d.current>0&&E(e=>[...e,{id:Math.random(),position:c}])},[l,c]),(0,i.useEffect)(()=>{l&&u&&g.current>0&&E(e=>[...e,{id:Math.random(),position:u}])},[l,u]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("group",{position:[0,-.6,.5],rotation:[-.55,0,0],scale:[.875,.8,.8],children:[(0,n.jsxs)("group",{ref:h,position:[y[0],y[1],y[2]],rotation:[0,0,Math.PI],scale:[1,1,.875],children:[(0,n.jsxs)("group",{position:[.2,-.125,0],rotation:[0,0,-Math.PI],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.015,.02,.45,12]}),(0,n.jsx)("meshStandardMaterial",{color:"#2a3b4c",roughness:.7})]}),[void 0,void 0,void 0,void 0].map((e,t)=>(0,n.jsxs)("mesh",{position:[0,.175-.065*t,0],children:[(0,n.jsx)("torusGeometry",{args:[.0225,.004,8,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#1a2b3c",metalness:.6,roughness:.4})]},t))]}),(0,n.jsxs)("group",{position:[.2,.3,0],rotation:[0,Math.PI/2,Math.PI/2],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("extrudeGeometry",{args:[C(),k]}),(0,n.jsx)("meshStandardMaterial",{color:"#0066ff",emissive:"#0088ff",emissiveIntensity:3,metalness:.9,roughness:.2,opacity:.9,transparent:!0})]}),(0,n.jsxs)("mesh",{position:[0,0,-.02],children:["  ",(0,n.jsx)("extrudeGeometry",{args:[R(),{...T,depth:.06}]}),(0,n.jsx)("meshStandardMaterial",{color:"#0033ff",emissive:"#0066ff",emissiveIntensity:8,metalness:.7,roughness:.1,opacity:.4,transparent:!0})]}),(0,n.jsx)("pointLight",{color:"#0088ff",intensity:5,distance:2,decay:2}),l&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("mesh",{ref:I,position:[-.15,0,0],children:[(0,n.jsx)("sphereGeometry",{args:[.06,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#0066ff",emissive:"#0088ff",emissiveIntensity:3,transparent:!0,opacity:.9})]}),(0,n.jsx)(x,{meshRef:I,color:new m.Q1f("#0088ff"),size:.04,opacity:.6})]})]})]}),(0,n.jsxs)("group",{ref:p,position:[j[0],j[1],j[2]],rotation:[0,0,Math.PI],scale:[1,1,.875],children:[(0,n.jsxs)("group",{position:[-.2,-.125,0],rotation:[0,0,-Math.PI],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.015,.02,.45,12]}),(0,n.jsx)("meshStandardMaterial",{color:"#2a3b4c",roughness:.7})]}),[void 0,void 0,void 0,void 0].map((e,t)=>(0,n.jsxs)("mesh",{position:[0,.175-.065*t,0],children:[(0,n.jsx)("torusGeometry",{args:[.0225,.004,8,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#1a2b3c",metalness:.6,roughness:.4})]},t))]}),(0,n.jsxs)("group",{position:[-.2,.3,0],rotation:[0,Math.PI/2,Math.PI/2],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("extrudeGeometry",{args:[C(),k]}),(0,n.jsx)("meshStandardMaterial",{color:"#0066ff",emissive:"#0088ff",emissiveIntensity:2,metalness:.9,roughness:.2,opacity:.9,transparent:!0})]}),(0,n.jsxs)("mesh",{position:[0,0,-.02],children:["  ",(0,n.jsx)("extrudeGeometry",{args:[R(),{...T,depth:.06}]}),(0,n.jsx)("meshStandardMaterial",{color:"#0033ff",emissive:"#0066ff",emissiveIntensity:3.5,metalness:.7,roughness:.1,opacity:.4,transparent:!0})]}),(0,n.jsx)("pointLight",{color:"#0088ff",intensity:1.5,distance:2,decay:2}),l&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("mesh",{ref:b,position:[-.15,0,0],children:[(0,n.jsx)("sphereGeometry",{args:[.06,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#0066ff",emissive:"#0088ff",emissiveIntensity:3,transparent:!0,opacity:.9})]}),(0,n.jsx)(x,{meshRef:b,color:new m.Q1f("#0088ff"),size:.04,opacity:.6})]})]})]})]}),F.map(e=>(0,n.jsx)(w,{position:e.position,onComplete:()=>{E(t=>t.filter(t=>t.id!==e.id))}},e.id))]})}let w=e=>{let{position:t,onComplete:r}=e,[s,o]=(0,i.useState)(()=>Array(15).fill(null).map(()=>({position:new m.Pq0(t.x+(Math.random()-.5)*.2,t.y,t.z+(Math.random()-.5)*.2),velocity:new m.Pq0((Math.random()-.5)*2,3*Math.random(),(Math.random()-.5)*2),scale:.3*Math.random()+.1,life:1})));return(0,f.F)((e,t)=>{o(e=>{let n=e.map(e=>(e.velocity.y-=5*t,e.position.add(e.velocity.multiplyScalar(t)),e.life-=1.5*t,e)).filter(e=>e.life>0);return 0===n.length&&r(),n})}),(0,n.jsx)("group",{children:s.map((e,t)=>(0,n.jsxs)("mesh",{position:e.position.toArray(),scale:[e.scale,e.scale,e.scale],children:[(0,n.jsx)("icosahedronGeometry",{args:[1,0]}),(0,n.jsx)("meshStandardMaterial",{color:"#A5F3FC",emissive:"#A5F3FC",emissiveIntensity:1.5,transparent:!0,opacity:.7*e.life,depthWrite:!1,blending:m.EZo})]},t))})};function P(e){let{chargeProgress:t,isCharging:r,onRelease:s}=e,o=(0,i.useRef)(null),a=(0,i.useRef)(r),l=(0,i.useRef)(null);return(0,f.F)(()=>{!a.current&&r&&(l.current=Date.now()),a.current&&!r&&(s(Math.min((l.current?(Date.now()-l.current)/1e3:0)/2,1)),l.current=null),a.current=r}),(0,n.jsx)("group",{position:[.6,.6,.6],rotation:[-Math.PI/2,-Math.PI/2,-Math.PI/2],scale:[.875,.8,.8],children:(0,n.jsxs)("group",{ref:o,position:[-.9,0,.75],rotation:[Math.PI,Math.PI/2,0],children:[(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("tubeGeometry",{args:[new m.B6O([new m.Pq0(-.875,0,0),new m.Pq0(-.85,.2,0),new m.Pq0(-.25,.5,0),new m.Pq0(-.4,.35,0),new m.Pq0(.4,.35,0),new m.Pq0(.25,.5,0),new m.Pq0(.85,.2,0),new m.Pq0(.875,0,0)]),64,.035,8,!1]}),(0,n.jsx)("meshStandardMaterial",{color:"#C18C4B",emissive:"#C18C4B",emissiveIntensity:1.5,transparent:!0,opacity:.8})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("tubeGeometry",{args:[(e=>{let t=1.35*e;return new m.s0K(new m.Pq0(-.8,0,0),new m.Pq0(0,0,-t),new m.Pq0(0,0,-t),new m.Pq0(.8,0,0))})(t),16,.02,8,!1]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",emissive:"#ffffff",emissiveIntensity:1,transparent:!0,opacity:.6})]}),(0,n.jsxs)("group",{children:[(0,n.jsxs)("mesh",{position:[-.4,0,.475],rotation:[Math.PI/2,0,Math.PI/6],children:[(0,n.jsx)("boxGeometry",{args:[.6,.02,.05]}),(0,n.jsx)("meshStandardMaterial",{color:"#C18C4B",emissive:"#C18C4B",emissiveIntensity:1.5,transparent:!0,opacity:.8})]}),(0,n.jsxs)("mesh",{position:[.4,0,.475],rotation:[Math.PI/2,0,-Math.PI/6],children:[(0,n.jsx)("boxGeometry",{args:[.6,.02,.05]}),(0,n.jsx)("meshStandardMaterial",{color:"#C18C4B",emissive:"#C18C4B",emissiveIntensity:1.5,transparent:!0,opacity:.8})]})]}),r&&(0,n.jsxs)("group",{position:[0,0,.8-1.35*t],rotation:[Math.PI/2,0,0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.015,.02,.9,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#00ffff",emissive:"#00ffff",emissiveIntensity:3,transparent:!0,opacity:.9})]}),(0,n.jsxs)("mesh",{position:[0,.35,0],children:[(0,n.jsx)("coneGeometry",{args:[.03,.175,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#00ffff",emissive:"#00ffff",emissiveIntensity:3,transparent:!0,opacity:.9})]})]})]})})}function S(e){let{isSwinging:t,onSwingComplete:r,enemyData:s,onHit:o,setDamageNumbers:a,nextDamageNumberId:l,isWhirlwinding:c=!1,fireballCharges:u=[]}=e,h=(0,i.useRef)(null),d=(0,i.useRef)(0),p=[-1.18,.225,-.3],x=(0,i.useRef)({}),g=(0,i.useRef)({}),y=(0,i.useRef)(0),j=(0,i.useRef)(0),M=(0,i.useRef)(!1),v=u.some(e=>e.available),w=c&&v;(0,i.useEffect)(()=>{c&&!v&&j.current>0&&(j.current=Math.max(j.current-5,0)),M.current=w},[c,v,w]),(0,f.F)((e,n)=>{if(h.current){if(w){j.current=Math.min(j.current+15*n,35),y.current+=n*j.current;let e=y.current,t=2.5*Math.cos(e),r=2.5*Math.sin(e);h.current.rotation.set(Math.PI/3,-e+Math.PI,1),h.current.rotateY(-e+Math.PI),h.current.position.set(t,.4,r);return}if(j.current>0){if(j.current=Math.max(0,j.current-30*n),y.current+=n*j.current,j.current<.5)j.current=0,h.current.position.x+=(p[0]-h.current.position.x)*.75,h.current.position.y+=(p[1]-h.current.position.y)*.75,h.current.position.z+=(p[2]-h.current.position.z)*.75,h.current.rotation.x+=(-Math.PI/2-h.current.rotation.x)*.75,h.current.rotation.y+=(0-h.current.rotation.y)*.75,h.current.rotation.z+=(Math.PI-h.current.rotation.z)*.75;else{let e=y.current,t=2.5*Math.cos(e),r=2.5*Math.sin(e);h.current.rotation.set(Math.PI/3,-e+Math.PI,1),h.current.rotateY(-e+Math.PI),h.current.position.set(t,.4,r)}return}if(t){let e;0===d.current&&(x.current={},g.current={}),d.current+=15*n;let t=Math.min(d.current/Math.PI/1.5,1);if(t>.4&&t<.8&&o&&a&&l&&(null==s||s.forEach(e=>{let t=Date.now();if(t-(g.current[e.id]||0)<200||x.current[e.id])return;let r=h.current.localToWorld(new m.Pq0(0,1,.35)),n=new m.Pq0(0,0,1).applyQuaternion(h.current.quaternion).normalize(),i=new m.Pq0().subVectors(e.position,r).dot(n);if(i>0&&i<=8){let s=new m.Pq0().copy(r).add(n.clone().multiplyScalar(i));1>=new m.Pq0().subVectors(e.position,s).length()&&(o(e.id,29),a(t=>[...t,{id:l.current++,damage:29,position:e.position.clone(),isCritical:!1}]),x.current[e.id]=1,g.current[e.id]=t)}})),d.current>=.75*Math.PI){d.current=0,x.current={},g.current={},h.current.rotation.set(0,0,Math.PI),h.current.position.set(...p),null==r||r();return}e=t<.25?p[2]+-(t/.2*.65):t<.5?p[2]+-.65+(3.35+Math.abs(-.65))*Math.sin((t-.2)/.3*Math.PI/2):p[2]+3.35*(1-(t-.5)/.5),h.current.position.set(p[0],p[1],e);let i=-Math.PI/2;t<.2?i+=t/.2*.1:t<.5&&(i+=.1-(t-.2)/.3*.1),h.current.rotation.set(i,0,Math.PI)}else 0===j.current&&(h.current.rotation.x=-Math.PI/2,h.current.rotation.y=0,h.current.rotation.z=Math.PI,h.current.position.x+=(p[0]-h.current.position.x)*.2,h.current.position.y+=(p[1]-h.current.position.y)*.2,h.current.position.z+=(p[2]-h.current.position.z)*.2)}});let P=()=>{let e=new m.ypk;return e.moveTo(0,0),e.lineTo(.15,-.23),e.bezierCurveTo(.8,.22,1.13,.5,1.8,1.6),e.lineTo(1.125,.75),e.bezierCurveTo(.5,.2,.225,0,.1,.7),e.lineTo(0,0),e},S=()=>{let e=new m.ypk;return e.moveTo(0,0),e.lineTo(0,.06),e.lineTo(.15,.15),e.quadraticCurveTo(1.2,.12,1.5,.15),e.quadraticCurveTo(2,.08,2.15,0),e.quadraticCurveTo(2,-.08,1.5,-.15),e.quadraticCurveTo(1.2,-.12,.15,-.15),e.lineTo(0,-.05),e.lineTo(0,0),e},I={steps:2,depth:.05,bevelEnabled:!0,bevelThickness:.014,bevelSize:.02,bevelOffset:.04,bevelSegments:2},b={...I,depth:.06,bevelThickness:.02,bevelSize:.02,bevelOffset:0,bevelSegments:6};return(0,n.jsx)("group",{position:[0,-.4,.6],rotation:[-.55,.15,0],scale:[.875,.8,.8],children:(0,n.jsxs)("group",{ref:h,position:[p[0],p[1],p[2]],rotation:[Math.PI/2,0,0],scale:[.8,.8,.7],children:[(0,n.jsxs)("group",{position:[-.025,-.55,.35],rotation:[0,0,-Math.PI],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.03,.04,2.2,12]}),(0,n.jsx)("meshStandardMaterial",{color:"#2a3b4c",roughness:.7})]}),[...Array(12)].map((e,t)=>(0,n.jsxs)("mesh",{position:[0,1-.18*t,0],rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("torusGeometry",{args:[.045,.016,8,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#1a2b3c",metalness:.6,roughness:.4})]},t))]}),(0,n.jsxs)("group",{position:[-.025,.45,.35],rotation:[Math.PI,1.5,Math.PI],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("torusGeometry",{args:[.26,.07,16,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#4a5b6c",metalness:.9,roughness:.1})]}),[...Array(8)].map((e,t)=>(0,n.jsxs)("mesh",{position:[.25*Math.cos(t*Math.PI/4),.25*Math.sin(t*Math.PI/4),0],rotation:[0,0,t*Math.PI/4-Math.PI/2],children:[(0,n.jsx)("coneGeometry",{args:[.07,.55,3]}),(0,n.jsx)("meshStandardMaterial",{color:"#4a5b6c",metalness:.9,roughness:.1})]},"spike-".concat(t))),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.155,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:new m.Q1f(0xff0000),emissive:new m.Q1f(0xff0000),emissiveIntensity:2,transparent:!0,opacity:1})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.1,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:new m.Q1f(0xff0000),emissive:new m.Q1f(0xff0000),emissiveIntensity:40,transparent:!0,opacity:.8})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.145,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:new m.Q1f(0xff0000),emissive:new m.Q1f(0xff0000),emissiveIntensity:35,transparent:!0,opacity:.6})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.175,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:new m.Q1f(0xff0000),emissive:new m.Q1f(0xff0000),emissiveIntensity:30,transparent:!0,opacity:.4})]}),(0,n.jsx)("pointLight",{color:new m.Q1f(0xff0000),intensity:2,distance:.5,decay:2})]}),(0,n.jsxs)("group",{position:[0,.75,.35],children:[(0,n.jsx)("group",{rotation:[0,0,0],children:(0,n.jsx)("group",{rotation:[0,0,.7],scale:[.55,.55,-.55],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("extrudeGeometry",{args:[P(),I]}),(0,n.jsx)("meshStandardMaterial",{color:new m.Q1f(0xff0000),emissive:new m.Q1f(0xff0000),emissiveIntensity:1.55,metalness:.8,roughness:.1,opacity:.8,transparent:!0,side:m.$EB})]})})}),(0,n.jsx)("group",{rotation:[0,2*Math.PI/3,Math.PI/2],children:(0,n.jsx)("group",{rotation:[0,0,5.33],scale:[.55,.55,-.55],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("extrudeGeometry",{args:[P(),I]}),(0,n.jsx)("meshStandardMaterial",{color:new m.Q1f(0xff0000),emissive:new m.Q1f(0xff0000),emissiveIntensity:1.55,metalness:.8,roughness:.1,opacity:.8,transparent:!0,side:m.$EB})]})})}),(0,n.jsx)("group",{rotation:[0,4*Math.PI/3,Math.PI/2],children:(0,n.jsx)("group",{rotation:[0,0,5.33],scale:[.55,.55,-.55],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("extrudeGeometry",{args:[P(),I]}),(0,n.jsx)("meshStandardMaterial",{color:new m.Q1f(0xff0000),emissive:new m.Q1f(0xff0000),emissiveIntensity:1.55,metalness:.8,roughness:.1,opacity:.8,transparent:!0,side:m.$EB})]})})})]}),(0,n.jsxs)("group",{position:[0,.65,.35],rotation:[0,-Math.PI/2,Math.PI/2],scale:[.8,.8,.5],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("extrudeGeometry",{args:[S(),I]}),(0,n.jsx)("meshStandardMaterial",{color:new m.Q1f(0xff0000),emissive:new m.Q1f(0xff0000),emissiveIntensity:1.5,metalness:.3,roughness:.1})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("extrudeGeometry",{args:[S(),b]}),(0,n.jsx)("meshStandardMaterial",{color:new m.Q1f(0xff0000),emissive:new m.Q1f(0xff0000),emissiveIntensity:1,metalness:.2,roughness:.1,opacity:.8,transparent:!0})]})]})]})})}function I(e){let{position:t,onComplete:r}=e,s=(0,i.useRef)(null),o=(0,i.useRef)(0),a=(0,i.useRef)(0),l=(0,i.useMemo)(()=>({core:new m.Ho_(.105,.105,20,16),inner:new m.Ho_(.25,.25,20,16),outer:new m.Ho_(.42,.42,20,16),glow1:new m.Ho_(.6,.6,20,16),glow2:new m.Ho_(.75,.6,20,16),outerGlow:new m.Ho_(.8,.9,20,16),torus:new m.O3Y(1.175,.1,8,32),skyTorus:new m.O3Y(1,.1,32,32),sphere:new m.Gu$(.15,8,8)}),[]),c=(0,i.useMemo)(()=>({core:new m._4j({color:"#FF7300",emissive:"#FFD500",emissiveIntensity:50,transparent:!0,opacity:.995}),inner:new m._4j({color:"#FF7300",emissive:"#FFD500",emissiveIntensity:25,transparent:!0,opacity:.675}),outer:new m._4j({color:"#FF7300",emissive:"#FFD500",emissiveIntensity:5,transparent:!0,opacity:.625}),glow1:new m._4j({color:"#FF7300",emissive:"#FFD500",emissiveIntensity:2.5,transparent:!0,opacity:.55}),glow2:new m._4j({color:"#FF7300",emissive:"#FF8812",emissiveIntensity:2.5,transparent:!0,opacity:.425}),outerGlow:new m._4j({color:"#FF7300",emissive:"#FF8812",emissiveIntensity:1,transparent:!0,opacity:.2}),spiral:new m._4j({color:"#FF0000",emissive:"#FF8812",emissiveIntensity:10,transparent:!0,opacity:.5}),skySpiral:new m._4j({color:"#FF0000",emissive:"#FF8812",emissiveIntensity:10,transparent:!0,opacity:.4}),particle:new m._4j({color:"#FF0000",emissive:"#FF8812",emissiveIntensity:10,transparent:!0,opacity:.665})}),[]),u=(0,i.useMemo)(()=>[,,,].fill(0).map((e,t)=>({rotation:new m.O9p(Math.PI/4,t*Math.PI/1.5,Math.PI)})),[]),h=(0,i.useMemo)(()=>Array(16).fill(0).map((e,t)=>({rotation:new m.O9p(0,t*Math.PI/1.5,0),position:new m.Pq0(0,7.45,0)})),[]),d=(0,i.useMemo)(()=>Array(8).fill(0).map((e,t)=>({position:new m.Pq0(1*Math.cos(t*Math.PI/4),(t-4)*2,1*Math.sin(t*Math.PI/4))})),[]);return(0,f.F)((e,t)=>{if(!s.current)return;if(a.current<.05){a.current+=t;return}o.current+=t;let n=Math.min(o.current/.9,1);if(n<1){s.current.position.y=40*(1-n);let e=n<.9?1:1-(n-.9)/.1;s.current.scale.set(e,e,e)}else r()}),(0,n.jsxs)("group",{ref:s,position:[t.x,25,t.z],visible:a.current>=.05,children:[(0,n.jsx)("mesh",{geometry:l.core,material:c.core}),(0,n.jsx)("mesh",{geometry:l.inner,material:c.inner}),(0,n.jsx)("mesh",{geometry:l.outer,material:c.outer}),(0,n.jsx)("mesh",{geometry:l.glow1,material:c.glow1}),(0,n.jsx)("mesh",{geometry:l.glow2,material:c.glow2}),(0,n.jsx)("mesh",{geometry:l.outerGlow,material:c.outerGlow}),u.map((e,t)=>(0,n.jsx)("mesh",{rotation:e.rotation,geometry:l.torus,material:c.spiral},t)),h.map((e,t)=>(0,n.jsx)("mesh",{rotation:e.rotation,position:e.position,geometry:l.skyTorus,material:c.skySpiral},t)),d.map((e,t)=>(0,n.jsx)("mesh",{position:e.position,geometry:l.sphere,material:c.particle},t)),(0,n.jsx)("pointLight",{position:[0,-10,0],color:"#ff8800",intensity:35,distance:25}),(0,n.jsx)("pointLight",{position:[0,0,0],color:"#ffaa00",intensity:10,distance:6})]})}var b=r(2027);function F(e){let{damage:t,position:r,isCritical:s=!1,isLightning:o=!1,isBlizzard:a=!1,isHealing:l=!1,isBoneclaw:c=!1,isOathstrike:u=!1,isFirebeam:h=!1,isOrbShield:d=!1,isChainLightning:m=!1,isFireball:p=!1,isSummon:x=!1,isStealthStrike:g=!1,isPyroclast:y=!1,isEagleEye:j=!1,isBreach:M=!1,isBowLightning:v=!1,onComplete:w}=e,P=(0,i.useRef)(null),S=(0,i.useRef)(Date.now()),I=r.y+3.5,{camera:F}=(0,f.D)(),E=Date.now()%1e3/1e3,C=.3*Math.sin(E*Math.PI*2),R=.2*Math.cos(E*Math.PI*2);return(0,f.F)(()=>{if(!P.current)return;let e=(Date.now()-S.current)/1e3;if(e>=1.5){w();return}P.current.quaternion.copy(F.quaternion);let t=e/1.5,n=I+1.2*(1-Math.pow(1-t,3)),i=r.x+C;P.current.position.set(i,n+R,r.z),P.current.material.opacity=Math.min(1,3*(1-t))}),(0,n.jsx)(b.E,{ref:P,position:[r.x,I,r.z],fontSize:.6,color:l?"#338C66":M?"#FF6A00":m?"#ffff00":d?"#13F3FF":j?"#48FF00":s?"#FF2D22":x?"#B999FF":c?"#00FF11":o?"#FFD000":u?"#FF9441":h?"#00FFE5":a?"#00B7FF":p?"#00C946":g?"#FF00FF":y?"#FF6A00":v?"#80D9FF":"#EBEBEB",anchorX:"center",anchorY:"middle",outlineWidth:.05,outlineColor:"#000000","material-transparent":!0,"material-depthTest":!1,children:l?"+".concat(t):t})}function E(e){let{children:t,position:r=[0,0,0],lockX:s=!1,lockY:o=!1,lockZ:a=!1}=e,l=(0,i.useRef)(null);return(0,f.F)(e=>{let{camera:t}=e;if(!l.current)return;let r=l.current.position,n=t.position,i=new m.Pq0().subVectors(n,r),c=l.current.rotation.clone();o||(c.y=Math.atan2(i.x,i.z)),s||(c.x=Math.atan2(-i.y,Math.sqrt(i.x*i.x+i.z*i.z))),a||(c.z=0),l.current.rotation.set(c.x,c.y,c.z)}),(0,n.jsx)("group",{ref:l,position:r,children:t})}function C(e){let{parentRef:t,weaponType:r}=e,o=(0,i.useRef)([]),a=(0,i.useRef)([]),[l,c]=(0,i.useState)(!1);(0,i.useEffect)(()=>{if(t.current){let e=t.current.position.clone();a.current=Array(30).fill(0).map(()=>e.clone()),c(!0)}},[t]);let u=()=>{switch(r){case s.SCYTHE:return"#00FF37";case s.SWORD:return"#FFB300";case s.SABRES:return"#00BFFF";case s.SPEAR:return"#FF544E";case s.BOW:return"#3A905E"}};return((0,f.F)(()=>{if(!t.current||!l)return;let e=t.current.position.clone();a.current.unshift(e),a.current=a.current.slice(0,30),o.current.forEach((e,t)=>{e&&a.current[t]&&(e.position.copy(a.current[t]),e.scale.setScalar(1-t/30*.6),e.material&&e.material instanceof m.V9B&&(e.material.opacity=(1-t/30)*.2))})}),l)?(0,n.jsx)(n.Fragment,{children:Array.from({length:30}).map((e,t)=>(0,n.jsxs)("mesh",{ref:e=>{e&&(o.current[t]=e)},children:[(0,n.jsx)("sphereGeometry",{args:[.43,32,32]}),(0,n.jsx)("meshBasicMaterial",{color:new m.Q1f(u()),transparent:!0,opacity:.3,depthWrite:!1})]},t))}):null}function R(e){let{collectedBones:t,isLeftWing:r}=e,s=(0,i.useRef)(null),o=[{pos:new m.Pq0(r?-.3:.3,.275,0),rot:new m.O9p(0,0,r?-Math.PI/5:Math.PI/5),scale:1.2},{pos:new m.Pq0(r?-.5:.5,.45,0),rot:new m.O9p(0,0,r?-Math.PI/3.5:Math.PI/3.5),scale:1.4},{pos:new m.Pq0(r?-.65:.65,.6,0),rot:new m.O9p(0,0,r?-Math.PI/2.5:Math.PI/2.5),scale:1},{pos:new m.Pq0(r?-.85:.85,.72,.1),rot:new m.O9p(.1,0,r?-Math.PI/2.2:Math.PI/2.2),scale:1},{pos:new m.Pq0(r?-1.05:1.05,.8,.2),rot:new m.O9p(.2,0,r?-Math.PI/2:Math.PI/2),scale:.9},{pos:new m.Pq0(r?-1.2:1.2,.9,.2),rot:new m.O9p(.2,0,r?-Math.PI/1.8:Math.PI/1.8),scale:.8},{pos:new m.Pq0(r?-1.3:1.3,.75,.2),rot:new m.O9p(.05,0,r?-(-Math.PI/.475):-(Math.PI/.475)),scale:1},{pos:new m.Pq0(r?-1.13:1.13,.445,.17),rot:new m.O9p(.2,0,r?-(-Math.PI/.45):-(Math.PI/.45)),scale:.8}],a=()=>(0,n.jsxs)("group",{children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.023,.0175,.32,3]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",emissive:"#304040",emissiveIntensity:.6,roughness:.3,metalness:.4})]}),(0,n.jsxs)("mesh",{position:new m.Pq0(0,.2,0),children:[(0,n.jsx)("sphereGeometry",{args:[.035,4,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",emissive:"#304040",emissiveIntensity:.6,roughness:.4,metalness:.3})]})]});return(0,n.jsx)("group",{ref:s,rotation:new m.O9p(0,Math.PI,0),position:new m.Pq0(0,-.3,0),children:o.slice(0,Math.min(15,t)).map((e,t)=>(0,n.jsx)("group",{position:e.pos,rotation:e.rot,scale:e.scale,children:a()},"bone-".concat(t)))})}let k=()=>(0,n.jsxs)("group",{rotation:[Math.PI/4,0,0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.0175,.0175,.175,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",roughness:.4,metalness:.3})]}),(0,n.jsxs)("mesh",{position:new m.Pq0(0,.1,0),rotation:new m.O9p(0,0,Math.PI/6),children:[(0,n.jsx)("sphereGeometry",{args:[.03,4,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",roughness:.5,metalness:.2})]}),(0,n.jsxs)("mesh",{position:new m.Pq0(0,-.1,0),rotation:new m.O9p(0,0,-Math.PI/6),children:[(0,n.jsx)("sphereGeometry",{args:[.0325,4,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#a4a4a4",roughness:.5,metalness:.2})]})]});function T(e){let{parentRef:t}=e,r=(0,i.useRef)([]),s=(0,i.useRef)(null);return(0,f.F)(()=>{if(!t.current||!s.current)return;let e=t.current.position;s.current.position.set(e.x,0,e.z),r.current.forEach((e,t)=>{let r=t/16*Math.PI*2+.001*Date.now(),n=-(.465*Math.cos(r)*1.1),i=.465*Math.sin(r)*1.1,s=.02*Math.sin(.002*Date.now()+t);e.position.set(n,s+.13,i),e.rotation.y=r+Math.PI/3})}),(0,n.jsx)("group",{ref:s,children:Array.from({length:16}).map((e,t)=>(0,n.jsx)("mesh",{ref:e=>{e&&(r.current[t]=e)},children:k()},t))})}let _=()=>{let e=(0,i.useRef)(null),t=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(0,n.jsxs)("group",{position:[0,e,0],scale:t,children:[(0,n.jsxs)("group",{rotation:[0,0,-Math.PI/3],children:[(0,n.jsxs)("mesh",{position:[.085,.05,.08],rotation:[.3,Math.PI/2,-.5],children:[(0,n.jsx)("torusGeometry",{args:[.2,.022,8,12,1.1*Math.PI]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("mesh",{position:[0,0,-.1],children:[(0,n.jsx)("sphereGeometry",{args:[.0375,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]})]}),(0,n.jsxs)("group",{rotation:[0,0,Math.PI/3],children:[(0,n.jsxs)("mesh",{position:[-.085,.05,.08],rotation:[.3,-Math.PI/2,0],children:[(0,n.jsx)("torusGeometry",{args:[.2,.022,8,12,1.1*Math.PI]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("mesh",{position:[-.3,-.15,0],children:[(0,n.jsx)("sphereGeometry",{args:[.02,4,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.06,.05,.075,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]})]})};return(0,n.jsx)("group",{ref:e,position:[0,.04,-0],rotation:[.25,Math.PI+Math.PI,0],children:(0,n.jsxs)("group",{children:[(0,n.jsxs)("group",{children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.04,.04,.9,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),[-.3,-.15,0,.15,.3].map((e,t)=>(0,n.jsxs)("group",{position:[0,e,0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.06,.06,.04,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]}),(0,n.jsxs)("mesh",{position:[0,0,-.125],children:[(0,n.jsx)("boxGeometry",{args:[.0175,.06,.075]}),(0,n.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]})]},t))]}),(0,n.jsxs)("group",{position:[0,0,0],children:[t(.45,.7),t(.3,.8),t(.15,.9),t(0,1),t(-.15,.9),t(-.3,.8),t(-.45,.7)]})]})})},D=e=>{let{movementDirection:t=new m.Pq0}=e,r=(0,i.useRef)(null),[s,o]=(0,i.useState)({x:0,y:0});(0,f.F)(e=>{let{clock:n}=e;if(!r.current)return;let i=n.getElapsedTime(),s=.035*Math.sin(.7*i),a=.175*Math.sin(.5*i),l=1.2*t.length(),c=-(.45*t.z)*l,u=-(.125*t.x)*l,h=Math.min(1.5*l,1),d=s*(1-h)+c*h,m=a*(1-h)+u*h;o({x:d,y:m}),r.current.rotation.x=.1+d,r.current.rotation.y=m});let a=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1?arguments[1]:void 0,r=1.8*Math.pow(t/20,5),i=.8*Math.pow((t+1)/15,2.2),o=Math.max(0,1-t/15),a=s.x*o,l=s.y*Math.pow(o,1.2),c=Math.PI,u=Math.atan2(i-r,.4*(1-t/20))+(0===t?c:0)+a*(1-t/15);return(0,n.jsxs)("group",{position:[0,-r+.325,-(.2*t)*(1-t/40-.1)],scale:e,rotation:[-u+.85*a,l*(1-t/2),0],children:[(0,n.jsxs)("mesh",{rotation:[-(Math.PI/4),0,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.04,.055,.125,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",emissive:"#304040",emissiveIntensity:.6,roughness:.3,metalness:.4})]}),(0,n.jsxs)("group",{rotation:[Math.PI/2,0,Math.PI/2],children:[(0,n.jsxs)("mesh",{position:[0,.08,0],children:[(0,n.jsx)("coneGeometry",{args:[.02,.06,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",emissive:"#304040",emissiveIntensity:.6,roughness:.3,metalness:.4})]}),(0,n.jsxs)("mesh",{position:[.08,0,0],rotation:[0,0,Math.PI/2],children:[(0,n.jsx)("coneGeometry",{args:[.015,.25,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",emissive:"#304040",emissiveIntensity:.6,roughness:.3,metalness:.4})]}),(0,n.jsxs)("mesh",{position:[-.085,0,0],rotation:[0,0,-(Math.PI/2)],children:[(0,n.jsx)("coneGeometry",{args:[.015,.2,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",emissive:"#304040",emissiveIntensity:.6,roughness:.3,metalness:.4})]})]}),(0,n.jsxs)("group",{rotation:[Math.PI/24,0,-Math.PI/2],children:[(0,n.jsxs)("mesh",{position:[0,.08,0],children:[(0,n.jsx)("coneGeometry",{args:[.02,.06,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",emissive:"#304040",emissiveIntensity:.6,roughness:.3,metalness:.4})]}),(0,n.jsxs)("mesh",{position:[.05,0,0],rotation:[0,0,2*Math.PI],children:[(0,n.jsx)("coneGeometry",{args:[.0125,.04,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",emissive:"#304040",emissiveIntensity:.6,roughness:.3,metalness:.4})]}),(0,n.jsxs)("mesh",{position:[-.085,0,0],rotation:[0,0,Math.PI/2],children:[(0,n.jsx)("coneGeometry",{args:[.015,.04,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",emissive:"#304040",emissiveIntensity:.6,roughness:.3,metalness:.4})]})]}),(0,n.jsxs)("mesh",{position:[0,.025,.06],rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("sphereGeometry",{args:[.025,6,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",emissive:"#304040",emissiveIntensity:.6,roughness:.3,metalness:.4})]})]})};return(0,n.jsx)("group",{ref:r,position:[0,-.7,-.25],rotation:[-.1,0,0],children:[...Array(15)].map((e,t)=>a(1-.04*t,t))})},G=e=>{switch(e){case s.SCYTHE:return"#5EFF00";case s.SWORD:return"#FF9748";case s.SABRES:return"#00AAFF";case s.SPEAR:return"#FF544E";case s.BOW:return"#3A905E";default:return"#00ff44"}},A=e=>{let t=G(e);return(0,n.jsxs)("group",{children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("boxGeometry",{args:[.1075,.02,.025]}),(0,n.jsx)("meshStandardMaterial",{color:t,transparent:!0,opacity:.6,emissive:t,emissiveIntensity:.55})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.035,9,9]}),(0,n.jsx)("meshStandardMaterial",{color:t,emissive:t,emissiveIntensity:.7,transparent:!0,opacity:.4})]})]})};function B(e){let{parentRef:t,weaponType:r}=e,s=(0,i.useRef)([]),o=(0,i.useRef)(null);return(0,f.F)(e=>{let{clock:r}=e;if(!t.current||!o.current)return;let n=t.current.position;o.current.position.set(n.x,0,n.z),s.current.forEach((e,t)=>{if(!e)return;let n=r.getElapsedTime(),i=t/32*.625,s=t/32*Math.PI*4+2*n,o=.45*(1-.875*i),a=Math.cos(s)*o,l=Math.sin(s)*o;e.position.set(a,i,l),e.rotation.y=s+Math.PI/2,e.rotation.x=Math.PI/6,e.rotation.z=.1*Math.sin(3*n+t);let c=e.children[0];c&&c.material&&(c.material.opacity=Math.max(.1,1-2*i))})}),(0,n.jsxs)("group",{ref:o,children:[(0,n.jsx)("pointLight",{color:G(r),intensity:2,distance:1.3,position:[0,.15,0]}),(0,n.jsx)("pointLight",{color:G(r),intensity:1,distance:2,position:[0,.1,0],decay:2}),Array.from({length:32}).map((e,t)=>(0,n.jsx)("group",{ref:e=>{e&&(s.current[t]=e)},children:A(r)},t))]})}class z{static getInstance(){return z.instance||(z.instance=new z),z.instance}activateStealth(){this.state.isStealthed=!0,this.state.hasShadowStrikeBuff=!0,this.state.lastStealthStartTime=Date.now()}breakStealth(){this.state.isStealthed=!1,this.state.hasShadowStrikeBuff=!1,this.state.lastStealthStartTime=null,window.dispatchEvent(new CustomEvent("stealthBreak"))}isUnitStealthed(){return!!this.state.isStealthed&&!!this.state.lastStealthStartTime&&(!(Date.now()-this.state.lastStealthStartTime>=this.state.duration)||(this.breakStealth(),!1))}hasShadowStrikeBuff(){return!!this.state.lastStealthStartTime&&(Date.now()-this.state.lastStealthStartTime>=this.state.duration?(this.breakStealth(),!1):this.state.hasShadowStrikeBuff)}consumeShadowStrikeBuff(){this.state.hasShadowStrikeBuff=!1}getRemainingDuration(){if(!this.state.lastStealthStartTime)return 0;let e=Date.now()-this.state.lastStealthStartTime;return Math.max(0,this.state.duration-e)}constructor(){this.state={isStealthed:!1,hasShadowStrikeBuff:!1,lastStealthStartTime:null,duration:3500}}}let q=z.getInstance();function L(e){let t=.11>Math.random();return{damage:t?2*e:e,isCritical:t}}let O=Math.PI/2,W={temp1:new m.Pq0,temp2:new m.Pq0,temp3:new m.Pq0};function H(e){let{position:t,direction:r,onComplete:s}=e,o=(0,i.useRef)(null),a=(0,i.useRef)(0),l=(0,i.useRef)(0),c=new m.Q1f("#39ff14"),u=(0,i.useRef)(null),h=(0,i.useRef)(0),d=new m.Pq0(t.x+5*r.x,0,t.z+5*r.z),p=new m.Pq0(-r.z,0,r.x).normalize(),x=d.clone().add(p.clone().multiplyScalar(-1.35)),g=d.clone().add(p.clone().multiplyScalar(1.35)),y=e=>new m.BKk({transparent:!0,depthWrite:!1,blending:m.EZo,vertexShader:"\n      varying vec2 vUv;\n      void main() {\n        vUv = uv;\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n      }\n    ",fragmentShader:"\n      uniform vec3 uColor;\n      varying vec2 vUv;\n      void main() {\n        float strength = 1.0 - length(vUv - vec2(0.5));\n        vec3 glowColor = mix(uColor, vec3(1.0), 0.3);\n        gl_FragColor = vec4(glowColor, strength * ".concat(e,");\n      }\n    "),uniforms:{uColor:{value:c}}}),j={core:y(.95),inner:y(.8),middle:y(.6),outer:y(.4)},M={beam:new m.Ho_(.1,.1,15,16),innerBeam:new m.Ho_(.175,.175,15,16),middleBeam:new m.Ho_(.25,.25,15,16),outerBeam:new m.Ho_(.375,.375,15,16),torus:new m.O3Y(.5,.08,32,32),particle:new m.Gu$(.04,8,8)};(0,f.F)((e,t)=>{if(!o.current)return;if(l.current<.125){l.current+=t;return}a.current+=t,h.current+=t;let r=Math.min(a.current/1.2,1),n=Math.min(h.current/2.5,1);if(r<1){o.current.position.y=3.5*(1-r);let e=r<.9?1:1-(r-.9)/.2;o.current.scale.set(e,e,e)}else s();u.current&&(u.current.scale.set(Math.min(1.2*n,1),1,Math.min(1.2*n,1)),u.current.children[0].material.opacity=.6*(n>.7?1-(n-.7)/.3:1))});let v=(e,t)=>(0,n.jsxs)("group",{position:[e.x,0,e.z],rotation:[Math.PI/6,Math.atan2(r.x,r.z),0],children:[(0,n.jsx)("mesh",{geometry:M.beam,material:j.core}),(0,n.jsx)("mesh",{geometry:M.innerBeam,material:j.inner}),(0,n.jsx)("mesh",{geometry:M.middleBeam,material:j.middle}),(0,n.jsx)("mesh",{geometry:M.outerBeam,material:j.outer}),[...Array(8)].map((e,t)=>(0,n.jsxs)("mesh",{rotation:[0,t*Math.PI/1.5,0],position:[0,7.45,0],children:[(0,n.jsx)("torusGeometry",{args:[.5,.08,32,32]}),(0,n.jsx)("meshStandardMaterial",{color:c,emissive:c,emissiveIntensity:3,transparent:!0,opacity:.4})]},t)),[...Array(20)].map((e,t)=>(0,n.jsxs)("mesh",{position:[.5*Math.cos(t*Math.PI/4),(t-4)*.5,.5*Math.sin(t*Math.PI/4)],children:[(0,n.jsx)("sphereGeometry",{args:[.04,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:c,emissive:c,emissiveIntensity:12,transparent:!0,opacity:.6})]},t)),(0,n.jsx)("pointLight",{position:[0,0,0],color:c,intensity:20,distance:6}),(0,n.jsx)("pointLight",{position:[0,0,0],color:c,intensity:15,distance:3})]});return(0,n.jsxs)("group",{ref:o,visible:l.current>=.125,children:[v(x,!1),v(d,!0),v(g,!1)]})}let N={cylinder:new m.Ho_(.06,.02,.12,6),sphere:new m.Gu$(.12,12,12),box:new m.iNn(.2,.15,.08),cone:new m.qFE(.03,.3,6)},U={bone:new m._4j({color:"#d6cfc7",roughness:.9,metalness:.1}),spectral:new m._4j({color:"#39ff14",emissive:"#39ff14",emissiveIntensity:1.3,metalness:.8,roughness:.1,opacity:.85,transparent:!0,side:m.$EB})};function Q(e){let{position:t,direction:r,onComplete:s,parentRef:o,onHitTarget:a,enemyData:l,onSwingComplete:c}=e,u=(0,i.useRef)(null),h=(0,i.useRef)(0),d=(0,i.useRef)(!1),p=(0,i.useRef)(!1),x=(0,i.useRef)(new Set),g=(0,i.useRef)(new m.kn4),y=(0,i.useRef)(new m.Pq0),j=(0,i.useRef)(new m.Pq0),M=(e,t)=>(0,n.jsx)("mesh",{scale:[t/.06,e/.12,t/.06],geometry:N.cylinder,material:U.bone}),v=e=>(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[1.1*e,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#d6cfc7",roughness:.9,metalness:.1})]}),w=(e,t)=>(0,n.jsxs)("group",{children:[(0,n.jsx)("group",{position:[t/2,0,0],children:M(e,.06)}),(0,n.jsx)("group",{position:[-t/2,0,0],children:M(e,.06)}),(0,n.jsx)("group",{position:[0,e/2,0],children:v(.135)}),(0,n.jsx)("group",{position:[0,-e/2,0],children:v(.155)})]}),P=()=>{let e=new m.ypk;return e.moveTo(0,0),e.lineTo(.25,-.08),e.bezierCurveTo(.4,.3,1.05,.32,1.1,.23),e.lineTo(.84,.47),e.bezierCurveTo(.35,.13,.15,0,.07,.44),e.lineTo(0,0),e},S={steps:1,depth:1e-4,bevelEnabled:!0,bevelThickness:.015,bevelSize:.0175,bevelSegments:1,curveSegments:16},I=e=>(0,n.jsx)("group",{position:[.025*(e-2),-.3,0],rotation:[-Math.PI,Math.PI/2,Math.PI-Math.PI/4+e*Math.PI/10],scale:[.7,.7,.7],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("extrudeGeometry",{args:[P(),S]}),(0,n.jsx)("meshStandardMaterial",{color:"#39ff14",emissive:"#39ff14",emissiveIntensity:1.3,metalness:.8,roughness:.1,opacity:.85,transparent:!0,side:m.$EB})]})}),b=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return(0,n.jsxs)("group",{scale:[e,e,e],children:[(0,n.jsxs)("mesh",{position:[0,0,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.06,.02,.12,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("mesh",{position:[0,.1,.02],rotation:[.05,0,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.025,.025,.12,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("mesh",{position:[0,.2,.04],rotation:[.1,0,0],children:[(0,n.jsx)("coneGeometry",{args:[.03,.15,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#d4d4d4",roughness:.3,metalness:.5})]}),[0,Math.PI/4,1*Math.PI/2,Math.PI,3*Math.PI/2,5*Math.PI/4].map((e,t)=>(0,n.jsx)("group",{rotation:[0,e,0],children:(0,n.jsxs)("mesh",{position:[.04,.05,0],children:[(0,n.jsx)("boxGeometry",{args:[.01,.12,.02]}),(0,n.jsx)("meshStandardMaterial",{color:"#d4d4d4",roughness:.5,metalness:.3})]})},t))]})};return(0,f.F)((e,t)=>{if(!u.current||!(null==o?void 0:o.current))return;h.current+=5*t;let n=Math.min(h.current/Math.PI,1);if(n>=1){h.current=0,x.current.clear(),null==c||c(u.current.position.clone(),r),s();return}let i=o.current.position,m=o.current.rotation.y,f=-(2.5*Math.sin(n*Math.PI))+3,M=Math.cos(n*Math.PI)+3.75,v=2*Math.sin(n*Math.PI)+.75;if(g.current.makeRotationY(m),y.current.set(f,0,v),y.current.applyMatrix4(g.current),j.current.set(i.x+y.current.x,i.y+M,i.z+y.current.z),u.current.position.copy(j.current),u.current.rotation.set(Math.cos(n*Math.PI)/(1.5*Math.PI),m+Math.PI/2-n*Math.PI/2,-(Math.PI/3.5*Math.sin(n*Math.PI))),.1>Math.abs(n-.1)&&!d.current){d.current=!0,p.current=!0;let e=function(e,t,r,n){let i=[];for(let s=0;s<r.length;s++){let o=r[s];if(o.health<=0||o.isDying||n.has(o.id)||(W.temp1.subVectors(o.position,e),W.temp1.length()>8.625)||(W.temp2.copy(W.temp1).normalize(),Math.acos(W.temp2.dot(t))>O))continue;let{damage:a,isCritical:l}=L(73);i.push({targetId:o.id,damage:a,isCritical:l,position:o.position.clone()})}return i}(u.current.position,r,l,x.current);e.length>0&&requestAnimationFrame(()=>{e.forEach(e=>{x.current.has(e.targetId)||(x.current.add(e.targetId),null==a||a(e.targetId,e.damage,e.isCritical,e.position,!0))})})}}),(0,n.jsxs)(n.Fragment,{children:[p.current&&(0,n.jsx)(H,{position:t,direction:r,onComplete:()=>{p.current=!1}}),(0,n.jsx)("group",{ref:u,position:t,rotation:[0,Math.atan2(r.x,r.z),Math.PI/3],scale:1.25,children:(0,n.jsxs)("group",{children:[w(1.15,.15),(0,n.jsxs)("group",{position:[-.22,-.85,.21],children:["   ",(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.12,12,12]}),(0,n.jsx)("meshStandardMaterial",{color:"#d6cfc7",roughness:.9,metalness:.1})]}),(0,n.jsxs)("group",{rotation:[-.7,-0,-Math.PI/5],children:[w(.8,.12),(0,n.jsxs)("group",{position:[0,-.5,0],rotation:[0,0,1-Math.PI/4],children:[v(.125),(0,n.jsxs)("group",{position:[0,-.1,0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("boxGeometry",{args:[.2,.15,.08]}),(0,n.jsx)("meshStandardMaterial",{color:"#d6cfc7",roughness:.9,metalness:.1})]}),M(.5,.02),(0,n.jsxs)("group",{position:[.025,-.3,0],rotation:[0,0,Math.PI+Math.PI/16],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("coneGeometry",{args:[.03,.3,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#c4bdb6",roughness:.9,metalness:.1})]}),[0,1,2,3,4].map(e=>I(e))]})]})]})]})]}),(0,n.jsx)("group",{position:[0,.7,0],rotation:[-1,1,1],scale:.5,children:[-.03,-.01,0,.01,.03].map((e,t)=>(0,n.jsx)("group",{position:[e,.1,0],rotation:[0,0,(t-2)*Math.PI/5],children:(0,n.jsxs)("group",{position:[0,.3,0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.075,.5,.2,4,1,!1,0,2*Math.PI]}),(0,n.jsx)("meshStandardMaterial",{color:"#d6cfc7",roughness:.9,metalness:.1})]}),(0,n.jsxs)("group",{position:[0,.25,0],children:[(0,n.jsx)("group",{position:[0,0,0],rotation:[0,0,0],children:b(2)}),(0,n.jsx)("group",{position:[0,-.05,.15],rotation:[-.1,0,0],children:b(.9)}),(0,n.jsx)("group",{position:[0,-.05,-.15],rotation:[.1,0,0],children:b(.9)}),(0,n.jsx)("group",{position:[0,-.1,.25],rotation:[-.2,0,0],children:b(.7)}),(0,n.jsx)("group",{position:[0,-.1,-.25],rotation:[.2,0,0],children:b(.7)})]})]})},t))})]})})]})}function Y(e){let{initialPosition:t,onComplete:r,type:s}=e,o=(0,i.useRef)(null),a=(0,i.useRef)(1.5*Math.random()+3.65),l=(0,i.useRef)({x:1.5*Math.random(),y:.25*Math.random(),z:1*Math.random()}),c=(0,i.useRef)(Math.min(t.length(),2.7)),u=(0,i.useRef)(Math.atan2(t.z,t.x));return(0,f.F)((e,t)=>{o.current&&("falling"===s?(o.current.position.y-=a.current*t,o.current.position.y<0&&r()):(u.current+=t,o.current.position.x=Math.cos(u.current)*c.current,o.current.position.z=Math.sin(u.current)*c.current,u.current>2*Math.PI&&r()),o.current.rotation.x+=l.current.x,o.current.rotation.y+=l.current.y,o.current.rotation.z+=l.current.z)}),(0,n.jsx)("mesh",{ref:o,position:t,geometry:K.tetrahedron,material:V.shard})}function Z(e){let{onComplete:t}=e,r=(0,i.useRef)(null),s=(0,i.useRef)(0),o=(0,i.useRef)({x:.2*Math.random(),y:2*Math.random(),z:.3*Math.random()});return(0,f.F)((e,n)=>{if(!r.current)return;s.current+=n,r.current.rotation.x+=o.current.x*n,r.current.rotation.y+=o.current.y*n,r.current.rotation.z+=o.current.z*n;let i=.1*Math.sin(2*s.current)+1;r.current.scale.setScalar(i),s.current>6&&t()}),(0,n.jsx)("mesh",{ref:r,geometry:K.torus,material:V.blizzard})}let K={torus:new m.O3Y(.8,.075,8,32),tetrahedron:new m.Zpd(.0725)},V={blizzard:new m._4j({color:"#80ffff",emissive:"#40a0ff",emissiveIntensity:2,transparent:!0,opacity:.3}),shard:new m._4j({color:"#80ffff",emissive:"#40a0ff",emissiveIntensity:1,transparent:!0,opacity:.7})};function $(e){let{onComplete:t,enemyData:r=[],onHitTarget:s,parentRef:o}=e,a=(0,i.useRef)(null),l=(0,i.useRef)(0),c=(0,i.useRef)(0),u=(0,i.useRef)([]),h=(0,i.useRef)([]);return(0,f.F)((e,n)=>{if(!a.current||!(null==o?void 0:o.current))return;let i=o.current.position;if(a.current.position.copy(i),l.current+=n,l.current>=6){t();return}if(a.current.rotation.y+=4*n,.2>Math.random()){let e=Math.random()*Math.PI*2,t=.8*Math.random()/50,r=new m.Pq0(Math.cos(e)*t,2.35+1.7*Math.random(),Math.sin(e)*t);u.current.push({id:Date.now()+Math.random(),position:r,type:"orbital"})}if(Math.random()>.2){let e=Math.random()*Math.PI*2,t=2.5*Math.random(),r=new m.Pq0(Math.cos(e)*t,1.2+3*Math.random(),Math.sin(e)*t);u.current.push({id:Date.now()+Math.random(),position:r,type:"falling"})}.1>Math.random()&&h.current.push({id:Date.now()+Math.random()});let d=Date.now();d-c.current>=1e3&&(c.current=d,r&&s&&(function(e,t){let r=[];return t.forEach(t=>{if(!(t.health<=0)&&5.35>=t.position.distanceTo(e)){let{damage:e,isCritical:n}=L(37);r.push({targetId:t.id,damage:e,isCritical:n,position:t.position.clone()})}}),r})(i,r).forEach(e=>{s(e.targetId,e.damage,e.isCritical,e.position,!0)}))}),(0,n.jsxs)("group",{ref:a,children:[u.current.map(e=>(0,n.jsx)(Y,{initialPosition:e.position,type:e.type,onComplete:()=>{u.current=u.current.filter(t=>t.id!==e.id)}},e.id)),h.current.map(e=>(0,n.jsx)(Z,{onComplete:()=>{h.current=h.current.filter(t=>t.id!==e.id)}},e.id))]})}let X=e=>{let{parentRef:t}=e,[r,n]=(0,i.useState)(!1);return{isActive:r,activateFirebeam:(0,i.useCallback)(()=>{if(!t.current)return;let e=t.current.position.clone();e.y+=1;let r=new m.Pq0(0,0,1).applyQuaternion(t.current.quaternion);return n(!0),{position:e,direction:r,onComplete:()=>n(!1),damage:43}},[t]),deactivateFirebeam:(0,i.useCallback)(()=>{n(!1)},[])}};function J(e){let{parentRef:t,charges:r,orbitRadius:o=.55,orbitSpeed:a=.8,particleSize:l=.08,weaponType:c}=e,u=r.length,h=(0,i.useRef)([]),d=(()=>{switch(c){case s.SCYTHE:return"#00FF37";case s.SWORD:return"#FF831D";case s.SABRES:return"#0091FF";case s.SPEAR:return"#FF544E";case s.BOW:return"#C18C4B";default:return"#00ff44"}})();return(0,f.F)(()=>{t.current&&h.current.forEach((e,t)=>{let r=t/u*Math.PI*2+.001*Date.now()*a,n=Math.cos(r)*o,i=Math.sin(r)*o,s=.05*Math.sin(.002*Date.now()+t);e.position.set(n,s,i)})}),(0,n.jsx)(n.Fragment,{children:Array.from({length:u}).map((e,t)=>{let i=r[t];return(0,n.jsxs)("group",{ref:e=>{e&&(h.current[t]=e)},children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[l,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:(null==i?void 0:i.available)?d:"#333333",emissive:(null==i?void 0:i.available)?d:"#333333",emissiveIntensity:(null==i?void 0:i.available)?1.25:.4,transparent:!0,opacity:(null==i?void 0:i.available)?.8:.4})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[1.225*l,32,32]}),(0,n.jsx)("meshStandardMaterial",{color:(null==i?void 0:i.available)?d:"#333333",emissive:(null==i?void 0:i.available)?d:"#333333",emissiveIntensity:(null==i?void 0:i.available)?.5:.1,transparent:!0,opacity:(null==i?void 0:i.available)?.4:.15,depthWrite:!1,side:m.$EB,blending:m.EZo})]})]},t)})})}let ee=e=>{let{parentRef:t,onHit:r,enemyData:n,setActiveEffects:s,charges:o,setCharges:a,setDamageNumbers:l,nextDamageNumberId:c}=e,u=(0,i.useRef)(0),h=(0,i.useRef)(null),d=(0,i.useRef)(0),{isActive:p,activateFirebeam:f,deactivateFirebeam:x}=X({onHit:r,parentRef:t}),g=(0,i.useMemo)(()=>new m.Pq0,[]),y=(0,i.useMemo)(()=>new m.Pq0,[]),j=(0,i.useMemo)(()=>new m.Pq0,[]),M=(0,i.useMemo)(()=>new m.Pq0,[]),v=(0,i.useMemo)(()=>new m.Pq0,[]),w=(0,i.useCallback)(()=>{null!==h.current&&(s(e=>e.filter(e=>e.id!==h.current)),h.current=null),x()},[x,s]),P=(0,i.useCallback)(()=>{let e=o.findIndex(e=>e.available);return -1!==e&&(a(t=>t.map((t,r)=>r===e?{...t,available:!1,cooldownStartTime:Date.now()}:t)),setTimeout(()=>{a(t=>t.map((t,r)=>r===e?{...t,available:!0,cooldownStartTime:null}:t))},8250),!0)},[o,a]),S=(0,i.useCallback)(()=>{let e=Date.now();if(e-d.current<725||!P())return;let t=f();if(!t)return;let{position:i,direction:o,damage:a}=t,m=u.current++;return h.current=m,d.current=e,s(e=>[...e,{id:m,type:"firebeam",position:i,direction:o}]),n.forEach(e=>{if(e.health<=0)return;g.set(i.x,0,i.z),y.set(e.position.x,0,e.position.z),j.copy(o).setY(0).normalize(),M.copy(y).sub(g);let t=M.dot(j);t<=0||t>20||(v.copy(g).add(j.multiplyScalar(t)),1.375>y.distanceTo(v)&&(r(e.id,a),l(t=>[...t,{id:c.current++,damage:a,position:e.position.clone(),isCritical:!1,isFirebeam:!0}])))}),setTimeout(w,6e3)},[c,g,y,j,M,v,l,f,n,r,s,P,w]);return(0,i.useEffect)(()=>()=>{w()},[w]),{isActive:p,startFirebeam:S,stopFirebeam:w}},et=e=>{let{beamRef:t}=e,r=(0,i.useRef)(0),n=(0,i.useRef)(!0),s=(0,i.useRef)(!1),o=(0,i.useRef)();return(0,i.useEffect)(()=>{let e=t.current;return()=>{n.current=!1,e&&(s.current=!0,o.current=setTimeout(()=>{e&&(e.scale.z=0)},2500))}},[t]),(0,f.F)((e,n)=>{t.current&&(s.current?!(Math.random()>.25)&&(r.current-=n/2500,r.current>0&&(t.current.scale.z=r.current)):r.current<1&&(r.current+=n/0,t.current.scale.z=Math.min(r.current,1)))}),{reset:(0,i.useCallback)(()=>{r.current=0,n.current=!1,s.current=!0,o.current&&clearTimeout(o.current),o.current=setTimeout(()=>{t.current&&(t.current.scale.z=0),s.current=!1},2500)},[t])}};function er(e){let{position:t,direction:r,onComplete:s}=e,o=(0,i.useRef)(null);(0,i.useEffect)(()=>{let e=o.current;return()=>{e&&(e.scale.z=0),s()}},[s]);let{reset:a}=et({beamRef:o,position:t,direction:r});return(0,i.useEffect)(()=>()=>{a()},[a]),(0,n.jsxs)("group",{ref:o,position:t.toArray(),rotation:[0,Math.atan2(r.x,r.z),0],children:[(0,n.jsxs)("group",{position:[0,-1.1,0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.65,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#58FCEC",emissive:"#00E5FF",emissiveIntensity:2.5,transparent:!0,opacity:.65})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.825,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#58FCEC",emissive:"#00E5FF",emissiveIntensity:.7,transparent:!0,opacity:.65})]}),[void 0,void 0,void 0].map((e,t)=>(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,t*Math.PI/3],children:[(0,n.jsx)("torusGeometry",{args:[.875,.075,8,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#58FCEC",emissive:"#00E5FF",emissiveIntensity:.8,transparent:!0,opacity:.9})]},"ring-".concat(t))),(0,n.jsx)("pointLight",{color:"#58FCEC",intensity:20,distance:3})]}),(0,n.jsxs)("group",{position:[0,-1.1,10.7],children:[(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.1,.1,20,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#58FCEC",emissive:"#00E5FF",emissiveIntensity:15,transparent:!0,opacity:.95})]}),(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.25,.275,20,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#58FCEC",emissive:"#00E5FF",emissiveIntensity:5,transparent:!0,opacity:.7})]}),(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.3,.375,20,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#58FCEC",emissive:"#00E5FF",emissiveIntensity:1,transparent:!0,opacity:.6})]}),(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.35,.375,20,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#58FCEC",emissive:"#00E5FF",emissiveIntensity:.75,transparent:!0,opacity:.6})]}),[void 0,void 0,void 0,void 0,void 0].map((e,t)=>(0,n.jsxs)("mesh",{rotation:[-Math.PI/4,0,-(t*Math.PI/1.5)],position:[0,0,10],children:[(0,n.jsx)("torusGeometry",{args:[.35,.05,8,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#58FCEC",emissive:"#00E5FF",emissiveIntensity:1,transparent:!0,opacity:.3})]},t)),[...Array(24)].map((e,t)=>(0,n.jsxs)("mesh",{position:[(Math.random()-.5)*1.75,(Math.random()-.5)*1.75,10*Math.random()],rotation:[Math.random()*Math.PI*2,Math.random()*Math.PI*2,Math.random()*Math.PI*2],children:[(0,n.jsx)("boxGeometry",{args:[.05,.05,.1]})," ",(0,n.jsx)("meshStandardMaterial",{color:"#58FCEC",emissive:"#00E5FF",emissiveIntensity:2,transparent:!0,opacity:.75})]},"spark-".concat(t))),(0,n.jsx)("pointLight",{position:[0,0,18.5],color:"#00E5FF",intensity:12,distance:4})]})]})}let en=i.memo(e=>{let{position:t,onComplete:r}=e,[s,o]=(0,i.useState)(0),a=(0,i.useCallback)((e,t)=>{o(e=>{let n=e+t;return n>=1.5&&r(),n})},[1.5,r]);(0,f.F)(a);let l=s/1.5,c=Math.sin(l*Math.PI),u=1+2*l,h=(0,i.useMemo)(()=>({color:"#60FF38",emissive:"#60FF38",emissiveIntensity:1.5,transparent:!0}),[]),d=(0,i.useMemo)(()=>({color:"#60FF38",emissive:"#60FF38",emissiveIntensity:2.5,transparent:!0}),[]),m=(0,i.useMemo)(()=>[void 0,void 0,void 0],[]),p=(0,i.useMemo)(()=>[...Array(12)],[]);return(0,n.jsxs)("group",{position:t.toArray(),children:[m.map((e,t)=>(0,n.jsxs)("mesh",{position:[0,2*l+.5*t,0],rotation:[Math.PI/2,0,2*s],children:[(0,n.jsx)("torusGeometry",{args:[.8-.2*t,.05,16,32]}),(0,n.jsx)("meshStandardMaterial",{...h,opacity:c*(1-.2*t)})]},"ring-".concat(t))),(0,n.jsxs)("mesh",{scale:[u,u,u],children:[(0,n.jsx)("sphereGeometry",{args:[.5,32,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#60FF38",emissive:"#60FF38",emissiveIntensity:2,transparent:!0,opacity:.3*c})]}),p.map((e,t)=>{let r=t/12*Math.PI*2,i=.75+l;return(0,n.jsxs)("mesh",{position:[Math.cos(r+2*s)*i/1.1,2*l+.5*Math.sin(3*s+t),Math.sin(r+2*s)*i/1.1],children:[(0,n.jsx)("sphereGeometry",{args:[.095,8,8]}),(0,n.jsx)("meshStandardMaterial",{...d,opacity:.8*c})]},"particle-".concat(t))}),(0,n.jsx)("pointLight",{color:"#60FF38",intensity:2*c,distance:5,decay:2})]})});en.displayName="HealingEffect";let ei=(0,i.forwardRef)((e,t)=>{let{parentRef:r,onHealthChange:o,charges:l,setCharges:c,setDamageNumbers:u,nextDamageNumberId:h}=e,[d,p]=(0,i.useState)(!1),{castReanimate:f}=function(e){let{charges:t,setCharges:r,onHealthChange:n,parentRef:o,setDamageNumbers:l,nextDamageNumberId:c}=e,u=(0,i.useRef)(0),h=(0,i.useMemo)(()=>7,[]),d=(0,i.useMemo)(()=>1e3*a[s.SCYTHE].passive.cooldown,[]),p=(0,i.useMemo)(()=>new m.Pq0(0,2,0),[]);return{castReanimate:(0,i.useCallback)(()=>{let e=Date.now();if(e-u.current<d)return!1;let i=t.findIndex(e=>e.available);if(-1===i)return!1;u.current=e,r(t=>{let r=[...t];return r[i]={...r[i],available:!1,cooldownStartTime:e},r});let s=null==o?void 0:o.current;return s&&l(e=>[...e,{id:c.current++,damage:h,position:s.position.clone().add(p),isCritical:!1,isHealing:!0}]),n(h),setTimeout(()=>{r(e=>{let t=[...e];return t[i]={...t[i],available:!0,cooldownStartTime:null},t})},8250),!0},[t,r,n,o,l,c,d,h,p])}}((0,i.useMemo)(()=>({parentRef:r,charges:l,setCharges:c,onHealthChange:o,setDamageNumbers:u,nextDamageNumberId:h}),[r,l,c,o,u,h])),x=(0,i.useCallback)(()=>{let e=f();return e&&p(!0),e},[f]);return(0,i.useImperativeHandle)(t,()=>({castReanimate:x})),d&&r.current?(0,n.jsx)(en,{position:r.current.position.clone().add(new m.Pq0(0,0,0)),onComplete:()=>p(!1)}):null});ei.displayName="Reanimate";let es=e=>{let{effectRef:t,parentRef:r}=e,n=(0,i.useRef)(0),s=(0,i.useRef)(!0);return(0,i.useEffect)(()=>{let e=t.current;return()=>{s.current=!1,e&&e.scale.set(0,0,0)}},[t]),(0,f.F)((e,i)=>{if(!t.current||!s.current||!r.current)return;n.current+=i;let o=n.current/.2;if(o<=1){let e=r.current.quaternion,n=new m.Pq0(0,0,2);n.applyQuaternion(e),t.current.position.copy(r.current.position).add(n).setY(.1);let i=new m.PTz().setFromAxisAngle(new m.Pq0(-1,0,0),-Math.PI/2);t.current.quaternion.copy(e).multiply(i);let s=1.5*Math.sin(o*Math.PI);t.current.scale.set(s,s,.5*s),t.current.traverse(e=>{let t=e.material;(null==t?void 0:t.opacity)!==void 0&&(t.opacity=Math.sin(o*Math.PI))})}else s.current=!1,t.current&&t.current.scale.set(0,0,0)}),{reset:()=>{n.current=0,s.current=!0,t.current&&t.current.scale.set(0,0,0)}}};function eo(e){let{position:t,direction:r,onComplete:s,parentRef:o}=e,a=(0,i.useRef)(null),l=(0,i.useMemo)(()=>({mainArc:new m.O3Y(3,.8,8,32,Math.PI),innerGlow:new m.O3Y(3,.4,16,32,Math.PI),outerGlow:new m.O3Y(2,.9,16,32,Math.PI),particle:new m.Gu$(.15,8,8)}),[]),c=(0,i.useMemo)(()=>({mainFlame:new m._4j({color:"#FF9748",emissive:"#FF6F00",emissiveIntensity:2,transparent:!0,opacity:.9}),innerGlow:new m._4j({color:"#FF9748",emissive:"#FF6F00",emissiveIntensity:1,transparent:!0,opacity:.7}),outerGlow:new m._4j({color:"#FF9748",emissive:"#FF6F00",emissiveIntensity:1.3,transparent:!0,opacity:.5}),particle:new m._4j({color:"#FF9748",emissive:"#FF6F00",emissiveIntensity:1.5,transparent:!0,opacity:.6})}),[]),u=(0,i.useMemo)(()=>Array(12).fill(0).map((e,t)=>({position:new m.Pq0(1.5*Math.cos(t*Math.PI/6),1.5*Math.sin(t*Math.PI/6),0)})),[]),{reset:h}=es({effectRef:a,position:t,direction:r,parentRef:o});return(0,i.useEffect)(()=>()=>{h(),s()},[h,s]),(0,n.jsx)("group",{ref:a,position:t.toArray(),rotation:[Math.PI/2,Math.atan2(r.x,r.z),0],children:(0,n.jsxs)("group",{position:[0,0,0],children:[(0,n.jsx)("mesh",{geometry:l.mainArc,material:c.mainFlame}),(0,n.jsx)("mesh",{geometry:l.innerGlow,material:c.innerGlow}),(0,n.jsx)("mesh",{geometry:l.outerGlow,material:c.outerGlow}),u.map((e,t)=>(0,n.jsx)("mesh",{position:e.position,geometry:l.particle,material:c.particle},t)),(0,n.jsx)("pointLight",{color:"#FF9748",intensity:15,distance:8}),(0,n.jsx)("pointLight",{color:"#FF6F00",intensity:10,distance:12})]})})}let ea=e=>{let{currentHealth:t,maxHealth:r,onHealthChange:n,setDamageNumbers:s,nextDamageNumberId:o,healAmount:a=10}=e;return{processHealing:(0,i.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a,i=arguments.length>1?arguments[1]:void 0,l=Math.min(e,r-t);l>0&&(n(l),s&&o&&s(e=>[...e,{id:o.current++,damage:l,position:i,isCritical:!1,isHealing:!0}]))},[t,r,n,s,o,a])}},el=e=>{let{parentRef:t,onHit:r,charges:n,setCharges:s,enemyData:o,onHealthChange:a,setDamageNumbers:l,nextDamageNumberId:c,currentHealth:u,maxHealth:h}=e,[d,p]=(0,i.useState)(!1),{processHealing:f}=ea({currentHealth:u,maxHealth:h,onHealthChange:a,setDamageNumbers:l,nextDamageNumberId:c,healAmount:5}),x=(0,i.useCallback)(()=>{let e=n.filter(e=>e.available);if(e.length<2)return!1;s(t=>t.map((t,r)=>r===e[0].id-1||r===e[1].id-1?{...t,available:!1,cooldownStartTime:Date.now()}:t));for(let t=0;t<2;t++)e[t].id&&setTimeout(()=>{s(r=>r.map((r,n)=>n===e[t].id-1?{...r,available:!0,cooldownStartTime:null}:r))},8250);return!0},[n,s]);return{isActive:d,activateOathstrike:(0,i.useCallback)(()=>{if(!t.current||!x())return null;let e=t.current.position.clone();e.y+=1;let n=new m.Pq0(0,0,1).applyQuaternion(t.current.quaternion);p(!0);let i=n.clone(),s=.6*Math.PI,a=!1;return o.forEach(t=>{if(t.health<=0)return;let n=t.position.clone().sub(e);if(6>=n.length()&&Math.abs(i.angleTo(n))<=s/2){a=!0;let{damage:e,isCritical:n}=L(47);r(t.id,e),l(r=>[...r,{id:c.current++,damage:e,position:t.position.clone(),isCritical:n,isOathstrike:!0}])}}),a&&f(5,e),{position:e,direction:n,onComplete:()=>{p(!1)}}},[c,l,t,x,o,r,f])}},ec=e=>{let{onHealthChange:t,parentRef:r,setDamageNumbers:n,nextDamageNumberId:s,currentHealth:o,maxHealth:a}=e,[l,c]=(0,i.useState)(!1),{processHealing:u}=ea({currentHealth:o,maxHealth:a,onHealthChange:t,setDamageNumbers:n,nextDamageNumberId:s,healAmount:3});return{processHealingChance:(0,i.useCallback)(()=>{r.current&&.25>Math.random()&&(u(3,r.current.position.clone().add(new m.Pq0(0,2,0))),c(!0))},[u,r,.25,3]),showHealingEffect:l,setShowHealingEffect:c}},eu=e=>{let{position:t,onComplete:r}=e,s=(0,i.useRef)(0),o=(0,i.useMemo)(()=>({ring:new m.O3Y(.8,.05,16,32),sphere:new m.Gu$(.5,32,32),particle:new m.Gu$(.1,8,8)}),[]),a=(0,i.useMemo)(()=>({ring:new m._4j({color:"#ffaa00",emissive:"#ff8800",emissiveIntensity:2,transparent:!0}),glow:new m._4j({color:"#ffaa00",emissive:"#ff8800",emissiveIntensity:3,transparent:!0}),particle:new m._4j({color:"#ffaa00",emissive:"#ff8800",emissiveIntensity:2,transparent:!0})}),[]),l=(0,i.useMemo)(()=>Array(12).fill(0).map((e,t)=>t/12*Math.PI*2),[]);(0,f.F)((e,t)=>{if(s.current+=t,s.current>=1.5){r();return}let n=Math.sin(s.current/1.5*Math.PI);a.ring.opacity=n,a.glow.opacity=.3*n,a.particle.opacity=.8*n});let c=s.current/1.5,u=1+2*c;return(0,n.jsxs)("group",{position:t.toArray(),children:[[0,1,2].map(e=>(0,n.jsx)("mesh",{position:[0,2*c+.5*e,0],rotation:[Math.PI/2,0,2*s.current],geometry:o.ring,material:a.ring,scale:[1-.2*e,1-.2*e,1]},"ring-".concat(e))),(0,n.jsx)("mesh",{geometry:o.sphere,material:a.glow,scale:[u,u,u]}),l.map((e,t)=>{let r=1+c;return(0,n.jsx)("mesh",{position:[Math.cos(e+2*s.current)*r,2*c+.5*Math.sin(3*s.current+t),Math.sin(e+2*s.current)*r],geometry:o.particle,material:a.particle},"particle-".concat(t))}),(0,n.jsx)("pointLight",{color:"#ff8800",intensity:4*Math.sin(c*Math.PI),distance:5,decay:2})]})},eh=(0,i.forwardRef)((e,t)=>{let{parentRef:r,onHealthChange:s,setDamageNumbers:o,nextDamageNumberId:a,currentHealth:l,maxHealth:c}=e,u=(0,i.useRef)(null),{processHealingChance:h,showHealingEffect:d,setShowHealingEffect:p}=ec({onHealthChange:s,parentRef:r,setDamageNumbers:o,nextDamageNumberId:a,currentHealth:l,maxHealth:c});return(0,i.useImperativeHandle)(t,()=>({processHealingChance:h})),(0,f.F)(()=>{if(u.current&&r.current){let e=r.current.position;u.current.position.set(e.x,.015,e.z),u.current.rotation.y+=.0012}}),(0,n.jsxs)(n.Fragment,{children:[d&&r.current&&(0,n.jsx)(eu,{position:r.current.position.clone().add(new m.Pq0(0,0,0)),onComplete:()=>p(!1)}),(0,n.jsxs)("group",{ref:u,children:[(0,n.jsx)("group",{rotation:[0,0,0],position:[0,.005,0],children:[0,Math.PI/2,Math.PI,1.5*Math.PI].map((e,t)=>(0,n.jsxs)("mesh",{rotation:[-Math.PI/2,0,e+8e-4*Date.now()],children:[(0,n.jsx)("ringGeometry",{args:[.85,1,3]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffaa00",emissive:"#ff8800",emissiveIntensity:2,transparent:!0,opacity:.6,depthWrite:!1})]},t))}),(0,n.jsxs)("mesh",{position:[0,.1,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.925,.5,-.175,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#ff8800",emissive:"#ff6600",emissiveIntensity:1,transparent:!0,opacity:.55,depthWrite:!1})]})]})]})});eh.displayName="CrusaderAura";let ed=()=>(0,n.jsxs)("group",{rotation:[Math.PI/4,0,0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.12,.12,1.8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",roughness:.4,metalness:.3})]}),(0,n.jsxs)("mesh",{position:new m.Pq0(0,.5,0),rotation:new m.O9p(0,0,Math.PI/6),children:[(0,n.jsx)("sphereGeometry",{args:[.12,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",roughness:.5,metalness:.2})]}),(0,n.jsxs)("mesh",{position:new m.Pq0(0,.15,0),rotation:new m.O9p(0,0,-Math.PI/6),children:[(0,n.jsx)("sphereGeometry",{args:[.12,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#a4a4a4",roughness:.5,metalness:.2})]})]});function em(e){let{parentRef:t}=e,r=(0,i.useRef)([]),s=(0,i.useRef)(null);return(0,f.F)(()=>{if(!t.current||!s.current)return;let e=t.current.position;s.current.position.set(e.x,.4,e.z),r.current.forEach((e,t)=>{let r=t/20*Math.PI*2+.001*Date.now(),n=-(1.75*Math.cos(r)),i=1.75*Math.sin(r),s=.15*Math.sin(.002*Date.now()+t);e.position.set(n,s-.3,i),e.rotation.y=r+Math.PI/3})}),(0,n.jsx)("group",{ref:s,children:Array.from({length:20}).map((e,t)=>(0,n.jsx)("mesh",{ref:e=>{e&&(r.current[t]=e)},children:ed()},t))})}function ep(e){let{parentRef:t}=e,r=(0,i.useRef)(null);return(0,f.F)(()=>{if(r.current&&t.current){let e=t.current.position;r.current.position.set(e.x,.015,e.z),r.current.rotation.y+=96e-5}}),(0,n.jsxs)("group",{ref:r,scale:1.45,children:[(0,n.jsxs)("mesh",{rotation:[-Math.PI/2,0,0],position:[0,.01,0],children:[(0,n.jsx)("ringGeometry",{args:[2.4,2.8,128]}),(0,n.jsx)("meshStandardMaterial",{color:"#00ff88",emissive:"#00ff88",emissiveIntensity:1.5,transparent:!0,opacity:.3,depthWrite:!1})]}),(0,n.jsx)("group",{position:[0,.02,0],children:[...Array(8)].map((e,t)=>(0,n.jsxs)("mesh",{rotation:[-Math.PI/2,0,t/8*Math.PI*2+.001*Date.now()],position:[0,0,0],children:[(0,n.jsx)("planeGeometry",{args:[.4,2.6]}),(0,n.jsx)("meshStandardMaterial",{color:"#00ff88",emissive:"#00ff88",emissiveIntensity:2,transparent:!0,opacity:.4+.2*Math.sin(.003*Date.now()+t),depthWrite:!1})]},t))}),(0,n.jsx)("group",{position:[0,.03,0],children:[void 0,void 0,void 0,void 0,void 0].map((e,t)=>{let r=t/5*Math.PI*2;return(0,n.jsxs)("mesh",{position:[1.2*Math.cos(r+.001*Date.now()),0,1.2*Math.sin(r+.001*Date.now())],rotation:[-Math.PI/2,0,r+Math.PI/2],children:[(0,n.jsx)("planeGeometry",{args:[.6,.6]}),(0,n.jsx)("meshStandardMaterial",{color:"#00cc66",emissive:"#00ff88",emissiveIntensity:2,transparent:!0,opacity:.3+.2*Math.sin(.002*Date.now()+.5*t),depthWrite:!1})]},t)})}),(0,n.jsx)("group",{position:[0,.01,0],children:[...Array(12)].map((e,t)=>{let r=t/12*Math.PI*2,i=1.8+.2*Math.sin(.002*Date.now()+t);return(0,n.jsxs)("mesh",{position:[Math.cos(r)*i,0,Math.sin(r)*i],rotation:[-Math.PI/2,0,r+.0015*Date.now()],children:[(0,n.jsx)("planeGeometry",{args:[.2,.8]}),(0,n.jsx)("meshStandardMaterial",{color:"#004433",emissive:"#00ff88",emissiveIntensity:3,transparent:!0,opacity:.2+.1*Math.sin(.004*Date.now()+t),depthWrite:!1})]},t)})}),(0,n.jsxs)("mesh",{position:[0,.02,0],rotation:[-Math.PI/2,0,0],children:[(0,n.jsx)("ringGeometry",{args:[.2,1,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#002211",emissive:"#00ff88",emissiveIntensity:1.5,transparent:!0,opacity:.4,depthWrite:!1})]}),(0,n.jsxs)("mesh",{position:[0,.01,0],rotation:[-Math.PI/2,0,0],children:[(0,n.jsx)("ringGeometry",{args:[2.4,2.55,128,1]}),(0,n.jsx)("meshStandardMaterial",{color:"#00ff88",emissive:"#00ff88",emissiveIntensity:.3,transparent:!0,opacity:.6,depthWrite:!1})]})]})}let ef={bone:new m._4j({color:"#D2B48C",roughness:1,metalness:0}),spikes:new m._4j({color:"#BC8F8F",roughness:1,metalness:0}),runes:new m._4j({color:"#00ff88",emissive:"#00ff88",transparent:!0,opacity:.9}),crown:new m._4j({color:"#DEB887",roughness:1,metalness:0})},ex={tower:new m.Ho_(.6,.8,4,8),spike:new m.qFE(.2,.8,4),rune:new m.bdM(.2,.2),crown:new m.qFE(.15,1.2,4),eye:new m.Gu$(.3,32,32),base:new m.Ho_(1,1.2,.6,8),lightning:new m.Gu$(.1,16,16)};function eg(e){let{isAttacking:t}=e,r=(0,i.useRef)(null);return(0,n.jsxs)("group",{ref:r,scale:.475,position:[0,-.75,0],children:[(0,n.jsxs)("mesh",{position:[0,2,0],children:[(0,n.jsx)("primitive",{object:ex.tower}),(0,n.jsx)("primitive",{object:ef.bone})]}),[...Array(12)].map((e,t)=>(0,n.jsx)("group",{rotation:[0,-Math.PI*t/12,.25*Math.PI],position:[0,2.5,0],children:(0,n.jsxs)("mesh",{position:[.7,.5*Math.sin(3*t),0],rotation:[Math.PI/3,0,-(.25*Math.PI)],children:[(0,n.jsx)("primitive",{object:ex.spike}),(0,n.jsx)("primitive",{object:ef.spikes})]})},t)),[.5,1.5,2.5,3.5].map((e,r)=>(0,n.jsxs)("group",{position:[0,e,0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("torusGeometry",{args:[.7,.05,16,32]}),(0,n.jsx)("primitive",{object:ef.runes,emissiveIntensity:t?3:1})]}),[void 0,void 0,void 0,void 0].map((e,r)=>(0,n.jsxs)("mesh",{position:[.7*Math.cos(2*Math.PI*r/4),.1*Math.sin(.001*Date.now()+r),.7*Math.sin(2*Math.PI*r/4)],children:[(0,n.jsx)("primitive",{object:ex.rune}),(0,n.jsx)("primitive",{object:ef.runes,emissiveIntensity:t?4:2,opacity:.8,side:2})]},r))]},r)),(0,n.jsxs)("group",{position:[0,4,0],children:[[...Array(8)].map((e,t)=>(0,n.jsxs)("mesh",{position:[.5*Math.cos(2*Math.PI*t/8),.3,.5*Math.sin(2*Math.PI*t/8)],rotation:[.2*Math.random(),2*Math.PI*t/8,.15*Math.PI],children:[(0,n.jsx)("primitive",{object:ex.crown}),(0,n.jsx)("primitive",{object:ef.crown})]},t)),(0,n.jsxs)("mesh",{position:[0,.5,0],children:[(0,n.jsx)("primitive",{object:ex.eye}),(0,n.jsx)("primitive",{object:ef.runes,emissiveIntensity:t?5:3})]})]}),(0,n.jsxs)("mesh",{position:[0,.3,0],children:[(0,n.jsx)("primitive",{object:ex.base}),(0,n.jsx)("primitive",{object:ef.bone})]}),t&&[void 0,void 0,void 0,void 0].map((e,t)=>(0,n.jsxs)("mesh",{position:[1*Math.cos(2*Math.PI*t/4),2,1*Math.sin(2*Math.PI*t/4)],children:[(0,n.jsx)("primitive",{object:ex.lightning}),(0,n.jsx)("primitive",{object:ef.runes,emissiveIntensity:5,opacity:.8})]},t)),(0,n.jsx)(em,{parentRef:r}),(0,n.jsx)(ep,{parentRef:r})]})}function ey(e){let{position:t,enemyData:r,onDamage:s,onComplete:o,onStartCooldown:a,setActiveEffects:l,activeEffects:c,setDamageNumbers:u,nextDamageNumberId:h}=e,d=(0,i.useRef)(null),[p,x]=(0,i.useState)(null),g=(0,i.useRef)({lastAttackTime:0,startTime:Date.now(),hasTriggeredCleanup:!1,mountId:Date.now(),lastTargetSwitchTime:Date.now(),ATTACK_COOLDOWN:400,RANGE:35,DURATION:14e3,DAMAGE:47,EFFECT_DURATION:225,TARGET_SWITCH_INTERVAL:2e3}).current,y=(0,i.useCallback)((e,t)=>{let r=e.x-t.x,n=e.z-t.z;return Math.sqrt(r*r+n*n)},[]),j=(0,i.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!d.current)return null;let t=d.current.position,n=g.RANGE,i=null;for(let s=0;s<r.length;s++){let o=r[s];if(o.health<=0||o.isDying||o.deathStartTime||!o.position||e&&p&&o.id===p.id)continue;let a=y({x:o.position.x,z:o.position.z},{x:t.x,z:t.z});a<=n&&(n=a,i=o)}return i},[r,y,p,g.RANGE]),M=(0,i.useCallback)(e=>{var t;if(!e||e.health<=0||e.isDying||e.deathStartTime||!e.position)return;let n=e.id.startsWith("boss-")||e.id.startsWith("enemy-boss-")?17:g.DAMAGE,i=e.position.clone().setY(1.5);if(!r.find(t=>t.id===e.id&&t.health>0))return;s(e.id,n,i,!0);let o=Date.now(),a=new m.Pq0;null===(t=d.current)||void 0===t||t.getWorldPosition(a);let c={damageNumber:{id:h.current++,damage:n,position:i.clone(),isCritical:!1,isSummon:!0},effect:{id:o,type:"summonExplosion",position:i.clone().sub(a),direction:new m.Pq0,duration:g.EFFECT_DURATION/1e3,startTime:Date.now(),summonId:g.mountId,targetId:e.id}};u(e=>[...e,c.damageNumber]),l(e=>[...e.filter(e=>"summonExplosion"!==e.type||e.startTime&&Date.now()-e.startTime<g.EFFECT_DURATION),c.effect]),requestAnimationFrame(()=>{Date.now()-c.effect.startTime>=g.EFFECT_DURATION+150&&l(e=>e.filter(e=>e.id!==o))})},[g,s,l,u,h,r]);return(0,f.F)(()=>{let e=Date.now();if(e-g.startTime>g.DURATION){g.hasTriggeredCleanup||(g.hasTriggeredCleanup=!0,o(),a());return}if(!(e-g.lastAttackTime<g.ATTACK_COOLDOWN)){if(e-g.lastTargetSwitchTime>=g.TARGET_SWITCH_INTERVAL){let t=j(!0);t&&x(t),g.lastTargetSwitchTime=e}if(!(null==p?void 0:p.health)||p.health<=0||p.isDying){x(j());return}M(p),g.lastAttackTime=e}}),(0,i.useEffect)(()=>{let e=g.mountId;return()=>{l(t=>t.filter(t=>"summonExplosion"!==t.type||t.summonId!==e))}},[l,g.mountId]),(0,n.jsxs)("group",{ref:d,position:t.toArray(),children:[(0,n.jsx)(eg,{isAttacking:!!p}),c.map(e=>{if("summonExplosion"===e.type){let t=e.startTime?(Date.now()-e.startTime)/1e3:0,i=Math.max(0,1-t/(e.duration||.2)),s=e.targetId?r.find(t=>t.id===e.targetId):null;if(s&&d.current){let r=new m.Pq0;d.current.getWorldPosition(r);let o=s.position.clone().setY(1.5).sub(r);return(0,n.jsxs)("group",{position:o.toArray(),children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.35*(1+2*t),32,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#8800ff",emissive:"#9933ff",emissiveIntensity:.5*i,transparent:!0,opacity:.8*i,depthWrite:!1,blending:m.EZo})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.25*(1+3*t),24,24]}),(0,n.jsx)("meshStandardMaterial",{color:"#aa66ff",emissive:"#ffffff",emissiveIntensity:.5*i,transparent:!0,opacity:.9*i,depthWrite:!1,blending:m.EZo})]}),[.45,.65,.85].map((e,r)=>(0,n.jsxs)("mesh",{rotation:[Math.random()*Math.PI,Math.random()*Math.PI,Math.random()*Math.PI],children:[(0,n.jsx)("torusGeometry",{args:[e*(1+3*t),.045,16,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#8800ff",emissive:"#9933ff",emissiveIntensity:1*i,transparent:!0,opacity:.6*i*(1-.2*r),depthWrite:!1,blending:m.EZo})]},r)),[void 0,void 0,void 0,void 0].map((e,r)=>{let s=r/4*Math.PI*2,o=.5*(1+2*t);return(0,n.jsxs)("mesh",{position:[Math.sin(s)*o,Math.cos(s)*o,0],children:[(0,n.jsx)("sphereGeometry",{args:[.05,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#aa66ff",emissive:"#ffffff",emissiveIntensity:2*i,transparent:!0,opacity:.8*i,depthWrite:!1,blending:m.EZo})]},"spark-".concat(r))}),(0,n.jsx)("pointLight",{color:"#8800ff",intensity:1*i,distance:4,decay:2}),(0,n.jsx)("pointLight",{color:"#aa66ff",intensity:1*i,distance:6,decay:1})]},e.id)}}return null})]})}let ej=e=>{let{parentRef:t,enemies:r,onEnemyDamage:n,setDamageNumbers:s,nextDamageNumberId:o}=e,[a,l]=(0,i.useState)([]),[c,u]=(0,i.useState)(!1);return{processChainLightning:(0,i.useCallback)(()=>{if(c)return;if(u(!0),Math.random()>=.675){u(!1);return}let e=(e,t)=>{let n=null,i=1/0,s="";return r.forEach(r=>{if(r.isDying||!r.position||r.health<=0||t.has(r.id))return;let o=e.distanceTo(r.position);o<i&&o<11.25&&(i=o,n=r.position,s=r.id)}),n?{position:n,id:s}:null},i=e=>[19,17,13,11,7][e],a=new Set,h=e(t.current.position.clone(),a);if(!h){u(!1);return}a.add(h.id);let d=[h.position];n(h.id,19,!1,h.position,!0),s(e=>[...e,{id:o.current++,damage:19,position:h.position.clone().add(new m.Pq0(0,1.5,0)),isCritical:!1,isChainLightning:!0}]);let p=h.position;for(let t=1;t<Math.min(r.length,5);t++){let r=e(p,a);if(!r)break;let l=i(t);d.push(r.position),a.add(r.id),setTimeout(()=>{n(r.id,l,!1,r.position,!0),s(e=>[...e,{id:o.current++,damage:l,position:r.position.clone().add(new m.Pq0(0,1.5,0)),isCritical:!1,isChainLightning:!0}])},100*t),p=r.position}d.length>0&&(l(d),setTimeout(()=>{l([]),u(!1)},500))},[t,r,n,s,o,c]),lightningTargets:a,isProcessing:c}},eM=e=>{let{startPosition:t,targetPositions:r}=e,s=(0,i.useRef)(0),o=(0,i.useRef)(1),a=(0,i.useMemo)(()=>({segment:new m.Gu$(1,8,8),impact:new m.Gu$(.4,16,16)}),[]),l=(0,i.useMemo)(()=>({core:new m._4j({color:new m.Q1f("#FFD700"),emissive:new m.Q1f("#FFD700"),emissiveIntensity:5,transparent:!0}),branch:new m._4j({color:new m.Q1f("#FFA500"),emissive:new m.Q1f("#FFA500"),emissiveIntensity:4,transparent:!0}),impact:new m._4j({color:new m.Q1f("#FFD700"),emissive:new m.Q1f("#FFD700"),emissiveIntensity:3,transparent:!0})}),[]),c=(0,i.useMemo)(()=>Array(32).fill(0).map(()=>new m.Pq0((Math.random()-.5)*.15,(Math.random()-.5)*.15+2,(Math.random()-.5)*.15)),[]);return(0,f.F)((e,t)=>{s.current=Math.min(s.current+t,.5),o.current=.5*Math.random()+.5;let r=s.current/.5;l.core.opacity=.7*(1-r)*o.current,l.branch.opacity=.75*(1-r)*o.current,l.impact.opacity=.6*(1-r)*o.current}),(0,n.jsx)("group",{children:r.map((e,i)=>{let u=0===i?t:r[i-1],h=Math.ceil(8*e.clone().sub(u).length());return(0,n.jsxs)("group",{children:[Array(h).fill(0).map((t,r)=>{let i=r/h,s=c[r%c.length],o=u.clone().lerp(e,i).add(s).add(new m.Pq0(0,.5*Math.sin(i*Math.PI),0)),d=.025*Math.random()+.04;return(0,n.jsxs)("group",{children:[(0,n.jsx)("mesh",{position:o.toArray(),geometry:a.segment,material:l.core,scale:[d,d,d]}),.2>Math.random()&&(0,n.jsx)("mesh",{position:o.clone().add(c[(r+1)%c.length]),geometry:a.segment,material:l.branch,scale:[.35*d,.35*d,.35*d]})]},r)}),(0,n.jsx)("mesh",{position:e.toArray(),geometry:a.impact,material:l.impact}),(0,n.jsx)("pointLight",{position:e.toArray(),color:"#FFA500",intensity:15*(1-s.current/.5)*o.current,distance:4,decay:2})]},i)})})},ev=(0,i.forwardRef)((e,t)=>{let{parentRef:r,enemies:s,onEnemyDamage:o,setDamageNumbers:a,nextDamageNumberId:l}=e,{processChainLightning:c,lightningTargets:u}=ej({parentRef:r,enemies:s,onEnemyDamage:o,setDamageNumbers:a,nextDamageNumberId:l});return(0,i.useImperativeHandle)(t,()=>({processChainLightning:c})),(0,n.jsx)(n.Fragment,{children:u.length>0&&(0,n.jsx)(eM,{startPosition:r.current.position,targetPositions:u})})});ev.displayName="ChainLightning";let ew={1:29,2:37,3:41,4:53,5:79,6:97},eP=e=>{let{position:t}=e,[r,s]=i.useState(()=>Array(15).fill(null).map(()=>({offset:new m.Pq0((Math.random()-.5)*.8,0,(Math.random()-.5)*.8),speed:new m.Pq0((Math.random()-.5)*.55,(Math.random()-.5)*.05,(Math.random()-.5)*.55),life:1,orbit:{radius:.2+.3*Math.random(),speed:(Math.random()+.5)*2,phase:Math.random()*Math.PI*2}})));return(0,f.F)((e,t)=>{s(e=>e.map(e=>{let r=.001*Date.now()*e.orbit.speed+e.orbit.phase;return(e.offset.x=Math.cos(r)*e.orbit.radius+e.speed.x,e.offset.z=Math.sin(r)*e.orbit.radius+e.speed.z,e.offset.y=e.speed.y,e.speed.add(new m.Pq0((Math.random()-.5)*.01,(Math.random()-.5)*.001,(Math.random()-.5)*.01)),e.speed.multiplyScalar(.8),e.life-=1*t,e.life<=0)?{offset:new m.Pq0((Math.random()-.5)*.4,0,(Math.random()-.5)*.4),speed:new m.Pq0((Math.random()-.5)*.15,(Math.random()-.5)*.05,(Math.random()-.5)*.15),life:1,orbit:{radius:.4+.3*Math.random(),speed:(Math.random()+.5)*2,phase:Math.random()*Math.PI*2}}:e}))}),(0,n.jsx)("group",{position:t,children:r.map((e,t)=>(0,n.jsxs)("mesh",{position:e.offset.toArray(),children:[(0,n.jsx)("sphereGeometry",{args:[.0125,4,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#4488ff",emissive:"#4488ff",emissiveIntensity:3,transparent:!0,opacity:.8*e.life,depthWrite:!1,blending:m.EZo})]},t))})},eS=(0,i.forwardRef)((e,t)=>{let{parentRef:r,charges:s,setCharges:o}=e,a=(0,i.useRef)(null),{calculateBonusDamage:l,consumeOrb:c}=function(e){let{charges:t,setCharges:r}=e;return{calculateBonusDamage:(0,i.useCallback)(()=>ew[t.filter(e=>e.available).length]||0,[t]),consumeOrb:(0,i.useCallback)(()=>{let e=t.filter(e=>e.available);if(0===e.length)return;let n=e[0];r(e=>e.map(e=>e.id===n.id?{...e,available:!1,cooldownStartTime:Date.now()+200}:e)),setTimeout(()=>{r(e=>e.map(e=>e.id===n.id?{...e,available:!0,cooldownStartTime:null}:e))},8450)},[t,r])}}({charges:s,setCharges:o});if((0,i.useImperativeHandle)(t,()=>({calculateBonusDamage:l,consumeOrb:c})),(0,f.F)(()=>{a.current&&r.current&&a.current.position.copy(r.current.position)}),!r.current||!s.some(e=>e.available))return null;let u=s.length;return(0,n.jsx)("group",{ref:a,children:s.map((e,t)=>{if(!e.available)return null;let r=Math.acos(-1+2*t/u),i=Math.sqrt(u*Math.PI)*r,s=.05*Math.sin(r)*Math.cos(i),o=.05*Math.sin(r)*Math.sin(i+.001*Date.now()),a=.05*Math.cos(r);return(0,n.jsx)(eP,{position:new m.Pq0(s,o,a)},e.id)})})});eS.displayName="OrbShield";let eI=e=>{let{position:t,onComplete:r}=e,s=(0,i.useRef)(Date.now()),o=(0,i.useRef)(!1),a=(0,i.useRef)([]);(0,i.useEffect)(()=>{a.current=Array(40).fill(null).map(()=>({position:new m.Pq0(t.x+(Math.random()-.5)*1.65,t.y+3+2*Math.random(),t.z+(Math.random()-.5)*2),velocity:new m.Pq0((Math.random()-.5)*3,-(5*Math.random())-3,(Math.random()-.5)*3),scale:.1*Math.random()+.02,rotation:Math.random()*Math.PI,rotationSpeed:(Math.random()-.5)*5,life:1}))},[t]);let l=(0,i.useCallback)(()=>{o.current||(o.current=!0,null==r||r())},[r]);(0,i.useEffect)(()=>{let e=setTimeout(l,2850);return()=>{clearTimeout(e)}},[l]);let[c,u]=(0,i.useState)([]);return(0,f.F)((e,t)=>{if(o.current)return;let r=a.current.map(e=>({...e,velocity:e.velocity.clone().add(new m.Pq0(0,-(8*t),0)),position:e.position.clone().add(e.velocity.clone().multiplyScalar(t)),rotation:e.rotation+e.rotationSpeed*t,life:e.life-t})).filter(e=>e.life>0);a.current=r,u(r);let n=Date.now()-s.current;0===r.length&&n>=1250&&l()}),(0,n.jsx)("group",{children:c.map((e,t)=>(0,n.jsxs)("mesh",{position:e.position.toArray(),scale:[e.scale,e.scale,e.scale],rotation:[e.rotation,e.rotation,e.rotation],children:[(0,n.jsx)("icosahedronGeometry",{args:[1,0]}),(0,n.jsx)("meshStandardMaterial",{color:"#E5F7FF",emissive:"#E5F7FF",emissiveIntensity:1,transparent:!0,opacity:.45*e.life,depthWrite:!1,blending:m.EZo})]},t))})};function eb(e){let{isLeft:t=!1}=e,r=1.75*Math.PI;return(0,n.jsx)("group",{rotation:[-.45,t?-.7:.7,t?-.15:.15],children:Array.from({length:18}).map((e,i)=>{let s=i/19,o=.075*(1-.725*s),a=Math.pow(s,.2)*r,l=3.25*Math.pow(s,2.7);return(0,n.jsxs)("group",{position:[l*(t?-.15:.15),.0675*i,-(.725*l)],rotation:[-1.5*s,a,0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[o,1.5*o,.0675,10]}),(0,n.jsx)("meshStandardMaterial",{color:"rgb(".concat(139-80*s,", ").concat(0+20*s,", ").concat(0+20*s,")"),roughness:.7,metalness:.4})]}),Array.from({length:6}).map((e,t)=>(0,n.jsx)("group",{rotation:[0,t*Math.PI/2,0],children:(0,n.jsxs)("mesh",{position:[.95*o,0,0],children:[(0,n.jsx)("boxGeometry",{args:[.3*o,.259375,1.5*o]}),(0,n.jsx)("meshStandardMaterial",{color:"rgb(".concat(159-100*s,", ").concat(20+20*s,", ").concat(20+20*s,")"),roughness:.8,metalness:.3})]})},t))]},i)})})}function eF(e){let{parentRef:t,rotationSpeed:r}=e,s=(0,i.useRef)(null),o=(0,i.useRef)(0),a=(0,i.useRef)([]);return(0,i.useEffect)(()=>{a.current=Array(56).fill(null).map((e,t)=>({angle:t/24*Math.PI*2,height:0+1*Math.random(),radius:.4+2.25*Math.random(),rotationOffset:Math.random()*Math.PI*2,speed:.5+.5*Math.random(),spinSpeed:(Math.random()>.5?1:-1)*(2+3*Math.random())}));let e=s.current;return()=>{e&&(e.children.forEach(e=>{e.geometry&&e.geometry.dispose(),e.material&&(Array.isArray(e.material)?e.material.forEach(e=>e.dispose()):e.material.dispose())}),e.clear(),e.parent&&e.parent.remove(e)),a.current=[],o.current=0}},[]),(0,f.F)((e,n)=>{if(!s.current||!t.current||null===r.current)return;s.current.rotation.y+=n*(r.current||0)*.5;let i=Date.now();i-o.current>50&&(a.current.forEach((e,t)=>{let o=s.current.children[t];if(!o)return;e.angle+=n*e.speed*(r.current||0)/5;let a=Math.cos(e.angle)*e.radius,l=Math.sin(e.angle)*e.radius;o.position.set(a,e.height+.2*Math.sin(.002*i+t)-.35,l),o.rotation.y+=n*e.spinSpeed,o.rotation.x+=n*e.spinSpeed*.75;let c=.25+(r.current||0)/25*.2;o.scale.setScalar(c);let u=o.material;u&&(u.opacity=.2+(r.current||0)/25*.3,u.emissiveIntensity=.025+(r.current||0)/25*1.01)}),o.current=i)}),(0,n.jsxs)("group",{ref:s,children:[a.current.map((e,t)=>(0,n.jsxs)("mesh",{children:[(0,n.jsx)("dodecahedronGeometry",{args:[.115,0]})," ",(0,n.jsx)("meshStandardMaterial",{color:"#FF4400",emissive:"#FF2200",emissiveIntensity:2,transparent:!0,opacity:.3,blending:m.EZo,depthWrite:!1})]},t)),(0,n.jsxs)("mesh",{position:[0,-.25,0],rotation:[-Math.PI/2,0,0],children:[(0,n.jsx)("ringGeometry",{args:[.65,.5,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#FF3000",emissive:"#FF2200",emissiveIntensity:1.5,transparent:!0,opacity:.3,blending:m.EZo,depthWrite:!1,side:m.$EB})]}),(0,n.jsx)("pointLight",{position:[0,.5,0],color:"#FF6000",intensity:.1+(r.current||0)/25*2,distance:3,decay:2})]})}function eE(e){let{parentRef:t,isActive:r,onHit:s,enemyData:o,setDamageNumbers:a,nextDamageNumberId:l,charges:c,setCharges:u,onWhirlwindEnd:h,reigniteRef:d}=e,p=(0,i.useRef)(null),x=(0,i.useRef)(0),g=(0,i.useRef)(new Set),y=(0,i.useRef)({}),j=(0,i.useRef)(!1),M=(0,i.useRef)(!1),{consumeCharge:v}=function(e){let{charges:t,setCharges:r,isWhirlwinding:n,onWhirlwindEnd:s}=e,o=(0,i.useRef)(0),a=(0,i.useRef)(!1);(0,i.useEffect)(()=>{n?t.some(e=>e.available)||a.current||(a.current=!0,null==s||s()):a.current=!1},[t,n,s]);let l=(0,i.useCallback)(()=>{let e=Date.now();if(e-o.current<1e3)return!1;let n=t.findIndex(e=>e.available);return -1===n?(a.current||(a.current=!0,null==s||s()),!1):(o.current=e,r(t=>{let r=[...t];return r[n]={...r[n],available:!1,cooldownStartTime:e},r}),setTimeout(()=>{r(e=>{let t=[...e];return t[n]={...t[n],available:!0,cooldownStartTime:null},t})},8250),0===t.filter((e,t)=>t!==n&&e.available).length&&setTimeout(()=>{a.current||(a.current=!0,null==s||s())},100),!0)},[t,r,s]);return(0,i.useEffect)(()=>{if(n){if(!t.some(e=>e.available)){a.current||(a.current=!0,null==s||s());return}l();let e=setInterval(()=>{l()},1e3);return()=>clearInterval(e)}},[l,n,t,s]),{consumeCharge:l}}({parentRef:t,charges:c,setCharges:u,isWhirlwinding:r,onWhirlwindEnd:h}),w=c.some(e=>e.available),P=r&&w;return(0,i.useEffect)(()=>{P&&!M.current&&(x.current=0),M.current=P},[P]),(0,i.useEffect)(()=>{!P&&r&&(g.current.clear(),x.current=0,j.current=!1,null==h||h())},[P,r,h]),(0,i.useEffect)(()=>{if(P){j.current=!0;let e=setInterval(()=>{v()||(j.current=!1,null==h||h())},500);return()=>{clearInterval(e),j.current=!1}}j.current=!1},[P,v,h]),(0,i.useEffect)(()=>{let e=g.current;return()=>{j.current=!1,e.clear(),x.current=0}},[]),(0,f.F)((e,r)=>{p.current&&t.current&&P&&(p.current.position.copy(t.current.position),x.current=Math.min(x.current+8*r,25),p.current.rotation.y+=x.current*r,s&&a&&l&&o&&o.forEach(e=>{if(e.health<=0)return;let t=Date.now();if(t-(y.current[e.id]||0)<550-400*Math.pow(x.current/25,2))return;let r=p.current.position.distanceTo(e.position);if(r<=4.8){let n,i;r>=3.9599999999999995?(n=38,i=!0):(n=19,i=!1);let o=e.health;if(s(e.id,n),o>0&&o-n<=0&&(null==d?void 0:d.current)){let t=e.position.clone();d.current.processKill(t)}a(t=>[...t,{id:l.current++,damage:n,position:e.position.clone(),isCritical:i}]),y.current[e.id]=t}}))}),(0,n.jsxs)("group",{children:[P&&j.current&&t.current&&(0,n.jsx)("primitive",{object:t.current,children:(0,n.jsx)(eF,{parentRef:t,rotationSpeed:x})}),(0,n.jsx)("group",{ref:p,children:P&&(0,n.jsxs)(n.Fragment,{children:[[.5,1,1.5].map((e,t)=>(0,n.jsxs)("mesh",{position:[0,-.25,0],rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("torusGeometry",{args:[2*e,.1,16,32]}),(0,n.jsx)("meshStandardMaterial",{color:new m.Q1f(0xff0000),emissive:new m.Q1f(0xff0000),emissiveIntensity:2,transparent:!0,opacity:.6-.15*t,side:m.$EB})]},t)),[...Array(8)].map((e,t)=>(0,n.jsxs)("mesh",{position:[0,-.25,0],rotation:[0,t/8*Math.PI*2,0],children:[(0,n.jsx)("planeGeometry",{args:[6,.25]}),(0,n.jsx)("meshStandardMaterial",{color:new m.Q1f(0xff0000),emissive:new m.Q1f(0xff0000),emissiveIntensity:1.5,transparent:!0,opacity:.4,side:m.$EB,blending:m.EZo})]},"trail-".concat(t)))]})})]})}let eC=e=>{let{currentHealth:t,maxHealth:r,onHealthChange:n,setDamageNumbers:s,nextDamageNumberId:o}=e,{processHealing:a}=ea({currentHealth:t,maxHealth:r,onHealthChange:n,setDamageNumbers:s,nextDamageNumberId:o,healAmount:4});return{handleStealthKillHeal:(0,i.useCallback)(function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1],a(4,e.clone().add(new m.Pq0(0,2,0)))},[a])}};function eR(e){let{parentRef:t}=e,r=(0,i.useRef)([]),s=(0,i.useRef)(Date.now());return(0,i.useEffect)(()=>(r.current=Array(20).fill(null).map(()=>{let e=new m.eaF(new m.Gu$(.15,8,8),new m._4j({color:"#a8e6cf",emissive:"#a8e6cf",transparent:!0,opacity:.6,blending:m.EZo,depthWrite:!1})),t=Math.random()*Math.PI*2,r=.5+.5*Math.random();return e.position.set(Math.cos(t)*r,.5+1*Math.random(),Math.sin(t)*r),e}),()=>{r.current.forEach(e=>{e.geometry.dispose(),e.material.dispose()})}),[]),(0,f.F)(()=>{if(!t.current)return;let e=Math.min((Date.now()-s.current)/1e3,1);r.current.forEach((t,n)=>{let i=n/r.current.length*Math.PI*2+e*Math.PI,s=.5*(1-e);t.position.x=Math.cos(i)*s,t.position.z=Math.sin(i)*s,t.position.y+=.03,t.material.opacity=.6*(1-e),t.scale.setScalar(1-.5*e)})}),(0,n.jsxs)("group",{children:[r.current.map((e,t)=>(0,n.jsx)("primitive",{object:e},t)),(0,n.jsx)("pointLight",{color:"#a8e6cf",intensity:2,distance:3,decay:2})]})}function ek(e){let{position:t,direction:r,onComplete:s,parentRef:o}=e,a=(0,i.useRef)(null),l=(0,i.useMemo)(()=>({mainArc:new m.O3Y(1.5,.4,8,32,Math.PI),innerGlow:new m.O3Y(1.5,.2,16,32,Math.PI),outerGlow:new m.O3Y(1,.45,16,32,Math.PI),particle:new m.Gu$(.08,8,8)}),[]),c=(0,i.useMemo)(()=>({mainFlame:new m._4j({color:"#9b4dff",emissive:"#4d2bff",emissiveIntensity:2,transparent:!0,opacity:.9}),innerGlow:new m._4j({color:"#4d8eff",emissive:"#2b4dff",emissiveIntensity:1,transparent:!0,opacity:.7}),outerGlow:new m._4j({color:"#9b4dff",emissive:"#4d2bff",emissiveIntensity:1.3,transparent:!0,opacity:.5}),particle:new m._4j({color:"#4d8eff",emissive:"#2b4dff",emissiveIntensity:1.5,transparent:!0,opacity:.6})}),[]),u=(0,i.useMemo)(()=>Array(12).fill(0).map((e,t)=>({position:new m.Pq0(.75*Math.cos(t*Math.PI/6),.75*Math.sin(t*Math.PI/6),0)})),[]),{reset:h}=es({effectRef:a,position:t,direction:r,parentRef:o});return(0,i.useEffect)(()=>()=>{h(),s()},[h,s]),(0,n.jsx)("group",{ref:a,position:t.toArray(),rotation:[Math.PI/2,Math.atan2(r.x,r.z),0],children:(0,n.jsxs)("group",{position:[0,0,0],children:[(0,n.jsx)("mesh",{geometry:l.mainArc,material:c.mainFlame}),(0,n.jsx)("mesh",{geometry:l.innerGlow,material:c.innerGlow}),(0,n.jsx)("mesh",{geometry:l.outerGlow,material:c.outerGlow}),u.map((e,t)=>(0,n.jsx)("mesh",{position:e.position,geometry:l.particle,material:c.particle},t)),(0,n.jsx)("pointLight",{color:"#9b4dff",intensity:8,distance:4}),(0,n.jsx)("pointLight",{color:"#4d8eff",intensity:5,distance:6})]})})}function eT(e){let{position:t,onComplete:r}=e,s=(0,i.useRef)(null),o=(0,i.useRef)(Date.now());return(0,f.F)(()=>{if(!s.current)return;let e=Math.min((Date.now()-o.current)/500,1),t=1+2*e;s.current.scale.set(t,t,t),s.current.children.forEach(t=>{if(t instanceof m.eaF){let r=t.material;r.opacity&&(r.opacity=1-e)}}),e>=1&&r()}),(0,n.jsxs)("group",{ref:s,position:[t.x,t.y+1,t.z],children:[(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("ringGeometry",{args:[.6,.8,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffcc00",emissive:"#ffcc00",emissiveIntensity:2,transparent:!0,opacity:.9,depthWrite:!1,blending:m.EZo})]}),(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("ringGeometry",{args:[.2,.3,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",emissive:"#ffffff",emissiveIntensity:2,transparent:!0,opacity:.9,depthWrite:!1,blending:m.EZo})]}),(0,n.jsx)("pointLight",{color:"#ffcc00",intensity:3,distance:5,decay:2}),[...Array(8)].map((e,t)=>(0,n.jsxs)("mesh",{position:[.4*Math.cos(2*Math.PI*t/8),0,.4*Math.sin(2*Math.PI*t/8)],rotation:[0,0,2*Math.PI*t/8],children:[(0,n.jsx)("boxGeometry",{args:[.05,.05,.4]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffcc00",emissive:"#ffcc00",emissiveIntensity:2,transparent:!0,opacity:.8,depthWrite:!1,blending:m.EZo})]},t))]})}function e_(e){let{position:t,onComplete:r}=e,s=(0,i.useRef)(null),o=(0,i.useRef)(Date.now());(0,f.F)(()=>{if(!s.current)return;let e=Math.min((Date.now()-o.current)/1e3,1),t=1+1.5*e;s.current.scale.set(t,t,t),s.current.children.forEach(t=>{if(t instanceof m.eaF){let r=t.material;r.opacity&&(r.opacity=1-e)}}),e>=1&&r()});let a=(0,i.useRef)(Math.random()*Math.PI*2);return(0,n.jsxs)("group",{ref:s,position:[t.x,t.y+1,t.z],rotation:[0,a.current,0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.4,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#00FF44",emissive:"#00FF44",emissiveIntensity:1.5,transparent:!0,opacity:.8,depthWrite:!1,blending:m.EZo})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.2,12,12]}),(0,n.jsx)("meshStandardMaterial",{color:"#33FF33",emissive:"#33FF33",emissiveIntensity:2,transparent:!0,opacity:.9,depthWrite:!1,blending:m.EZo})]}),[...Array(6)].map((e,t)=>{let r=t/6*Math.PI*2,i=.3+.2*Math.random(),s=.3+.2*Math.random();return(0,n.jsxs)("mesh",{position:[Math.cos(r)*i,.4*Math.random()-.2,Math.sin(r)*s],children:[(0,n.jsx)("sphereGeometry",{args:[.15+.1*Math.random(),8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#00BB33",emissive:"#00BB33",emissiveIntensity:1.5,transparent:!0,opacity:.7,depthWrite:!1,blending:m.EZo})]},t)}),[...Array(10)].map((e,t)=>{let r=Math.random()*Math.PI*2,i=.5*Math.random(),s=.4*Math.random()-.2;return(0,n.jsxs)("mesh",{position:[Math.cos(r)*i,s,Math.sin(r)*i],children:[(0,n.jsx)("sphereGeometry",{args:[.05+.04*Math.random(),6,6]}),(0,n.jsx)("meshStandardMaterial",{color:t%2==0?"#00FF44":"#55FF00",emissive:t%2==0?"#00FF44":"#55FF00",emissiveIntensity:2,transparent:!0,opacity:.8,depthWrite:!1,blending:m.EZo})]},"particle-".concat(t))}),(0,n.jsx)("pointLight",{color:"#00FF44",intensity:1.5,distance:3,decay:2})]})}let eD=(0,i.forwardRef)(function(e,t){let{isUnlocked:r}=e,[s,o]=(0,i.useState)([]),[a,l]=(0,i.useState)([]),c=(0,i.useRef)(0),u=e=>{r&&(o(t=>[...t,{id:c.current++,position:e.clone()}]),l(t=>[...t,{id:c.current++,position:e.clone()}]))},h=e=>{o(t=>t.filter(t=>t.id!==e))},d=e=>{l(t=>t.filter(t=>t.id!==e))};return(0,i.useImperativeHandle)(t,()=>({createEagleEyeEffect:u})),(0,n.jsxs)(n.Fragment,{children:[s.map(e=>(0,n.jsx)(eT,{position:e.position,onComplete:()=>h(e.id)},e.id)),a.map(e=>(0,n.jsx)(e_,{position:e.position,onComplete:()=>d(e.id)},e.id))]})}),eG=e=>{let{parentRef:t,onHit:r,enemyData:a,setDamageNumbers:l,nextDamageNumberId:c,charges:u,setCharges:h,isEagleEyeUnlocked:d}=e,p=(0,i.useRef)([]),f=(0,i.useRef)(0),x=(0,i.useRef)(null),{consumeCharge:g}=function(e){let{charges:t,setCharges:r}=e,n=(0,i.useRef)(0),s=(0,i.useRef)(null);return{consumeCharge:(0,i.useCallback)(()=>{let e=t.filter(e=>e.available);if(0===e.length)return!1;if(null===s.current&&(s.current=e[0].id,n.current=0),n.current++,n.current>=6){let e=s.current;r(t=>t.map(t=>t.id===e?{...t,available:!1,cooldownStartTime:Date.now()}:t)),setTimeout(()=>{r(t=>t.map(t=>t.id===e?{...t,available:!0,cooldownStartTime:null}:t))},8250),n.current=0,s.current=null}return!0},[t,r])}}({charges:u,setCharges:h}),{processHit:y,resetCounter:j}=function(e){let{isUnlocked:t,setDamageNumbers:r,nextDamageNumberId:n,onHit:s,eagleEyeManagerRef:o}=e,a=(0,i.useRef)(0),l=(0,i.useRef)(0);return{processHit:(0,i.useCallback)((e,i)=>{if(!t)return!1;let c=Date.now();return c-l.current>3e3&&(a.current=0),l.current=c,a.current+=1,a.current>=3&&(a.current=0,s(e,67),r(e=>[...e,{id:n.current++,damage:67,position:i.clone(),isCritical:!0,isEagleEye:!0}]),(null==o?void 0:o.current)&&o.current.createEagleEyeEffect(i),!0)},[t,s,r,n,o]),resetCounter:(0,i.useCallback)(()=>{a.current=0},[])}}({isUnlocked:d,setDamageNumbers:l,nextDamageNumberId:c,onHit:r,eagleEyeManagerRef:x});(0,i.useEffect)(()=>{p.current=Array(8).fill(null).map((e,t)=>({id:t,position:new m.Pq0,direction:new m.Pq0,startPosition:new m.Pq0,maxDistance:40,isQuickShot:!0,power:1,startTime:0,hasCollided:!1,active:!1,opacity:1,fadeStartTime:null}))},[]);let M=()=>p.current.find(e=>!e.active),v=(0,i.useCallback)(()=>{let e=Date.now();if(e-f.current<155||!u.some(e=>e.available)||!t.current||!g())return;f.current=e;let r=M();if(!r)return;let n=t.current.position.clone();n.y+=1;let i=new m.Pq0(0,0,1);i.applyQuaternion(t.current.quaternion),r.position.copy(n),r.direction.copy(i),r.startPosition.copy(n),r.startTime=e,r.hasCollided=!1,r.active=!0,r.opacity=1,r.fadeStartTime=null},[t,u,g]);return(0,i.useEffect)(()=>{let e;let t=()=>{let n=Date.now();p.current.filter(e=>e.active).forEach(e=>{if(null!==e.fadeStartTime){let t=n-e.fadeStartTime;if(t>=400){e.active=!1;return}e.opacity=1-t/400;return}if(e.position.distanceTo(e.startPosition)>=e.maxDistance){e.fadeStartTime=n;return}for(let t of(e.position.add(e.direction.clone().multiplyScalar(.5)),a)){if(t.isDying||t.health<=0)continue;let i=new m.Pq0(e.position.x,0,e.position.z),a=new m.Pq0(t.position.x,0,t.position.z);if(1.3>i.distanceTo(a)){let i=o[s.BOW].normal;r(t.id,i),t.health-i>0&&(l(e=>[...e,{id:c.current++,damage:i,position:t.position.clone(),isCritical:!1}]),d&&y(t.id,t.position)),e.hasCollided=!0,e.fadeStartTime=n;return}}}),p.current.some(e=>e.active)&&(e=requestAnimationFrame(t))};return e=requestAnimationFrame(t),()=>{cancelAnimationFrame(e)}},[a,r,l,c,d,y]),{shootQuickShot:v,projectilePool:p,resetEagleEyeCounter:j,eagleEyeManagerRef:x,eagleEyeManager:(0,n.jsx)(eD,{ref:x,isUnlocked:d})}};function eA(e){let{position:t,direction:r,opacity:i=1}=e,s=new m._4j({color:"#d6cfc7",roughness:.9,metalness:.1,transparent:!0,opacity:i});return(0,n.jsxs)("group",{position:t.toArray(),rotation:[0,Math.atan2(r.x,r.z),0],children:[(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.04,.06,1.2,6]}),(0,n.jsx)("meshStandardMaterial",{...s})]}),[-.3,0,.3].map((e,t)=>(0,n.jsx)("group",{position:[0,0,e],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.08,8,8]}),(0,n.jsx)("meshStandardMaterial",{...s})]})},t)),(0,n.jsx)("group",{position:[0,0,-.7],children:(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("coneGeometry",{args:[.1,.3,6]}),(0,n.jsx)("meshStandardMaterial",{...s})]})}),[0,Math.PI/2,Math.PI,3*Math.PI/2].map((e,t)=>(0,n.jsx)("group",{position:[.08*Math.sin(e),.08*Math.cos(e),0],rotation:[0,0,e],children:(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("coneGeometry",{args:[.02,.1,4]}),(0,n.jsx)("meshStandardMaterial",{...s})]})},t)),(0,n.jsx)("pointLight",{color:"#a8e6cf",intensity:.5*i,distance:2,decay:2})]})}function eB(e){let{parentRef:t,isActive:r,onComplete:n}=e,s=(0,i.useRef)(null),o=(0,i.useRef)(null);return(0,f.F)(()=>{if(!r||!t.current)return;if(!o.current){o.current=Date.now(),s.current=t.current.position.clone();return}let e=Math.min((Date.now()-o.current)/1e3/.25,1),i=1-Math.pow(1-e,2),a=new m.Pq0(0,0,-1).applyQuaternion(t.current.quaternion).normalize(),l=s.current.clone().add(a.multiplyScalar(3.5*i));t.current.position.copy(l),1===e&&(n(),o.current=null,s.current=null)}),null}function ez(e){let t=Math.floor(334*Math.max(.5,Math.min(4,e))),r=.11>Math.random();return r&&(t*=2),console.log("Pyroclast damage calculation:",{chargeTimeSeconds:e,damage:t,isCritical:r}),{damage:t,isCritical:r}}function eq(e){let{position:t,chargeTime:r=1,explosionStartTime:s,onComplete:o}=e,a=(0,i.useRef)(s||Date.now()),[,l]=(0,i.useState)({}),c=Math.min(r/4,1),u=.5+.8*c,h=2+3*c;(0,i.useEffect)(()=>{let e=setInterval(()=>{l({}),(Date.now()-a.current)/1e3>.8&&(clearInterval(e),o&&o())},16),t=setTimeout(()=>{clearInterval(e),o&&o()},800);return()=>{clearInterval(e),clearTimeout(t)}},[o]);let d=(Date.now()-a.current)/1e3,p=Math.max(0,1-d/.8);if(p<=0)return null;let f=3+(d<.1?8:0);return(0,n.jsxs)("group",{position:t,children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.5*u*(1+d*f),32,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#FF2200",emissive:"#FF3300",emissiveIntensity:h*p*.5,transparent:!0,opacity:.9*p,depthWrite:!1,blending:m.EZo})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.525*u*(1+d*(f+1)),24,24]}),(0,n.jsx)("meshStandardMaterial",{color:"#FF4400",emissive:"#FF6600",emissiveIntensity:.5*h*p,transparent:!0,opacity:.95*p,depthWrite:!1,blending:m.EZo})]}),[.45,.675,.8,.925,1.125].map((e,t)=>(0,n.jsxs)("mesh",{rotation:[Math.random()*Math.PI,Math.random()*Math.PI,Math.random()*Math.PI],children:[(0,n.jsx)("torusGeometry",{args:[e*u*(1+d*(f+2)),.06*u,16,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#FF2200",emissive:"#FF4400",emissiveIntensity:h*p*.3,transparent:!0,opacity:.7*p*(1-.15*t),depthWrite:!1,blending:m.EZo})]},t)),[...Array(12)].map((e,t)=>{let r=t/12*Math.PI*2,i=u*(1+d*(f-1))*(1+.3*Math.random()),s=(Math.random()-.5)*.5;return(0,n.jsxs)("mesh",{position:[Math.sin(r)*i,Math.cos(r)*i+s,(Math.random()-.5)*.3],children:[(0,n.jsx)("sphereGeometry",{args:[.08*u,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#FF5500",emissive:"#FF7700",emissiveIntensity:1.2*h*p,transparent:!0,opacity:.9*p,depthWrite:!1,blending:m.EZo})]},"spark-".concat(t))}),(0,n.jsx)("pointLight",{color:"#FF2200",intensity:3*h*p,distance:5*u,decay:1.8}),(0,n.jsx)("pointLight",{color:"#FF4400",intensity:1.5*h*p,distance:8*u,decay:1.5}),d<.1&&(0,n.jsx)("pointLight",{color:"#FF3300",intensity:5*h*(1-10*d),distance:3*u,decay:1})]})}function eL(e){let{id:t,position:r,direction:s,chargeTime:o,onImpact:a,checkCollisions:l}=e,c=(0,i.useRef)(null),u=(0,i.useRef)(r.clone()),h=(0,i.useRef)(!1),[d,p]=(0,i.useState)(!1),[x,g]=(0,i.useState)(null),[y,j]=(0,i.useState)(null);(0,i.useEffect)(()=>{c.current&&c.current.position.copy(r)},[r]),(0,f.F)((e,r)=>{if(c.current&&!h.current){if(c.current.position.add(s.clone().multiplyScalar(25*r)),l){let e=u.current.clone();if(console.log("[PyroclastMissile] Missile ".concat(t," moved from ").concat(e.x.toFixed(2),", ").concat(e.y.toFixed(2),", ").concat(e.z.toFixed(2)," to ").concat(c.current.position.x.toFixed(2),", ").concat(c.current.position.y.toFixed(2),", ").concat(c.current.position.z.toFixed(2))),l(t,c.current.position.clone())){console.log("[PyroclastMissile] Missile ".concat(t," hit something, creating explosion")),h.current=!0,g(c.current.position.clone()),j(Date.now()),p(!0),a&&a(c.current.position.clone());return}}c.current.position.distanceTo(u.current)>40&&!h.current&&(console.log("[PyroclastMissile] Missile ".concat(t," reached max distance, creating explosion")),h.current=!0,g(c.current.position.clone()),j(Date.now()),p(!0),a&&a(c.current.position.clone()))}});let M=Math.min(o/4,1),v=.4+.75*M,w=1.25+2.5*M;return(0,n.jsxs)("group",{children:[!h.current&&(0,n.jsxs)("group",{ref:c,position:r.toArray(),children:[(0,n.jsx)("group",{children:(0,n.jsxs)("mesh",{rotation:[0,0,0],onUpdate:e=>{let t=new m.Pq0(0,1,0),r=new m.PTz().setFromUnitVectors(t,s.clone().normalize());e.quaternion.copy(r)},children:[(0,n.jsx)("cylinderGeometry",{args:[.2*v,.4*v,2*v,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#FF2200",emissive:"#FF2200",emissiveIntensity:w,transparent:!0,opacity:.9})]})}),[void 0,void 0,void 0,void 0].map((e,t)=>(0,n.jsxs)("mesh",{position:[0,0,-(.45*t)+.5],rotation:[0,0,0],children:[(0,n.jsx)("torusGeometry",{args:[.4*v+.1*t,.1,6,12]}),(0,n.jsx)("meshStandardMaterial",{color:"#FF2200",emissive:"#FF2200",emissiveIntensity:w*(1-.2*t),transparent:!0,opacity:.7-.15*t,blending:m.EZo})]},t)),(0,n.jsx)("pointLight",{color:"#FF544E",intensity:1*w,distance:5,decay:2})]}),d&&x&&(0,n.jsx)(eq,{position:x,chargeTime:o,explosionStartTime:y,onComplete:()=>{setTimeout(()=>{a&&a()},200)}})]})}let eO=(0,i.forwardRef)((e,t)=>{let{parentRef:r,setCharges:s,isActive:o=!0}=e,a=(0,i.useRef)(null),[l,c]=(0,i.useState)(!1),u=(0,i.useRef)(.1),h=(0,i.useRef)(0),{restoreCharge:d}=function(e){let{setCharges:t}=e;return{restoreCharge:(0,i.useCallback)(()=>{try{console.log("[Reignite] restoreCharge called"),t(e=>{console.log("[Reignite] Current charges state:",e.map(e=>({id:e.id,available:e.available,cooldownStartTime:e.cooldownStartTime})));let t=e.map((e,t)=>e.available?-1:t).filter(e=>-1!==e).slice(0,3);if(console.log("[Reignite] Found unavailable indices to restore:",t),0===t.length)return console.log("[Reignite] No unavailable charges found, all charges are already available"),e;console.log("[Reignite] Restoring exactly ".concat(t.length," orbs at indices:"),t);let r=e.map((e,r)=>t.includes(r)?{...e,available:!0,cooldownStartTime:null}:e),n=r.filter(e=>e.available).length,i=r.length;return console.log("[Reignite] After restoration: ".concat(n,"/").concat(i," charges are available")),console.log("[Reignite] Updated charges state:",r.map(e=>({id:e.id,available:e.available,cooldownStartTime:e.cooldownStartTime}))),r})}catch(e){console.error("[Reignite] Error in restoreCharge:",e)}},[t])}}({setCharges:s}),p=e=>{if(!o){console.log("[Reignite] Kill detected but Reignite not active (not using Spear with passive)");return}console.log("[Reignite] Calling restoreCharge() to replenish orbs"),d(),c(!0),u.current=.1,h.current=Date.now()};return((0,i.useImperativeHandle)(t,()=>({processKill:p})),(0,f.F)(()=>{if(a.current&&r.current&&(a.current.position.copy(r.current.position),a.current.position.y=1),l){let e=(Date.now()-h.current)/1e3;if(e<.75){let t=e/.75;u.current=3*Math.pow(t,.5)*(1-.5*t)}else c(!1)}}),o)?(0,n.jsxs)("group",{ref:a,children:[l&&(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[u.current,24,24]}),(0,n.jsx)("meshStandardMaterial",{color:"#ff3300",emissive:"#ff0000",emissiveIntensity:2,transparent:!0,opacity:1-u.current/3,depthWrite:!1,blending:m.EZo})]}),l&&(0,n.jsx)("pointLight",{color:"#ff3300",intensity:5*(1-u.current/3),distance:5,decay:2})]}):null});function eW(e){let{parentRef:t,isActive:r,chargeProgress:s}=e,o=(0,i.useRef)(null),a=(0,i.useRef)(0),[l,c]=(0,i.useState)(!1);if((0,i.useEffect)(()=>{if(r){let e=setTimeout(()=>{c(!0)},100);return()=>{clearTimeout(e)}}c(!1)},[r]),(0,f.F)(()=>{if(!l||!t.current||!o.current)return;o.current.position.copy(t.current.position),o.current.position.y+=-.5;let e=Date.now();e-a.current>50&&(Array.from(o.current.children).forEach(e=>{e.rotation.y+=.2*Math.random()-.1,e.rotation.x+=.1*Math.random()-.05;let t=(.1+.7*s)*(.8+.4*Math.random());if(e.scale.set(t,t,t),e.material instanceof m.imn){let t=e.material;t.opacity=.6+.4*s,t.emissiveIntensity=1+4*s}}),a.current=e)}),!l)return null;let u=[];for(let e=0;e<12;e++){let t=e/12*Math.PI*2,r=.8+.3*Math.random(),i=Math.sin(t)*r,o=Math.cos(t)*r,a=.6*Math.random()+.2;u.push((0,n.jsxs)("mesh",{position:[i,a,o],rotation:[0,Math.random()*Math.PI*2,0],children:[(0,n.jsx)("dodecahedronGeometry",{args:[.2,0]}),(0,n.jsx)("meshStandardMaterial",{color:e%3==0?"#FF8800":e%3==1?"#FF4400":"#FF2200",emissive:e%3==0?"#FF8800":e%3==1?"#FF4400":"#FF2200",emissiveIntensity:1+4*s,transparent:!0,opacity:.6+.4*s,blending:m.EZo,depthWrite:!1})]},e))}let h=.8+1.375*s;return(0,n.jsxs)("group",{ref:o,children:[u,(0,n.jsxs)("mesh",{position:[0,.5,0],rotation:[-Math.PI/2,0,0],children:[(0,n.jsx)("ringGeometry",{args:[h-.2,h,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#FF3000",emissive:"#FF6000",emissiveIntensity:2+4*s,transparent:!0,opacity:.3+.6*s,blending:m.EZo,depthWrite:!1,side:m.$EB})]}),(0,n.jsxs)("mesh",{position:[0,0,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.2,.5,2*s,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#FF4000",emissive:"#FF6000",emissiveIntensity:3+3*s,transparent:!0,opacity:.5+.4*s,blending:m.EZo,depthWrite:!1})]}),(0,n.jsx)("pointLight",{color:"#FF6000",intensity:2+6*s,distance:4+4*s,decay:2})]})}function eH(e){let{parentRef:t,isActive:r,onComplete:s,enemyData:o=[],onHit:a,showDamageNumber:l,reigniteRef:c}=e,u=(0,i.useRef)(null),h=(0,i.useRef)(null),d=(0,i.useRef)(new m.Pq0),p=(0,i.useRef)(null),x=(0,i.useRef)(new Set),[g,y]=(0,i.useState)([]),j=(0,i.useRef)(1),M=(0,i.useRef)({});return(0,i.useEffect)(()=>{console.log("[Breach] Component mounted, reigniteRef available:",!!c)},[c]),(0,f.F)(()=>{if(!r||!t.current)return;if(!h.current){h.current=Date.now(),u.current=t.current.position.clone(),p.current=t.current.position.clone(),x.current.clear(),d.current=new m.Pq0(0,0,1).applyQuaternion(t.current.quaternion).normalize(),y([]),o&&o.forEach(e=>{M.current[e.id]=e.health});return}let e=Math.min((Date.now()-h.current)/1e3/.35,1),n=1-Math.pow(1-e,2),i=d.current.clone(),f=u.current.clone().add(i.multiplyScalar(7.5*n)),g=e;if(f.length()>=28.5&&(f.normalize().multiplyScalar(27.075),g<.9&&(g=.9)),p.current&&g<1){let e=[];if(Math.random()>.6){let t=Math.random(),r=p.current.clone().lerp(f,t);r.x+=(Math.random()-.5)*1.5,r.y+=.5*Math.random(),r.z+=(Math.random()-.5)*1.5,e.push({id:j.current++,position:r})}e.length>0&&y(t=>[...t,...e])}if(o&&o.length>0&&a){for(let e of o)if(!x.current.has(e.id)&&!(e.health<=0)&&2>function(e,t,r){let n=t.clone().sub(e),i=n.length();if(0===i)return r.distanceTo(e);let s=Math.max(0,Math.min(1,r.clone().sub(e).dot(n)/(i*i))),o=e.clone().add(n.multiplyScalar(s));return r.distanceTo(o)}(p.current,f,e.position)){x.current.add(e.id);let t=e.health;console.log("[Breach] Enemy ".concat(e.id," previous health: ").concat(t)),a(e.id,113),l&&l(e.id,113,e.position.clone(),!0),t>0&&t-113<=0&&(console.log("[Breach] Enemy ".concat(e.id," was killed! Calling Reignite")),c&&c.current?(console.log("[Breach] Triggering Reignite effect at position:",e.position),c.current.processKill(e.position.clone())):console.warn("[Breach] Cannot trigger Reignite: reigniteRef is ".concat(c?"defined but current is null":"undefined")))}}t.current.position.copy(f),p.current=f.clone(),1===g&&(s(),h.current=null,u.current=null,p.current=null,setTimeout(()=>{y([])},1500))}),(0,n.jsx)(n.Fragment,{children:g.map(e=>(0,n.jsx)(eN,{position:e.position},e.id))})}function eN(e){let{position:t}=e,r=(0,i.useRef)(null),s=(0,i.useRef)(.5+1*Math.random()),o=(0,i.useRef)(Date.now()),a=(0,i.useRef)(.2+.6*Math.random());return(0,f.F)(()=>{if(!r.current)return;let e=Math.min((Date.now()-o.current)/1e3/s.current,1);if(e<1){r.current.position.y+=.01;let t=a.current*(1-e);r.current.scale.set(t,t,t);let n=r.current.material;n&&(n.opacity=1-e)}}),(0,n.jsxs)("mesh",{ref:r,position:[t.x,t.y,t.z],children:[(0,n.jsx)("sphereGeometry",{args:[.5,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#ff4500",emissive:"#ff7700",emissiveIntensity:2,transparent:!0,opacity:.8,depthWrite:!1})]})}eO.displayName="Reignite";let eU=e=>{let{parentRef:t,charges:r,setCharges:n,reigniteRef:s}=e,[o,a]=(0,i.useState)(!1);console.log("[useBreachController] Initialized with reigniteRef:",s?"available":"undefined");let l=(0,i.useCallback)(()=>{let e=r.filter(e=>e.available);if(e.length<2)return!1;n(t=>t.map((t,r)=>r===e[0].id-1||r===e[1].id-1?{...t,available:!1,cooldownStartTime:Date.now()}:t));for(let t=0;t<2;t++)e[t].id&&setTimeout(()=>{n(r=>r.map((r,n)=>n===e[t].id-1?{...r,available:!0,cooldownStartTime:null}:r))},8250);return!0},[r,n]),c=(0,i.useCallback)(()=>!!(t.current&&l())&&(a(!0),!0),[t,l]);return{isActive:o,setIsActive:a,activateBreach:c,reigniteRef:s}},eQ=e=>{let{position:t,onComplete:r}=e,s=(0,i.useRef)(Date.now()),o=(0,i.useRef)(1),a=(0,i.useMemo)(()=>new m.Pq0(t.x,t.y+20,t.z),[t]),l=(0,i.useMemo)(()=>{let e=t.clone().sub(a).length(),r={points:Array(128).fill(0).map((e,r)=>{let n=r/127,i=Math.sin(n*Math.PI*8)*(1-n)*1.2,s=Math.sin(n*Math.PI*16)*(1-n)*.6,o=(Math.random()-.5)*.8*(1-n);return new m.Pq0(a.x+(t.x-a.x)*n+i+o,a.y+(t.y-a.y)*Math.pow(n,.7),a.z+(t.z-a.z)*n+s+o)}),thickness:.11,isCoreStrike:!0},n=Array(48).fill(0).map(()=>{let t=Math.floor(102.4*Math.random()),n=r.points[t],i=Math.floor(128*(.1+.2*Math.random())),s=Math.random()*Math.PI*2;return{points:Array(i).fill(0).map((t,r)=>{let o=r/(i-1),a=n.clone().add(new m.Pq0(Math.cos(s)*e*.2,-e*(.05+.05*Math.random())*o,Math.sin(s)*e*.2)),l=new m.Pq0((Math.random()-.5)*.3,(Math.random()-.5)*.2,(Math.random()-.5)*.3),c=n.clone().lerp(a,o);return c.add(l),c}),thickness:.03+.06*Math.random(),isCoreStrike:!1}}),i=n.flatMap(t=>{if(Math.random()>.5)return[];let r=Math.floor(Math.random()*t.points.length*.7),n=t.points[r],i=Math.floor(.4*t.points.length);return[{points:Array(i).fill(0).map((t,r)=>{let s=r/(i-1),o=new m.Pq0(Math.random()-.5,-.25*s,Math.random()-.5).normalize();return n.clone().add(o.multiplyScalar(.04*e*s))}),thickness:.02+.03*Math.random(),isCoreStrike:!1}]});return[r,...n,...i]},[t,a]),c=(0,i.useMemo)(()=>({bolt:new m.Gu$(1,8,8),impact:new m.Gu$(.8,16,16)}),[]),u=(0,i.useMemo)(()=>({coreBolt:new m._4j({color:new m.Q1f("#FFFFFF"),emissive:new m.Q1f("#80D9FF"),emissiveIntensity:15,transparent:!0}),secondaryBolt:new m._4j({color:new m.Q1f("#80D9FF"),emissive:new m.Q1f("#80D9FF"),emissiveIntensity:8,transparent:!0}),impact:new m._4j({color:new m.Q1f("#FFFFFF"),emissive:new m.Q1f("#B6EAFF"),emissiveIntensity:6,transparent:!0})}),[]);return(0,f.F)(()=>{let e=(Date.now()-s.current)/1e3;if(o.current=.3*Math.random()+.7,e>=.5){r();return}let t=1*(1-e/.5)*o.current;u.coreBolt.opacity=t,u.secondaryBolt.opacity=.8*t,u.impact.opacity=.9*t}),(0,n.jsxs)("group",{children:[l.map((e,t)=>(0,n.jsx)("group",{children:e.points.map((t,r)=>(0,n.jsx)("mesh",{position:t.toArray(),geometry:c.bolt,material:e.isCoreStrike?u.coreBolt:u.secondaryBolt,scale:[e.thickness,e.thickness,e.thickness]},r))},t)),(0,n.jsxs)("group",{position:t.toArray(),children:[(0,n.jsx)("mesh",{geometry:c.impact,material:u.impact,scale:[1,1,1]}),[1,1.4,1.8].map((e,t)=>(0,n.jsxs)("mesh",{rotation:[Math.random()*Math.PI,Math.random()*Math.PI,Math.random()*Math.PI],children:[(0,n.jsx)("ringGeometry",{args:[e,e+.2,32]}),(0,n.jsx)("meshBasicMaterial",{color:"#80D9FF",transparent:!0,opacity:(.8-.15*t)*(1-(Date.now()-s.current)/500),blending:m.EZo})]},t)),(0,n.jsx)("pointLight",{color:"#80D9FF",intensity:25*(1-(Date.now()-s.current)/500)*o.current,distance:8,decay:2})]})]})};class eY{acquire(){return this.pool.pop()||this.createFn()}release(e){this.resetFn(e),this.pool.push(e)}constructor(e,t,r){this.pool=[],this.createFn=t,this.resetFn=r;for(let r=0;r<e;r++)this.pool.push(t())}}function eZ(e){var t;let{onHit:r,controlsRef:a,currentWeapon:l,health:c,maxHealth:h,isPlayer:d=!1,abilities:p,onAbilityUse:x,onPositionUpdate:M,enemyData:w,onHealthChange:b,fireballManagerRef:k}=e,G=(0,i.useRef)(null),[A,z]=(0,i.useState)(!1),[O,W]=(0,i.useState)([]),H=(0,i.useRef)(0),{camera:N}=(0,f.D)(),[U,Y]=(0,i.useState)(!1),[Z,K]=(0,i.useState)([]),V=(0,i.useRef)(0),[X,et]=(0,i.useState)(()=>Array.from({length:u[l]},(e,t)=>({id:t+1,available:!0,cooldownStartTime:null}))),[en,es]=(0,i.useState)([]),ea=(0,i.useRef)(null),{isCharging:ec,chargeStartTime:eu,activeMissiles:ed,startCharging:em,releaseCharge:ep,handleMissileImpact:ef,checkMissileCollisions:ex}=function(e){let{parentRef:t,onHit:r,enemyData:n,setDamageNumbers:s,nextDamageNumberId:o,onImpact:a,charges:l,setCharges:c,reigniteRef:u,checkForSpearKillAndProcessReignite:h}=e;console.log("[usePyroclast] Initializing with reigniteRef:",u);let[d,p]=(0,i.useState)(!1),[f,x]=(0,i.useState)(0),g=(0,i.useRef)(null),[y,j]=(0,i.useState)([]),M=(0,i.useRef)(0),v=(0,i.useRef)(0),w=(0,i.useRef)(0),P=(0,i.useRef)({});(0,i.useEffect)(()=>{n&&n.forEach(e=>{P.current[e.id]=e.health})},[n]);let S=(0,i.useCallback)(()=>{let e=Date.now();e-w.current<150||(w.current=e,p(!0),g.current=e)},[]),I=(0,i.useCallback)(()=>{if(!t.current||!g.current)return;let e=Date.now();if(e-w.current<150)return;w.current=e;let r=(e-g.current)/1e3;if(r<.05){p(!1),x(0),g.current=null;return}let n=t.current.position.clone();n.y+=1;let i=new m.Pq0(0,0,1).applyQuaternion(t.current.quaternion).normalize();j(e=>[...e,{id:M.current++,position:n,direction:i,chargeTime:r,hitEnemies:new Set}]),p(!1),x(0),g.current=null},[t]),b=(0,i.useCallback)((e,t)=>{a&&a(e,t),j(t=>t.filter(t=>t.id!==e))},[a]),F=(0,i.useCallback)((e,t,i)=>{let a=!1,l=y.find(t=>t.id===e);if(!l)return console.log("[Pyroclast] Missile ".concat(e," not found for collision check")),!1;console.log("[Pyroclast] Checking collisions for missile ".concat(e," at position ").concat(t.x.toFixed(2),", ").concat(t.y.toFixed(2),", ").concat(t.z.toFixed(2))),l.hitEnemies||(l.hitEnemies=new Set);let c=!1;for(let e of n){if(e.health<=0||l.hitEnemies.has(e.id)){e.health<=0&&!l.hitEnemies.has(e.id)&&(console.log("[Pyroclast] Skipping dead enemy ".concat(e.id," with health ").concat(e.health)),l.hitEnemies.add(e.id));continue}let n=t.distanceTo(e.position);if(n<4){console.log("[Pyroclast] Hit detected! Enemy ".concat(e.id," at distance ").concat(n.toFixed(2),", health before: ").concat(e.health));let{damage:t,isCritical:i}=ez(l.chargeTime);console.log("[Pyroclast] Calculated damage for enemy ".concat(e.id,": ").concat(t," (critical: ").concat(i,"), charge time: ").concat(l.chargeTime.toFixed(2),"s"));let h=e.position.clone(),d=e.health;r(e.id,t),d>0&&e.health<=0&&(console.log("[Pyroclast] Enemy ".concat(e.id," was killed! Calling Reignite")),u&&u.current&&(console.log("[Pyroclast] Triggering Reignite effect at position:",h),u.current.processKill(h))),s(e=>[...e,{id:o.current++,damage:t,position:h,isCritical:i,isPyroclast:!0}]),c=!0,a=!0,console.log("[Pyroclast] Processed hit on enemy ".concat(e.id," for ").concat(t," damage"))}else if(i){let n=t.clone().sub(i).length();if(n<.1)continue;let h=Math.ceil(n/2);for(let n=0;n<=h;n++){let d=n/h,m=i.clone().lerp(t,d).distanceTo(e.position);if(m<4){console.log("[Pyroclast] Interpolated hit detected! Enemy ".concat(e.id," at distance ").concat(m.toFixed(2)));let{damage:t,isCritical:n}=ez(l.chargeTime),i=e.position.clone(),h=e.health;r(e.id,t),h>0&&e.health<=0&&(console.log("[Pyroclast] Enemy ".concat(e.id," was killed! Calling Reignite")),u&&u.current&&(console.log("[Pyroclast] Triggering Reignite effect at position:",i),u.current.processKill(i))),s(e=>[...e,{id:o.current++,damage:t,position:i,isCritical:n,isPyroclast:!0}]),c=!0,a=!0,console.log("[Pyroclast] Processed interpolated hit on enemy ".concat(e.id," for ").concat(t," damage"));break}}}}return c&&console.log("[Pyroclast] Missile ".concat(e," hit one or more enemies")),a},[u,y,n,s,o,r]),E=(0,i.useCallback)(()=>{let e=Date.now();if(e-v.current<500)return!1;let t=l.findIndex(e=>e.available);return -1===t?(I(),p(!1),x(0),g.current=null,!1):(v.current=e,c(r=>{let n=[...r];return n[t]={...n[t],available:!1,cooldownStartTime:e},n}),setTimeout(()=>{c(e=>{let r=[...e];return r[t]={...r[t],available:!0,cooldownStartTime:null},r})},8250),!0)},[l,c,I]);return(0,i.useEffect)(()=>{d&&!l.some(e=>e.available)&&(I(),p(!1),x(0),g.current=null)},[d,l,I]),(0,i.useEffect)(()=>{if(d){if(!l.some(e=>e.available)){I();return}E();let e=setInterval(E,500);return()=>clearInterval(e)}},[d,E,l,I]),{isCharging:d,chargeProgress:f,activeMissiles:y,startCharging:S,releaseCharge:I,handleMissileImpact:b,checkMissileCollisions:F,setChargeProgress:x,chargeStartTime:g,charges:l,setCharges:c}}({parentRef:G,onHit:r,enemyData:w,setDamageNumbers:K,nextDamageNumberId:V,onImpact:(e,t)=>{let r=ed.find(t=>t.id===e);r&&es(e=>[...e,{id:Date.now(),type:"pyroclastExplosion",position:t||r.position.clone(),direction:new m.Pq0,duration:.3,startTime:Date.now()}])},charges:X,setCharges:et,reigniteRef:ea,checkForSpearKillAndProcessReignite:(e,t,r,n)=>{if(ea.current){let i=w.find(t=>t.id===e);if(!i){t(e,r);return}let s=i.health;t(e,r);let o=w.find(t=>t.id===e);if(o&&s>0&&o.health<=0){let e=o.position.clone();console.log("[".concat(n?"Pyroclast":"SpearKill","] Kill detected! Processing Reignite at position:"),e),ea.current.processKill(e)}}else console.log("[".concat(n?"Pyroclast":"SpearKill","] reigniteRef is not available, just applying damage")),t(e,r)}}),{keys:eg}=function(e){var t,r;let{groupRef:n,controlsRef:o,camera:a,speed:l=3.625,onPositionUpdate:c,health:u,isCharging:h=!1,onMovementUpdate:d,currentWeapon:p,abilities:x}=e,g=(0,i.useRef)({w:!1,a:!1,s:!1,d:!1,shift:!1}),y=(0,i.useRef)(!1),j=(0,i.useRef)(new m.Pq0),M=p===s.BOW&&(null==x?void 0:null===(r=x[s.BOW])||void 0===r?void 0:null===(t=r.active)||void 0===t?void 0:t.isUnlocked)?.6:.1;return(0,i.useEffect)(()=>{u<=0?(y.current=!0,g.current={w:!1,a:!1,s:!1,d:!1,shift:!1}):y.current=!1},[u]),(0,i.useEffect)(()=>{let e=()=>{y.current=!0,g.current={w:!1,a:!1,s:!1,d:!1,shift:!1}},t=()=>{y.current=!1};return window.addEventListener("gameOver",e),window.addEventListener("gameReset",t),()=>{window.removeEventListener("gameOver",e),window.removeEventListener("gameReset",t)}},[]),(0,f.F)((e,t)=>{if(!n.current||y.current)return;let r=new m.Pq0;a.getWorldDirection(r),r.y=0,r.normalize();let i=new m.Pq0(-r.z,0,r.x),s=new m.Pq0(0,0,0);if(g.current.w&&s.add(r),g.current.s&&s.sub(r),g.current.a&&s.sub(i),g.current.d&&s.add(i),s.length()>0){s.normalize(),j.current.copy(s),d&&d(s);let e=l*t,i=s.dot(r);i<-.1?e*=.6:.1>=Math.abs(i)&&(e*=.8),h&&(e*=M);let o=q.isUnitStealthed();o&&(e*=1.7);let a=s.multiplyScalar(e),u=n.current.position.clone().add(a);if(29>u.length())n.current.position.copy(u);else{let e=n.current.position.clone(),t=e.clone().normalize(),r=new m.Pq0(-t.z,0,t.x),i=r.multiplyScalar(a.dot(r)),s=e.add(i);s.normalize().multiplyScalar(29),n.current.position.copy(s)}c(n.current.position,o)}if(o.current){if(!g.current.shift&&!o.current.mouseButtons.LEFT){let e=Math.atan2(r.x,r.z)-n.current.rotation.y;for(;e>Math.PI;)e-=2*Math.PI;for(;e<-Math.PI;)e+=2*Math.PI;n.current.rotation.y+=e*Math.min(1,15*t)}let e=n.current.position;o.current.target.set(e.x,e.y,e.z)}}),(0,i.useEffect)(()=>{let e=e=>{if(y.current)return;let t=e.key.toLowerCase();"shift"===t?g.current.shift=!0:t in g.current&&(g.current[t]=!0)},t=e=>{let t=e.key.toLowerCase();"shift"===t?g.current.shift=!1:t in g.current&&(g.current[t]=!1)};return window.addEventListener("keydown",e),window.addEventListener("keyup",t),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",t)}},[]),{keys:g}}({groupRef:G,controlsRef:a,camera:N,onPositionUpdate:M,health:c,isCharging:U||ec,onMovementUpdate:e=>{e7.copy(e)},currentWeapon:l,abilities:p}),[ej,eM]=(0,i.useState)(!1),[ew,eP]=(0,i.useState)([]),eF=(0,i.useRef)(0),[eT,e_]=(0,i.useState)({}),[eN,eZ]=(0,i.useState)(0),eK=(0,i.useRef)(null),eV=(0,i.useRef)(0),[e$,eX]=(0,i.useState)([]),eJ=(0,i.useRef)(new Set),[e0]=(0,i.useState)(15),[e1,e2]=(0,i.useState)(!1),[e5,e3]=(0,i.useState)(!1),e4=(0,i.useRef)(null),[e8,e6]=(0,i.useState)(0),[e7]=(0,i.useState)(()=>new m.Pq0),e9=(0,i.useRef)(null),te=(0,i.useRef)(0),tt=(0,i.useRef)(0),tr=(0,i.useRef)([]),tn=(0,i.useRef)([]),{activateStealth:ti,isStealthed:ts,setIsStealthed:to,setHasShadowStrikeBuff:ta}=function(){let{onStealthStart:e,onStealthEnd:t,duration:r=3500}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},[n,s]=(0,i.useState)(!1),[o,a]=(0,i.useState)(!1),l=(0,i.useRef)(null),c=(0,i.useCallback)(()=>{q.activateStealth(),s(!0),a(!0),null==e||e(),clearTimeout(l.current),l.current=setTimeout(()=>{q.breakStealth(),s(!1),a(!1),null==t||t()},r)},[r,e,t]);return(0,i.useEffect)(()=>()=>{l.current&&clearTimeout(l.current)},[]),{activateStealth:c,isStealthed:n,hasShadowStrikeBuff:o,setIsStealthed:s,setHasShadowStrikeBuff:a}}({onStealthStart:()=>{es(e=>{var t;return[...e,{id:Date.now(),type:"stealth",position:(null===(t=G.current)||void 0===t?void 0:t.position.clone())||new m.Pq0,direction:new m.Pq0,duration:5,startTime:Date.now()}]})},onStealthEnd:()=>{es(e=>e.filter(e=>"stealth"!==e.type))}}),{handleStealthKillHeal:tl}=eC({currentHealth:c,maxHealth:h,onHealthChange:e=>null==b?void 0:b(e),setDamageNumbers:K,nextDamageNumberId:V}),tc=(0,i.useCallback)(function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=t,o=!1,a=n,c=q.hasShadowStrikeBuff();if(c){let t=w.find(t=>t.id===e);if(t&&G.current){let e=G.current.position,r=t.position,n=new m.Pq0(0,0,1).applyEuler(new m.O9p(0,t.rotation,0)),s=new m.Pq0().subVectors(e,r).normalize().dot(n);o=!0,q.breakStealth(),requestAnimationFrame(()=>{to(!1),ta(!1)}),s>.5?(i+=221,a=!0,t.health<=i&&tl(t.position,!0)):(i+=110,t.health<=i&&tl(t.position,!1))}}let u=w.find(t=>t.id===e);if(u&&K(e=>[...e,{id:V.current++,damage:i,position:u.position.clone(),isCritical:a,isStealthStrike:o}]),c&&u&&G.current){let e=new m.Pq0().subVectors(u.position,G.current.position).normalize();es(t=>[...t,{id:Date.now(),type:"stealthStrike",position:u.position.clone(),direction:e,duration:.2,startTime:Date.now()}])}if(r){r(e,i);let t=u&&u.health-i;if(t&&t<=0&&l===s.SPEAR&&p[s.SPEAR].passive.isUnlocked&&ea.current){let e=u.position.clone();console.log("[Attack] Reignite processKill at position:",{x:e.x.toFixed(3),y:e.y.toFixed(3),z:e.z.toFixed(3)}),ea.current.processKill(e)}}},[r,to,ta,w,tl,l,p]),[tu,th]=(0,i.useState)(!1),td=(0,i.useRef)(null),{shootQuickShot:tm,projectilePool:tp,resetEagleEyeCounter:tf,eagleEyeManagerRef:tx}=eG({parentRef:G,onHit:r,enemyData:w,setDamageNumbers:K,nextDamageNumberId:V,charges:X,setCharges:et,isEagleEyeUnlocked:p[s.BOW].passive.isUnlocked}),{fireballPool:tg,projectilePool:ty}=(0,i.useMemo)(()=>({fireballPool:new eY(10,()=>({id:0,position:new m.Pq0,direction:new m.Pq0,startPosition:new m.Pq0,maxDistance:0}),e=>{e.position.set(0,0,0),e.direction.set(0,0,0),e.startPosition.set(0,0,0),e.maxDistance=0}),projectilePool:new eY(20,()=>({id:0,position:new m.Pq0,direction:new m.Pq0,power:0,startTime:0,maxDistance:0,startPosition:new m.Pq0,hasCollided:!1}),e=>{e.position.set(0,0,0),e.direction.set(0,0,0),e.power=0,e.startTime=0,e.maxDistance=0,e.startPosition.set(0,0,0),e.hasCollided=!1})}),[]),tj=(0,i.useMemo)(()=>new m.Pq0,[]),tM=(0,i.useMemo)(()=>new m.Pq0,[]),tv=(0,i.useCallback)(()=>{if(!G.current)return;let e=X.findIndex(e=>e.available);if(-1===e)return;tj.copy(G.current.position),tj.y+=1,tM.set(0,0,1),tM.applyQuaternion(G.current.quaternion),tM.normalize(),et(t=>t.map((t,r)=>r===e?{...t,available:!1,cooldownStartTime:Date.now()}:t));let t=tg.acquire();t.id=H.current++,t.position.copy(tj),t.startPosition.copy(tj),t.direction.copy(tM),t.maxDistance=45,tr.current.push(t),W(e=>[...e,t])},[G,X,tj,tM,tg]),[tw,tP]=(0,i.useState)(0),tS=(0,i.useCallback)(e=>{if(!G.current)return;let t=Date.now();if(t-tw<750)return;tP(t),tj.copy(G.current.position),tj.y+=1,tM.set(0,0,1),tM.applyQuaternion(G.current.quaternion);let r=ty.acquire();r.id=Date.now(),r.position.copy(tj),r.direction.copy(tM),r.power=e,r.startTime=Date.now(),r.maxDistance=40,r.startPosition.copy(tj),r.hasCollided=!1,r.isFullyCharged=e>=.95,tn.current.push(r),eX(e=>[...e,r]),Y(!1),eZ(0),eK.current=null,x(l,"e")},[G,tw,tj,tM,l,x,ty]),tI=(e,t)=>{let r=tr.current.find(t=>t.id===e);if(r){let e=r.position.clone();tg.release(r),t||es(t=>[...t,{id:Date.now(),type:"unitFireballExplosion",position:e,direction:new m.Pq0,duration:.225,startTime:Date.now()}])}tr.current=tr.current.filter(t=>t.id!==e),W(t=>t.filter(t=>t.id!==e))},tb=(0,i.useRef)({}),tF=l===s.SCYTHE?120:200,tE=e=>{if(!G.current||!A)return;let t=Date.now();if(t-(tb.current[e]||0)<tF)return;tb.current[e]=t;let n=w.find(t=>t.id===e);if(!n||n.health<=0||n.isDying)return;let i="number"==typeof eT[n.id]?eT[n.id]:0,a=n.id.startsWith("enemy");if(!a||i>=(a&&l===s.SABRES?2:1))return;e_(e=>({...e,[n.id]:(e[n.id]||0)+1,["".concat(n.id,"_time")]:t}));let c=G.current.position.distanceTo(n.position),u=o[l].range;if(c<=u){var h,d;if(l===s.SPEAR){let e=new m.Pq0().subVectors(n.position,G.current.position).normalize(),t=new m.Pq0(0,0,1).applyQuaternion(G.current.quaternion);if(Math.abs(e.angleTo(t))>(c<=.6*u?Math.PI/6:Math.PI/8.5))return}else if(l===s.SABRES){let e=new m.Pq0().subVectors(n.position,G.current.position).normalize(),t=new m.Pq0(0,0,.25).applyQuaternion(G.current.quaternion);if(Math.abs(e.angleTo(t))>Math.PI/4.5)return}let t=o[l].normal;if(ej&&l===s.SWORD){let e=eJ.current;if(e.has(n.id)||n.health<=0)return;e.add(n.id),K(e=>[...e,{id:V.current++,damage:f,position:n.position.clone(),isCritical:a}]),setTimeout(()=>{let t=w.find(e=>e.id===n.id);if(!t||t.health<=0){e.delete(n.id);return}let{damage:i,isCritical:s}=L(53);r(n.id,i),K(e=>[...e,{id:V.current++,damage:i,position:t.position.clone(),isCritical:s,isLightning:!0}]),e.delete(n.id)},300)}let a=!1,f=t;if(l===s.SPEAR){let e=o[s.SPEAR].range;if(c>=.8*e&&c<=e)a=!0,f=2*t;else{let e=L(t);f=e.damage,a=e.isCritical}}else if(l===s.SABRES)a=.25>Math.random(),e_(e=>({...e,["".concat(n.id,"_crit_").concat(i)]:a})),f=a?2*t:t;else{let e=L(t);f=e.damage,a=e.isCritical}let x=f;if(l===s.SABRES&&tD.current&&p[s.SABRES].active.isUnlocked){let t=tD.current.calculateBonusDamage();if(t>0){x+=t,K(e=>(console.log("Creating OrbShield damage number:",{damage:t,isOrbShield:!0}),[...e,{id:V.current++,damage:t,position:new m.Pq0(n.position.x+(0===i?-.4:.4),n.position.y+.8,n.position.z),isCritical:!1,isOrbShield:!0}]));let r=Date.now();if(r-te.current>=1e3){te.current=r;let e=G.current.position.clone(),t=new m.Pq0(0,0,1).applyQuaternion(G.current.quaternion).multiplyScalar(2);es(r=>[...r.filter(e=>"frostExplosion"!==e.type||e.startTime&&Date.now()-e.startTime<2e3),{id:Date.now(),type:"frostExplosion",position:e.add(t),direction:new m.Pq0,duration:.5,startTime:Date.now()}])}eT[e]||tD.current.consumeOrb()}}tc(n.id,x,a);let g=n.health-x;if(l!==s.SWORD||!p[s.SWORD].passive.isUnlocked||ej||e1||e5||!(g>0)||(null===(h=e4.current)||void 0===h||h.processHealingChance(),e3(!0)),g>0){if(l===s.SABRES){let e=0===i?-.4:.4,t=eT["".concat(n.id,"_crit_").concat(i)],r="boolean"==typeof t&&!0===t;console.log("Sabre hit ".concat(i," critical status:"),r,t),K(t=>[...t,{id:V.current++,damage:f,position:new m.Pq0(n.position.x+e,n.position.y,n.position.z),isCritical:r}])}else K(e=>[...e,{id:V.current++,damage:f,position:n.position.clone(),isCritical:a}])}if(l!==s.SWORD||!p[s.SWORD].active.isUnlocked||ej||e1||null===(d=e9.current)||void 0===d||d.processChainLightning(),l===s.SPEAR&&p[s.SPEAR].passive.isUnlocked&&ea.current&&g<=0){let e=n.position.clone();console.log("[Weapon] Reignite processKill at position:",{x:e.x.toFixed(3),y:e.y.toFixed(3),z:e.z.toFixed(3)}),ea.current.processKill(e)}}},tC=()=>{z(!1),e_({}),eM(!1),e3(!1)};(0,f.F)((e,t)=>{if(G.current){if(A&&G.current&&w.forEach(e=>{tE(e.id)}),U&&null!==eK.current){let e=Math.min((Date.now()-eK.current)/1e3/1.675,1);eZ(e),e6(e);let r=eV.current;eV.current+=(e-r)*t*5,e>=1&&tS(1)}if(tn.current=tn.current.filter(e=>{if(e.position.distanceTo(e.startPosition)<e.maxDistance&&!e.hasCollided){let t=e.power>=1?.5:.375;for(let r of(e.position.add(e.direction.clone().multiplyScalar(t)),e.hitEnemies||(e.hitEnemies=new Set),w)){if(r.health<=0||r.isDying)continue;let t=new m.Pq0(e.position.x,0,e.position.z),n=new m.Pq0(r.position.x,0,r.position.z);if(1.3>t.distanceTo(n)&&!e.hitEnemies.has(r.id)&&(e.hitEnemies.add(r.id),tQ(e.id,r.id,e.power,e.position),e.power<1))return e.hasCollided=!0,!1}return!0}return!1}),tn.current.length!==e$.length&&eX([...tn.current]),tr.current=tr.current.filter(e=>{if(e.position.distanceTo(e.startPosition)<e.maxDistance){for(let t of(e.position.add(e.direction.clone().multiplyScalar(.4)),w)){if(t.health<=0)continue;let r=t.position.clone();if(r.y=1.5,1.5>e.position.distanceTo(r))return tY(e.id,t.id),tI(e.id,e.position.clone()),!1}return!0}return tI(e.id),!1}),W([...tr.current]),et(e=>e.map(e=>!e.available&&e.cooldownStartTime&&Date.now()-e.cooldownStartTime>=8250?{...e,available:!0,cooldownStartTime:null}:e)),es(e=>e.filter(e=>"boneclaw"===e.type||"blizzard"===e.type||!e.duration||!e.startTime||(Date.now()-e.startTime)/1e3<e.duration)),tu&&td.current&&Date.now()-td.current>=15e3&&(th(!1),td.current=null,x(l,"e")),ec){let e=Date.now();if(eu.current){let t=(e-eu.current)/1e3,r=Math.min(t/4,1);tt.current=r*r*(3-2*r),t>=4&&(ep(),x(s.SPEAR,"r"))}}else tt.current>0&&(tt.current=0);ed.forEach(e=>{ex(e.id,e.position)})}});let{startFirebeam:tR,stopFirebeam:tk}=ee({parentRef:G,onHit:r,enemyData:w,setActiveEffects:es,charges:X,setCharges:et,setDamageNumbers:K,nextDamageNumberId:V}),tT=(0,i.useRef)(null),t_=(0,i.useCallback)(e=>{b&&b(e)},[b]),tD=(0,i.useRef)(null),{activateOathstrike:tG}=el({parentRef:G,onHit:r,charges:X,setCharges:et,enemyData:w,onHealthChange:t_,setDamageNumbers:K,nextDamageNumberId:V,currentHealth:c,maxHealth:h}),[tA,tB]=(0,i.useState)(!1),[tz,tq]=(0,i.useState)(!1),{activateBreach:tL}=eU({parentRef:G,charges:X,setCharges:et,reigniteRef:ea}),{activeStrikes:tO,createLightningStrike:tW,removeLightningStrike:tH}=function(){let[e,t]=(0,i.useState)([]),r=(0,i.useRef)(1);return{activeStrikes:e,createLightningStrike:(0,i.useCallback)(e=>{let n={id:r.current++,position:e.clone()};return t(e=>[...e,n]),n.id},[]),removeLightningStrike:(0,i.useCallback)(e=>{t(t=>t.filter(t=>t.id!==e))},[])}}();!function(e){let{keys:t,groupRef:r,currentWeapon:n,abilities:o,isSwinging:a,isSmiting:l,isBowCharging:c,bowChargeProgress:u,nextSmiteId:h,setIsSwinging:d,setIsSmiting:p,setIsBowCharging:f,setBowChargeStartTime:x,setSmiteEffects:g,setActiveEffects:y,onAbilityUse:j,shootFireball:M,releaseBowShot:v,startFirebeam:w,stopFirebeam:P,castReanimate:S,health:I,maxHealth:b,onHealthChange:F,activateOathstrike:E,setIsOathstriking:C,orbShieldRef:R,setIsWhirlwinding:k,whirlwindStartTime:T,isWhirlwinding:_,fireballCharges:D,activateStealth:G,shootQuickShot:A,setIsVaulting:B,isVaulting:z,isPyroclastActive:q,startPyroclastCharge:L,releasePyroclastCharge:O,isBreaching:W,setIsBreaching:H,activateBreach:N}=e,U=(0,i.useRef)(0),Q=(0,i.useRef)(!1),Y=(0,i.useRef)(0),Z=n===s.SCYTHE?125:250,K=(0,i.useCallback)(()=>{let e=Date.now();return!(e-Y.current<Z)&&(n!==s.SPEAR||!_)&&o[n].q.currentCooldown<=0&&!a&&(Y.current=e,U.current=e,d(!0),j(n,"q"),!0)},[o,n,a,j,d,Z,_]);(0,i.useEffect)(()=>{I<=0?Q.current=!0:Q.current=!1},[I]),(0,i.useEffect)(()=>{let e=e=>{if(Q.current)return;let i=e.key.toLowerCase();if(!(i in t.current)||!t.current[i]){if(i in t.current&&(t.current[i]=!0),"q"!==i||(n===s.BOW?A():t.current.mouse0||a||n===s.SPEAR&&_||K()),"e"===i){let e=o[n].e;if(e.currentCooldown<=0)switch(n){case s.SWORD:if(!l){if(Date.now()-U.current<450)return;p(!0),d(!0);let e=r.current.position.clone();e.add(new m.Pq0(0,0,3.5).applyQuaternion(r.current.quaternion)),g(t=>[...t,{id:h.current++,position:e}]),j(n,"e")}break;case s.BOW:c||(f(!0),x(Date.now()));break;case s.SABRES:e.currentCooldown<=0&&(G(),j(n,"e"));break;case s.SCYTHE:M(),j(n,"e");break;case s.SPEAR:!_&&D.some(e=>e.available)&&(k(!0),T.current=Date.now(),j(n,"e"))}}if("1"===i&&o[n].passive.isUnlocked&&(n===s.SCYTHE?S():n===s.SABRES&&w&&P&&(w(),j(n,"passive"))),"2"===i){let e=o[n].active;if(e.isUnlocked&&e.currentCooldown<=0){if(n===s.SCYTHE){let e=Date.now();y(t=>t.some(e=>"summon"===e.type)?t:[...t,{id:e,type:"summon",position:r.current.position.clone(),direction:new m.Pq0(0,0,1).applyQuaternion(r.current.quaternion),onComplete:()=>{},onStartCooldown:()=>{}}]),j(n,"active")}else n===s.BOW||n===s.SPEAR&&!W&&N()&&(H(!0),j(n,"active"))}}if("r"===i){let e=o[n].r;if(e.isUnlocked&&e.currentCooldown<=0)switch(n){case s.SWORD:let t=E();t&&(C(!0),y(e=>[...e,{id:Math.random(),type:"oathstrike",position:t.position,direction:t.direction}]),j(n,"r"));break;case s.SABRES:y(e=>[...e,{id:Math.random(),type:"blizzard",position:r.current.position.clone(),direction:new m.Pq0(0,0,0)}]),j(n,"r");break;case s.SCYTHE:y(e=>[...e,{id:Math.random(),type:"boneclaw",position:r.current.position.clone(),direction:new m.Pq0(0,0,1).applyQuaternion(r.current.quaternion)}]),j(n,"r");break;case s.BOW:z||(B(!0),j(n,"r"));break;case s.SPEAR:!q&&D.filter(e=>e.available).length>=2&&L()}}a||n!==s.BOW||"q"!==e.key.toLowerCase()||(A(),j(s.BOW,"q"))}},i=e=>{if(Q.current)return;let r=e.key.toLowerCase();r in t.current&&(t.current[r]=!1),"e"===r&&n===s.BOW&&c&&v(u),"e"===r&&n===s.SPEAR&&_&&(k(!1),T.current=null,j(n,"e")),"r"===r&&n===s.SPEAR&&q&&(O(),j(n,"r"))};return window.addEventListener("keydown",e),window.addEventListener("keyup",i),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",i)}},[z,t,K,r,n,o,a,l,c,u,d,p,f,g,y,j,M,v,h,x,w,P,S,I,b,F,C,E,R,k,T,_,D,G,A,B,q,L,O,W,H,N]),(0,i.useEffect)(()=>{let e=e=>{Q.current||0!==e.button||(t.current.mouse0=!0)},r=e=>{Q.current||0!==e.button||(t.current.mouse0=!1)};return window.addEventListener("mousedown",e),window.addEventListener("mouseup",r),()=>{window.removeEventListener("mousedown",e),window.removeEventListener("mouseup",r)}},[t]);let V=(0,i.useRef)(Z);(0,i.useEffect)(()=>{V.current=Z},[Z]),(0,i.useEffect)(()=>{let e=setInterval(()=>{Q.current||!t.current||a||n===s.SPEAR&&_||!t.current.mouse0||K()},50);return()=>clearInterval(e)},[K,t,a,n,_]),(0,i.useEffect)(()=>{let e=()=>{Q.current=!0},t=()=>{Q.current=!1};return window.addEventListener("gameOver",e),window.addEventListener("gameReset",t),()=>{window.removeEventListener("gameOver",e),window.removeEventListener("gameReset",t)}},[]),(0,i.useEffect)(()=>{_&&n===s.SPEAR&&!D.some(e=>e.available)&&(k(!1),T.current=null,j(n,"e"))},[D,_,n,k,T,j])}({keys:eg,groupRef:G,currentWeapon:l,abilities:p,isSwinging:A,isSmiting:ej,isBowCharging:U,bowChargeProgress:eN,nextSmiteId:eF,setIsSwinging:z,setIsSmiting:eM,setIsBowCharging:Y,setBowChargeStartTime:e=>{eK.current=e},setSmiteEffects:eP,setActiveEffects:es,onAbilityUse:x,shootFireball:tv,releaseBowShot:tS,startFirebeam:tR,stopFirebeam:tk,castReanimate:()=>{var e;null===(e=tT.current)||void 0===e||e.castReanimate()},reanimateRef:tT,health:c,maxHealth:h,onHealthChange:b,activateOathstrike:tG,setIsOathstriking:e2,orbShieldRef:tD,isWhirlwinding:tu,setIsWhirlwinding:th,whirlwindStartTime:td,fireballCharges:X,activateStealth:ti,shootQuickShot:tm,setIsVaulting:tB,isVaulting:tA,startPyroclastCharge:em,releasePyroclastCharge:ep,isPyroclastActive:ec,isBreaching:tz,setIsBreaching:tq,activateBreach:tL});let tN=e=>{eP(t=>t.filter(t=>t.id!==e))},tU=e=>{K(t=>t.filter(t=>t.id!==e))};(0,i.useEffect)(()=>{l===s.SABRES&&e_({})},[l]);let tQ=(e,t,n,i)=>{let o;let a=tn.current.find(t=>t.id===e);if(!a)return;a.power>=.99?(o=137,p[s.BOW].active.isUnlocked&&(o+=Math.floor(121*Math.random())+120)):(o=47+Math.floor(108*a.power),p[s.BOW].active.isUnlocked&&(o+=67,tW(i)));let{damage:l,isCritical:c}=L(o);K(e=>[...e,{id:V.current++,damage:l,position:i.clone().add(new m.Pq0(0,0,0)),isCritical:c,isLightning:!1,isBowLightning:!a.isFullyCharged&&p[s.BOW].active.isUnlocked,isHealing:!1,isBlizzard:!1,isBoneclaw:!1,isOathstrike:!1,isFirebeam:!1,isOrbShield:!1,isChainLightning:!1,isFireball:!1,isSummon:!1,isStealthStrike:!1,isPyroclast:!1,isEagleEye:!1,isBreach:!1}]),r(t,l),a.isFullyCharged||(a.hasCollided=!0)},tY=(e,t)=>{if(!t.startsWith("enemy"))return;let n=w.find(e=>e.id===t);if(!n)return;let{damage:i,isCritical:o}=L(59);r(t,i);let a=n.health-i;if(a>0&&K(e=>[...e,{id:V.current++,damage:i,position:n.position.clone(),isCritical:o,isFireball:!0}]),tI(e),a<=0&&l===s.SPEAR&&p[s.SPEAR].passive.isUnlocked&&ea.current){let e=n.position.clone();console.log("[Fireball] Reignite processKill at position:",{x:e.x.toFixed(3),y:e.y.toFixed(3),z:e.z.toFixed(3)}),ea.current.processKill(e)}};(0,f.F)(()=>{G.current&&M(G.current.position.clone(),ts)}),(0,i.useEffect)(()=>{let e=eJ.current;return()=>{e.clear()}},[]),(0,f.F)(()=>{eX(e=>e.filter(e=>e.position.distanceTo(e.startPosition)<e.maxDistance))}),(0,i.useEffect)(()=>{let e=setInterval(()=>{es(e=>e.filter(e=>"unitFireballExplosion"!==e.type||!!e.startTime&&Date.now()-e.startTime<1e3*e.duration))},100);return()=>{clearInterval(e),es(e=>e.filter(e=>"unitFireballExplosion"!==e.type))}},[]),(0,i.useEffect)(()=>()=>{es(e=>e.filter(e=>"fireballExplosion"!==e.type))},[]),(0,i.useEffect)(()=>{k&&(k.current={shootFireball:tv,cleanup:()=>{W([]),es([]),eJ.current.clear(),et(e=>e.map(e=>({...e,available:!0,cooldownStartTime:null})))}})},[k,tv]),(0,i.useEffect)(()=>()=>{W([]),et(e=>e.map(e=>({...e,available:!0,cooldownStartTime:null})))},[]),(0,i.useEffect)(()=>()=>{es(e=>e.filter(e=>"boneclaw"===e.type||"blizzard"===e.type))},[]),(0,i.useEffect)(()=>{let e=setInterval(()=>{es(e=>e.filter(e=>"fireballExplosion"!==e.type||(e.startTime?(Date.now()-e.startTime)/1e3:0)<(e.duration||.225)))},100);return()=>clearInterval(e)},[es]),(0,i.useEffect)(()=>{let e=setInterval(()=>{es(e=>e.filter(e=>"frostExplosion"!==e.type||(e.startTime?(Date.now()-e.startTime)/1e3:0)<(e.duration||.25)))},100);return()=>clearInterval(e)},[es]),(0,i.useEffect)(()=>()=>{tr.current=[],W([])},[]),(0,i.useEffect)(()=>()=>{tn.current=[],eX([])},[]),(0,i.useEffect)(()=>()=>{th(!1),td.current=null},[]),(0,i.useEffect)(()=>()=>{tn.current.forEach(e=>ty.release(e)),tr.current.forEach(e=>tg.release(e)),tn.current=[],tr.current=[],eX([]),W([])},[ty,tg]),(0,i.useEffect)(()=>{tf&&tf()},[l,tf]);let tZ=(0,i.useCallback)(function(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!n&&(l!==s.SPEAR||!p[s.SPEAR].passive.isUnlocked)){var i,o;console.log("[SpearKill] Not processing Reignite - weapon: ".concat(l,", passive unlocked: ").concat(null===(o=p[s.SPEAR])||void 0===o?void 0:null===(i=o.passive)||void 0===i?void 0:i.isUnlocked,", reigniteRef: ").concat(ea.current?"available":"null")),t(e,r);return}let a=w.find(t=>t.id===e);if(!a){console.log("[SpearKill] Target ".concat(e," not found")),t(e,r);return}let c=a.health;console.log("[SpearKill] Target ".concat(e," health before damage: ").concat(c,", damage: ").concat(r)),t(e,r);let u=w.find(t=>t.id===e);if(!u){console.log("[SpearKill] Target ".concat(e," was removed after damage"));return}if(console.log("[SpearKill] Target ".concat(e," health after damage: ").concat(u.health)),c>0&&u.health<=0){if(console.log("[SpearKill] Kill detected with Spear ability, processing Reignite..."),ea.current){let e=u.position.clone();console.log("[SpearKill] Reignite processKill at position:",{x:e.x.toFixed(3),y:e.y.toFixed(3),z:e.z.toFixed(3)}),ea.current.processKill(e)}else console.log("[SpearKill] ISSUE: reigniteRef.current is null at kill time")}else console.log("[SpearKill] No kill detected - health before: ".concat(c,", after: ").concat(u.health))},[l,p,w,ea]);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("group",{ref:G,position:[0,1,0],children:[(0,n.jsx)("group",{scale:[.335,.335,.335],position:[-.05,.215,.35],rotation:[.15,0,-5],children:(0,n.jsx)(eb,{isLeft:!0})}),(0,n.jsx)("group",{scale:[.335,.335,.335],position:[.05,.215,.35],rotation:[.15,0,5],children:(0,n.jsx)(eb,{isLeft:!1})}),(0,n.jsxs)("mesh",{scale:1.085,children:[(0,n.jsx)("sphereGeometry",{args:[.415,32,32]}),(0,n.jsx)("meshBasicMaterial",{color:"#a8e6cf",transparent:!0,opacity:ts?.15:.125,depthWrite:!1,blending:m.EZo})]}),ts&&(0,n.jsxs)("mesh",{scale:1.1,children:[(0,n.jsx)("sphereGeometry",{args:[.42,32,32]}),(0,n.jsx)("meshBasicMaterial",{color:"#a8e6cf",transparent:!0,opacity:.08,depthWrite:!1,blending:m.EZo})]}),ts&&(0,n.jsx)(eR,{parentRef:G}),(0,n.jsxs)("group",{position:[0,.2,-.2],children:[(0,n.jsx)("group",{rotation:[0,Math.PI/5.5,0],children:(0,n.jsx)(R,{collectedBones:e0,isLeftWing:!0,parentRef:G})}),(0,n.jsx)("group",{rotation:[0,-Math.PI/5.5,0],children:(0,n.jsx)(R,{collectedBones:e0,isLeftWing:!1,parentRef:G})})]}),(0,n.jsx)(J,{parentRef:G,charges:X,weaponType:l}),(0,n.jsx)("group",{scale:[.8,.55,.8],position:[0,.04,-.015],rotation:[.4,0,0],children:(0,n.jsx)(_,{})}),(0,n.jsx)("group",{scale:[.85,.85,.85],position:[0,.05,.1],children:(0,n.jsx)(D,{movementDirection:e7})}),l===s.SABRES?(0,n.jsx)(v,{isSwinging:A,onSwingComplete:tC,onLeftSwingStart:()=>{},onRightSwingStart:()=>{},isBowCharging:U,hasActiveAbility:p[s.SABRES].active.isUnlocked}):l===s.SCYTHE?(0,n.jsx)(y,{parentRef:G,isSwinging:A,onSwingComplete:tC}):l===s.SPEAR?(0,n.jsx)(S,{isSwinging:A,onSwingComplete:tC,enemyData:w,onHit:r,setDamageNumbers:K,nextDamageNumberId:V,isWhirlwinding:tu,fireballCharges:X}):l===s.BOW?(0,n.jsx)("group",{position:[0,.1,.3],children:(0,n.jsx)(P,{position:new m.Pq0,direction:new m.Pq0(0,0,1).applyQuaternion((null===(t=G.current)||void 0===t?void 0:t.quaternion)||new m.PTz),chargeProgress:eN,isCharging:U,onRelease:tS})}):(0,n.jsx)(j,{isSwinging:A,isSmiting:ej,isOathstriking:e1,onSwingComplete:tC,onSmiteComplete:()=>{eM(!1),z(!1),e_({})},onOathstrikeComplete:()=>{e2(!1),z(!1),e_({})},hasChainLightning:p[s.SWORD].active.isUnlocked}),!d&&(0,n.jsxs)(E,{position:[0,2,0],lockX:!1,lockY:!1,lockZ:!1,children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("planeGeometry",{args:[1,.1]}),(0,n.jsx)("meshBasicMaterial",{color:"#333333"})]}),(0,n.jsx)("mesh",{position:[.5+c/h*.5,0,.001],children:(0,n.jsx)("planeGeometry",{args:[c/h,.08]})})]})]}),(0,n.jsx)(C,{parentRef:G,weaponType:l}),O.map(e=>(0,n.jsx)(g,{position:e.position,direction:e.direction,onImpact:t=>tI(e.id,t)},e.id)),ew.map(e=>(0,n.jsx)(I,{weaponType:l,position:e.position,onComplete:()=>tN(e.id)},e.id)),Z.map(e=>(0,n.jsx)(F,{damage:e.damage,position:e.position,isCritical:e.isCritical,isLightning:e.isLightning,isHealing:e.isHealing,isBlizzard:e.isBlizzard,isBoneclaw:e.isBoneclaw,isOathstrike:e.isOathstrike,isFirebeam:e.isFirebeam,isOrbShield:e.isOrbShield,isChainLightning:e.isChainLightning,isFireball:e.isFireball,isSummon:e.isSummon,isStealthStrike:e.isStealthStrike,isPyroclast:e.isPyroclast,isEagleEye:e.isEagleEye,isBreach:e.isBreach,onComplete:()=>tU(e.id)},e.id)),e$.map(e=>(0,n.jsxs)("group",{children:[(0,n.jsxs)("group",{position:e.position.toArray(),rotation:[0,Math.atan2(e.direction.x,e.direction.z),0],children:[(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.03,.125,2.1,6]})," ",(0,n.jsx)("meshStandardMaterial",{color:"#00ffff",emissive:"#00ffff",emissiveIntensity:1,transparent:!0,opacity:1})]}),[void 0,void 0,void 0].map((e,t)=>(0,n.jsxs)("mesh",{position:[0,0,-(.45*t)+.5],rotation:[Math.PI,0,.003*Date.now()+t*Math.PI/3],children:[(0,n.jsx)("torusGeometry",{args:[.125+.04*t,.05,6,12]})," ",(0,n.jsx)("meshStandardMaterial",{color:"#00ffff",emissive:"#00ffff",emissiveIntensity:3,transparent:!0,opacity:.9-.125*t,blending:m.EZo})]},"ring-".concat(t))),(0,n.jsx)("pointLight",{color:"#00ffff",intensity:3,distance:5,decay:2})]}),e.power>=1&&e.position.distanceTo(e.startPosition)<e.maxDistance&&!e.hasCollided&&(0,n.jsxs)("group",{position:e.position.toArray(),rotation:[0,Math.atan2(e.direction.x,e.direction.z),0],children:[(0,n.jsxs)("mesh",{rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.15,.35,2,4]})," ",(0,n.jsx)("meshStandardMaterial",{color:p[s.BOW].active.isUnlocked?"#ff6a00":"#EAC4D5",emissive:p[s.BOW].active.isUnlocked?"#ff3300":"#EAC4D5",emissiveIntensity:p[s.BOW].active.isUnlocked?2.5:1.5,transparent:!0,opacity:.7})]}),[...Array(p[s.BOW].active.isUnlocked?6:4)].map((e,t)=>{let r=t/(p[s.BOW].active.isUnlocked?6:4)*Math.PI*2;return(0,n.jsx)("group",{position:[.4*Math.sin(r+.003*Date.now()),.4*Math.cos(r+.003*Date.now()),-1.4],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.125,3,3]})," ",(0,n.jsx)("meshStandardMaterial",{color:p[s.BOW].active.isUnlocked?"#ff5500":"#00ffff",emissive:p[s.BOW].active.isUnlocked?"#ff3300":"#00ffff",emissiveIntensity:p[s.BOW].active.isUnlocked?1.5:1,transparent:!0,opacity:.5,blending:m.EZo})]})},"ghost-trail-".concat(t))}),p[s.BOW].active.isUnlocked&&[...Array(8)].map((e,t)=>{let r=Math.random()*Math.PI*2,i=.25+.3*Math.random(),s=-(2.5*Math.random());return(0,n.jsx)("group",{position:[Math.sin(r)*i,Math.cos(r)*i,s],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.07+.1*Math.random(),3,3]}),(0,n.jsx)("meshStandardMaterial",{color:t%2==0?"#ffcc00":"#ff4400",emissive:t%2==0?"#ffcc00":"#ff4400",emissiveIntensity:2,transparent:!0,opacity:.7,blending:m.EZo})]})},"fire-particle-".concat(t))}),[...Array(6)].map((e,t)=>(0,n.jsx)("group",{position:[0,0,-(.3*t)-1.5],rotation:[0,.001*Date.now()+t,0],children:(0,n.jsxs)("mesh",{scale:1-.015*t,children:[(0,n.jsx)("torusGeometry",{args:[.4,.1,3,6]})," ",(0,n.jsx)("meshStandardMaterial",{color:p[s.BOW].active.isUnlocked?"#ff7700":"#00ffff",emissive:p[s.BOW].active.isUnlocked?"#ff5500":"#00ffff",emissiveIntensity:p[s.BOW].active.isUnlocked?1.5:1,transparent:!0,opacity:.3,blending:m.EZo})]})},"wisp-".concat(t))),(0,n.jsx)("pointLight",{color:p[s.BOW].active.isUnlocked?"#ff5500":"#EAC4D5",intensity:p[s.BOW].active.isUnlocked?5:3,distance:p[s.BOW].active.isUnlocked?7:5,decay:2})]})]},e.id)),(0,n.jsx)(B,{parentRef:G,weaponType:l}),(0,n.jsx)(T,{parentRef:G}),en.map(e=>{if("boneclaw"===e.type)return(0,n.jsx)(Q,{position:e.position,direction:e.direction,parentRef:G,enemyData:w,onComplete:()=>{es(t=>t.filter(t=>t.id!==e.id))},onHitTarget:(e,t,n,i,s)=>{r(e,t),K(e=>[...e,{id:V.current++,damage:t,position:i.clone(),isCritical:n,isBoneclaw:s}])}},e.id);if("blizzard"===e.type)return(0,n.jsx)($,{position:e.position,enemyData:w,parentRef:G,onHitTarget:(e,t,n,i,s)=>{r(e,t),K(e=>[...e,{id:V.current++,damage:t,position:i.clone(),isCritical:n,isBlizzard:s}])},onComplete:()=>{es(t=>t.filter(t=>t.id!==e.id))}},e.id);if("firebeam"===e.type)return(0,n.jsx)(er,{position:e.position,direction:e.direction,onComplete:()=>{es(t=>t.filter(t=>t.id!==e.id))}},e.id);if("oathstrike"===e.type)return(0,n.jsx)(eo,{position:e.position,direction:e.direction,onComplete:()=>{es(t=>t.filter(t=>t.id!==e.id))},parentRef:G},e.id);if("summon"===e.type)return(0,n.jsx)(ey,{position:e.position,enemyData:w,onDamage:(e,t,n)=>{r(e,t);let i=w.find(t=>t.id===e);i&&i.position&&K(e=>[...e,{id:V.current++,damage:t,position:n||i.position.clone(),isCritical:!1,isSummon:!0}])},id:e.id.toString(),onComplete:()=>{es(t=>t.filter(t=>t.id!==e.id))},onStartCooldown:()=>{x(l,"active")},setActiveEffects:es,activeEffects:en,setDamageNumbers:K,nextDamageNumberId:V},e.id);if("frostExplosion"===e.type)return(0,n.jsx)(eI,{position:e.position,onComplete:()=>{es(t=>t.filter(t=>t.id!==e.id))}},e.id);if("stealthStrike"===e.type)return(0,n.jsx)(ek,{position:e.position,direction:e.direction,onComplete:()=>{es(t=>t.filter(t=>t.id!==e.id))},parentRef:G},e.id);else if("pyroclastExplosion"===e.type)return(0,n.jsx)(eq,{position:e.position,chargeTime:1,explosionStartTime:e.startTime||null,onComplete:()=>{es(t=>t.filter(t=>t.id!==e.id))}},e.id);return null}),(0,n.jsx)(ei,{ref:tT,parentRef:G,onHealthChange:t_,charges:X,setCharges:et,setDamageNumbers:K,nextDamageNumberId:V,currentHealth:c,maxHealth:h}),l===s.SWORD&&p[s.SWORD].passive.isUnlocked&&(0,n.jsx)(eh,{ref:e4,parentRef:G,onHealthChange:t_,setDamageNumbers:K,nextDamageNumberId:V,currentHealth:c,maxHealth:h}),en.map(e=>{if("unitFireballExplosion"===e.type){let t=e.startTime?(Date.now()-e.startTime)/1e3:0,r=Math.max(0,1-t/(e.duration||.225));return(0,n.jsxs)("group",{position:e.position,children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.3*(1+2*t),32,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#00ff44",emissive:"#33ff66",emissiveIntensity:2*r,transparent:!0,opacity:.8*r,depthWrite:!1,blending:m.EZo})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.2*(1+3*t),24,24]}),(0,n.jsx)("meshStandardMaterial",{color:"#66ff88",emissive:"#ffffff",emissiveIntensity:3*r,transparent:!0,opacity:.9*r,depthWrite:!1,blending:m.EZo})]}),[.4,.6,.8].map((e,i)=>(0,n.jsxs)("mesh",{rotation:[Math.random()*Math.PI,Math.random()*Math.PI,Math.random()*Math.PI],children:[(0,n.jsx)("torusGeometry",{args:[e*(1+3*t),.045,16,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#00ff44",emissive:"#33ff66",emissiveIntensity:.8*r,transparent:!0,opacity:.5*r*(1-.2*i),depthWrite:!1,blending:m.EZo})]},i)),[...Array(8)].map((e,i)=>{let s=i/8*Math.PI*2,o=.5*(1+2*t);return(0,n.jsxs)("mesh",{position:[Math.sin(s)*o,Math.cos(s)*o,0],children:[(0,n.jsx)("sphereGeometry",{args:[.05,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#66ff88",emissive:"#ffffff",emissiveIntensity:1.85*r,transparent:!0,opacity:.85*r,depthWrite:!1,blending:m.EZo})]},"spark-".concat(i))}),(0,n.jsx)("pointLight",{color:"#00ff44",intensity:2*r,distance:4,decay:2}),(0,n.jsx)("pointLight",{color:"#66ff88",intensity:1*r,distance:6,decay:1})]},e.id)}return null}),U&&(0,n.jsxs)("group",{position:G.current?(()=>{let e=new m.Pq0(0,0,1).applyQuaternion(G.current.quaternion).multiplyScalar(2);return[G.current.position.x+e.x,.01,G.current.position.z+e.z]})():[0,.015,0],ref:e=>{e&&(null==G?void 0:G.current)&&(e.rotation.y=G.current.rotation.y)},children:[(0,n.jsxs)("mesh",{rotation:[-Math.PI/2,0,0],position:[0,.15,15*e8-4.5],children:[(0,n.jsx)("planeGeometry",{args:[.4,30*e8-4]}),(0,n.jsx)("meshStandardMaterial",{color:"#C18C4B",emissive:"#C18C4B",emissiveIntensity:1,transparent:!0,opacity:.3+.4*e8,blending:m.EZo,depthWrite:!1})]}),[-.4,.4].map((e,t)=>(0,n.jsxs)("mesh",{position:[e,.1,7.5*e8+3.5],rotation:[-Math.PI/2,0,0],children:[(0,n.jsx)("planeGeometry",{args:[.125,15*e8+10]}),(0,n.jsx)("meshStandardMaterial",{color:"#C18C4B",emissive:"#C18C4B",emissiveIntensity:2,transparent:!0,opacity:.6*e8,blending:m.EZo,depthWrite:!1})]},t)),[...Array(10)].map((e,t)=>(0,n.jsxs)("mesh",{position:[0,.1,2.5*t*e8+(3*e8-2)],rotation:[-Math.PI/2,0,0],children:[(0,n.jsx)("planeGeometry",{args:[1,.1]}),(0,n.jsx)("meshStandardMaterial",{color:"#C18C4B",emissive:"#C18C4B",emissiveIntensity:1.5,transparent:!0,opacity:.4*e8*(1-.07*t),blending:m.EZo,depthWrite:!1})]},t))]}),l===s.SWORD&&p[s.SWORD].active.isUnlocked&&(0,n.jsx)(ev,{ref:e9,parentRef:G,enemies:w,onEnemyDamage:r,setDamageNumbers:K,nextDamageNumberId:V}),l===s.SABRES&&p[s.SABRES].active.isUnlocked&&(0,n.jsx)(eS,{ref:tD,parentRef:G,charges:X,setCharges:et}),l===s.SPEAR&&(0,n.jsx)(eE,{parentRef:G,isActive:tu,onHit:(e,t)=>{tZ(e,r,t)},enemyData:w,setDamageNumbers:K,nextDamageNumberId:V,charges:X,setCharges:et,reigniteRef:ea,onWhirlwindEnd:()=>{th(!1),td.current=null,x(s.SPEAR,"e")}}),tp.current.map(e=>(0,n.jsx)(eA,{position:e.position,direction:e.direction,opacity:e.opacity},e.id)),l===s.BOW&&(0,n.jsx)(eB,{parentRef:G,isActive:tA,onComplete:()=>{tB(!1),x(s.BOW,"r")}}),l===s.SPEAR&&ec&&(0,n.jsx)(eW,{parentRef:G,isActive:ec,chargeProgress:tt.current}),ed.map(e=>(0,n.jsx)(eL,{id:e.id,position:e.position,direction:e.direction,chargeTime:e.chargeTime,onImpact:t=>ef(e.id,t),checkCollisions:(e,t)=>ex(e,t)},e.id)),(0,n.jsx)(eO,{ref:ea,parentRef:G,charges:X,setCharges:et,isActive:p[s.SPEAR].passive.isUnlocked}),l===s.SPEAR&&p[s.SPEAR].active.isUnlocked&&(0,n.jsx)(eH,{parentRef:G,isActive:tz,onComplete:()=>{tq(!1),x(s.SPEAR,"active")},enemyData:w,onHit:r,showDamageNumber:(e,t,r)=>{K(e=>[...e,{id:V.current++,damage:t,position:r.clone().add(new m.Pq0(0,1.5,0)),isCritical:!1,isBreach:!0}])},reigniteRef:ea}),tO.map(e=>(0,n.jsx)(eQ,{position:e.position,onComplete:()=>tH(e.id)},e.id)),l===s.BOW&&p[s.BOW].passive.isUnlocked&&(0,n.jsx)(eD,{ref:tx,isUnlocked:p[s.BOW].passive.isUnlocked})]})}var eK=r(2433);let eV=new m._4j({color:"#e8e8e8",roughness:.4,metalness:.3}),e$=new m._4j({color:"#d4d4d4",roughness:.3,metalness:.4}),eX=new m.Gu$(.06,6,6),eJ=new m.Ho_(.04,.032,1,5),e0=new m.qFE(.02,.15,5),e1=new m.kn4,e2=new m.Pq0,e5=new m.O9p,e3=new m.Pq0,e4=new m.PTz;function e8(e,t,r,n,i){e4.setFromEuler(n),e1.compose(r,e4,i),e.setMatrixAt(t,e1)}function e6(e){let{isUpper:t=!0}=e,r=(0,i.useMemo)(()=>{let e=t?5:4,r=new m.ZLX(e0,eV,e);return r.instanceMatrix.setUsage(m.Vnu),r},[t]);return(0,i.useEffect)(()=>{(t?[-.03,-.06,-.09,0,.03]:[-.06,-.02,.02,.06]).forEach((e,n)=>{e2.set(e,t?-.25:-.18,.2),e5.set(t?.5:2.5,0,0),e3.set(1,1,1),e8(r,n,e2,e5,e3)}),r.instanceMatrix.needsUpdate=!0},[r,t]),(0,n.jsx)("primitive",{object:r})}function e7(){let e=(0,i.useMemo)(()=>{let e=new m.ZLX(new m.iNn(.12,.19,.02),e$,4);return e.instanceMatrix.setUsage(m.Vnu),e},[]);return(0,i.useEffect)(()=>{for(let t=0;t<4;t++){let r=t*Math.PI/2;e2.set(.11*Math.cos(r),0,.11*Math.sin(r)),e5.set(0,r+Math.PI/6,0),e3.set(1,1,1),e8(e,t,e2,e5,e3)}e.instanceMatrix.needsUpdate=!0},[e]),(0,n.jsx)("primitive",{object:e})}function e9(){return(0,n.jsx)("group",{children:(0,n.jsxs)("group",{children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.123,.19,.175,6,1,!1,0,2*Math.PI]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsx)(e7,{}),(0,n.jsxs)("mesh",{position:[0,.22,0],rotation:[Math.PI/2,Math.PI,Math.PI/2],children:[(0,n.jsx)("torusGeometry",{args:[.065,.02,3,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#d4d4d4",roughness:.3,metalness:.5})]}),(0,n.jsxs)("mesh",{position:[0,0,0],rotation:[Math.PI/2,Math.PI,Math.PI/2],children:[(0,n.jsx)("torusGeometry",{args:[.16,.02,4,5]}),(0,n.jsx)("meshStandardMaterial",{color:"#d4d4d4",roughness:.3,metalness:.5})]}),(0,n.jsxs)("mesh",{position:[0,-.1,0],rotation:[Math.PI/2,Math.PI,Math.PI/2],children:[(0,n.jsx)("torusGeometry",{args:[.2,.02,4,5]}),(0,n.jsx)("meshStandardMaterial",{color:"#d4d4d4",roughness:.3,metalness:.5})]}),(0,n.jsxs)("mesh",{position:[0,.1,0],rotation:[Math.PI/2,Math.PI,Math.PI/2],children:[(0,n.jsx)("torusGeometry",{args:[.125,.0175,6,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#d4d4d4",roughness:.3,metalness:.5})]})]})})}function te(){let e=(e,t)=>(0,n.jsx)("mesh",{geometry:eJ,material:eV,scale:[t/.04,e,t/.04]}),t=e=>(0,n.jsx)("mesh",{geometry:eX,material:eV,scale:[e/.06,e/.06,e/.06]}),r=(r,i)=>(0,n.jsxs)("group",{children:[(0,n.jsx)("group",{position:[i/2,0,0],children:e(r,.04)}),(0,n.jsx)("group",{position:[-i/2,0,0],children:e(r,.04)}),(0,n.jsx)("group",{position:[0,r/2,0],children:t(.06)}),(0,n.jsx)("group",{position:[0,-r/2,0],children:t(.06)})]});return(0,n.jsx)("group",{children:(0,n.jsxs)("group",{children:[r(.65,.05),(0,n.jsxs)("group",{position:[0,-.35,0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.08,12,12]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("group",{position:[0,-.15,0],children:[r(.7,.06),(0,n.jsxs)("group",{position:[0,-.25,0],rotation:[Math.PI/2,0,0],children:[t(.06),(0,n.jsxs)("group",{position:[0,-.015,.1],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("boxGeometry",{args:[.15,.02,.4]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),[-.05,0,.05].map((e,t)=>(0,n.jsx)("group",{position:[e,.15,.25],rotation:[-Math.PI,0,0],children:(0,n.jsxs)("group",{children:[r(.15,.02),(0,n.jsx)("group",{position:[0,-.1,0],rotation:[Math.PI/6,0,0],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("coneGeometry",{args:[.02,.15,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#d4d4d4",roughness:.3,metalness:.4})]})})]})},t))]})]})]})]})]})})}function tt(e){let{isLeftHand:t=!1}=e,r=(e,t)=>(0,n.jsx)("mesh",{geometry:eJ,material:eV,scale:[t/.04,e,t/.04]}),i=e=>(0,n.jsx)("mesh",{geometry:eX,material:eV,scale:[e/.06,e/.06,e/.06]}),s=(e,t)=>(0,n.jsxs)("group",{children:[(0,n.jsx)("group",{position:[t/2,0,0],children:r(e,.06)}),(0,n.jsx)("group",{position:[-t/2,0,0],children:r(e,.06)}),(0,n.jsx)("group",{position:[0,e/2,0],children:i(.08)}),(0,n.jsx)("group",{position:[0,-e/2,0],children:i(.08)})]});return(0,n.jsx)("group",{children:(0,n.jsxs)("group",{children:[s(1.3,.15),(0,n.jsxs)("group",{position:[.25,-.85,.21],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.12,12,12]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("group",{rotation:[-.7,-0,Math.PI/5],children:[s(.8,.12),(0,n.jsxs)("group",{position:[0,-.5,0],rotation:[0,0,Math.PI/5.5],children:[i(.09),(0,n.jsxs)("group",{position:[0,-.1,0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("boxGeometry",{args:[.2,.15,.08]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4})]}),[-.08,0,.08].map((e,t)=>(0,n.jsxs)("group",{position:[e,-.1,0],rotation:[0,0,(t-1)*Math.PI/8],children:[r(.5,.02),(0,n.jsx)("group",{position:[.025,-.3,0],rotation:[0,0,Math.PI+Math.PI/16],children:(0,n.jsx)("mesh",{geometry:e0,material:e$})})]},t)),!t&&(0,n.jsx)("group",{position:[0,-.2,.3],rotation:[Math.PI/2,0,0],scale:[.8,.8,.8],children:(0,n.jsx)(tr,{})})]})]})]})]})]})})}function tr(){let e={color:"#FF4C4C",emissive:"#4ECB7E",emissiveIntensity:.5,roughness:.4,metalness:.6};return(0,n.jsxs)("group",{rotation:[0,-1.05,-Math.PI/2.5],position:[.3,-.1,.75],scale:[.9,.9,1.2],children:[(0,n.jsxs)("mesh",{position:[0,0,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.125,.125,3.35,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#8b0000",roughness:.4,metalness:.3})]}),(0,n.jsxs)("mesh",{position:[0,-.25,0],rotation:[Math.PI/2,-Math.PI/2,Math.PI/2],children:[(0,n.jsx)("cylinderGeometry",{args:[.3,.3,.125]}),(0,n.jsx)("meshStandardMaterial",{color:"#4ECB7E",roughness:.4,metalness:.5})]}),(0,n.jsxs)("mesh",{position:[0,1,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.325,.125,2.9,4]}),(0,n.jsx)("meshStandardMaterial",{...e})]}),(0,n.jsxs)("mesh",{position:[0,3.45,0],children:[(0,n.jsx)("coneGeometry",{args:[.325,2,4]}),(0,n.jsx)("meshStandardMaterial",{...e})]}),(0,n.jsx)("pointLight",{color:"#FF4D00",intensity:.3,distance:3,decay:2.5})]})}function tn(e){let{position:t,isAttacking:r,isWalking:s,onHit:o}=e,a=(0,i.useRef)(null),[l,c]=(0,i.useState)(0),[u,h]=(0,i.useState)(0),d=(0,i.useRef)();return(0,f.F)((e,n)=>{if(!a.current)return;let i=a.current;if(s){let e=(l+4*n)%(2*Math.PI);c(e);let r=Math.abs(.1*Math.sin(e));i.position.y=t[1]-r;let s=new m.O9p;["LeftLeg","RightLeg"].forEach(t=>{var r;let n=i.getObjectByName(t);if(!n)return;let o=t.includes("Right")?e:e+Math.PI,a=Math.sin(o);s.set(.4*a,.05*Math.sin(o),0),n.rotation.copy(s);let l=.4*Math.sin(o);n.rotation.x=l;let c=null===(r=n.children[0])||void 0===r?void 0:r.children[1];if(c){let e=Math.max(0,Math.sin(o+Math.PI/4));c.rotation.x=.2+.8*e;let t=.1*Math.sin(o);c.rotation.y=t}let u=.05*Math.sin(o);n.rotation.y=u}),["LeftArm","RightArm"].forEach(t=>{let r=i.getObjectByName(t);if(r){let n=.1*Math.sin(t.includes("Right")?e+Math.PI:e);r.rotation.x=n}})}if(r){h(e=>e+3*n);let e=Math.sin(Math.min(u,Math.PI/2))*Math.PI,t=i.getObjectByName("RightArm");t&&(t.rotation.x=-e),u>Math.PI/4&&o&&!d.current&&(d.current=setTimeout(()=>{d.current=void 0},0)),u>Math.PI/2&&h(0)}else d.current&&(clearTimeout(d.current),d.current=void 0)}),(0,i.useEffect)(()=>()=>{d.current&&clearTimeout(d.current)},[]),(0,i.useEffect)(()=>()=>{eV.dispose(),e$.dispose(),eX.dispose(),eJ.dispose(),e0.dispose()},[]),(0,n.jsxs)("group",{ref:a,position:[t[0],t[1]+1,t[2]],children:[(0,n.jsx)("group",{name:"Body",position:[0,1.05,0],scale:[.95,.8,.8],rotation:[-.2,0,0],children:(0,n.jsx)(_,{})}),(0,n.jsxs)("group",{name:"Head",position:[0,1.775,.1],scale:[.75,.8,.8],children:[(0,n.jsxs)("group",{children:[(0,n.jsxs)("mesh",{position:[0,0,-.05],children:[(0,n.jsx)("sphereGeometry",{args:[.22,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("mesh",{position:[0,-.02,.12],children:[(0,n.jsx)("boxGeometry",{args:[.28,.28,.1]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("group",{children:[(0,n.jsxs)("mesh",{position:[.12,-.08,.1],children:[(0,n.jsx)("boxGeometry",{args:[.08,.12,.15]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("mesh",{position:[-.12,-.08,.1],children:[(0,n.jsx)("boxGeometry",{args:[.08,.12,.15]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]})]}),(0,n.jsx)("group",{position:[0,-.15,.05],children:(0,n.jsxs)("mesh",{position:[0,-.08,.08],rotation:[0,Math.PI/5,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.08,.08,.2,5]}),(0,n.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]})}),(0,n.jsx)("group",{position:[.025,-.25,.2175],children:(0,n.jsx)(e6,{isUpper:!0})}),(0,n.jsx)("group",{position:[0,-.18,.2],children:(0,n.jsx)(e6,{isUpper:!1})})]}),(0,n.jsxs)("group",{position:[0,.05,.14],children:[(0,n.jsxs)("group",{position:[-.07,0,0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.02,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#2FFF00",emissive:"#2FFF00",emissiveIntensity:3})]}),(0,n.jsxs)("mesh",{scale:1.2,children:[(0,n.jsx)("sphereGeometry",{args:[.035,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#2FFF00",emissive:"#2FFF00",emissiveIntensity:1,transparent:!0,opacity:.75})]}),(0,n.jsxs)("mesh",{scale:1.4,children:[(0,n.jsx)("sphereGeometry",{args:[.05,6.5,2]}),(0,n.jsx)("meshStandardMaterial",{color:"#2FFF00",emissive:"#2FFF00",emissiveIntensity:1,transparent:!0,opacity:.7})]}),(0,n.jsx)("pointLight",{color:"#FF4C4C",intensity:.75,position:[0,0,0],distance:1.5,decay:2})]}),(0,n.jsxs)("group",{position:[.07,0,0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.02,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#2FFF00",emissive:"#2FFF00",emissiveIntensity:3})]}),(0,n.jsxs)("mesh",{scale:1.2,children:[(0,n.jsx)("sphereGeometry",{args:[.035,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#2FFF00",emissive:"#2FFF00",emissiveIntensity:1,transparent:!0,opacity:.75})]}),(0,n.jsxs)("mesh",{scale:1.4,children:[(0,n.jsx)("sphereGeometry",{args:[.05,6.5,2]}),(0,n.jsx)("meshStandardMaterial",{color:"#2FFF00",emissive:"#2FFF00",emissiveIntensity:1,transparent:!0,opacity:.7})]}),(0,n.jsx)("pointLight",{color:"#FF4C4C",intensity:.75,position:[0,0,0],distance:1.5,decay:2})]})]})]}),(0,n.jsx)("group",{position:[-.34,1.475,0],rotation:[-.35,-Math.PI-.4,-.35],children:(0,n.jsx)(e9,{})}),(0,n.jsx)("group",{position:[.34,1.475,0],rotation:[-.35,Math.PI-.4,.35],children:(0,n.jsx)(e9,{})}),(0,n.jsx)("group",{name:"LeftArm",position:[-.35,1.325,0],scale:[-.45,.45,.45],rotation:[0,Math.PI/3,0],children:(0,n.jsx)(tt,{isLeftHand:!0})}),(0,n.jsx)("group",{name:"RightArm",position:[.35,1.525,.1],scale:[.45,.45,.45],rotation:[0,-Math.PI/2.5,0],children:(0,n.jsx)(tt,{isLeftHand:!1})}),(0,n.jsxs)("group",{position:[0,.6,0],scale:[1.4,1,.8],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.21,.2,.2,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]}),[-1,1].map(e=>(0,n.jsx)("group",{position:[.15*e,-.1,0],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.075,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]})},e))]}),(0,n.jsx)("group",{name:"LeftLeg",position:[.2,.2725,0],children:(0,n.jsx)(te,{})}),(0,n.jsx)("group",{name:"RightLeg",position:[-.2,.2725,0],children:(0,n.jsx)(te,{})}),(0,n.jsx)("group",{position:[0,1.2,0],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.04,.04,.2,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]})})]})}let ti=()=>(0,n.jsx)("group",{children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.03,.025,.3,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#F33FAE",transparent:!0,opacity:.55,emissive:"#FF0000",emissiveIntensity:.75})]})});function ts(e){let{position:t,onComplete:r,isSpawning:s=!1,scale:o=1}=e,a=(0,i.useRef)([]),l=1.15*o,c=2.75*o,u=(0,i.useRef)(null),h=(0,i.useRef)(Date.now());return(0,f.F)(()=>{if(!u.current)return;let e=Date.now()-h.current,n=Math.min(e/1500,1),i=s?1-n:n;u.current.position.copy(t),a.current.forEach((t,r)=>{let n=Math.floor(r/10)/11,s=l*n*(i<.5?2*i:2-2*i),o=r%10/10*Math.PI*2+.006*(1+3*n)*e,a=Math.cos(o+2*n)*s,u=Math.sin(o+2*n)*s,h=(1-n)*c*(1+.1*Math.sin(.002*e));t.position.set(a,h,u),t.rotation.y=o+Math.PI/2,t.rotation.z=Math.PI/2+.8*n,t.rotation.x=.2*Math.sin(.004*e+r);let d=t.material;d.opacity=Math.max(0,.7-.4*n-(i>.7?(i-.7)*3:0)),d.emissiveIntensity=.5+.3*Math.sin(.004*e+r);let m=1+.2*Math.sin(.003*e+.5*r);t.scale.set(m,m,m)}),1===n&&r&&r()}),(0,n.jsx)("group",{ref:u,children:Array.from({length:120}).map((e,t)=>(0,n.jsx)("mesh",{ref:e=>{e&&(a.current[t]=e)},children:ti()},t))})}let to=e=>{switch(e){case s.SCYTHE:return"#00FF4D";case s.SWORD:return"#FFD700";case s.SABRES:return"#00BBFF";case s.SPEAR:return"#F33FAE";default:return"#00ff44"}},ta=e=>{let t=to(e);return(0,n.jsx)("group",{children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.03,.025,.3,8]}),(0,n.jsx)("meshStandardMaterial",{color:t,transparent:!0,opacity:.525,emissive:t,emissiveIntensity:.75})]})})};function tl(e){let{position:t,onComplete:r,isSpawning:s=!1,weaponType:o}=e,a=(0,i.useRef)([]),l=(0,i.useRef)(null),c=(0,i.useRef)(Date.now());return(0,f.F)(()=>{if(!l.current)return;let e=Date.now()-c.current,n=Math.min(e/1500,1),i=s?1-n:n;l.current.position.set(t.x,0,t.z),a.current.forEach((t,r)=>{let n=Math.floor(r/10)/11,s=1.15*n*(i<.5?2*i:2-2*i),o=r%10/10*Math.PI*2+.006*(1+3*n)*e,a=Math.cos(o+2*n)*s,l=Math.sin(o+2*n)*s,c=(1-n)*2.75*(1+.1*Math.sin(.002*e));t.position.set(a,c,l),t.rotation.y=o+Math.PI/2,t.rotation.z=Math.PI/2+.8*n,t.rotation.x=.2*Math.sin(.004*e+r);let u=t.material;u.opacity=Math.max(0,.7-.4*n-(i>.7?(i-.7)*3:0)),u.emissiveIntensity=.5+.3*Math.sin(.004*e+r);let h=1+.2*Math.sin(.003*e+.5*r);t.scale.set(h,h,h)}),1===n&&r&&r()}),(0,n.jsx)("group",{ref:l,children:Array.from({length:120}).map((e,t)=>(0,n.jsx)("mesh",{ref:e=>{e&&(a.current[t]=e)},children:ta(o)},t))})}let tc={skeleton:null,mage:null,abomination:null,tree:null,mountain:null,mushroom:null,boss:null,player:null},tu={skeleton:null,mage:null,abomination:null,tree:null,mountain:null,mushroom:null,bossMaterial:null,playerMaterial:null};function th(){tc.skeleton||(Object.keys(tc).forEach(e=>{tc[e]=new m.LoY}),Object.keys(tu).forEach(e=>{tu[e]=new m._4j}))}function td(){Object.values(tc).forEach(e=>null==e?void 0:e.dispose()),Object.values(tu).forEach(e=>null==e?void 0:e.dispose())}let tm=i.memo(function(e){let{id:t,initialPosition:r,position:o,health:a,maxHealth:l,onTakeDamage:c,onPositionUpdate:u,playerPosition:h,onAttackPlayer:d,weaponType:p}=e,x=(0,i.useRef)(null),g=(0,i.useRef)(Date.now()+2e3),[y,j]=(0,i.useState)(!1),[M,v]=(0,i.useState)(!1),[w,P]=(0,i.useState)(!1),[S,I]=(0,i.useState)(!0),[F,E]=(0,i.useState)(!1),[C,R]=(0,i.useState)(!1),k=(0,i.useRef)(r.clone().setY(0)),T=(0,i.useRef)(r.clone().setY(0)),_=(0,i.useRef)(Date.now()),D=(0,i.useRef)(a),G=(0,i.useRef)(new m.Pq0),A=(0,i.useRef)(0),B=(0,i.useRef)(null),z=(0,i.useRef)(Date.now()),L=(0,i.useCallback)(()=>{if(!x.current)return null;let e=Math.random()*Math.PI*2,t=6*Math.random();return new m.Pq0(k.current.x+Math.cos(e)*t,0,k.current.z+Math.sin(e)*t)},[]);(0,i.useEffect)(()=>{D.current=a},[a]);let O=(0,i.useCallback)((e,r)=>{if(D.current<=0)return;let n=Math.max(0,D.current-e);c("enemy-".concat(t),e),0===n&&D.current>0&&(P(!0),v(!0)),r.type===s.SABRES&&r.hasActiveAbility&&R(!0)},[t,c]);(0,i.useEffect)(()=>{o&&S&&(k.current.copy(o),k.current.y=0,T.current.copy(k.current),x.current&&x.current.position.copy(k.current))},[o,S]);let W=(0,i.useCallback)((e,t)=>{x.current&&u(e,t.clone(),x.current.rotation.y)},[u]);return(0,f.F)((e,r)=>{if(!x.current||D.current<=0||!h){E(!1);return}let n=k.current.distanceTo(h);if(q.isUnitStealthed()){j(!1);let e=Date.now();if(!B.current||e-z.current>4500){if(B.current){let e=new m.Pq0().subVectors(B.current,k.current).normalize(),t=new m.Pq0().copy(k.current).add(e.multiplyScalar(6));B.current=t}else B.current=L();z.current=e}if(B.current){E(!0);let e=new m.Pq0().subVectors(B.current,k.current).normalize(),t=e.multiplyScalar(1.05*r);G.current.lerp(t,1.5*r),k.current.add(G.current),k.current.y=0,x.current.position.copy(k.current);let n=Math.atan2(e.x,e.z)-x.current.rotation.y;for(;n>Math.PI;)n-=2*Math.PI;for(;n<-Math.PI;)n+=2*Math.PI;x.current.rotation.y+=n*Math.min(1,2.5*r)}return}if(q.isUnitStealthed()){E(!1),j(!1);return}if(n>2.5&&D.current>0){var i;j(!1),E(!0);let e=new m.Pq0().subVectors(h,k.current).normalize(),t=new m.Pq0;((null===(i=x.current.parent)||void 0===i?void 0:i.children.filter(e=>e!==x.current&&e.position&&1.25>e.position.distanceTo(k.current)))||[]).forEach(e=>{let r=k.current.clone().setY(0),n=e.position.clone().setY(0),i=new m.Pq0().subVectors(r,n).normalize().multiplyScalar(.155/Math.max(.1,n.distanceTo(r)));t.add(i)});let n=e.add(t).normalize();n.y=0;let s=G.current.length(),o=m.cj9.lerp(s,3.54*r,3*r),a=n.multiplyScalar(o);G.current.lerp(a,3*r*.5);let l=k.current.clone().add(G.current);k.current.lerp(l,.8),k.current.y=0,x.current.position.copy(k.current);let c=new m.Pq0().copy(h).setY(k.current.y);A.current=Math.atan2(c.x-k.current.x,c.z-k.current.z);let u=x.current.rotation.y,d=A.current-u;for(;d>Math.PI;)d-=2*Math.PI;for(;d<-Math.PI;)d+=2*Math.PI;x.current.rotation.y+=d*Math.min(1,5*r)}else E(!1),G.current.multiplyScalar(1-4*r),G.current.length()>.001&&(k.current.add(G.current),x.current.position.copy(k.current));if(n<=2.5&&D.current>0){let e=Date.now();if(e-g.current>=2500){j(!0);let t=k.current.clone();setTimeout(()=>{let e=k.current.distanceTo(h);D.current>0&&e<=2.5&&.55>t.distanceTo(k.current)&&d(10)},1250),g.current=e,setTimeout(()=>{j(!1)},500)}}let s=Date.now();s-_.current>=20&&k.current.distanceTo(o)>.125&&(W(t,k.current.clone()),_.current=s)}),(0,i.useEffect)(()=>{0===a&&!w&&(P(!0),v(!0),x.current&&(x.current.visible=!0))},[a,w]),(0,i.useEffect)(()=>{if(w){let e=setTimeout(()=>{var e;v(!1),(null===(e=x.current)||void 0===e?void 0:e.parent)&&x.current.parent.remove(x.current)},3e3);return()=>clearTimeout(e)}},[w]),(0,i.useEffect)(()=>{let e=()=>{E(!0)};return window.addEventListener("stealthBreak",e),()=>{window.removeEventListener("stealthBreak",e)}},[]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("group",{ref:x,visible:!S&&D.current>0,position:k.current,onClick:e=>{e.stopPropagation()},children:[(0,n.jsx)(tn,{position:[0,.795,0],isAttacking:y,isWalking:F&&D.current>0,onHit:e=>O(e,{type:p})}),(0,n.jsx)(eK.Q,{position:[0,3.5,0],follow:!0,lockX:!1,lockY:!1,lockZ:!1,children:D.current>0&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("mesh",{position:[0,0,0],children:[(0,n.jsx)("planeGeometry",{args:[2,.25]}),(0,n.jsx)("meshBasicMaterial",{color:"#333333",opacity:.8,transparent:!0})]}),(0,n.jsxs)("mesh",{position:[-1+D.current/l,0,.001],children:[(0,n.jsx)("planeGeometry",{args:[D.current/l*2,.23]}),(0,n.jsx)("meshBasicMaterial",{color:"#ff3333",opacity:.9,transparent:!0})]}),(0,n.jsx)(b.E,{position:[0,0,.002],fontSize:.2,color:"#ffffff",anchorX:"center",anchorY:"middle",fontWeight:"bold",children:"".concat(Math.ceil(D.current),"/").concat(l)})]})})]}),S&&(0,n.jsx)(ts,{position:k.current,onComplete:()=>{I(!1)},isSpawning:!0}),M&&(0,n.jsx)(tl,{position:k.current,onComplete:()=>{v(!1)},isSpawning:!1,weaponType:p}),C&&(0,n.jsx)(eI,{position:o,onComplete:()=>R(!1)})]})},(e,t)=>e.health===t.health&&e.position.equals(t.position)&&e.playerPosition.equals(t.playerPosition));tc.skeleton,tu.skeleton;let tp=()=>{let e=(0,f.H)(m.Tap,"/textures/ring-alpha.jpg"),t=(0,i.useMemo)(()=>(e.minFilter=m.k6q,e.magFilter=m.k6q,e.generateMipmaps=!1,e),[e]),r=(0,i.useRef)(null),s=(0,i.useRef)(null),o=(0,i.useMemo)(()=>new m.Gu$(1,24,24),[]),a=(0,i.useMemo)(()=>new m.rKP(1.4,2.1,48),[]),l=(0,i.useMemo)(()=>new m._4j({color:"#B8E0D2",roughness:.7,metalness:.2,emissive:"#B8E0D2",emissiveIntensity:.675}),[]),c=(0,i.useMemo)(()=>new m.V9B({color:"#4dff90",transparent:!0,opacity:.5}),[]),u=(0,i.useMemo)(()=>new m.PPD,[]),h=(0,i.useMemo)(()=>new m.kn4,[]),d=(0,i.useMemo)(()=>new m.iyt(new m.Pq0,24*Math.sqrt(3)),[]);return(0,f.F)((e,t)=>{r.current&&(r.current.rotation.z+=.006*t),s.current&&(h.multiplyMatrices(e.camera.projectionMatrix,e.camera.matrixWorldInverse),u.setFromProjectionMatrix(h),d.center.copy(s.current.position),s.current.visible=u.intersectsSphere(d))}),(0,n.jsxs)("group",{ref:s,position:[100,80,-150],scale:[24,24,24],rotation:[1,.1,.1],children:[(0,n.jsx)("mesh",{geometry:o,material:l}),(0,n.jsx)("mesh",{ref:r,rotation:[Math.PI/2.8,0,0],geometry:a,children:(0,n.jsx)("meshStandardMaterial",{map:t,color:"#A8DBFF",transparent:!0,opacity:1,side:m.$EB,alphaMap:t,roughness:.7,metalness:.2,emissive:"#77FFC0",emissiveIntensity:1.1})}),(0,n.jsx)("mesh",{scale:[1.05,1.05,1.05],geometry:o,material:c}),(0,n.jsx)("mesh",{scale:[1.1,1.1,1.1],geometry:o,children:(0,n.jsx)("meshBasicMaterial",{color:"#4dff90",transparent:!0,opacity:.2,side:m.hsX})})]})},tf={uniforms:{topColor:{value:new m.Q1f("#4B0082")},middleColor:{value:new m.Q1f("#8A2BE2")},bottomColor:{value:new m.Q1f("#87CEEB")},offset:{value:33},exponent:{value:.6}},vertexShader:"\n    varying vec3 vWorldPosition;\n    \n    void main() {\n      vec4 worldPosition = modelMatrix * vec4(position, 1.0);\n      vWorldPosition = worldPosition.xyz;\n      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n    }\n  ",fragmentShader:"\n    uniform vec3 topColor;\n    uniform vec3 middleColor;\n    uniform vec3 bottomColor;\n    uniform float offset;\n    uniform float exponent;\n    \n    varying vec3 vWorldPosition;\n    \n    void main() {\n      float h = normalize(vWorldPosition + vec3(0.0, offset, 0.0)).y;\n      float mixStrength = max(pow(max(h, 0.0), exponent), 0.0);\n      vec3 color = mix(middleColor, topColor, mixStrength);\n      color = mix(bottomColor, color, smoothstep(0.0, 1.0, h));\n      gl_FragColor = vec4(color, 1.0);\n    }\n  "},tx=()=>{let e=(0,i.useMemo)(()=>({uniforms:tf.uniforms,vertexShader:tf.vertexShader,fragmentShader:tf.fragmentShader,side:m.hsX}),[]);return(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[500,32,32]}),(0,n.jsx)("shaderMaterial",{attach:"material",args:[e]})]})},tg=()=>{let e=[];for(let t=0;t<34;t++){let r=t/34*Math.PI*2,n=51+(4*Math.random()-2),i=Math.cos(r)*n,s=Math.sin(r)*n,o=.75+.4*Math.random();e.push({position:new m.Pq0(i,0,s),scale:o});let a=r+Math.PI/34,l=39*Math.cos(a),c=39*Math.sin(a);e.push({position:new m.Pq0(l,0,c),scale:.9*o})}return e},ty=()=>[{position:new m.Pq0(-15,0,-5),scale:1.3,trunkColor:new m.Q1f("#B89F89"),leafColor:new m.Q1f("#FFA1E0").multiplyScalar(2.5)},{position:new m.Pq0(-12,0,-8),scale:1.25,trunkColor:new m.Q1f("#B89F89"),leafColor:new m.Q1f("#FFA1E0").multiplyScalar(3.5)},{position:new m.Pq0(-12,0,-13.5),scale:.8,trunkColor:new m.Q1f("#B89F89"),leafColor:new m.Q1f("#8AFF7B").multiplyScalar(2.5)},{position:new m.Pq0(16,0,-10),scale:1,trunkColor:new m.Q1f("#B89F89"),leafColor:new m.Q1f("#8AFF7B").multiplyScalar(3.5)},{position:new m.Pq0(12,0,8),scale:1.25,trunkColor:new m.Q1f("#B89F89"),leafColor:new m.Q1f("#8AFF7B").multiplyScalar(1.5)},{position:new m.Pq0(-11,0,5),scale:1.3,trunkColor:new m.Q1f("#B89F89"),leafColor:new m.Q1f("#8AFF7B").multiplyScalar(3.5)},{position:new m.Pq0(12,0,-8),scale:1.25,trunkColor:new m.Q1f("#B89F89"),leafColor:new m.Q1f("#8AFF7B").multiplyScalar(2.5)},{position:new m.Pq0(18,0,-8),scale:1.1,trunkColor:new m.Q1f("#C69155"),leafColor:new m.Q1f("#FFA1E0").multiplyScalar(1.5)},{position:new m.Pq0(17.5,0,-10),scale:.9,trunkColor:new m.Q1f("#C69155"),leafColor:new m.Q1f("#73D0FF").multiplyScalar(3.25)},{position:new m.Pq0(15,0,-11.5),scale:1.1,trunkColor:new m.Q1f("#C69155"),leafColor:new m.Q1f("#73D0FF").multiplyScalar(3.5)},{position:new m.Pq0(16.5,0,-6.5),scale:1,trunkColor:new m.Q1f("#C69155"),leafColor:new m.Q1f("#73D0FF").multiplyScalar(2.5)},{position:new m.Pq0(-12,0,12),scale:.8,trunkColor:new m.Q1f("#C69155"),leafColor:new m.Q1f("#73D0FF").multiplyScalar(3.5)},{position:new m.Pq0(12,0,12),scale:.8,trunkColor:new m.Q1f("#AC8F75"),leafColor:new m.Q1f("#FFA1E0").multiplyScalar(2.5)},{position:new m.Pq0(-5,0,-15),scale:.85,trunkColor:new m.Q1f("#B89F89"),leafColor:new m.Q1f("#8AFF7B").multiplyScalar(2.5)},{position:new m.Pq0(5,0,-18),scale:.85,trunkColor:new m.Q1f("#C69155"),leafColor:new m.Q1f("#73D0FF").multiplyScalar(1.5)}],tj=()=>{let e=[],t=ty();for(let r=0;r<30;r++){let r,n,i;let s=.375+.175*Math.random();if(.7>Math.random()&&t.length>0){let e=t[Math.floor(Math.random()*t.length)],i=Math.random()*Math.PI*2,s=4*Math.random();r=e.position.x+Math.cos(i)*s,n=e.position.z+Math.sin(i)*s}else{let e=Math.random()*Math.PI*2,t=48*Math.random();r=t*Math.cos(e),n=t*Math.sin(e)}let o=100*Math.random();i=o<33.33?"pink":o<66.66?"green":"blue",e.push({position:new m.Pq0(r,0,n),scale:s,variant:i})}return e},tM=()=>{let e=Math.random()*Math.PI*2,t=15.5*Math.random(),r=Math.cos(e)*t,n=Math.sin(e)*t;return new m.Pq0(r,0,n)},tv=e=>{let{trees:t}=e,r=(0,i.useRef)(null),s=(0,i.useRef)([]);return(0,i.useEffect)(()=>{if(!r.current)return;let e=new m.kn4;t.forEach((t,n)=>{var i;e.makeTranslation(t.position.x,t.position.y,t.position.z),e.scale(new m.Pq0(.9*t.scale,.9*t.scale,.9*t.scale)),null===(i=r.current)||void 0===i||i.setMatrixAt(n,e)}),r.current.instanceMatrix&&(r.current.instanceMatrix.needsUpdate=!0),s.current.forEach((r,n)=>{r&&(t.forEach((t,i)=>{let s=[{posY:2.24,size:1.35,height:1.7},{posY:2.76,size:1.08,height:1.36},{posY:3.4,size:.756,height:1.36},{posY:3.62,size:.709,height:.765}][n];e.makeTranslation(t.position.x,s.posY*t.scale,t.position.z),e.scale(new m.Pq0(.9*t.scale,.9*t.scale,.9*t.scale)),r.setMatrixAt(i,e);let o=t.leafColor.clone().multiplyScalar(1.5);r.setColorAt(i,o)}),r.instanceMatrix.needsUpdate=!0,r.instanceColor&&(r.instanceColor.needsUpdate=!0))})},[t]),(0,n.jsxs)("group",{children:[(0,n.jsxs)("instancedMesh",{args:[void 0,void 0,t.length],ref:r,frustumCulled:!1,children:[(0,n.jsx)("cylinderGeometry",{args:[.25,.30625,4,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#FFBD83",roughness:.6,metalness:.2,emissive:"#FFBD83",emissiveIntensity:0})]}),[{posY:.56,size:1.35,height:1.7,emissiveIntensity:1},{posY:.69,size:1.08,height:1.36,emissiveIntensity:1.3},{posY:.85,size:.756,height:1.36,emissiveIntensity:1.6},{posY:.905,size:.709,height:.765,emissiveIntensity:1.9}].map((e,r)=>(0,n.jsxs)("instancedMesh",{args:[void 0,void 0,t.length],ref:e=>{s.current[r]=e},frustumCulled:!1,children:[(0,n.jsx)("coneGeometry",{args:[e.size,e.height,8]}),(0,n.jsx)("meshStandardMaterial",{roughness:.3,metalness:.2,emissiveIntensity:e.emissiveIntensity,transparent:!0,opacity:1})]},"foliage-".concat(r)))]})},tw=e=>{let{mountains:t}=e,r=(0,i.useRef)(null),s=(0,i.useRef)(null),o=(0,i.useRef)(null);return(0,i.useEffect)(()=>{if(!r.current||!s.current||!o.current)return;let e=new m.kn4;t.forEach((t,n)=>{var i;e.makeTranslation(t.position.x,t.position.y,t.position.z);let s=new m.kn4().makeScale(t.scale,t.scale,t.scale);e.multiply(s),null===(i=r.current)||void 0===i||i.setMatrixAt(n,e)}),t.forEach((t,r)=>{var n;let i=new m.kn4().makeRotationFromEuler(new m.O9p(0,.5,.1)),o=-4*t.scale,a=-5*t.scale,l=-2*t.scale;e.makeTranslation(t.position.x+o,t.position.y+a,t.position.z+l);let c=new m.kn4().makeScale(t.scale,t.scale,t.scale);e.multiply(i).multiply(c),null===(n=s.current)||void 0===n||n.setMatrixAt(r,e)}),t.forEach((t,r)=>{var n;e.makeTranslation(t.position.x,t.position.y+14*t.scale,t.position.z);let i=new m.kn4().makeScale(.9*t.scale,t.scale,.9*t.scale);e.multiply(i),null===(n=o.current)||void 0===n||n.setMatrixAt(r,e)}),r.current.instanceMatrix.needsUpdate=!0,s.current.instanceMatrix.needsUpdate=!0,o.current.instanceMatrix.needsUpdate=!0},[t]),(0,n.jsxs)("group",{children:[(0,n.jsxs)("instancedMesh",{args:[void 0,void 0,t.length],ref:r,castShadow:!0,receiveShadow:!0,children:[(0,n.jsx)("coneGeometry",{args:[23,35,12]}),(0,n.jsx)("meshPhysicalMaterial",{color:"#2a2a2a",metalness:.1,roughness:1,emissive:"#222222",flatShading:!0,clearcoat:.1,clearcoatRoughness:.8})]}),(0,n.jsxs)("instancedMesh",{args:[void 0,void 0,t.length],ref:s,castShadow:!0,children:[(0,n.jsx)("coneGeometry",{args:[24,28,12]}),(0,n.jsx)("meshPhysicalMaterial",{color:"#252525",metalness:.05,roughness:1,flatShading:!0,clearcoat:.1,clearcoatRoughness:.9})]}),(0,n.jsxs)("instancedMesh",{args:[void 0,void 0,t.length],ref:o,castShadow:!0,children:[(0,n.jsx)("coneGeometry",{args:[5,8,12]}),(0,n.jsx)("meshPhysicalMaterial",{color:"#ffffff",metalness:.1,roughness:.3,flatShading:!0,clearcoat:.4,clearcoatRoughness:.2,envMapIntensity:1.5})]})]})},tP=e=>{let{mushrooms:t}=e,r=(0,i.useRef)(null),s=(0,i.useRef)(null),o=(0,i.useRef)(null),a=(0,i.useMemo)(()=>({pink:{main:new m.Q1f("#FAA9C5").multiplyScalar(4.5),spots:new m.Q1f("#FAA9C5").multiplyScalar(4.5)},green:{main:new m.Q1f("#FF8DC6").multiplyScalar(2.5),spots:new m.Q1f("#92E2FF").multiplyScalar(2.5)},blue:{main:new m.Q1f("#92E2FF").multiplyScalar(2.5),spots:new m.Q1f("#92E2FF").multiplyScalar(2.5)}}),[]);return(0,i.useEffect)(()=>{if(!r.current||!s.current||!o.current)return;let e=new m.kn4;t.forEach((t,n)=>{var i,s;e.makeTranslation(t.position.x,t.position.y,t.position.z),e.scale(new m.Pq0(.8*t.scale,.8*t.scale,.8*t.scale)),null===(i=r.current)||void 0===i||i.setMatrixAt(n,e),null===(s=r.current)||void 0===s||s.setColorAt(n,a[t.variant].main.clone().multiplyScalar(.9))}),t.forEach((t,r)=>{var n,i;e.makeTranslation(t.position.x,t.position.y+.35*t.scale*.8,t.position.z),e.scale(new m.Pq0(.8*t.scale,.8*t.scale,.8*t.scale)),null===(n=s.current)||void 0===n||n.setMatrixAt(r,e),null===(i=s.current)||void 0===i||i.setColorAt(r,a[t.variant].main)}),t.forEach((t,r)=>{for(let s=0;s<6;s++){var n,i;let l=s*Math.PI/3,c=6*r+s;e.makeTranslation(t.position.x+.15*Math.sin(l)*t.scale*.8,t.position.y+(.4+.1*Math.cos(l))*t.scale*.8,t.position.z+.15*Math.cos(l)*t.scale*.8);let u=new m.kn4().makeRotationFromEuler(new m.O9p(-Math.PI/3,0,-l));e.multiply(u),e.scale(new m.Pq0(.8*t.scale,.8*t.scale,.8*t.scale)),null===(n=o.current)||void 0===n||n.setMatrixAt(c,e),null===(i=o.current)||void 0===i||i.setColorAt(c,a[t.variant].spots)}}),r.current.instanceMatrix.needsUpdate=!0,s.current.instanceMatrix.needsUpdate=!0,o.current.instanceMatrix.needsUpdate=!0,r.current.instanceColor&&(r.current.instanceColor.needsUpdate=!0),s.current.instanceColor&&(s.current.instanceColor.needsUpdate=!0),o.current.instanceColor&&(o.current.instanceColor.needsUpdate=!0)},[t,a]),(0,n.jsxs)("group",{children:[(0,n.jsxs)("instancedMesh",{args:[void 0,void 0,t.length],ref:r,frustumCulled:!1,children:[(0,n.jsx)("cylinderGeometry",{args:[.1,.12,.7,16]}),(0,n.jsx)("meshStandardMaterial",{roughness:.3,metalness:.2,emissiveIntensity:.5})]}),(0,n.jsxs)("instancedMesh",{args:[void 0,void 0,t.length],ref:s,children:[(0,n.jsx)("sphereGeometry",{args:[.3,32,32,0,2*Math.PI,0,Math.PI/2]}),(0,n.jsx)("meshStandardMaterial",{roughness:.3,metalness:.2,emissiveIntensity:.8,transparent:!0,opacity:.95})]}),(0,n.jsxs)("instancedMesh",{args:[void 0,void 0,6*t.length],ref:o,children:[(0,n.jsx)("circleGeometry",{args:[.04,16]}),(0,n.jsx)("meshStandardMaterial",{roughness:.2,metalness:.3,emissiveIntensity:1.5,transparent:!0,opacity:.95})]})]})};function tS(){let e=(0,i.useRef)(null),t=(0,i.useMemo)(()=>{let e=new m.LoY,t=new Float32Array([-.2,0,0,.2,0,0,0,.4,0]);return e.setAttribute("position",new m.THS(t,3)),e.computeVertexNormals(),e},[]),r=(0,i.useMemo)(()=>new m._4j({color:new m.Q1f("#1a4d1a"),side:m.$EB,roughness:.8,metalness:.1}),[]);return(0,i.useEffect)(()=>{if(!e.current)return;let t=e.current,r=new m.kn4,n=new m.Pq0,i=new m.O9p,s=new m.PTz,o=new m.Pq0;for(let e=0;e<400;e++){let a=Math.random()*Math.PI*2,l=45*Math.sqrt(Math.random());n.set(Math.cos(a)*l,.01,Math.sin(a)*l);for(let a=0;a<7;a++){let l=7*e+a,c=new m.Pq0((Math.random()-.5)*.5,0,(Math.random()-.5)*.5),u=n.clone().add(c),h=2*Math.PI;i.set(-Math.PI/2+(Math.random()-.5)*h,Math.random()*Math.PI*2,(Math.random()-.5)*h),s.setFromEuler(i);let d=.4+.4*Math.random();o.set(d,d,d),r.compose(u,s,o),t.setMatrixAt(l,r)}}t.instanceMatrix.needsUpdate=!0},[]),(0,n.jsx)("instancedMesh",{ref:e,args:[t,r,2800],receiveShadow:!0,castShadow:!0})}let tI=i.memo(()=>{let{pillarGeometries:e,materials:t}=(0,i.useMemo)(()=>{let e=new m.Ho_(2,2.2,1,8),t=new m.Ho_(1.5,1.5,8,8),r=new m.Ho_(2.2,2,1,8),n=new m._4j({color:"#ffffff",roughness:.7,metalness:.2});return{pillarGeometries:{base:e,column:t,top:r,orb:new m.Gu$(1,32,32)},materials:{stone:n,orb:new m._4j({color:"#ff0000",emissive:"#600000",metalness:1,roughness:.2})}}},[]),[r,s]=i.useState(0);return i.useEffect(()=>{let e;let t=()=>{s(e=>(e+.02)%(2*Math.PI)),e=requestAnimationFrame(t)};return t(),()=>{cancelAnimationFrame(e)}},[]),i.useEffect(()=>()=>{Object.values(e).forEach(e=>e.dispose()),Object.values(t).forEach(e=>e.dispose())},[e,t]),(0,n.jsxs)("group",{position:[0,0,0],scale:[.35,.35,.35],children:[(0,n.jsx)("mesh",{geometry:e.base,material:t.stone,position:[0,0,0]}),(0,n.jsx)("mesh",{geometry:e.column,material:t.stone,position:[0,.25,0]}),(0,n.jsx)("mesh",{geometry:e.top,material:t.stone,position:[0,3,0]}),(0,n.jsx)("mesh",{geometry:e.orb,material:t.orb,position:[0,5,0],rotation:[r,r,0],children:(0,n.jsx)("pointLight",{color:"#ff0000",intensity:.5,distance:5})})]})});class tb{acquire(){if(this.pool.length>0)return this.pool.pop();if(this.maxSize>0&&this.pool.length>=this.maxSize)throw Error("Pool exhausted");return this.create()}release(e){this.maxSize>0&&this.pool.length>=this.maxSize||this.pool.push(e)}clear(){this.pool=[]}constructor(e,t,r){this.pool=[],this.create=e,this.maxSize=r;for(let e=0;e<t;e++)this.pool.push(this.create())}}function tF(e){let{unitProps:{controlsRef:t,...r},onLevelComplete:s,spawnInterval:o=2e3,maxSkeletons:a=13,initialSkeletons:l=4,killCount:c}=e,u=(0,i.useMemo)(()=>tg(),[]),h=(0,i.useMemo)(()=>ty(),[]),d=(0,i.useMemo)(()=>tj(),[]),[f]=(0,i.useState)(()=>new tb(()=>new m.YJl,a,a+5)),x=(0,i.useCallback)(e=>{let t=f.acquire(),r=tM();return r.y=0,{id:e,position:r.clone(),initialPosition:r.clone(),rotation:0,health:196,maxHealth:196,ref:{current:t}}},[f]),g=(0,i.useCallback)(e=>{var t;(null===(t=e.ref)||void 0===t?void 0:t.current)&&(e.ref.current.position.set(0,0,0),f.release(e.ref.current))},[f]),[y,j]=(0,i.useState)(()=>Array.from({length:l},(e,t)=>x("skeleton-".concat(t)))),[M,v]=(0,i.useState)(l),[w,P]=(0,i.useState)(r.health),S=(0,i.useRef)(null),[I,b]=(0,i.useState)(new m.Pq0(0,0,0)),F=(0,i.useCallback)((e,t)=>{j(n=>{let i=[...n],s=i.findIndex(t=>t.id===e.replace("enemy-",""));if(-1!==s){let e=Math.max(0,i[s].health-t);if(0===e&&i[s].health>0){var o;i[s]={...i[s],health:e,isDying:!0,deathStartTime:Date.now()},null===(o=r.onEnemyDeath)||void 0===o||o.call(r)}else i[s]={...i[s],health:e}}return i})},[r]),E=(0,i.useCallback)(e=>{var t;null===(t=r.onDamage)||void 0===t||t.call(r,e)},[r]),C=(0,i.useCallback)(e=>{b(e)},[]),R=(0,i.useCallback)((e,t)=>{j(r=>r.map(r=>r.id===e.replace("enemy-","")?{...r,position:t.clone()}:r))},[]),k={onHit:F,controlsRef:t,currentWeapon:r.currentWeapon,onWeaponSelect:r.onWeaponSelect,health:w,maxHealth:r.maxHealth,isPlayer:r.isPlayer,abilities:r.abilities,onAbilityUse:r.onAbilityUse,onPositionUpdate:C,onHealthChange:e=>{if("function"==typeof e)P(t=>{var n;let i=e(t);return null===(n=r.onHealthChange)||void 0===n||n.call(r,i),i});else{var t;P(e),null===(t=r.onHealthChange)||void 0===t||t.call(r,e)}},enemyData:y.map(e=>({id:"enemy-".concat(e.id),position:e.position,initialPosition:e.initialPosition,rotation:e.rotation,health:e.health,maxHealth:e.maxHealth})),onDamage:r.onDamage,onEnemyDeath:()=>{},onFireballDamage:r.onFireballDamage,fireballManagerRef:r.fireballManagerRef,onSmiteDamage:r.onSmiteDamage},[T,_]=(0,i.useState)(0);(0,i.useEffect)(()=>{if(M>=a)return;let e=setInterval(()=>{c<2&&0===T||c<5&&1===T||c<8&&2===T||j(e=>{let t=a-M;if(t<=0)return e;let r=Math.min(3,t),n=Array.from({length:r},(e,t)=>x("skeleton-".concat(M+t)));return v(e=>e+r),_(e=>e+1),[...e,...n]})},o);return()=>clearInterval(e)},[M,a,o,T,c,x]),(0,i.useEffect)(()=>{let e=y.every(e=>e.health<=0),t=M>=a;e&&t&&s()},[y,M,a,s]),(0,i.useEffect)(()=>{t.current&&(t.current.object.position.set(0,12,-18),t.current.target.set(0,0,0),t.current.update())},[t]),(0,i.useEffect)(()=>{j(e=>{let t=Date.now();return e.filter(e=>e.isDying&&e.deathStartTime?t-e.deathStartTime<1500:e.health>0)})},[y]),(0,i.useEffect)(()=>{let e=S.current;return()=>{j([]),e&&e.clear(),b(new m.Pq0(0,0,0)),v(l)}},[l]),(0,i.useEffect)(()=>{let e=[],t=[];return()=>{e.forEach(e=>e.dispose()),t.forEach(e=>e.dispose())}},[]);let D=(0,i.useCallback)(()=>{j(e=>(e.forEach(g),[])),f.clear()},[g,f]);return(0,i.useEffect)(()=>D,[D]),(0,i.useEffect)(()=>(th(),tc.mountain=new m.qFE(23,35,12),tu.mountain=new m.uSd({color:"#2a2a2a",metalness:.1,roughness:1,emissive:"#222222",flatShading:!0,clearcoat:.1,clearcoatRoughness:.8}),()=>{td()}),[]),(0,i.useEffect)(()=>()=>{td(),f.clear()},[f]),(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("group",{children:[(0,n.jsx)(tx,{}),(0,n.jsx)(tp,{}),(0,n.jsx)(p,{}),(0,n.jsx)(tS,{}),(0,n.jsx)(tv,{trees:h}),(0,n.jsx)(tw,{mountains:u}),(0,n.jsx)(tP,{mushrooms:d}),(0,n.jsx)(tI,{}),(0,n.jsx)("group",{ref:S,children:(0,n.jsx)(eZ,{...k})}),y.map(e=>(0,n.jsx)(tm,{id:e.id,initialPosition:e.initialPosition,position:e.position,health:e.health,maxHealth:e.maxHealth,isDying:e.isDying,onTakeDamage:F,onPositionUpdate:R,playerPosition:I,onAttackPlayer:E,weaponType:r.currentWeapon},e.id))]})})}let tE=new m.kn4,tC=new m.Pq0,tR=new m.O9p,tk=new m.Pq0,tT=new m.PTz;function t_(e,t,r,n,i){tT.setFromEuler(n),tE.compose(r,tT,i),e.setMatrixAt(t,tE)}let tD=new m._4j({color:"#e8e8e8",roughness:.4,metalness:.3}),tG=new m._4j({color:"#4169E1",emissive:"#4169E1",emissiveIntensity:1.75,transparent:!0,opacity:.875}),tA=new m._4j({color:"#896BFF",roughness:.7,transparent:!0,opacity:.7}),tB=new m.Gu$(.06,6,6),tz=new m.Ho_(.04,.032,1,4),tq=new m.Gu$(.02,8,8),tL=new m.Ho_(.03,.04,2.8,8),tO=new m.rKP(.575,.7,24),tW={tooth:new m.qFE(.03,.075,3),lowerTooth:new m.qFE(.01,.08,3),eye:new m.Gu$(.02,8,8),eyeGlow:new m.Gu$(.035,8,8),eyeOuterGlow:new m.Gu$(.05,6.5,2),vertebrae:new m.Ho_(.0225,.0225,.03,6),particle:new m.Gu$(.01,6,6)},tH={bone:new m._4j({color:"#e8e8e8",roughness:.4,metalness:.3}),darkBone:new m._4j({color:"#d8d8d8",roughness:.5,metalness:.2}),eyeCore:new m._4j({color:"#2FFF00",emissive:"#2FFF00",emissiveIntensity:3}),eyeGlow:new m._4j({color:"#2FFF00",emissive:"#2FFF00",emissiveIntensity:1,transparent:!0,opacity:.75}),eyeOuterGlow:new m._4j({color:"#2FFF00",emissive:"#2FFF00",emissiveIntensity:1,transparent:!0,opacity:.7}),particleGlow:new m._4j({color:"#4169E1",emissive:"#4169E1",emissiveIntensity:2,transparent:!0,opacity:.7})};function tN(){let e=(e,t)=>(0,n.jsx)("mesh",{geometry:tz,material:tD,scale:[t/.04,e,t/.04]}),t=e=>(0,n.jsx)("mesh",{geometry:tB,material:tD,scale:[e/.06,e/.06,e/.06]}),r=(r,i)=>(0,n.jsxs)("group",{children:[(0,n.jsx)("group",{position:[i/2,0,0],children:e(r,.04)}),(0,n.jsx)("group",{position:[-i/2,0,0],children:e(r,.04)}),(0,n.jsx)("group",{position:[0,r/2,0],children:t(.06)}),(0,n.jsx)("group",{position:[0,-r/2,0],children:t(.06)})]});return(0,n.jsx)("group",{children:(0,n.jsxs)("group",{children:[(0,n.jsx)("mesh",{geometry:tz,material:tD}),(0,n.jsxs)("group",{position:[0,-.35,0],children:[(0,n.jsx)("mesh",{geometry:tB,material:tD}),(0,n.jsxs)("group",{position:[0,-.15,0],children:[r(.7,.06),(0,n.jsxs)("group",{position:[0,-.25,0],rotation:[Math.PI/2,0,0],children:[t(.06),(0,n.jsxs)("group",{position:[0,-.015,.1],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("boxGeometry",{args:[.15,.02,.4]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),[-.05,0,.05].map((e,t)=>(0,n.jsx)("group",{position:[e,.15,.25],rotation:[-Math.PI,0,0],children:(0,n.jsxs)("group",{children:[r(.15,.02),(0,n.jsx)("group",{position:[0,-.1,0],rotation:[Math.PI/6,0,0],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("coneGeometry",{args:[.02,.15,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#d4d4d4",roughness:.3,metalness:.4})]})})]})},t))]})]})]})]})]})})}function tU(e){let{isLeftHand:t=!1}=e,r=(e,t)=>(0,n.jsx)("mesh",{geometry:tz,material:tD,scale:[t/.04,e,t/.04]}),i=e=>(0,n.jsx)("mesh",{geometry:tB,material:tD,scale:[e/.06,e/.06,e/.06]}),s=(e,t)=>(0,n.jsxs)("group",{children:[(0,n.jsx)("group",{position:[t/2,0,0],children:r(e,.06)}),(0,n.jsx)("group",{position:[-t/2,0,0],children:r(e,.06)}),(0,n.jsx)("group",{position:[0,e/2,0],children:i(.08)}),(0,n.jsx)("group",{position:[0,-e/2,0],children:i(.08)})]});return(0,n.jsx)("group",{children:(0,n.jsxs)("group",{children:[s(1.3,.15),(0,n.jsxs)("group",{position:[.25,-.875,.21],scale:[.8,.8,1.1],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.12,12,12]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("group",{rotation:[-.7,-0,Math.PI/5],children:[s(.8,.12),(0,n.jsxs)("group",{position:[0,-.5,0],rotation:[0,0,Math.PI/5.5],children:[i(.09),(0,n.jsxs)("group",{position:[0,-.1,0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("boxGeometry",{args:[.2,.15,.08]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4})]}),[-.08,-.04,0,.04,.08].map((e,t)=>(0,n.jsxs)("group",{position:[e,-.1,0],rotation:[0,0,(t-2)*Math.PI/10],children:[r(.5,.02),(0,n.jsx)("group",{position:[.025,-.3,0],rotation:[0,0,Math.PI+Math.PI/16],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("coneGeometry",{args:[.03,.3,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#d4d4d4",roughness:.3,metalness:.4})]})})]},t)),!t&&(0,n.jsx)("group",{position:[0,0,.1],rotation:[Math.PI,Math.PI/4,Math.PI/1.65],scale:[2.5,2.5,2.5],children:(0,n.jsx)(tY,{isLeftHand:!0})})]})]})]})]})]})})}function tQ(){return(0,n.jsx)("group",{children:(0,n.jsxs)("group",{children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.123,.19,.175,6,1,!1,0,2*Math.PI]}),(0,n.jsx)("meshStandardMaterial",{color:"#97EFFF",roughness:.4,metalness:.3})]}),[0,1,2,3,4,5].map(e=>(0,n.jsxs)("group",{rotation:[0,e*Math.PI/3,0],children:[(0,n.jsxs)("mesh",{position:[.11,0,0],rotation:[0,Math.PI/6,0],children:[(0,n.jsx)("boxGeometry",{args:[.12,.19,.02]}),(0,n.jsx)("meshStandardMaterial",{color:"#97EFFF",roughness:.5,metalness:.4})]}),(0,n.jsxs)("mesh",{position:[.07,.05,0],rotation:[0,Math.PI/6,0],children:[(0,n.jsx)("boxGeometry",{args:[.035,.24,.015]}),(0,n.jsx)("meshStandardMaterial",{color:"#c0c0c0",roughness:.3,metalness:.5})]})]},e)),(0,n.jsxs)("mesh",{position:[0,.22,0],rotation:[0,.25,Math.PI/2],children:[(0,n.jsx)("torusGeometry",{args:[.2,.035,3,5]}),(0,n.jsx)("meshStandardMaterial",{color:"#97EFFF",roughness:.3,metalness:.5})]}),(0,n.jsxs)("mesh",{position:[0,0,0],rotation:[Math.PI/2,Math.PI,Math.PI/2],children:[(0,n.jsx)("torusGeometry",{args:[.16,.02,4,5]}),(0,n.jsx)("meshStandardMaterial",{color:"#00D9FF",roughness:.3,metalness:.5})]}),(0,n.jsxs)("mesh",{position:[0,-.1,0],rotation:[Math.PI/2,Math.PI,Math.PI/2],children:[(0,n.jsx)("torusGeometry",{args:[.2,.02,4,5]}),(0,n.jsx)("meshStandardMaterial",{color:"#00D9FF",roughness:.3,metalness:.5})]}),(0,n.jsxs)("mesh",{position:[0,.1,0],rotation:[Math.PI/2,Math.PI,Math.PI/2],children:[(0,n.jsx)("torusGeometry",{args:[.175,.0175,6,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#00D9FF",roughness:.3,metalness:.5})]})]})})}function tY(e){let{isLeftHand:t=!1}=e;return(0,n.jsxs)("group",{rotation:[0,0,t?Math.PI:-Math.PI/3],children:[(0,n.jsx)("mesh",{geometry:tL,children:(0,n.jsx)("meshStandardMaterial",{color:"#4a2105",roughness:.6,metalness:.2})}),[.3,.6,.9].map((e,t)=>(0,n.jsx)("group",{position:[0,e,0],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("torusGeometry",{args:[.075,.03,3,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#c0c0c0",metalness:.7,roughness:.3})]})},t)),(0,n.jsxs)("group",{position:[0,1.25,0],children:[(0,n.jsx)("mesh",{geometry:tq,material:tG}),(0,n.jsx)("pointLight",{color:"#4169E1",intensity:1.5,distance:4,decay:2}),[0,1].map(e=>{let t=Math.PI*e;return(0,n.jsx)("group",{rotation:[0,t,0],position:[.3*Math.cos(t),.1*Math.sin(e*Math.PI),.3*Math.sin(t)],children:(0,n.jsx)("mesh",{geometry:tq,material:tG})},e)})]})]})}function tZ(){return(0,n.jsxs)("group",{children:[(0,n.jsxs)("mesh",{position:[0,-.15,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.17,.45,1.65,6]}),(0,n.jsx)("meshStandardMaterial",{...tA})]}),(0,n.jsxs)("mesh",{position:[0,0,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.285,.285,.135,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#6b0fb3",metalness:.3,roughness:.6})]}),[-1,1].map(e=>(0,n.jsx)("group",{position:[.3*e,.5,0],rotation:[0,5,.1*e],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.1,.125,.3,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#2a0845",roughness:.7,transparent:!0,opacity:.75})]})},e))]})}function tK(e){let{isUpper:t=!0}=e,r=(0,i.useMemo)(()=>{let e=t?5:4,r=t?tW.tooth:tW.lowerTooth,n=new m.ZLX(r,tH.bone,e);return n.instanceMatrix.setUsage(m.Vnu),n},[t]);return(0,i.useEffect)(()=>{(t?[-.03,-.06,-.09,0,.03]:[-.06,-.02,.02,.06]).forEach((e,n)=>{tC.set(e,t?-.25:-.18,.2),tR.set(t?.5:2.5,0,0),tk.set(1,1,1),t_(r,n,tC,tR,tk)}),r.instanceMatrix.needsUpdate=!0},[r,t]),(0,n.jsx)("primitive",{object:r})}function tV(){let e=(0,i.useMemo)(()=>{let e=new m.ZLX(tW.vertebrae,tH.bone,5);return e.instanceMatrix.setUsage(m.Vnu),e},[]);return(0,i.useEffect)(()=>{[.15,.27,.39,.51,.63].forEach((t,r)=>{tC.set(0,t,0),tR.set(0,0,0),tk.set(1,1,1),t_(e,r,tC,tR,tk)}),e.instanceMatrix.needsUpdate=!0},[e]),(0,n.jsx)("primitive",{object:e})}function t$(e){let{position:t,isAttacking:r,isWalking:s,onHit:o}=e,a=(0,i.useRef)(null),[l,c]=(0,i.useState)(0),[u,h]=(0,i.useState)(0),d=(0,i.useRef)(),m=(0,i.useMemo)(()=>({walkSpeed:3,attackSpeed:.6,walkHeightMultiplier:.1,armSwingMultiplier:.3,legSwingMultiplier:.4}),[]);return(0,f.F)((e,n)=>{if(a.current){if(s){let e=(l+n*m.walkSpeed)%(2*Math.PI);c(e);let r=Math.abs(Math.sin(e)*m.walkHeightMultiplier);a.current.position.y=t[1]-r,["LeftLeg","RightLeg"].forEach(t=>{var r,n;let i=null===(r=a.current)||void 0===r?void 0:r.getObjectByName(t);if(i){let r=t.includes("Right")?e:e+Math.PI,s=.4*Math.sin(r);i.rotation.x=s;let o=null===(n=i.children[0])||void 0===n?void 0:n.children[1];if(o){let e=Math.max(0,Math.sin(r+Math.PI/4));o.rotation.x=.2+.8*e;let t=.1*Math.sin(r);o.rotation.y=t}let a=.05*Math.sin(r);i.rotation.y=a}}),["LeftArm","RightArm"].forEach(t=>{var r;let n=null===(r=a.current)||void 0===r?void 0:r.getObjectByName(t);if(n){let r=Math.sin(t.includes("Right")?e+Math.PI:e)*m.armSwingMultiplier;n.rotation.x=r}})}if(r){h(e=>e+n*m.attackSpeed);let e=Math.sin(Math.min(u,Math.PI/4))*Math.PI,t=a.current.getObjectByName("RightArm");t&&(t.rotation.x=-e),u>Math.PI/4&&o&&!d.current&&(d.current=setTimeout(()=>{d.current=void 0},0)),u>Math.PI/4&&h(0)}else d.current&&(clearTimeout(d.current),d.current=void 0)}}),(0,i.useEffect)(()=>()=>{d.current&&clearTimeout(d.current)},[]),(0,n.jsxs)("group",{ref:a,position:[t[0],t[1],t[2]],scale:[.925,.935,.8],children:[(0,n.jsx)("group",{position:[0,.775,.025],children:(0,n.jsx)(tZ,{})}),(0,n.jsx)("group",{name:"Body",position:[0,1.15,0],scale:[.9,.75,.775],rotation:[-.2,0,0],children:(0,n.jsx)(_,{})}),(0,n.jsx)("group",{children:[0,1].map(e=>(0,n.jsx)("group",{rotation:[0,Math.PI*e,0],position:[0,1.3,0],children:(0,n.jsx)("mesh",{geometry:tO,material:tG})},e))}),Array.from({length:4}).map((e,t)=>(0,n.jsxs)("group",{position:[.2*Math.sin(t*Math.PI/2),1.25+.3*Math.cos(t*Math.PI),.5*Math.cos(t*Math.PI/2)],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.01,6,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#4169E1",emissive:"#4169E1",emissiveIntensity:2,transparent:!0,opacity:.7})]}),(0,n.jsx)("pointLight",{color:"#4169E1",intensity:.5,distance:1,decay:2})]},t)),(0,n.jsxs)("group",{name:"Head",position:[0,1.7,.1],scale:[.75,.8,.8],children:[(0,n.jsxs)("group",{children:[(0,n.jsxs)("mesh",{position:[0,0,-.05],children:[(0,n.jsx)("sphereGeometry",{args:[.22,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("mesh",{position:[0,-.02,.12],children:[(0,n.jsx)("boxGeometry",{args:[.28,.28,.1]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("group",{children:[(0,n.jsxs)("mesh",{position:[.12,-.08,.1],children:[(0,n.jsx)("boxGeometry",{args:[.08,.12,.15]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("mesh",{position:[-.12,-.08,.1],children:[(0,n.jsx)("boxGeometry",{args:[.08,.12,.15]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]})]}),(0,n.jsx)("group",{position:[0,-.15,.05],children:(0,n.jsxs)("mesh",{position:[0,-.08,.08],rotation:[0,Math.PI/5,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.08,.08,.2,5]}),(0,n.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]})}),(0,n.jsx)("group",{position:[.025,-.25,.2175],children:(0,n.jsx)(tK,{isUpper:!0})}),(0,n.jsx)("group",{position:[0,-.18,.2],children:(0,n.jsx)(tK,{isUpper:!1})})]}),(0,n.jsxs)("group",{position:[0,.05,.14],children:[(0,n.jsxs)("group",{position:[-.07,0,0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.02,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#2FFF00",emissive:"#2FFF00",emissiveIntensity:3})]}),(0,n.jsxs)("mesh",{scale:1.2,children:[(0,n.jsx)("sphereGeometry",{args:[.035,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#2FFF00",emissive:"#2FFF00",emissiveIntensity:1,transparent:!0,opacity:.75})]}),(0,n.jsxs)("mesh",{scale:1.4,children:[(0,n.jsx)("sphereGeometry",{args:[.05,6.5,2]}),(0,n.jsx)("meshStandardMaterial",{color:"#2FFF00",emissive:"#2FFF00",emissiveIntensity:1,transparent:!0,opacity:.7})]}),(0,n.jsx)("pointLight",{color:"#FF4C4C",intensity:.5,distance:1,decay:2})]}),(0,n.jsxs)("group",{position:[.07,0,0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.02,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#2FFF00",emissive:"#2FFF00",emissiveIntensity:3})]}),(0,n.jsxs)("mesh",{scale:1.2,children:[(0,n.jsx)("sphereGeometry",{args:[.035,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#2FFF00",emissive:"#2FFF00",emissiveIntensity:1,transparent:!0,opacity:.75})]}),(0,n.jsxs)("mesh",{scale:1.4,children:[(0,n.jsx)("sphereGeometry",{args:[.05,6.5,2]}),(0,n.jsx)("meshStandardMaterial",{color:"#2FFF00",emissive:"#2FFF00",emissiveIntensity:1,transparent:!0,opacity:.7})]}),(0,n.jsx)("pointLight",{color:"#FF4C4C",intensity:.5,distance:1,decay:1})]})]})]}),(0,n.jsx)("group",{position:[-.36,1.475,0],rotation:[-.15,-Math.PI-.4,-.35],children:(0,n.jsx)(tQ,{})}),(0,n.jsx)("group",{position:[.36,1.475,0],rotation:[-.15,Math.PI-.4,.35],children:(0,n.jsx)(tQ,{})}),(0,n.jsx)("group",{name:"LeftArm",position:[-.35,1.325,0],scale:[-.4,.4,.4],rotation:[0,Math.PI/3,0],children:(0,n.jsx)(tU,{isLeftHand:!0})}),(0,n.jsx)("group",{name:"RightArm",position:[.35,1.325,.1],scale:[.4,.4,.4],rotation:[0,-Math.PI/2.5,0],children:(0,n.jsx)(tU,{isLeftHand:!1})}),(0,n.jsxs)("group",{position:[0,.7,0],scale:[1.4,1,.8],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.21,.2,.2,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]}),(0,n.jsx)("group",{position:[0,.15,-.16],rotation:[.1,0,0],children:(0,n.jsx)(tV,{})}),[-1,1].map(e=>(0,n.jsx)("group",{position:[.15*e,-.1,0],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.075,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]})},e))]}),(0,n.jsx)("group",{name:"LeftLeg",position:[.2,.36,0],children:(0,n.jsx)(tN,{})}),(0,n.jsx)("group",{name:"RightLeg",position:[-.2,.36,0],children:(0,n.jsx)(tN,{})}),(0,n.jsx)("group",{position:[0,1.2,0],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.04,.04,.2,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]})})]})}let tX=e=>{let{color:t,size:r,meshRef:s,opacity:o=1}=e,a=(0,i.useRef)(null),l=(0,i.useRef)(new Float32Array(54)),c=(0,i.useRef)(new Float32Array(18)),u=(0,i.useRef)(new Float32Array(18)),h=(0,i.useRef)(!1);return(0,i.useEffect)(()=>{if(s.current&&!h.current){let{x:e,y:t,z:r}=s.current.position;for(let n=0;n<18;n++)l.current[3*n]=e,l.current[3*n+1]=t,l.current[3*n+2]=r,c.current[n]=0,u.current[n]=0;h.current=!0}},[s]),(0,f.F)(()=>{var e;if(!(null===(e=a.current)||void 0===e?void 0:e.parent)||!s.current||!h.current)return;let{x:t,y:n,z:i}=s.current.position;for(let e=17;e>0;e--)l.current[3*e]=l.current[(e-1)*3],l.current[3*e+1]=l.current[(e-1)*3+1],l.current[3*e+2]=l.current[(e-1)*3+2],c.current[e]=.8*Math.pow(1-e/18,1.5)*o,u.current[e]=.6*r*Math.pow(1-e/18,.8);if(l.current[0]=t,l.current[1]=n,l.current[2]=i,c.current[0]=.8*o,u.current[0]=1.5*r,a.current){let e=a.current.geometry;e.attributes.position.array=l.current,e.attributes.position.needsUpdate=!0,e.attributes.opacity&&(e.attributes.opacity.array=c.current,e.attributes.opacity.needsUpdate=!0),e.attributes.scale&&(e.attributes.scale.array=u.current,e.attributes.scale.needsUpdate=!0)}}),(0,i.useEffect)(()=>{let e=a.current;return()=>{e&&(e.geometry.dispose(),e.material.dispose())}},[]),(0,n.jsxs)("points",{ref:a,children:[(0,n.jsxs)("bufferGeometry",{children:[(0,n.jsx)("bufferAttribute",{attach:"attributes-position",count:18,array:l.current,itemSize:3}),(0,n.jsx)("bufferAttribute",{attach:"attributes-opacity",count:18,array:c.current,itemSize:1}),(0,n.jsx)("bufferAttribute",{attach:"attributes-scale",count:18,array:u.current,itemSize:1})]}),(0,n.jsx)("shaderMaterial",{transparent:!0,depthWrite:!1,blending:m.EZo,vertexShader:"\n          attribute float opacity;\n          attribute float scale;\n          varying float vOpacity;\n          void main() {\n            vOpacity = opacity;\n            vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n            gl_Position = projectionMatrix * mvPosition;\n            gl_PointSize = scale * 17.0 * (300.0 / -mvPosition.z);\n          }\n        ",fragmentShader:"\n          varying float vOpacity;\n          uniform vec3 uColor;\n          void main() {\n            float d = length(gl_PointCoord - vec2(0.5));\n            float strength = smoothstep(0.4, 0.1, d);\n            vec3 glowColor = mix(uColor, vec3(1.0), 0.3);\n            gl_FragColor = vec4(glowColor, vOpacity * strength);\n          }\n        ",uniforms:{uColor:{value:t}}})]})};function tJ(e){let{position:t,target:r,onHit:s,playerPosition:o}=e,a=(0,i.useRef)(null),l=(0,i.useRef)(null),c=r.clone().sub(t).normalize(),[u,h]=(0,i.useState)(!1),[d,p]=(0,i.useState)(null),[,x]=(0,i.useState)({}),g=(0,i.useRef)(!1);return(0,f.F)(()=>{if(a.current){if(u){x({}),g.current||(g.current=!0,s(!0)),d&&Date.now()-d>200&&s(!1);return}if(a.current.position.add(c.clone().multiplyScalar(.25)),1.175>a.current.position.distanceTo(o)){h(!0),p(Date.now());return}if(1.175>a.current.position.distanceTo(r)){1.175>o.distanceTo(r)?(h(!0),p(Date.now())):s(!1);return}a.current.position.distanceTo(t)>300&&s(!1)}}),(0,i.useEffect)(()=>{let e=l.current;return()=>{e&&(e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose())}},[]),(0,n.jsx)("group",{ref:a,position:t,children:u?(0,n.jsx)(n.Fragment,{children:(()=>{let e=d?(Date.now()-d)/1e3:0,t=Math.max(0,1-e/.2);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.45*(1+2*e),32,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#ff3333",emissive:"#ff4444",emissiveIntensity:2*t,transparent:!0,opacity:.8*t,depthWrite:!1,blending:m.EZo})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.4*(1+3*e),24,24]}),(0,n.jsx)("meshStandardMaterial",{color:"#ff6666",emissive:"#ffffff",emissiveIntensity:3*t,transparent:!0,opacity:.9*t,depthWrite:!1,blending:m.EZo})]}),[.45,.675,.9,1.175].map((r,i)=>(0,n.jsxs)("mesh",{rotation:[Math.random()*Math.PI,Math.random()*Math.PI,Math.random()*Math.PI],children:[(0,n.jsx)("torusGeometry",{args:[r*(1+3*e),.045,16,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#ff3333",emissive:"#ff4444",emissiveIntensity:.8*t,transparent:!0,opacity:.5*t*(1-.2*i),depthWrite:!1,blending:m.EZo})]},i)),[void 0,void 0,void 0,void 0].map((r,i)=>{let s=i/4*Math.PI*2,o=.5*(1+2*e);return(0,n.jsxs)("mesh",{position:[Math.sin(s)*o,Math.cos(s)*o,0],children:[(0,n.jsx)("sphereGeometry",{args:[.05,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#ff6666",emissive:"#ffffff",emissiveIntensity:2*t,transparent:!0,opacity:.8*t,depthWrite:!1,blending:m.EZo})]},"spark-".concat(i))}),(0,n.jsx)("pointLight",{color:"#ff3333",intensity:2*t,distance:4,decay:2}),(0,n.jsx)("pointLight",{color:"#ff6666",intensity:1*t,distance:6,decay:1})]})})()}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("mesh",{ref:l,children:[(0,n.jsx)("sphereGeometry",{args:[.2,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#ff3333",emissive:"#ff0000",emissiveIntensity:2,transparent:!0,opacity:.9})]}),(0,n.jsx)(tX,{color:new m.Q1f("#ff3333"),size:.235,meshRef:l,opacity:.8}),(0,n.jsx)("pointLight",{color:"#ff3333",intensity:2,distance:3,decay:2})]})})}let t0=i.memo(function(e){let{id:t,initialPosition:r,position:s,health:o,maxHealth:a,onTakeDamage:l,onPositionUpdate:c,playerPosition:u,onAttackPlayer:h,weaponType:d}=e,p=(0,i.useRef)(null),[x,g]=(0,i.useState)(!1),[y,j]=(0,i.useState)(!1),[M,v]=(0,i.useState)(!0),[w,P]=(0,i.useState)(!1),[S,I]=(0,i.useState)(!1),F=(0,i.useRef)(Date.now()+2e3),[E,C]=(0,i.useState)([]),[R,k]=(0,i.useState)([]),T=(0,i.useRef)(r.clone()),_=(0,i.useRef)(r.clone()),D=(0,i.useRef)(Date.now()),G=(0,i.useRef)(o),A=(0,i.useRef)(new m.Pq0),B=(0,i.useRef)(null),z=(0,i.useRef)(Date.now());(0,i.useEffect)(()=>{G.current=o},[o]);let L=(0,i.useCallback)((e,r)=>{if(G.current<=0)return;let n=Math.max(0,G.current-e);if(l("enemy-".concat(t),e),r.type&&q.hasShadowStrikeBuff()){let e=new m.Pq0().subVectors(T.current,u).normalize();k(t=>[...t,{id:Date.now(),type:"stealthStrike",position:T.current.clone(),direction:e,duration:.2,startTime:Date.now()}])}0===n&&G.current>0&&(j(!0),g(!0))},[t,l,u]);(0,i.useEffect)(()=>{s&&(_.current.copy(s),_.current.y=0)},[s]);let O=(0,i.useCallback)(()=>{S||y||(I(!0),setTimeout(()=>{if(p.current){let e=T.current.clone();e.y+=1.5,C(t=>[...t,{id:Date.now(),position:e,target:u.clone()}])}setTimeout(()=>{I(!1)},500)},1e3))},[S,y,u]),W=(0,i.useCallback)(()=>{if(!p.current)return null;let e=Math.random()*Math.PI*2,t=5*Math.random();return new m.Pq0(T.current.x+Math.cos(e)*t,0,T.current.z+Math.sin(e)*t)},[]);return(0,f.F)((e,r)=>{if(!p.current||G.current<=0||!u){P(!1);return}if(q.isUnitStealthed()){P(!1),I(!1);let e=Date.now();if(!B.current||e-z.current>4500){if(B.current){let e=new m.Pq0().subVectors(B.current,T.current).normalize(),t=new m.Pq0().copy(T.current).add(e.multiplyScalar(5));B.current=t}else B.current=W();z.current=e}if(B.current){P(!0);let e=new m.Pq0().subVectors(B.current,T.current).normalize(),t=e.multiplyScalar(1.5*r);A.current.lerp(t,3*r),T.current.add(A.current),T.current.y=0,p.current.position.copy(T.current);let n=Math.atan2(e.x,e.z)-p.current.rotation.y;for(;n>Math.PI;)n-=2*Math.PI;for(;n<-Math.PI;)n+=2*Math.PI;p.current.rotation.y+=n*Math.min(1,4*r)}return}let n=T.current.distanceTo(u);if(n>18&&G.current>0){var i;P(!0);let e=new m.Pq0().subVectors(u,T.current).normalize(),t=new m.Pq0;((null===(i=p.current.parent)||void 0===i?void 0:i.children.filter(e=>e!==p.current&&e.position&&1.25>e.position.distanceTo(T.current)))||[]).forEach(e=>{let r=T.current.clone().setY(0),n=e.position.clone().setY(0),i=new m.Pq0().subVectors(r,n).normalize().multiplyScalar(.155/Math.max(.1,n.distanceTo(r)));t.add(i)});let n=e.add(t).normalize();n.y=0;let s=n.multiplyScalar(2.1*r);A.current.lerp(s,6*r),T.current.add(A.current),T.current.y=0,p.current.position.copy(T.current);let o=new m.Pq0().copy(u).setY(T.current.y),a=Math.atan2(o.x-T.current.x,o.z-T.current.z)-p.current.rotation.y;for(;a>Math.PI;)a-=2*Math.PI;for(;a<-Math.PI;)a+=2*Math.PI;p.current.rotation.y+=a*Math.min(1,7*r)}else P(!1),A.current.multiplyScalar(1-7*r),A.current.length()>.001&&(T.current.add(A.current),p.current.position.copy(T.current));Date.now()-F.current>=3600&&n<=18&&(O(),F.current=Date.now());let o=Date.now();o-D.current>=35&&T.current.distanceTo(s)>.1&&(c(t,T.current.clone()),D.current=o)}),(0,i.useEffect)(()=>{0===o&&!y&&(j(!0),g(!0),p.current&&(p.current.visible=!0))},[o,y]),(0,i.useEffect)(()=>{if(y){let e=setTimeout(()=>{var e;g(!1),(null===(e=p.current)||void 0===e?void 0:e.parent)&&p.current.parent.remove(p.current)},3e3);return()=>clearTimeout(e)}},[y]),(0,i.useEffect)(()=>{s&&M&&(T.current.copy(s),T.current.y=0,_.current.copy(T.current),p.current&&p.current.position.copy(T.current))},[s,M]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("group",{ref:p,visible:!M&&G.current>0,position:T.current,onClick:e=>{e.stopPropagation()},children:[(0,n.jsx)(t$,{position:[0,.76,0],isAttacking:S,isWalking:w&&G.current>0,onHit:e=>L(e,{type:d})}),S&&(0,n.jsxs)("group",{position:[.4,2.265,0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.125,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#ff3333",emissive:"#ff0000",emissiveIntensity:1,transparent:!0,opacity:.8})]}),(0,n.jsx)("pointLight",{color:"#ff3333",intensity:2,distance:3})]}),S&&(0,n.jsxs)("group",{position:[-.4,2.265,-.05],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.125,16,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#ff3333",emissive:"#ff0000",emissiveIntensity:2,transparent:!0,opacity:.7})]}),(0,n.jsx)("pointLight",{color:"#ff3333",intensity:2,distance:3})]}),(0,n.jsx)(eK.Q,{position:[0,3.5,0],follow:!0,lockX:!1,lockY:!1,lockZ:!1,children:G.current>0&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("mesh",{position:[0,0,0],children:[(0,n.jsx)("planeGeometry",{args:[2,.25]}),(0,n.jsx)("meshBasicMaterial",{color:"#333333",opacity:.8,transparent:!0})]}),(0,n.jsxs)("mesh",{position:[-1+G.current/a,0,.001],children:[(0,n.jsx)("planeGeometry",{args:[G.current/a*2,.23]}),(0,n.jsx)("meshBasicMaterial",{color:"#ff3333",opacity:.9,transparent:!0})]}),(0,n.jsx)(b.E,{position:[0,0,.002],fontSize:.2,color:"#ffffff",anchorX:"center",anchorY:"middle",fontWeight:"bold",children:"".concat(Math.ceil(G.current),"/").concat(a)})]})})]}),M&&(0,n.jsx)(ts,{position:T.current,onComplete:()=>{v(!1)},isSpawning:!0}),x&&(0,n.jsx)(tl,{position:T.current,onComplete:()=>{g(!1)},isSpawning:!1,weaponType:d}),E.map(e=>(0,n.jsx)(tJ,{position:e.position,target:e.target,playerPosition:u,onHit:t=>{C(t=>t.filter(t=>t.id!==e.id)),t&&h(22)}},e.id)),R.map(e=>"stealthStrike"===e.type?(0,n.jsx)(ek,{position:e.position,direction:e.direction,onComplete:()=>{k(t=>t.filter(t=>t.id!==e.id))},parentRef:p},e.id):null)]})},(e,t)=>e.health===t.health&&e.position.equals(t.position)&&e.playerPosition.equals(t.playerPosition));tc.mage,tu.mage;let t1=e=>{let{parentRef:t}=e,r=(0,i.useRef)(null),s=(0,i.useRef)(new Float32Array(36)),o=(0,i.useRef)(new Float32Array(12)),a=(0,i.useRef)(new Float32Array(12)),l=(0,i.useRef)(0);return(0,f.F)((e,n)=>{var i;if(!(null===(i=r.current)||void 0===i?void 0:i.parent)||!t.current)return;l.current+=n;let c=t.current.position;for(let e=0;e<12;e++){let t=Math.acos(-1+2*e/12),r=Math.sqrt(12*Math.PI)*t+l.current,n=.8+.1*Math.sin(2*l.current+.2*e);s.current[3*e]=c.x+n*Math.cos(r)*Math.sin(t),s.current[3*e+1]=c.y+n*Math.sin(r)*Math.sin(t),s.current[3*e+2]=c.z+n*Math.cos(t),o.current[e]=.3*Math.pow(1-e/12,1.2),a.current[e]=.4*Math.pow(1-e/12,.5)}if(r.current){let e=r.current.geometry;e.attributes.position.needsUpdate=!0,e.attributes.opacity.needsUpdate=!0,e.attributes.scale.needsUpdate=!0}}),(0,n.jsxs)("points",{ref:r,children:[(0,n.jsxs)("bufferGeometry",{children:[(0,n.jsx)("bufferAttribute",{attach:"attributes-position",count:12,array:s.current,itemSize:3}),(0,n.jsx)("bufferAttribute",{attach:"attributes-opacity",count:12,array:o.current,itemSize:1}),(0,n.jsx)("bufferAttribute",{attach:"attributes-scale",count:12,array:a.current,itemSize:1})]}),(0,n.jsx)("shaderMaterial",{transparent:!0,depthWrite:!1,blending:m.EZo,vertexShader:"\n          attribute float opacity;\n          attribute float scale;\n          varying float vOpacity;\n          void main() {\n            vOpacity = opacity;\n            vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n            gl_Position = projectionMatrix * mvPosition;\n            gl_PointSize = scale * 25.0 * (300.0 / -mvPosition.z); // Larger point size\n          }\n        ",fragmentShader:"\n          varying float vOpacity;\n          void main() {\n            float d = length(gl_PointCoord - vec2(0.5));\n            float strength = smoothstep(0.5, 0.1, d);\n            vec3 glowColor = mix(vec3(0.5, 0.0, 0.5), vec3(0.8, 0.0, 0.8), 0.4); // Purple color\n            gl_FragColor = vec4(glowColor, vOpacity * strength);\n          }\n        "})]})};function t2(){let e={roughness:.4,metalness:.3,transparent:!0,opacity:.95};return(0,n.jsx)("group",{children:[-.89,.89].map(t=>(0,n.jsxs)("group",{position:[.56*t,.625,-.75],rotation:[-1.35,0,3.025*t],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.08,.0125,1]}),(0,n.jsx)("meshStandardMaterial",{color:"#d4d4d4",...e})]}),(0,n.jsxs)("group",{position:[0,1.35,-0],scale:1.6,rotation:[-.65,0,0],children:[[-.07,-.02,.02,.07].map((t,r)=>(0,n.jsx)("group",{position:[t,.125,-.15],rotation:[2,0,0],scale:[1,1.5,1.2],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("coneGeometry",{args:[.02,.075,3]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",...e})]})},"upper-".concat(r))),[-.08,-.015,.015,.09].map((t,r)=>(0,n.jsx)("group",{position:[t,.01075,0],rotation:[-.45,0,0],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("coneGeometry",{args:[.025*(0===r||3===r?1.3:1),.095*(0===r||3===r?1.5:1),3]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",...e})]})},"lower-".concat(r)))]}),(0,n.jsxs)("group",{position:[0,.4,.2],rotation:[-.05,0,.3*t],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.08,.008,.8,32,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#c4c4c4",...e})]}),[void 0,void 0,void 0,void 0,void 0].map((r,i)=>(0,n.jsx)("group",{position:[.02*t,.095*i,.07],rotation:[Math.PI/1.5,0,0],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("coneGeometry",{args:[.0325,.1,32,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#b4b4b4",...e})]})},i))]}),(0,n.jsx)("group",{position:[0,1.0225,.3],rotation:[-.925,0,.5*t],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.07,.0075,.6,5]}),(0,n.jsx)("meshStandardMaterial",{color:"#b4b4b4",...e})]})})]},t))})}let t5=new m.kn4,t3=new m.Pq0,t4=new m.O9p,t8=new m.Pq0,t6=new m.PTz;function t7(e,t,r,n,i){t6.setFromEuler(n),t5.compose(r,t6,i),e.setMatrixAt(t,t5)}let t9={sphere:new m.Gu$(.02,8,8),cylinder:new m.Ho_(.04,.032,1,4),cone:new m.qFE(.02,.15,4),box:new m.iNn(.2,.15,.08),vertebrae:new m.Ho_(.0225,.0225,.03,6),eye:new m.Gu$(.02,8,8),eyeGlow:new m.Gu$(.035,8,8),eyeOuterGlow:new m.Gu$(.05,6.5,2)},re={standardBone:new m._4j({color:"#e8e8e8",roughness:.4,metalness:.3}),darkBone:new m._4j({color:"#d4d4d4",roughness:.3,metalness:.4}),eyeCore:new m._4j({color:"#2FFF00",emissive:"#2FFF00",emissiveIntensity:3}),eyeGlow:new m._4j({color:"#2FFF00",emissive:"#2FFF00",emissiveIntensity:1,transparent:!0,opacity:.75}),eyeOuterGlow:new m._4j({color:"#2FFF00",emissive:"#2FFF00",emissiveIntensity:1,transparent:!0,opacity:.7})};function rt(){let e=(0,i.useMemo)(()=>{let e=new m.ZLX(t9.vertebrae,re.standardBone,5);return e.instanceMatrix.setUsage(m.Vnu),e},[]);return(0,i.useEffect)(()=>{[.15,.27,.39,.51,.63].forEach((t,r)=>{t3.set(0,t,0),t4.set(.1,0,0),t8.set(1,1,1),t7(e,r,t3,t4,t8)}),e.instanceMatrix.needsUpdate=!0},[e]),(0,n.jsx)("primitive",{object:e})}function rr(e){let{position:t}=e,r=(0,i.useMemo)(()=>({core:new m.ZLX(t9.eye,re.eyeCore,1),innerGlow:new m.ZLX(t9.eyeGlow,re.eyeGlow,1),outerGlow:new m.ZLX(t9.eyeOuterGlow,re.eyeOuterGlow,1)}),[]);return(0,i.useEffect)(()=>{t3.set(...t),t4.set(0,0,0),t7(r.core,0,t3,t4,t8.set(1,1,1)),t7(r.innerGlow,0,t3,t4,t8.set(1.2,1.2,1.2)),t7(r.outerGlow,0,t3,t4,t8.set(1.4,1.4,1.4)),Object.values(r).forEach(e=>{e.instanceMatrix.needsUpdate=!0})},[r,t]),(0,n.jsxs)("group",{children:[(0,n.jsx)("primitive",{object:r.core}),(0,n.jsx)("primitive",{object:r.innerGlow}),(0,n.jsx)("primitive",{object:r.outerGlow}),(0,n.jsx)("pointLight",{color:"#FF4C4C",intensity:.5,distance:1,decay:2,position:t})]})}function rn(){let e=(e,t)=>(0,n.jsx)("mesh",{geometry:t9.cylinder,material:re.standardBone,scale:[t/.04,e,t/.04]}),t=e=>(0,n.jsx)("mesh",{geometry:t9.sphere,material:re.standardBone,scale:[e/.06,e/.06,e/.06]});return(0,n.jsxs)("group",{children:[t(.08),(0,n.jsxs)("group",{rotation:[.3,0,0],children:[e(.4,.07),(0,n.jsxs)("group",{position:[0,-.2,0],children:[t(.09),(0,n.jsxs)("group",{position:[0,0,-.5],children:[e(.8,.06),(0,n.jsxs)("group",{position:[0,-.4,0],children:[t(.05),(0,n.jsxs)("group",{position:[0,0,0],children:[e(.9,.04),(0,n.jsxs)("group",{position:[0,-.45,0],children:[t(.04),(0,n.jsxs)("group",{position:[0,0,0],children:[e(.7,.03),(0,n.jsx)("group",{position:[0,-.35,0],children:(0,n.jsx)("mesh",{geometry:t9.cone,material:re.darkBone})})]})]})]})]})]})]})]})]})}function ri(e){let{isLeftHand:t=!1}=e,r=(e,t)=>(0,n.jsx)("mesh",{geometry:t9.cylinder,material:re.standardBone,scale:[t/.04,e,t/.04]}),i=e=>(0,n.jsx)("mesh",{geometry:t9.sphere,material:re.standardBone,scale:[e/.06,e/.06,e/.06]}),s=(e,t)=>(0,n.jsxs)("group",{children:[(0,n.jsx)("group",{position:[t/2,0,0],children:r(e,.06)}),(0,n.jsx)("group",{position:[-t/2,0,0],children:r(e,.06)}),(0,n.jsx)("group",{position:[0,e/2,0],children:i(.08)}),(0,n.jsx)("group",{position:[0,-e/2,0],children:i(.08)})]}),o=(()=>{let e=new m.ypk;return e.moveTo(0,0),e.lineTo(.4,-.13),e.bezierCurveTo(.8,.22,1.33,.5,1.6,.515),e.lineTo(1.125,.75),e.bezierCurveTo(.5,.2,.225,0,.1,.7),e.lineTo(0,0),e})();return(0,n.jsx)("group",{children:(0,n.jsxs)("group",{children:[s(1.3,.15),(0,n.jsxs)("group",{position:[.25,-.85,.21],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.12,12,12]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("group",{rotation:[-.7,-0,Math.PI/5],children:[s(.8,.12),(0,n.jsxs)("group",{position:[0,-.5,0],rotation:[0,0,Math.PI/5.5],children:[i(.09),(0,n.jsxs)("group",{position:[0,-.1,0],children:[(0,n.jsxs)("group",{position:[-0,-.2,.1],rotation:[2+Math.PI/4,-1,2.675*Math.PI+.85],scale:[1.4,.55,1.4],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("extrudeGeometry",{args:[o,{steps:1,depth:1e-4,bevelEnabled:!0,bevelThickness:.03,bevelSize:.035,bevelSegments:1,curveSegments:16}]}),(0,n.jsx)("meshStandardMaterial",{color:"#9c27b0",emissive:"#9c27b0",emissiveIntensity:1.3,metalness:.8,roughness:.1,opacity:1,transparent:!0,side:m.$EB})]}),(0,n.jsx)("pointLight",{color:"#9c27b0",intensity:1,distance:2,decay:2})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("boxGeometry",{args:[.2,.15,.08]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4})]}),[-.08,-.04,0,.04,.08].map((e,t)=>(0,n.jsxs)("group",{position:[e,-.1,0],rotation:[0,0,(t-2)*Math.PI/10],children:[r(.5,.02),(0,n.jsx)("group",{position:[.025,-.3,0],rotation:[0,0,Math.PI+Math.PI/16],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("coneGeometry",{args:[.03,.3,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#d4d4d4",roughness:.3,metalness:.4})]})})]},t)),!t&&(0,n.jsx)("group",{position:[0,-.2,.3],rotation:[Math.PI/2,0,0],scale:[.8,.8,.8]})]})]})]})]})]})})}function rs(){let e=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return(0,n.jsxs)("group",{scale:[e,e,e],position:[0,-.125,0],children:[(0,n.jsxs)("mesh",{position:[0,0,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.06,.06,.115,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("mesh",{position:[0,.1,.0275],rotation:[0,0,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.04,.03,.12,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("mesh",{position:[0,.2,.04],rotation:[.2,0,0],children:[(0,n.jsx)("coneGeometry",{args:[.04,.175,4]}),(0,n.jsx)("meshStandardMaterial",{color:"#d4d4d4",roughness:.3,metalness:.5})]}),[0,Math.PI/2,Math.PI,3*Math.PI/2].map((e,t)=>(0,n.jsx)("group",{rotation:[0,e,0],children:(0,n.jsxs)("mesh",{position:[.04,.05,0],children:[(0,n.jsx)("boxGeometry",{args:[.01,.12,.02]}),(0,n.jsx)("meshStandardMaterial",{color:"#d4d4d4",roughness:.5,metalness:.3})]})},t))]})};return(0,n.jsxs)("group",{children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.185,.2,.225,4,1]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("group",{position:[0,.25,0],rotation:[2*Math.PI,Math.PI/3,0],children:[(0,n.jsx)("group",{position:[0,0,0],rotation:[0,0,0],children:e(1.5)}),(0,n.jsx)("group",{position:[0,-.05,.15],rotation:[-.2,0,0],children:e(1.1)}),(0,n.jsx)("group",{position:[0,-.05,-.15],rotation:[.2,0,0],children:e(1.1)})]})]})}function ro(e){let{isLeft:t=!1}=e,r=1.2*Math.PI;return(0,n.jsx)("group",{rotation:[-.25,t?-.3:.3,t?-.4:.4],children:Array.from({length:10}).map((e,i)=>{let s=i/9,o=.15*(1-.8*s),a=Math.pow(s,1.2)*r,l=1.4*Math.pow(s,1.3);return(0,n.jsxs)("group",{position:[l*(t?-.15:.15),.12*i,-(.6*l)],rotation:[-.8*s,a,0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[o,.92*o,.12,4]}),(0,n.jsx)("meshStandardMaterial",{color:"rgb(".concat(139-80*s,", ").concat(0+20*s,", ").concat(0+20*s,")"),roughness:.7,metalness:.4})]}),Array.from({length:4}).map((e,t)=>(0,n.jsx)("group",{rotation:[0,t*Math.PI*2/4,0],children:(0,n.jsxs)("mesh",{position:[.95*o,0,0],children:[(0,n.jsx)("boxGeometry",{args:[.4*o,.132,.2*o]}),(0,n.jsx)("meshStandardMaterial",{color:"rgb(".concat(159-100*s,", ").concat(20+20*s,", ").concat(20+20*s,")"),roughness:.8,metalness:.3})]})},t))]},i)})})}function ra(e){let{position:t,isAttacking:r,isWalking:s}=e,o=(0,i.useRef)(null),[a,l]=(0,i.useState)(0),[c,u]=(0,i.useState)(0),h=(0,i.useRef)(),d=[{left:"LeftFrontLeg",right:"RightFrontLeg",baseRotation:{x:.2,y:-.6,z:.6},rightBaseRotation:{x:.2,y:.6,z:-.6},phase:0},{left:"LeftMiddleFrontLeg",right:"RightMiddleFrontLeg",baseRotation:{x:.25,y:-.8,z:.7},rightBaseRotation:{x:.25,y:.8,z:-.7},phase:Math.PI},{left:"LeftMiddleBackLeg",right:"RightMiddleBackLeg",baseRotation:{x:.5,y:-1,z:.7},rightBaseRotation:{x:.5,y:1,z:-.7},phase:0},{left:"LeftBackLeg",right:"RightBackLeg",baseRotation:{x:1,y:-1.2,z:.6},rightBaseRotation:{x:1,y:1.2,z:-.6},phase:Math.PI}];return(0,f.F)((e,t)=>{if(!o.current)return;let n=o.current;if(s){let e=(a+4*t)%(2*Math.PI);l(e),["LeftFrontLeg","RightFrontLeg","LeftMiddleFrontLeg","RightMiddleFrontLeg","LeftMiddleBackLeg","RightMiddleBackLeg","LeftBackLeg","RightBackLeg"].forEach((t,r)=>{let i=n.getObjectByName(t);if(i){var s,o;t.includes("Right");let n=e+(r%2==0?0:Math.PI),a=.3*Math.max(0,Math.sin(n)),l=.2*Math.cos(n);i.rotation.x=l,i.position.y=.6+a;let c=null===(s=i.children[0])||void 0===s?void 0:s.children[1],u=null==c?void 0:null===(o=c.children[1])||void 0===o?void 0:o.children[1];if(c&&u){let e=n+Math.PI/4;c.rotation.x=.4*Math.sin(e)-.2,u.rotation.x=-(.6*Math.sin(e))-.3}}})}if(r){u(e=>e+3*t);let e=[{left:"LeftLowerBackArm",right:"RightLowerBackArm",startTime:.65,rotationRange:.5*Math.PI},{left:"LeftMiddleBackArm",right:"RightMiddleBackArm",startTime:.95,rotationRange:.5*Math.PI},{left:"LeftUpperBackArm",right:"RightUpperBackArm",startTime:1.25,rotationRange:.5*Math.PI},{left:"LeftFrontArm",right:"RightFrontArm",startTime:1.55,rotationRange:.5*Math.PI}];e.forEach(e=>{let{left:t,right:r,startTime:i,rotationRange:s}=e,o=n.getObjectByName(t),a=n.getObjectByName(r);if(o&&a){let e=Math.max(0,Math.min(1,(c-i)*1)),t=Math.sin(e*Math.PI)*s,r=.5*Math.sin(e*Math.PI);o.rotation.y=4*Math.PI+t,a.rotation.y=4*Math.PI-t,o.rotation.z=r,a.rotation.z=r}}),c>2.45&&(u(0),e.forEach(e=>{let{left:t,right:r}=e,i=n.getObjectByName(t),s=n.getObjectByName(r);i&&s&&(i.rotation.z=0,s.rotation.z=0)}))}else[{left:"LeftLowerBackArm",right:"RightLowerBackArm",y:4.2*Math.PI},{left:"LeftMiddleBackArm",right:"RightMiddleBackArm",y:4.1*Math.PI},{left:"LeftUpperBackArm",right:"RightUpperBackArm",y:4*Math.PI},{left:"LeftFrontArm",right:"RightFrontArm",y:4.9*Math.PI}].forEach(e=>{let{left:t,right:r,y:i}=e,s=n.getObjectByName(t),o=n.getObjectByName(r);s&&o&&(s.rotation.y=i,o.rotation.y=-i)});r||d.forEach(t=>{let{left:r,right:i,baseRotation:s,rightBaseRotation:o,phase:a}=t,l=n.getObjectByName(r),c=n.getObjectByName(i);if(l&&c){let t=3*e.clock.getElapsedTime(),r=Math.sin(t+a),n=Math.sin(t+a+Math.PI);l.rotation.set(s.x+.15*r,s.y+.045*r,s.z+.075*r),c.rotation.set(o.x+.15*n,o.y+.045*n,o.z+.075*n)}})}),(0,i.useEffect)(()=>{let e=h.current;return()=>{e&&clearTimeout(e)}},[]),(0,n.jsxs)("group",{ref:o,position:[t[0],t[1],t[2]],scale:[1.425,1.425,1.425],children:[(0,n.jsx)("group",{position:[0,.15,-0],children:(0,n.jsx)(t1,{parentRef:o})}),(0,n.jsx)("group",{name:"Body",position:[0,1.2,-.25],scale:[1.8,1.4,1.65],rotation:[.25,0,0],children:(0,n.jsx)(_,{})}),(0,n.jsx)("group",{scale:[.7,.7,.7],position:[0,1.25,-.1],rotation:[.25,0,0],children:(0,n.jsx)(t2,{})}),(0,n.jsx)("group",{scale:[.7,.5,.7],position:[0,1.3,-.3],rotation:[1,0,-4.25],children:(0,n.jsx)(ro,{isLeft:!0})}),(0,n.jsx)("group",{scale:[.7,.5,.7],position:[0,1.3,-.3],rotation:[1,0,4.25],children:(0,n.jsx)(ro,{isLeft:!1})}),(0,n.jsx)("group",{scale:[.7,.5,.7],position:[0,.7,-.6],rotation:[1,0,-4.25],children:(0,n.jsx)(ro,{isLeft:!0})}),(0,n.jsx)("group",{scale:[.7,.5,.7],position:[0,.7,-.6],rotation:[1,0,4.25],children:(0,n.jsx)(ro,{isLeft:!1})}),(0,n.jsxs)("group",{name:"Head",position:[0,1.925,.2],scale:[.95,.8,.8],children:[(0,n.jsxs)("group",{children:[(0,n.jsxs)("mesh",{position:[0,0,-.05],children:[(0,n.jsx)("sphereGeometry",{args:[.22,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("mesh",{position:[0,-.02,.12],children:[(0,n.jsx)("boxGeometry",{args:[.28,.28,.1]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("group",{children:[(0,n.jsxs)("mesh",{position:[.12,-.08,.1],children:[(0,n.jsx)("boxGeometry",{args:[.08,.12,.15]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("mesh",{position:[-.12,-.08,.1],children:[(0,n.jsx)("boxGeometry",{args:[.08,.12,.15]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]})]}),(0,n.jsx)("group",{position:[0,-.15,.05],children:(0,n.jsxs)("mesh",{position:[0,-.08,.08],rotation:[0,Math.PI/5,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.08,.08,.2,5]}),(0,n.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]})}),(0,n.jsx)("group",{position:[.025,-.25,.2175],children:[-.03,-.06,-.09,-0,.03].map((e,t)=>(0,n.jsx)("group",{position:[e,0,0],rotation:[.5,0,0],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("coneGeometry",{args:[.03,.075,3]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.3,metalness:.4})]})},t))}),(0,n.jsx)("group",{position:[0,-.18,.2],children:[-.06,-.02,.02,.06].map((e,t)=>(0,n.jsx)("group",{position:[e,0,0],rotation:[2.5,0,0],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("coneGeometry",{args:[.01,.08,3]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.3,metalness:.4})]})},t))})]}),(0,n.jsxs)("group",{position:[0,.05,.14],children:[(0,n.jsx)(rr,{position:[-.07,0,0]}),(0,n.jsx)(rr,{position:[.07,0,0]})]})]}),(0,n.jsx)("group",{position:[-.55,1.8,.05],rotation:[-.45,-Math.PI/1.2,-.525],children:(0,n.jsx)(rs,{})}),(0,n.jsx)("group",{position:[.55,1.8,.05],rotation:[-.45,Math.PI/1.2,.525],children:(0,n.jsx)(rs,{})}),(0,n.jsx)("group",{name:"LeftFrontArm",position:[-.4,1.525,.1],scale:[-.525,.425,.525],rotation:[.2,Math.PI/3,0],children:(0,n.jsx)(ri,{isLeftHand:!0})}),(0,n.jsx)("group",{name:"RightFrontArm",position:[.4,1.525,.1],scale:[.525,.425,.525],rotation:[.2,-Math.PI/3,0],children:(0,n.jsx)(ri,{isLeftHand:!1})}),(0,n.jsx)("group",{name:"LeftUpperBackArm",position:[-.55,1.6,0],scale:[-1.1,.7,.9],rotation:[0,2*Math.PI,-.4],children:(0,n.jsx)(ri,{isLeftHand:!0})}),(0,n.jsx)("group",{name:"RightUpperBackArm",position:[.55,1.6,0],scale:[1.1,.7,.9],rotation:[0,-(2*Math.PI),.4],children:(0,n.jsx)(ri,{isLeftHand:!1})}),(0,n.jsx)("group",{name:"LeftMiddleBackArm",position:[-.45,1.5,-.1],scale:[-.75,.75,.75],rotation:[.4,2.1*Math.PI,-.4],children:(0,n.jsx)(ri,{isLeftHand:!0})}),(0,n.jsx)("group",{name:"RightMiddleBackArm",position:[.45,1.5,-.1],scale:[.75,.75,.75],rotation:[.4,-(2.1*Math.PI),.4],children:(0,n.jsx)(ri,{isLeftHand:!1})}),(0,n.jsx)("group",{name:"LeftFrontLeg",position:[.4,.75,.4],rotation:[.2,-.6,.6],children:(0,n.jsx)(rn,{})}),(0,n.jsx)("group",{name:"RightFrontLeg",position:[-.4,.75,.4],rotation:[.2,.6,-.6],children:(0,n.jsx)(rn,{})}),(0,n.jsx)("group",{name:"LeftMiddleFrontLeg",position:[.6,.73,0],rotation:[.25,-.8,.7],children:(0,n.jsx)(rn,{})}),(0,n.jsx)("group",{name:"RightMiddleFrontLeg",position:[-.6,.73,0],rotation:[.25,.8,-.7],children:(0,n.jsx)(rn,{})}),(0,n.jsx)("group",{name:"LeftMiddleBackLeg",position:[.5,.71,-.35],rotation:[.5,-1,.7],children:(0,n.jsx)(rn,{})}),(0,n.jsx)("group",{name:"RightMiddleBackLeg",position:[-.5,.71,-.35],rotation:[.5,1,-.7],children:(0,n.jsx)(rn,{})}),(0,n.jsx)("group",{name:"LeftBackLeg",position:[.4,.7,-.725],rotation:[1,-1.2,.6],children:(0,n.jsx)(rn,{})}),(0,n.jsx)("group",{name:"RightBackLeg",position:[-.4,.7,-.725],rotation:[1,1.2,-.6],children:(0,n.jsx)(rn,{})}),(0,n.jsxs)("group",{position:[0,1.925,.245],scale:[.405,.425,.275],children:[(0,n.jsx)("group",{position:[.2,.2,0],rotation:[-.4,.5,-.2],children:(0,n.jsx)(ro,{isLeft:!0})}),(0,n.jsx)("group",{position:[-.2,.2,0],rotation:[-.3,-.5,.3],children:(0,n.jsx)(ro,{isLeft:!1})})]}),(0,n.jsxs)("group",{position:[0,.5,-.25],scale:[1.9,1,1.75],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.35,.34,.27,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]}),(0,n.jsx)("group",{position:[0,.15,-.16],rotation:[.1,0,0],children:(0,n.jsx)(rt,{})}),[-1,1].map(e=>(0,n.jsx)("group",{position:[.15*e,-.1,0],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.075,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#d8d8d8",roughness:.5,metalness:.2})]})},e))]})]})}let rl=i.memo(function(e){let{id:t,initialPosition:r,position:s,health:o,maxHealth:a,onTakeDamage:l,onPositionUpdate:c,playerPosition:u,onAttackPlayer:h,weaponType:d}=e,p=(0,i.useRef)(null),x=(0,i.useRef)(Date.now()+2e3),[g,y]=(0,i.useState)(!1),[j,M]=(0,i.useState)(!1),[v,w]=(0,i.useState)(!1),[P,S]=(0,i.useState)(!0),[I,F]=(0,i.useState)(!1),E=(0,i.useRef)(r.clone()),C=(0,i.useRef)(r.clone()),R=(0,i.useRef)(o),k=(0,i.useRef)(new m.Pq0),T=(0,i.useRef)(Date.now()),_=(0,i.useRef)(null),D=(0,i.useRef)(Date.now());(0,i.useEffect)(()=>{R.current=o},[o]);let G=(0,i.useCallback)(e=>{if(R.current<=0)return;let r=Math.max(0,R.current-e);l("enemy-".concat(t),e),0===r&&R.current>0&&(w(!0),M(!0))},[t,l]);(0,i.useEffect)(()=>{s&&P&&(E.current.copy(s),E.current.y=0,C.current.copy(E.current),p.current&&p.current.position.copy(E.current))},[s,P]);let A=(0,i.useCallback)(()=>{if(!p.current)return null;let e=Math.random()*Math.PI*2,t=6*Math.random();return new m.Pq0(E.current.x+Math.cos(e)*t,0,E.current.z+Math.sin(e)*t)},[]);return(0,f.F)((e,r)=>{if(!p.current||R.current<=0||!u){F(!1);return}if(q.isUnitStealthed()){y(!1);let e=Date.now();if(!_.current||e-D.current>4500){if(_.current){let e=new m.Pq0().subVectors(_.current,E.current).normalize(),t=new m.Pq0().copy(E.current).add(e.multiplyScalar(6));_.current=t}else _.current=A();D.current=e}if(_.current){F(!0);let e=new m.Pq0().subVectors(_.current,E.current).normalize(),n=e.multiplyScalar(1.7999999999999998*r);k.current.lerp(n,2.5*r),E.current.add(k.current),E.current.y=0,p.current.position.copy(E.current);let i=Math.atan2(e.x,e.z)-p.current.rotation.y;for(;i>Math.PI;)i-=2*Math.PI;for(;i<-Math.PI;)i+=2*Math.PI;p.current.rotation.y+=i*Math.min(1,3.5*r);let o=Date.now();o-T.current>=50&&E.current.distanceTo(s)>.1&&(c(t,E.current.clone()),T.current=o);return}}let n=E.current.distanceTo(u);if(n>3.15&&R.current>0){var i;y(!1),F(!0);let e=new m.Pq0().subVectors(u,E.current).normalize(),n=(null===(i=p.current.parent)||void 0===i?void 0:i.children.filter(e=>e!==p.current&&e.position&&4>e.position.distanceTo(E.current)))||[],o=new m.Pq0;n.forEach(e=>{let t=E.current.clone().setY(0),r=e.position.clone().setY(0),n=new m.Pq0().subVectors(t,r).normalize().multiplyScalar(.15/Math.max(.1,r.distanceTo(t)));o.add(n)});let a=e.add(o).normalize();a.y=0;let l=a.multiplyScalar(2.6999999999999997*r);k.current.lerp(l,5*r),E.current.add(k.current),E.current.y=0,p.current.position.copy(E.current);let h=new m.Pq0().copy(u).setY(E.current.y),d=new m.Pq0().subVectors(h,E.current).normalize(),f=Math.atan2(d.x,d.z)-p.current.rotation.y;for(;f>Math.PI;)f-=2*Math.PI;for(;f<-Math.PI;)f+=2*Math.PI;p.current.rotation.y+=f*Math.min(1,7*r);let x=Date.now();x-T.current>=50&&E.current.distanceTo(s)>.1&&(c(t,E.current.clone()),T.current=x)}else F(!1),k.current.multiplyScalar(1-7*r),k.current.length()>.001&&(E.current.add(k.current),p.current.position.copy(E.current));if(n<=3.15&&R.current>0){let e=Date.now();if(e-x.current>=2100){y(!0);let t=E.current.clone();for(let e=0;e<6;e++)setTimeout(()=>{let e=E.current.distanceTo(u);R.current>0&&e<=3.15&&.65>t.distanceTo(E.current)&&h(9)},450+150*e);x.current=e,setTimeout(()=>{y(!1)},1950)}}}),(0,i.useEffect)(()=>{0===o&&!v&&(w(!0),M(!0),p.current&&(p.current.visible=!0))},[o,v]),(0,i.useEffect)(()=>{if(v){let e=setTimeout(()=>{var e;M(!1),(null===(e=p.current)||void 0===e?void 0:e.parent)&&p.current.parent.remove(p.current)},3e3);return()=>clearTimeout(e)}},[v]),(0,i.useEffect)(()=>{let e=()=>{F(!0)};return window.addEventListener("stealthBreak",e),()=>{window.removeEventListener("stealthBreak",e)}},[]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("group",{ref:p,visible:!P&&R.current>0,position:E.current,onClick:e=>{e.stopPropagation()},children:[(0,n.jsx)(ra,{position:[0,.765,0],isAttacking:g,isWalking:I&&R.current>0,onHit:G}),(0,n.jsx)(eK.Q,{position:[0,5.5,0],follow:!0,lockX:!1,lockY:!1,lockZ:!1,children:R.current>0&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("mesh",{position:[0,0,0],children:[(0,n.jsx)("planeGeometry",{args:[2,.25]}),(0,n.jsx)("meshBasicMaterial",{color:"#333333",opacity:.8,transparent:!0})]}),(0,n.jsxs)("mesh",{position:[-1+R.current/a,0,.001],children:[(0,n.jsx)("planeGeometry",{args:[R.current/a*2,.23]}),(0,n.jsx)("meshBasicMaterial",{color:"#ff3333",opacity:.9,transparent:!0})]}),(0,n.jsx)(b.E,{position:[0,0,.002],fontSize:.2,color:"#ffffff",anchorX:"center",anchorY:"middle",fontWeight:"bold",children:"".concat(Math.ceil(R.current),"/").concat(a)})]})})]}),P&&(0,n.jsx)(ts,{position:E.current,onComplete:()=>{S(!1)},isSpawning:!0,scale:1.5}),j&&(0,n.jsx)(tl,{position:E.current,onComplete:()=>{M(!1)},isSpawning:!1,weaponType:d,scale:1.5})]})},(e,t)=>e.health===t.health&&e.position.equals(t.position)&&e.playerPosition.equals(t.playerPosition));tc.abomination,tu.abomination;class rc{initialize(){for(let e=0;e<this.initialSize;e++)this.available.push(this.factory())}acquire(){0===this.available.length&&this.size<this.maxSize&&this.expand();let e=this.available.pop();if(!e)throw Error("Pool exhausted");return this.inUse.add(e),e}release(e){this.inUse.has(e)&&(this.inUse.delete(e),this.available.push(e))}clear(){this.available=[],this.inUse.clear(),this.initialize()}expand(){let e=Math.min(this.size+this.expandSize,this.maxSize)-this.size;for(let t=0;t<e;t++)this.available.push(this.factory())}get size(){return this.available.length+this.inUse.size}constructor(e,t,r,n){this.factory=e,this.initialSize=t,this.expandSize=r,this.maxSize=n,this.available=[],this.inUse=new Set,this.initialize()}}let ru={initialSize:20,expandSize:5,maxSize:30};function rh(e){let{unitProps:{controlsRef:t,...r},onLevelComplete:s,maxSkeletons:o=17,initialSkeletons:a=6,killCount:l}=e,c=(0,i.useMemo)(()=>tg(),[]),u=(0,i.useMemo)(()=>ty(),[]),h=(0,i.useMemo)(()=>tj(),[]),[d]=(0,i.useState)(()=>new rc(()=>{let e=new m.YJl;return e.visible=!1,e},ru.initialSize,ru.expandSize,ru.maxSize)),[f,x]=(0,i.useState)(()=>Array.from({length:a},(e,t)=>{let r=tM();r.y=0;let n=d.acquire();return n.visible=!0,{id:"skeleton-".concat(t),position:r.clone(),initialPosition:r.clone(),rotation:0,health:324,maxHealth:324,ref:{current:n}}})),[g,y]=(0,i.useState)(a),[j,M]=(0,i.useState)(r.health),v=(0,i.useRef)(null),[w,P]=(0,i.useState)(new m.Pq0(0,0,0)),[S,I]=(0,i.useState)(a),b=(0,i.useCallback)(e=>{var t;(null===(t=e.ref)||void 0===t?void 0:t.current)&&(e.ref.current.visible=!1,d.release(e.ref.current))},[d]),F=(0,i.useCallback)((e,t)=>{x(n=>{let i=[...n],s=i.findIndex(t=>t.id===e.replace("enemy-",""));if(-1!==s){let e=Math.max(0,i[s].health-t);if(0===e&&i[s].health>0){var o;i[s]={...i[s],health:e,isDying:!0,deathStartTime:Date.now()},I(e=>Math.max(0,e-1)),null===(o=r.onEnemyDeath)||void 0===o||o.call(r)}else i[s]={...i[s],health:e}}return i})},[r]),E=(0,i.useCallback)(e=>{var t;null===(t=r.onDamage)||void 0===t||t.call(r,e)},[r]),C=(0,i.useCallback)(e=>{P(e)},[]),R=(0,i.useCallback)((e,t)=>{x(r=>r.map(r=>r.id===e.replace("enemy-","")?{...r,position:t.clone()}:r))},[]),k={onHit:F,controlsRef:t,currentWeapon:r.currentWeapon,onWeaponSelect:r.onWeaponSelect,health:j,maxHealth:r.maxHealth,isPlayer:r.isPlayer,abilities:r.abilities,onAbilityUse:r.onAbilityUse,onPositionUpdate:C,onHealthChange:e=>{if("function"==typeof e)M(t=>{var n;let i=e(t);return null===(n=r.onHealthChange)||void 0===n||n.call(r,i),i});else{var t;M(e),null===(t=r.onHealthChange)||void 0===t||t.call(r,e)}},enemyData:f.filter(e=>!e.isDying&&e.health>0).map(e=>({id:"enemy-".concat(e.id),position:e.position.clone(),initialPosition:e.initialPosition.clone(),rotation:e.rotation,health:e.health,maxHealth:e.maxHealth,type:e.type})),onDamage:r.onDamage,onEnemyDeath:()=>{},onFireballDamage:r.onFireballDamage,fireballManagerRef:r.fireballManagerRef,onSmiteDamage:r.onSmiteDamage},[T,_]=(0,i.useState)(0);(0,i.useEffect)(()=>{if(g>=o)return;let e=setInterval(()=>{S>=6||l<14&&0===T||l<20&&1===T||l<26&&2===T||x(e=>{let t=o-g;if(t<=0||S>=6)return e;if(1===t){let t=tM();y(e=>e+1),_(e=>e+1);let r=d.acquire();return r.visible=!0,I(e=>e+1),[...e,{id:"abomination-".concat(g),position:t.clone(),initialPosition:t.clone(),rotation:0,health:841,maxHealth:841,isDying:!1,type:"abomination",ref:{current:r}}]}let r=tM(),n=(g+1)%4==0,i=d.acquire();i.visible=!0;let s=n?{id:"mage-".concat(g),position:r.clone(),initialPosition:r.clone(),rotation:0,health:289,maxHealth:289,isDying:!1,type:"mage",ref:{current:i}}:{id:"skeleton-".concat(g),position:r.clone(),initialPosition:r.clone(),rotation:0,health:324,maxHealth:324,isDying:!1,type:"regular",ref:{current:i}};return y(e=>e+1),I(e=>e+1),[...e,s]})},2500);return()=>clearInterval(e)},[g,o,l,T,d,S]),(0,i.useEffect)(()=>{t.current&&(t.current.object.position.set(0,12,-18),t.current.target.set(0,0,0),t.current.update())},[t]),(0,i.useEffect)(()=>{x(e=>{let t=Date.now();return e.filter(e=>e.isDying&&e.deathStartTime?!(t-e.deathStartTime>=1500)||(b(e),!1):e.health>0)})},[f,b]),(0,i.useEffect)(()=>{let e=v.current;return()=>{x([]),e&&e.clear(),P(new m.Pq0(0,0,0)),y(a)}},[a]),(0,i.useEffect)(()=>(th(),tc.mountain=new m.qFE(23,35,12),tc.mushroom=new m.Ho_(.25,.30625,4,8),tc.tree=new m.Ho_(.25,.30625,4,8),tu.mountain=new m.uSd({color:"#2a2a2a",metalness:.1,roughness:1,emissive:"#222222",flatShading:!0,clearcoat:.1,clearcoatRoughness:.8}),()=>{td()}),[]);let D=(0,i.useCallback)(()=>{x(e=>(e.forEach(e=>{var t,r;b(e),null===(r=e.ref)||void 0===r||null===(t=r.current)||void 0===t||t.traverse(e=>{if("geometry"in e&&e.geometry instanceof m.LoY&&!Object.values(tc).includes(e.geometry)&&e.geometry.dispose(),"material"in e){let t=e.material;Array.isArray(t)?t.forEach(e=>{Object.values(tu).includes(e)||e.dispose()}):t&&!Object.values(tu).includes(t)&&t.dispose()}})}),[])),d.clear()},[d,b]);return(0,i.useEffect)(()=>D,[D]),(0,i.useEffect)(()=>{let e=f.every(e=>e.health<=0),t=g>=o;e&&t&&s()},[f,g,o,s]),(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("group",{children:[(0,n.jsx)(tx,{}),(0,n.jsx)(tp,{}),(0,n.jsx)(p,{}),(0,n.jsx)(tS,{}),(0,n.jsx)(tI,{}),(0,n.jsx)(tw,{mountains:c}),(0,n.jsx)(tv,{trees:u}),(0,n.jsx)(tP,{mushrooms:h}),(0,n.jsx)("group",{ref:v,children:(0,n.jsx)(eZ,{...k})}),f.map(e=>"abomination"===e.type?(0,n.jsx)(rl,{id:e.id,initialPosition:e.initialPosition,position:e.position,health:e.health,maxHealth:e.maxHealth,onTakeDamage:F,onPositionUpdate:R,playerPosition:w,onAttackPlayer:E,weaponType:r.currentWeapon},e.id):"mage"===e.type?(0,n.jsx)(t0,{id:e.id,initialPosition:e.initialPosition,position:e.position,health:e.health,maxHealth:e.maxHealth,onTakeDamage:F,onPositionUpdate:R,playerPosition:w,onAttackPlayer:E,weaponType:r.currentWeapon},e.id):(0,n.jsx)(tm,{id:e.id,initialPosition:e.initialPosition,position:e.position,health:e.health,maxHealth:e.maxHealth,onTakeDamage:F,onPositionUpdate:R,playerPosition:w,onAttackPlayer:E,weaponType:r.currentWeapon},e.id))]})})}let rd=()=>(0,n.jsxs)("group",{children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("boxGeometry",{args:[.055,.015,.015]}),(0,n.jsx)("meshStandardMaterial",{color:"#ff0000",transparent:!0,opacity:.35,emissive:"#ff0000",emissiveIntensity:.4})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.0285,6,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#ff0000",emissive:"#ff0000",emissiveIntensity:.9,transparent:!0,opacity:.6})]})]});function rm(e){let{parentRef:t}=e,r=(0,i.useRef)([]),s=(0,i.useRef)(null);return(0,f.F)(e=>{let{clock:n}=e;if(!t.current||!s.current)return;let i=t.current.position;s.current.position.set(i.x,0,i.z),r.current.forEach((e,t)=>{if(!e)return;let r=n.getElapsedTime(),i=t/25*.65,s=t/25*Math.PI*4+2*r,o=.45*(1.1-1.5*i),a=Math.cos(s)*o,l=Math.sin(s)*o;e.position.set(a,i,l),e.rotation.y=s+Math.PI/2,e.rotation.x=Math.PI/6,e.rotation.z=.1*Math.sin(3*r+t);let c=e.children[0];c&&c.material&&(c.material.opacity=Math.max(.1,1-2*i))})}),(0,n.jsxs)("group",{ref:s,children:[Array.from({length:25}).map((e,t)=>(0,n.jsx)("group",{ref:e=>{e&&(r.current[t]=e)},children:rd()},t)),(0,n.jsx)("pointLight",{color:"#ff0000",intensity:10,distance:15,decay:2,position:[0,.5,0]})]})}let rp=e=>{let{parentRef:t}=e,r=(0,i.useRef)(null),s=(0,i.useRef)(new Float32Array(24)),o=(0,i.useRef)(new Float32Array(8)),a=(0,i.useRef)(new Float32Array(8)),l=(0,i.useRef)(0);return(0,f.F)((e,n)=>{var i;if(!(null===(i=r.current)||void 0===i?void 0:i.parent)||!t.current)return;l.current+=n;let c=t.current.position;for(let e=0;e<8;e++){let t=e/8*Math.PI*2+l.current,r=.1*+Math.sin(2*l.current+.2*e);s.current[3*e]=c.x+Math.cos(t)*r,s.current[3*e+1]=c.y+1e-4*Math.sin(l.current+.1*e),s.current[3*e+2]=c.z+Math.sin(t)*r,o.current[e]=.25*Math.pow(1-e/8,1.5),a.current[e]=.4*Math.pow(1-e/8,.6)}if(r.current){let e=r.current.geometry;e.attributes.position.needsUpdate=!0,e.attributes.opacity.needsUpdate=!0,e.attributes.scale.needsUpdate=!0}}),(0,n.jsxs)("points",{ref:r,children:[(0,n.jsxs)("bufferGeometry",{children:[(0,n.jsx)("bufferAttribute",{attach:"attributes-position",count:8,array:s.current,itemSize:3}),(0,n.jsx)("bufferAttribute",{attach:"attributes-opacity",count:8,array:o.current,itemSize:1}),(0,n.jsx)("bufferAttribute",{attach:"attributes-scale",count:8,array:a.current,itemSize:1})]}),(0,n.jsx)("shaderMaterial",{transparent:!0,depthWrite:!1,blending:m.EZo,vertexShader:"\n          attribute float opacity;\n          attribute float scale;\n          varying float vOpacity;\n          void main() {\n            vOpacity = opacity;\n            vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n            gl_Position = projectionMatrix * mvPosition;\n            gl_PointSize = scale * 20.0 * (300.0 / -mvPosition.z);\n          }\n        ",fragmentShader:"\n          varying float vOpacity;\n          void main() {\n            float d = length(gl_PointCoord - vec2(0.5));\n            float strength = smoothstep(0.5, 0.1, d);\n            vec3 glowColor = mix(vec3(0.8, 0.1, 0.1), vec3(1.0, 0.3, 0.3), 0.4);\n            gl_FragColor = vec4(glowColor, vOpacity * strength);\n          }\n        "})]})};function rf(e){let{isSwinging:t,onSwingComplete:r}=e,s=(0,i.useRef)(null),o=(0,i.useRef)(0),a=[-1.055,1.1,.35];return(0,f.F)((e,n)=>{if(t&&s.current){o.current+=2.7*n;let e=Math.min(o.current/Math.PI/1.5,1);if(o.current>=.5*Math.PI){o.current=0,s.current.rotation.set(0,0,0),s.current.position.set(...a),r();return}let t=e<=.25?2*e:.5-(e-.25),i=a[0]+-2*Math.sin(t*Math.PI),l=a[1]+-1.2*Math.sin(t*Math.PI),c=a[2]+.9*Math.cos(t*Math.PI);s.current.position.set(i,l,c);let u=Math.PI/4*Math.sin(t*Math.PI),h=Math.PI/2*Math.sin(t*Math.PI),d=Math.PI/4*Math.sin(t*Math.PI);s.current.rotation.set(u,h,d)}else!t&&s.current&&(s.current.rotation.x*=.85,s.current.rotation.y*=.85,s.current.rotation.z*=.85,s.current.position.x+=(a[0]-s.current.position.x)*.2,s.current.position.y+=(a[1]-s.current.position.y)*.2,s.current.position.z+=(a[2]-s.current.position.z)*.2)}),(0,n.jsxs)("group",{ref:s,position:[a[0],a[1],a[2]],rotation:[0,0,Math.PI],scale:[1,1,1],children:[(0,n.jsxs)("group",{position:[0,-.7,0],rotation:[0,0,-Math.PI],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.05,.05,2.5,12]}),(0,n.jsx)("meshStandardMaterial",{color:"#2c1810",roughness:.7,transparent:!0,opacity:.5})]}),[...Array(7)].map((e,t)=>(0,n.jsxs)("mesh",{position:[0,.81-.3*t,0],rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("torusGeometry",{args:[.06,.01,8,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#8B4513",metalness:.3,roughness:.7,transparent:!0,opacity:.5})]},t))]}),(0,n.jsxs)("group",{position:[0,.35,0],rotation:[Math.PI/1,0,Math.PI],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.08,.08,.3,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#2c1810",roughness:.6})]}),(0,n.jsx)("group",{"rotation-x":(0,f.F)(e=>2*e.clock.getElapsedTime()),children:(0,n.jsxs)("mesh",{"position-y":-.075,rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("torusGeometry",{args:[.145,.02,16,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#ff3300",emissive:"#ff3300",emissiveIntensity:1.5,transparent:!0,opacity:.7})]})}),(0,n.jsx)("group",{"rotation-x":(0,f.F)(e=>-(2*e.clock.getElapsedTime())),children:(0,n.jsxs)("mesh",{"position-y":.03,rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("torusGeometry",{args:[.175,.02,16,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#ff0000",emissive:"#ff0000",emissiveIntensity:1.5,transparent:!0,opacity:.7})]})}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.13,.11,.32,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#ff1a1a",emissive:"#ff1a1a",emissiveIntensity:1.5,transparent:!0,opacity:.3})]})]}),(0,n.jsx)("group",{position:[0,.375,1.175],rotation:[-1,-Math.PI/2,Math.PI/2.2],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("extrudeGeometry",{args:[(()=>{let e=new m.ypk;return e.moveTo(0,0),e.lineTo(.15,-.23),e.bezierCurveTo(.8,.22,1.13,.5,1.6,.6),e.lineTo(1.125,.75),e.bezierCurveTo(.5,.2,.225,0,.1,.7),e.lineTo(0,0),e})(),{steps:1,depth:1e-4,bevelEnabled:!0,bevelThickness:.03,bevelSize:.035,bevelSegments:1,curveSegments:16,depth:.03}]}),(0,n.jsx)("meshStandardMaterial",{color:"#ff0000",emissive:"#ff0000",emissiveIntensity:1.25,metalness:.8,roughness:.1,opacity:.5,transparent:!0,side:m.$EB})]})})]})}function rx(e){let{isSwinging:t,onSwingComplete:r}=e,s=(0,i.useRef)(null),o=(0,i.useRef)(0),a=[-1.055,1.1,.35];return(0,f.F)((e,n)=>{if(t&&s.current){o.current+=2.7*n;let e=Math.min(o.current/Math.PI/1.5,1);if(o.current>=.5*Math.PI){o.current=0,s.current.rotation.set(0,0,0),s.current.position.set(...a),r();return}let t=e<=.25?2*e:.5-(e-.25),i=a[0]+2*Math.sin(t*Math.PI),l=a[1]+-1.2*Math.sin(t*Math.PI),c=a[2]+.9*Math.cos(t*Math.PI);s.current.position.set(i,l,c);let u=Math.PI/4*Math.sin(t*Math.PI),h=Math.PI/2*Math.sin(t*Math.PI),d=Math.PI/4*Math.sin(t*Math.PI);s.current.rotation.set(u,h,d)}else!t&&s.current&&(s.current.rotation.x*=.85,s.current.rotation.y*=.85,s.current.rotation.z*=.85,s.current.position.x+=(a[0]-s.current.position.x)*.2,s.current.position.y+=(a[1]-s.current.position.y)*.2,s.current.position.z+=(a[2]-s.current.position.z)*.2)}),(0,n.jsxs)("group",{ref:s,position:[a[0],a[1],a[2]],rotation:[0,0,Math.PI],scale:[1,1,1],children:[(0,n.jsxs)("group",{position:[0,-.7,0],rotation:[0,0,-Math.PI],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.05,.05,2.5,12]}),(0,n.jsx)("meshStandardMaterial",{color:"#2c1810",roughness:.7,transparent:!0,opacity:.5})]}),[...Array(7)].map((e,t)=>(0,n.jsxs)("mesh",{position:[0,.81-.3*t,0],rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("torusGeometry",{args:[.06,.01,8,16]}),(0,n.jsx)("meshStandardMaterial",{color:"#8B4513",metalness:.3,roughness:.7,transparent:!0,opacity:.5})]},t))]}),(0,n.jsxs)("group",{position:[0,.35,0],rotation:[Math.PI/1,0,Math.PI],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.08,.08,.3,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#2c1810",roughness:.6})]}),(0,n.jsx)("group",{"rotation-x":(0,f.F)(e=>2*e.clock.getElapsedTime()),children:(0,n.jsxs)("mesh",{"position-y":-.075,rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("torusGeometry",{args:[.145,.02,16,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#ff3300",emissive:"#ff3300",emissiveIntensity:1.5,transparent:!0,opacity:.7})]})}),(0,n.jsx)("group",{"rotation-x":(0,f.F)(e=>-(2*e.clock.getElapsedTime())),children:(0,n.jsxs)("mesh",{"position-y":.03,rotation:[Math.PI/2,0,0],children:[(0,n.jsx)("torusGeometry",{args:[.175,.02,16,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#ff0000",emissive:"#ff0000",emissiveIntensity:1.5,transparent:!0,opacity:.7})]})}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.13,.11,.32,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#ff1a1a",emissive:"#ff1a1a",emissiveIntensity:1.5,transparent:!0,opacity:.3})]})]}),(0,n.jsx)("group",{position:[0,.375,1.175],rotation:[-1,-Math.PI/2,Math.PI/2.2],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("extrudeGeometry",{args:[(()=>{let e=new m.ypk;return e.moveTo(0,0),e.lineTo(.15,-.23),e.bezierCurveTo(.8,.22,1.13,.5,1.6,.6),e.lineTo(1.125,.75),e.bezierCurveTo(.5,.2,.225,0,.1,.7),e.lineTo(0,0),e})(),{steps:1,depth:1e-4,bevelEnabled:!0,bevelThickness:.03,bevelSize:.035,bevelSegments:1,curveSegments:16,depth:.03}]}),(0,n.jsx)("meshStandardMaterial",{color:"#ff0000",emissive:"#ff0000",emissiveIntensity:1.25,metalness:.8,roughness:.1,opacity:.5,transparent:!0,side:m.$EB})]})})]})}let rg=()=>(0,n.jsxs)("group",{rotation:[Math.PI/3.75,0,0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.04,.04,.7,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",roughness:.4,metalness:.3})]}),(0,n.jsxs)("mesh",{position:new m.Pq0(0,.375,0),rotation:new m.O9p(0,0,Math.PI/3),children:[(0,n.jsx)("sphereGeometry",{args:[.075,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",roughness:.5,metalness:.2})]}),(0,n.jsxs)("mesh",{position:new m.Pq0(0,-.375,0),rotation:new m.O9p(0,0,-Math.PI/3),children:[(0,n.jsx)("sphereGeometry",{args:[.075,8,8]}),(0,n.jsx)("meshStandardMaterial",{color:"#ffffff",roughness:.5,metalness:.2})]})]});function ry(e){let{parentRef:t}=e,r=(0,i.useRef)([]),s=(0,i.useRef)(null);return(0,f.F)(()=>{if(!t.current||!s.current)return;let e=t.current.position;s.current.position.set(e.x,.3,e.z),r.current.forEach((e,t)=>{let r=t/18*Math.PI*2+8e-4*Date.now(),n=-(.915*Math.cos(r)),i=.915*Math.sin(r),s=1e-4*Math.sin(.001*Date.now()+t);e.position.set(n,s-.2,i),e.rotation.y=r+Math.PI/3})}),(0,n.jsx)("group",{ref:s,children:Array.from({length:18}).map((e,t)=>(0,n.jsx)("mesh",{ref:e=>{e&&(r.current[t]=e)},children:rg()},t))})}let rj=new m._4j({color:"#e8e8e8",roughness:.4,metalness:.3}),rM=new m._4j({color:"#d4d4d4",roughness:.3,metalness:.4}),rv=new m.Gu$(.06,6,6),rw=new m.Ho_(.06,.048,1,4);function rP(e){let{isAttacking:t}=e,r=(0,i.useRef)(null);return(0,n.jsxs)("group",{ref:r,children:[(0,n.jsx)("group",{scale:[.7,.65,.7],position:[0,2.05,.35],rotation:[.5,0,0],children:(0,n.jsx)(t2,{})}),(0,n.jsx)("group",{scale:[1.3,1.1,1.3],position:[0,1.5,0],rotation:[.3,0,0],children:(0,n.jsx)(_,{})}),(0,n.jsxs)("group",{scale:[1.85,1.55,1.625],position:[0,1.85,0],children:[(0,n.jsx)("group",{rotation:[0,Math.PI/7,0],children:(0,n.jsx)(R,{collectedBones:15,isLeftWing:!0,parentRef:r})}),(0,n.jsx)("group",{rotation:[0,-Math.PI/7,0],children:(0,n.jsx)(R,{collectedBones:15,isLeftWing:!1,parentRef:r})})]}),(0,n.jsxs)("group",{scale:[1.7,1.525,1.525],position:[0,1.95,0],children:[(0,n.jsx)("group",{rotation:[0,Math.PI/4,0],children:(0,n.jsx)(R,{collectedBones:15,isLeftWing:!0,parentRef:r})}),(0,n.jsx)("group",{rotation:[0,-Math.PI/4,0],children:(0,n.jsx)(R,{collectedBones:15,isLeftWing:!1,parentRef:r})})]}),(0,n.jsxs)("group",{scale:[.625,.625,.625],position:[0,1.6,0],children:[(0,n.jsx)("group",{position:[-.775,.15,.1],rotation:[0,-(Math.PI/2),0],children:(0,n.jsx)(rS,{})}),(0,n.jsx)("group",{position:[.775,.15,.1],rotation:[0,-Math.PI/6,0],children:(0,n.jsx)(rS,{})})]}),(0,n.jsx)("group",{scale:[1.5,1.5,1.5],position:[0,1.7,.16],children:(0,n.jsx)(D,{})}),(0,n.jsx)("group",{position:[0,1.4,0],scale:[1.05,1.05,1.05],children:(0,n.jsx)(rp,{parentRef:r})}),(0,n.jsx)("group",{position:[0,2.15,.275],scale:[.525,.525,.525],children:(0,n.jsx)(rp,{parentRef:r})}),(0,n.jsxs)("group",{scale:[2.1,2.25,2.1],position:[0,-.325,0],children:[(0,n.jsx)("group",{position:[0,0,.11],rotation:[0,0,0],children:(0,n.jsx)(rm,{parentRef:r})}),(0,n.jsx)("group",{position:[0,0,-.11],rotation:[0,Math.PI,0],children:(0,n.jsx)(rm,{parentRef:r})})]}),(0,n.jsx)("group",{position:[.5,2.6,.2],rotation:[Math.PI/3+.2,1+Math.PI+1.15,1.45],scale:[.6,.6,.6],children:(0,n.jsx)(rx,{isSwinging:t,onSwingComplete:()=>{},parentRef:r})}),(0,n.jsx)("group",{position:[-.5,2.31,-1],rotation:[Math.PI/3+.2,-(1+Math.PI+1.15),-1.45],scale:[.6,.6,.6],children:(0,n.jsx)(rf,{isSwinging:t,onSwingComplete:()=>{},parentRef:r})}),(0,n.jsx)("group",{position:[0,.15,0],scale:[.9,.9,.9],children:(0,n.jsx)(ry,{parentRef:r})}),(0,n.jsx)("pointLight",{position:[0,.1,0],color:"#ff0000",intensity:4,distance:12,decay:2}),(0,n.jsx)("group",{position:[0,0,0]})]})}function rS(){let e=(e,t)=>(0,n.jsx)("mesh",{geometry:rw,scale:[t/.06,e,t/.06],children:(0,n.jsx)("meshStandardMaterial",{...rj})}),t=e=>(0,n.jsx)("mesh",{geometry:rv,scale:[e/.06,e/.06,e/.06],children:(0,n.jsx)("meshStandardMaterial",{...rj})}),r=(r,i)=>(0,n.jsxs)("group",{children:[(0,n.jsx)("group",{position:[i/2,0,0],children:e(r,.06)}),(0,n.jsx)("group",{position:[-i/2,0,0],children:e(r,.06)}),(0,n.jsx)("group",{position:[0,r/2,0],children:t(.17)}),(0,n.jsx)("group",{position:[0,-r/2,0],children:t(.075)})]}),i=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return(0,n.jsxs)("group",{scale:[e,e,e],children:[(0,n.jsxs)("mesh",{position:[0,0,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.06,.02,.12,4]})," ",(0,n.jsx)("meshStandardMaterial",{...rj})]}),(0,n.jsxs)("mesh",{position:[0,.1,.02],rotation:[.05,0,0],children:[(0,n.jsx)("cylinderGeometry",{args:[.025,.025,.12,4]})," ",(0,n.jsx)("meshStandardMaterial",{...rj})]}),(0,n.jsxs)("mesh",{position:[0,.2,.04],rotation:[.1,0,0],children:[(0,n.jsx)("coneGeometry",{args:[.03,.15,4]})," ",(0,n.jsx)("meshStandardMaterial",{...rM})]}),[0,Math.PI/2,Math.PI,3*Math.PI/2].map((e,t)=>(0,n.jsx)("group",{rotation:[0,e,0],children:(0,n.jsxs)("mesh",{position:[.04,.05,0],children:[(0,n.jsx)("boxGeometry",{args:[.01,.12,.02]}),(0,n.jsx)("meshStandardMaterial",{...rM})]})},t))]})};return(0,n.jsx)("group",{children:(0,n.jsxs)("group",{children:[r(1,.15),(0,n.jsx)("group",{position:[0,.7,0],rotation:[-1,1,1],scale:.5,children:[-.03,0,.03].map((e,t)=>(0,n.jsx)("group",{position:[e,-.275,-.15],rotation:[.4,0,(t-1)*Math.PI/4],children:(0,n.jsxs)("group",{position:[0,.4,0],scale:[1.35,1.35,1.35],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("cylinderGeometry",{args:[.075,.5,.2,4,1]})," ",(0,n.jsx)("meshStandardMaterial",{...rj})]}),(0,n.jsxs)("group",{position:[0,.25,0],children:[(0,n.jsx)("group",{position:[0,0,0],children:i(2)}),(0,n.jsx)("group",{position:[0,-.05,.15],rotation:[-.1,0,0],children:i(.9)}),(0,n.jsx)("group",{position:[0,-.05,-.15],rotation:[.1,0,0],children:i(.9)})]})]})},t))}),(0,n.jsxs)("group",{position:[.25,-.85,.21],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[.12,12,12]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4,metalness:.3})]}),(0,n.jsxs)("group",{rotation:[-.7,-0,Math.PI/5],children:[r(.8,.12),(0,n.jsxs)("group",{position:[0,-.5,0],rotation:[0,0,Math.PI/5.5],children:[t(.09),(0,n.jsxs)("group",{position:[0,-.1,0],children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("boxGeometry",{args:[.2,.15,.08]}),(0,n.jsx)("meshStandardMaterial",{color:"#e8e8e8",roughness:.4})]}),[-.08,-.04,0,.04,.08].map((t,r)=>(0,n.jsxs)("group",{position:[t,-.1,0],rotation:[0,0,(r-2)*Math.PI/10],children:[e(.5,.02),(0,n.jsx)("group",{position:[.025,-.3,0],rotation:[0,0,Math.PI+Math.PI/16],children:(0,n.jsxs)("mesh",{children:[(0,n.jsx)("coneGeometry",{args:[.03,.3,6]}),(0,n.jsx)("meshStandardMaterial",{color:"#d4d4d4",roughness:.3,metalness:.4})]})})]},r))]})]})]})]})]})})}function rI(e){let{color:t,size:r,meshRef:s}=e,o=(0,i.useRef)(null),a=(0,i.useRef)(new Float32Array(24)),l=(0,i.useRef)(new Float32Array(8)),c=(0,i.useRef)(new Float32Array(8)),u=(0,i.useRef)(!1);return(0,i.useEffect)(()=>{if(s.current&&!u.current){let e=s.current.position;for(let t=0;t<8;t++)a.current[3*t]=e.x,a.current[3*t+1]=e.y,a.current[3*t+2]=e.z,l.current[t]=0,c.current[t]=0;u.current=!0}},[s]),(0,f.F)(()=>{var e;if(!(null===(e=o.current)||void 0===e?void 0:e.parent)||!s.current||!u.current)return;let t=s.current.position;for(let e=7;e>0;e--)a.current[3*e]=a.current[(e-1)*3],a.current[3*e+1]=a.current[(e-1)*3+1]+.5,a.current[3*e+2]=a.current[(e-1)*3+2],l.current[e]=.9*Math.pow(1-e/8,.3),c.current[e]=r*(2-e/8*.5);if(a.current[0]=t.x,a.current[1]=t.y,a.current[2]=t.z,l.current[0]=.9,c.current[0]=.8*r,o.current){let e=o.current.geometry;e.attributes.position.array=a.current,e.attributes.position.needsUpdate=!0,e.attributes.opacity&&(e.attributes.opacity.array=l.current,e.attributes.opacity.needsUpdate=!0),e.attributes.scale&&(e.attributes.scale.array=c.current,e.attributes.scale.needsUpdate=!0)}}),(0,n.jsxs)("points",{ref:o,children:[(0,n.jsxs)("bufferGeometry",{children:[(0,n.jsx)("bufferAttribute",{attach:"attributes-position",count:8,array:a.current,itemSize:3}),(0,n.jsx)("bufferAttribute",{attach:"attributes-opacity",count:8,array:l.current,itemSize:1}),(0,n.jsx)("bufferAttribute",{attach:"attributes-scale",count:8,array:c.current,itemSize:1})]}),(0,n.jsx)("shaderMaterial",{transparent:!0,depthWrite:!1,blending:m.EZo,vertexShader:"\n          attribute float opacity;\n          attribute float scale;\n          varying float vOpacity;\n          void main() {\n            vOpacity = opacity;\n            vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n            gl_Position = projectionMatrix * mvPosition;\n            gl_PointSize = scale * 45.0 * (300.0 / -mvPosition.z);\n          }\n        ",fragmentShader:"\n          varying float vOpacity;\n          uniform vec3 uColor;\n          void main() {\n            float d = length(gl_PointCoord - vec2(0.5));\n            float strength = smoothstep(0.5, 0.1, d);\n            vec3 glowColor = mix(uColor, vec3(1.0), 0.4);\n            gl_FragColor = vec4(glowColor, vOpacity * strength);\n          }\n        ",uniforms:{uColor:{value:t}}})]})}let rb=new m.Gu$(.75,16,16),rF=new m.V9B({color:"#ff4400"}),rE=new m.rKP(2.79,2.99,32),rC=new m.rKP(2.99-.8,2.39,32),rR=new m.rKP(2.74,2.99,32),rk=new m.Gu$(.1,8,8),rT=new m.Pq0,r_=new m.Pq0,rD=(e,t,r)=>{let i=(Date.now()-t)/1e3,s=Math.max(0,1-i/1.25);return s<=0?(r(),null):(0,n.jsxs)("group",{position:e,children:[(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[1.2*(2+i),32,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#ff2200",emissive:"#ff4400",emissiveIntensity:2*s,transparent:!0,opacity:1.8*s,depthWrite:!1,blending:m.EZo})]}),(0,n.jsxs)("mesh",{children:[(0,n.jsx)("sphereGeometry",{args:[1,24,24]}),(0,n.jsx)("meshStandardMaterial",{color:"#ff8800",emissive:"#ffffff",emissiveIntensity:2*s,transparent:!0,opacity:1.9*s,depthWrite:!1,blending:m.EZo})]}),[2,2.15,2.3,2.5,2.7].map((e,t)=>(0,n.jsxs)("mesh",{rotation:[Math.random()*Math.PI,Math.random()*Math.PI,Math.random()*Math.PI],children:[(0,n.jsx)("torusGeometry",{args:[e*(1.125+2*i),.225,4,32]}),(0,n.jsx)("meshStandardMaterial",{color:"#ff2200",emissive:"#ff4400",emissiveIntensity:.7*s,transparent:!0,opacity:.95*s*(1-.1*t),depthWrite:!1,blending:m.EZo})]},t)),(0,n.jsx)("pointLight",{color:"#ff2200",intensity:.8*s,distance:8*(1+i),decay:2}),(0,n.jsx)("pointLight",{color:"#ff8800",intensity:.8*s,distance:12,decay:1})]})};function rG(e){var t;let{targetPosition:r,onImpact:s,onComplete:o,playerPosition:a}=e,l=(0,i.useRef)(null),c=(0,i.useRef)(null),[u,h,d]=i.useMemo(()=>{let e=new m.Pq0(r.x,-5,r.z),t=new m.Pq0(r.x,60,r.z),n=new m.Pq0().subVectors(e,t).normalize();return[e,t,n]},[r]),[p,x]=(0,i.useState)({impactOccurred:!1,showMeteor:!1,impactStartTime:null});(0,i.useEffect)(()=>{let e=setTimeout(()=>{x(e=>({...e,showMeteor:!0}))},1090);return()=>clearTimeout(e)},[]),(0,f.F)((e,t)=>{if(!l.current||!p.showMeteor||p.impactOccurred){p.impactOccurred&&!p.impactStartTime&&x(e=>({...e,impactStartTime:Date.now()}));return}let r=l.current.position;(2.99>r.distanceTo(u)||r.y<=.1)&&(x(e=>({...e,impactOccurred:!0,impactStartTime:Date.now()})),rT.set(a.x,0,a.z),r_.set(u.x,0,u.z),2.99>=rT.distanceTo(r_)&&s(76)),r.addScaledVector(d,27.75*t)});let g=(0,i.useCallback)(()=>{let e=1+.2*Math.sin(.005*Date.now());return[e,e,1]},[]);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("group",{position:[u.x,.1,u.z],children:[(0,n.jsxs)("mesh",{rotation:[-Math.PI/2,0,0],children:[(0,n.jsx)("primitive",{object:rE}),(0,n.jsx)("meshBasicMaterial",{color:"#ff2200",transparent:!0,opacity:.4,side:m.$EB})]}),(0,n.jsxs)("mesh",{rotation:[-Math.PI/2,0,0],scale:g(),children:[(0,n.jsx)("primitive",{object:rC}),(0,n.jsx)("meshBasicMaterial",{color:"#ff4400",transparent:!0,opacity:.4+.2*Math.sin(.003*Date.now()),side:m.$EB})]}),(0,n.jsxs)("mesh",{rotation:[-Math.PI/2,.0035*Date.now(),0],children:[(0,n.jsx)("primitive",{object:rR}),(0,n.jsx)("meshBasicMaterial",{color:"#ff3300",transparent:!0,opacity:.25,side:m.$EB})]}),[...Array(12)].map((e,t)=>(0,n.jsxs)("mesh",{position:[2.49*Math.sin(.001*Date.now()+t),.5*Math.sin(.002*Date.now()+t),2.49*Math.cos(.001*Date.now()+t)],children:[(0,n.jsx)("primitive",{object:rk}),(0,n.jsx)("meshBasicMaterial",{color:"#ff3300",transparent:!0,opacity:.3+.2*Math.sin(.004*Date.now()+t)})]},t))]}),p.showMeteor&&(0,n.jsx)("group",{ref:l,position:h,children:(0,n.jsxs)("mesh",{ref:c,children:[(0,n.jsx)("primitive",{object:rb}),(0,n.jsx)("primitive",{object:rF}),(0,n.jsx)("pointLight",{color:"#ff4400",intensity:5,distance:8}),(0,n.jsx)(rI,{meshRef:c,color:new m.Q1f("#ff4400"),size:.09})]})}),p.impactStartTime&&rD((null===(t=l.current)||void 0===t?void 0:t.position)||u,p.impactStartTime,o)]})}function rA(e){let{position:t,duration:r,range:s}=e,o=(0,i.useRef)(null),a=(0,i.useRef)(Date.now());return(0,f.F)(()=>{if(!o.current)return;let e=(Date.now()-a.current)/1e3,t=Math.min(e/r,1),n=1+.15*Math.sin(8*e);o.current.scale.setScalar(n),t>.7&&(o.current.material.opacity=.6*(1-(t-.7)/.3))}),(0,n.jsxs)("group",{position:[t.x,.5,t.z],children:[(0,n.jsxs)("mesh",{ref:o,rotation:[-Math.PI/2,0,0],children:[(0,n.jsx)("ringGeometry",{args:[s-.2,s,64]}),(0,n.jsx)("meshBasicMaterial",{color:"#ff3300",transparent:!0,opacity:.6,side:m.$EB})]}),(0,n.jsxs)("mesh",{rotation:[-Math.PI/2,0,0],children:[(0,n.jsx)("ringGeometry",{args:[s-.8,s-.6,64]}),(0,n.jsx)("meshBasicMaterial",{color:"#ff4400",transparent:!0,opacity:.2,side:m.$EB})]})]})}function rB(e){let{id:t,initialPosition:r,position:s,health:o,maxHealth:a,onTakeDamage:l,onPositionUpdate:c,playerPosition:u,onAttackPlayer:h,onEnrageSpawn:d}=e,p=(0,i.useRef)(null),x=(0,i.useRef)(Date.now()+2e3),g=(0,i.useRef)(Date.now()),y=(0,i.useRef)(r.clone()),j=(0,i.useRef)(u.clone()),M=(0,i.useRef)(o),[v,w]=(0,i.useState)(!1),[P,S]=(0,i.useState)(!1),[I,F]=(0,i.useState)(!0),[E,C]=(0,i.useState)(!1),[R,k]=(0,i.useState)(!1),[T,_]=(0,i.useState)(!1),D=(0,i.useRef)(3550),G=(0,i.useRef)(7e3),A=(0,i.useRef)(new m.Pq0),B=(0,i.useRef)(Date.now());(0,i.useEffect)(()=>{j.current.copy(u)},[u]),(0,i.useEffect)(()=>{s&&(y.current.copy(s),p.current&&p.current.position.copy(y.current))},[s]),(0,i.useEffect)(()=>{M.current=o},[o]),(0,i.useEffect)(()=>{let e=o<=a/2,t=3550===D.current;e&&t&&(null==d||d()),D.current=e?2125:3550,G.current=e?4500:7e3},[o,a,d]),(0,i.useEffect)(()=>{let e=setTimeout(()=>{F(!1)},2e3);return()=>clearTimeout(e)},[]),(0,i.useEffect)(()=>{0!==o||P||S(!0)},[o,t,P]);let z=(0,i.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=y.current;return!(new m.Pq0(r.x-e.x,0,r.z-e.z).length()>4)&&4>=Math.abs(e.y+t-(r.y+2))},[]),q=(0,i.useCallback)((e,r)=>{!(M.current<=0)&&r&&z(r)&&(l("enemy-".concat(t),e),0===Math.max(0,M.current-e)&&M.current>0&&S(!0))},[t,l,z]),L=(0,i.useCallback)(()=>{v||T||Date.now()-x.current<D.current||(k(!0),x.current=Date.now(),_(!0),setTimeout(()=>{k(!1),w(!0),setTimeout(()=>{let e=y.current.clone();e.y=0;let t=j.current.clone();t.y=0,5>=e.distanceTo(t)&&h(32)},270),setTimeout(()=>{w(!1),setTimeout(()=>{_(!1)},D.current)},540)},1500))},[v,T,h,32,5]),O=(0,i.useCallback)(()=>{!E&&Date.now()-g.current>=G.current&&(C(!0),g.current=Date.now(),setTimeout(()=>{C(!1)},3500))},[E]);return(0,f.F)((e,r)=>{if(!p.current||o<=0)return;let n=y.current.distanceTo(j.current);if(!E&&Date.now()-g.current>=G.current&&O(),n>4.625&&o>0){w(!1);let e=new m.Pq0().subVectors(j.current,y.current).normalize().multiplyScalar(2.34*r);A.current.lerp(e,4*r),y.current.add(A.current),y.current.y=0,p.current.position.copy(y.current);let n=j.current.clone().setY(y.current.y),i=new m.Pq0().subVectors(n,y.current).normalize(),o=Math.atan2(i.x,i.z)-p.current.rotation.y;for(;o>Math.PI;)o-=2*Math.PI;for(;o<-Math.PI;)o+=2*Math.PI;p.current.rotation.y+=o*Math.min(1,6*r);let a=Date.now();a-B.current>=50&&y.current.distanceTo(s)>.1&&(c(t,y.current.clone()),B.current=a)}else A.current.multiplyScalar(1-6*r),A.current.length()>.001&&(y.current.add(A.current),p.current.position.copy(y.current));Date.now()-x.current>=D.current&&(L(),x.current=Date.now())}),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("group",{ref:p,visible:!I&&o>0,position:y.current,scale:[1.595,1.595,1.595],onClick:e=>e.stopPropagation(),children:[(0,n.jsx)(rP,{isAttacking:v,isWalking:!v&&o>0,onHit:q,playerPosition:u}),(0,n.jsx)(eK.Q,{position:[0,4,0],follow:!0,lockX:!1,lockY:!1,lockZ:!1,children:M.current>0&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("mesh",{position:[0,0,0],children:[(0,n.jsx)("planeGeometry",{args:[4,.4]}),(0,n.jsx)("meshBasicMaterial",{color:"#333333",opacity:.8,transparent:!0})]}),(0,n.jsxs)("mesh",{position:[-2+M.current/a*2,0,.001],children:[(0,n.jsx)("planeGeometry",{args:[M.current/a*4,.35]}),(0,n.jsx)("meshBasicMaterial",{color:"#ff0000",opacity:.9,transparent:!0})]}),(0,n.jsx)(b.E,{position:[0,0,.002],fontSize:.3,color:"#ffffff",anchorX:"center",anchorY:"middle",fontWeight:"bold",children:"".concat(Math.ceil(M.current),"/").concat(a)})]})})]}),E&&(0,n.jsx)(rG,{targetPosition:j.current,onImpact:e=>h(e),onComplete:()=>C(!1),playerPosition:j.current}),R&&(0,n.jsx)(rA,{position:y.current,duration:1,range:5})]})}let rz=new m.Pq0(0,0,0),rq={initialSize:20,expandSize:5,maxSize:30};function rL(e){let{unitProps:t,skeletonProps:r,killCount:s,onLevelComplete:o,spawnInterval:a=5500,maxSkeletons:l=23,initialSkeletons:c=5}=e,u=(0,i.useMemo)(()=>tg(),[]),h=(0,i.useMemo)(()=>ty(),[]),d=(0,i.useMemo)(()=>tj(),[]),[f,x]=(0,i.useState)(!1),[g,y]=(0,i.useState)(c||5),[j,M]=(0,i.useState)(c),[v]=(0,i.useState)(()=>new rc(()=>{let e=new m.YJl;return e.visible=!1,e},rq.initialSize,rq.expandSize,rq.maxSize)),[w,P]=(0,i.useState)(()=>r&&0!==r.length?r.map((e,t)=>{let r=v.acquire();return r.visible=!0,{id:"skeleton-".concat(t),position:e.initialPosition.clone(),initialPosition:e.initialPosition.clone(),currentPosition:e.initialPosition.clone(),health:361,maxHealth:361,ref:{current:r},rotation:0}}):Array.from({length:c},(e,t)=>{let r=tM(),n=v.acquire();return n.visible=!0,{id:"skeleton-".concat(t),position:r.clone(),initialPosition:r.clone(),currentPosition:r.clone(),health:361,maxHealth:361,ref:{current:n},rotation:0}})),[S,I]=(0,i.useState)(t.health),b=(0,i.useRef)(null),[F,E]=(0,i.useState)(new m.Pq0(0,0,0)),[C,R]=(0,i.useState)(!1),[k,T]=(0,i.useState)(6084),[_,D]=(0,i.useState)(rz.clone()),[G,A]=(0,i.useState)(0),B=(0,i.useCallback)(e=>{var t;(null===(t=e.ref)||void 0===t?void 0:t.current)&&(e.ref.current.visible=!1,v.release(e.ref.current))},[v]),z=(0,i.useCallback)((e,r)=>{if(e.includes("boss")){let e=Math.max(0,k-r);T(e),e<=0&&k>0&&x(!1);return}P(n=>{let i=[...n],s=i.findIndex(t=>t.id===e.replace("enemy-",""));if(-1!==s){let e=Math.max(0,i[s].health-r);if(0===e&&i[s].health>0){var o;i[s]={...i[s],health:e,isDying:!0,deathStartTime:Date.now()},M(e=>Math.max(0,e-1)),null===(o=t.onEnemyDeath)||void 0===o||o.call(t)}else i[s]={...i[s],health:e}}return i})},[k,t,x]),q=(0,i.useCallback)(e=>{var r;null===(r=t.onDamage)||void 0===r||r.call(t,e)},[t]),L=(0,i.useCallback)(e=>{E(e)},[]),O=(0,i.useCallback)((e,t)=>{if(e.includes("boss")){D(t.clone());return}P(r=>r.map(r=>r.id===e.replace("enemy-","")?{...r,position:t.clone()}:r))},[]),W={onHit:z,controlsRef:t.controlsRef,currentWeapon:t.currentWeapon,onWeaponSelect:t.onWeaponSelect,health:S,maxHealth:t.maxHealth,isPlayer:t.isPlayer,abilities:t.abilities,onAbilityUse:t.onAbilityUse,onPositionUpdate:L,onHealthChange:e=>{if("function"==typeof e)I(r=>{var n;let i=e(r);return null===(n=t.onHealthChange)||void 0===n||n.call(t,i),i});else{var r;I(e),null===(r=t.onHealthChange)||void 0===r||r.call(t,e)}},enemyData:[...w.map(e=>({id:"enemy-".concat(e.id),position:e.position,initialPosition:e.initialPosition,rotation:e.rotation,health:e.health,maxHealth:e.maxHealth})),...C&&k>0?[{id:"enemy-boss-1",position:_,initialPosition:rz,rotation:0,health:k,maxHealth:6084}]:[]],onDamage:t.onDamage,onEnemyDeath:()=>{},onFireballDamage:t.onFireballDamage,fireballManagerRef:t.fireballManagerRef,onSmiteDamage:t.onSmiteDamage};(0,i.useEffect)(()=>{let e=w.every(e=>e.health<=0),r=f&&g>c;e&&r&&s>=40&&!C&&(console.log("BOSS SPAWN CONDITION MET - Preparing to spawn boss"),(async()=>{var e,r,n,i;x(!1),P(e=>(e.forEach(e=>{var t;(null===(t=e.ref)||void 0===t?void 0:t.current)&&(e.ref.current.traverse(e=>{e instanceof m.eaF&&(e.geometry&&e.geometry.dispose(),Array.isArray(e.material)?e.material.forEach(e=>{e.map&&e.map.dispose(),e.normalMap&&e.normalMap.dispose(),e.specularMap&&e.specularMap.dispose(),e.envMap&&e.envMap.dispose(),e.dispose()}):e.material&&(e.material.map&&e.material.map.dispose(),e.material.normalMap&&e.material.normalMap.dispose(),e.material.specularMap&&e.material.specularMap.dispose(),e.material.envMap&&e.material.envMap.dispose(),e.material.dispose()))}),e.ref.current.parent&&e.ref.current.parent.remove(e.ref.current),e.ref.current.visible=!1,v.release(e.ref.current))}),[])),v.clear(),m.l2R.clear(),b.current&&b.current.updateMatrixWorld(),window.gc&&window.gc(),await new Promise(e=>setTimeout(e,250));let s=null===(r=t.controlsRef.current)||void 0===r?void 0:null===(e=r.domElement)||void 0===e?void 0:e.parentElement;(null==s?void 0:null===(i=s.__r3f)||void 0===i?void 0:null===(n=i.fiber)||void 0===n?void 0:n.renderer)&&s.__r3f.fiber.renderer.renderLists.dispose(),await new Promise(e=>setTimeout(e,250)),setTimeout(()=>{console.log("SPAWNING BOSS NOW"),R(!0)},1e3)})()),C&&k<=0&&(x(!1),o())},[t.controlsRef,w,s,o,f,g,c,C,k,v]),(0,i.useEffect)(()=>{let e=setTimeout(()=>{x(!0)},1e3);return()=>clearTimeout(e)},[]),(0,i.useEffect)(()=>{0===w.length&&g<c&&P(()=>{let e=Array.from({length:c},(e,t)=>{let r=tM(),n=v.acquire();return n.visible=!0,{id:"skeleton-".concat(g+t),position:r.clone(),initialPosition:r.clone(),currentPosition:r.clone(),health:361,maxHealth:361,ref:{current:n},rotation:0}});return y(c),M(c),e})},[w.length,g,c,v]),(0,i.useEffect)(()=>{if(!f||g>=l||C||k<=0||s>=40)return;let e=setInterval(()=>{j>=6||P(e=>{if(C||k<=0||s>=40||l-g<=0||j>=6)return e;if((s>=36&&0===G||s>=38&&1===G)&&G<2){let t=tM();y(e=>e+1),A(e=>e+1),M(e=>e+1);let r=v.acquire();return r.visible=!0,[...e,{id:"abomination-".concat(g),position:t.clone(),initialPosition:t.clone(),rotation:0,health:961,maxHealth:961,isDying:!1,type:"abomination",ref:{current:r}}]}let t=tM(),r=(g+1)%4==0,n=v.acquire();n.visible=!0;let i=r?{id:"mage-".concat(g),position:t.clone(),initialPosition:t.clone(),rotation:0,health:361,maxHealth:361,isDying:!1,type:"mage",ref:{current:n}}:{id:"skeleton-".concat(g),position:t.clone(),initialPosition:t.clone(),rotation:0,health:361,maxHealth:361,isDying:!1,type:"regular",ref:{current:n}};return y(e=>e+1),M(e=>e+1),[...e,i]})},2500);return()=>clearInterval(e)},[g,l,a,G,s,v,j,f,C,k]),(0,i.useEffect)(()=>{t.controlsRef.current&&(t.controlsRef.current.object.position.set(0,12,-18),t.controlsRef.current.target.set(0,0,0),t.controlsRef.current.update())},[t.controlsRef]),(0,i.useEffect)(()=>{P(e=>{let t=Date.now();return e.filter(e=>e.isDying&&e.deathStartTime?!(t-e.deathStartTime>=1500)||(B(e),!1):e.health>0)})},[w,B]);let H=(0,i.useCallback)(()=>{P(e=>(e.forEach(e=>{var t,r;B(e),null===(r=e.ref)||void 0===r||null===(t=r.current)||void 0===t||t.traverse(e=>{if("geometry"in e&&e.geometry instanceof m.LoY&&e.geometry.dispose(),"material"in e){let t=e.material;Array.isArray(t)?t.forEach(e=>e.dispose()):null==t||t.dispose()}})}),[])),v.clear()},[v,B]);return(0,i.useEffect)(()=>{let e=b.current;return()=>{P([]),e&&e.clear(),E(new m.Pq0(0,0,0)),y(c),D(rz.clone()),R(!1),T(6084)}},[c]),(0,i.useEffect)(()=>{let e=[],t=[];return()=>{e.forEach(e=>e.dispose()),t.forEach(e=>e.dispose())}},[]),(0,i.useEffect)(()=>H,[H]),(0,i.useEffect)(()=>(th(),tc.mountain=new m.qFE(23,35,12),tc.mushroom=new m.Ho_(.25,.30625,4,8),tc.tree=new m.Ho_(.25,.30625,4,8),tc.skeleton=new m.LoY,tc.mage=new m.LoY,tc.boss=new m.LoY,tu.mountain=new m.uSd({color:"#2a2a2a",metalness:.1,roughness:1,emissive:"#222222",flatShading:!0,clearcoat:.1,clearcoatRoughness:.8}),tu.mushroom=new m._4j({color:"#FFBD83",roughness:.6,metalness:.2,emissive:"#FFBD83",emissiveIntensity:0}),()=>{td()}),[]),(0,n.jsx)(i.Suspense,{fallback:null,children:(0,n.jsxs)("group",{children:[(0,n.jsx)(tx,{}),(0,n.jsx)(tp,{}),(0,n.jsx)(p,{}),(0,n.jsx)(tS,{}),(0,n.jsx)(tI,{}),(0,n.jsx)(tw,{mountains:u}),(0,n.jsx)(tv,{trees:h}),(0,n.jsx)(tP,{mushrooms:d}),(0,n.jsx)("group",{ref:b,children:(0,n.jsx)(eZ,{...W})}),w.map(e=>"abomination"===e.type?(0,n.jsx)(rl,{id:e.id,initialPosition:e.initialPosition,position:e.position,health:e.health,maxHealth:e.maxHealth,onTakeDamage:z,onPositionUpdate:O,playerPosition:F,onAttackPlayer:q,weaponType:t.currentWeapon},e.id):"mage"===e.type?(0,n.jsx)(t0,{id:e.id,initialPosition:e.initialPosition,position:e.position,health:e.health,maxHealth:e.maxHealth,onTakeDamage:z,onPositionUpdate:O,playerPosition:F,onAttackPlayer:q,weaponType:t.currentWeapon},e.id):(0,n.jsx)(tm,{id:e.id,initialPosition:e.initialPosition,position:e.position,health:e.health,maxHealth:e.maxHealth,onTakeDamage:z,onPositionUpdate:O,playerPosition:F,onAttackPlayer:q,weaponType:t.currentWeapon},e.id)),C&&(0,n.jsx)(rB,{id:"boss-1",initialPosition:rz,position:rz,health:k,maxHealth:6084,onTakeDamage:(e,t)=>{console.log("Boss taking damage: ".concat(t,", current health: ").concat(k)),T(e=>Math.max(0,e-t))},onPositionUpdate:O,playerPosition:F,onAttackPlayer:q,onEnrageSpawn:()=>{if(j>=6)return;let e=tM();M(e=>e+1),P(t=>[...t,{id:"abomination-enraged-".concat(Date.now()),position:e.clone(),initialPosition:e.clone(),rotation:0,health:1024,maxHealth:1024,isDying:!1,type:"abomination",ref:{current:v.acquire()}}])}},"boss-1")]})})}function rO(e){let{sceneProps:t,onLevelTransition:r,currentLevel:s,onAbilityUnlock:o}=e,[a,l]=(0,i.useState)(!1),[c,u]=(0,i.useState)(!1),[h,d]=(0,i.useState)(!1),p=(0,i.useCallback)(()=>new Promise(e=>{let t=e=>{if("geometry"in e&&e.geometry instanceof m.LoY&&e.geometry.dispose(),"material"in e){let t=e.material;Array.isArray(t)?t.forEach(e=>e.dispose()):null==t||t.dispose()}"texture"in e&&e.texture instanceof m.gPd&&e.texture.dispose(),e.children.forEach(e=>t(e))};document.querySelectorAll("canvas").forEach(e=>{var r;let n=null===(r=e.__r3f)||void 0===r?void 0:r.scene;n&&n.traverse(t)}),window.gc&&window.gc(),e()}),[]),f=(0,i.useCallback)(()=>{if(h)return;let e=t.killCount||0;e>=13&&1===s?(r(1,!0),d(!0)):e>=30&&2===s?(r(2,!0),d(!0)):3===s&&e>=50&&(r(3,!1),d(!0))},[s,r,t.killCount,h]);return(0,i.useEffect)(()=>{f()},[t.killCount,f]),(0,i.useEffect)(()=>{(async()=>{await p(),await new Promise(e=>setTimeout(e,1100)),2===s?(l(!0),u(!1)):3===s?(l(!1),u(!0)):(l(!1),u(!1)),d(!1)})()},[s,p]),(0,i.useEffect)(()=>()=>{p()},[p]),(0,n.jsxs)(n.Fragment,{children:[!a&&!c&&(0,n.jsx)(tF,{...t,onLevelComplete:f,onAbilityUnlock:o,spawnInterval:1e3,maxSkeletons:13,initialSkeletons:4}),a&&!c&&(0,n.jsx)(rh,{...t,onLevelComplete:f,onAbilityUnlock:o,spawnInterval:1e3,maxSkeletons:17,initialSkeletons:5,spawnCount:3}),c&&(0,n.jsx)(rL,{...t,onLevelComplete:f,onAbilityUnlock:o,spawnInterval:4500,maxSkeletons:20,initialSkeletons:5,spawnCount:4})]})}var rW=r(5019),rH=r.n(rW),rN=r(9965),rU=r.n(rN),rQ=r(5831),rY=r.n(rQ);function rZ(e){let{damage:t,index:r,onComplete:s,timestamp:o}=e,[a,l]=(0,i.useState)(!0);(0,i.useEffect)(()=>{let e=setTimeout(()=>{l(!1),setTimeout(s,300)},1e3),t=setTimeout(()=>{s()},2e3);return()=>{clearTimeout(e),clearTimeout(t)}},[s]);let c=Math.max(0,1-(Date.now()-o)/1e3);return(0,n.jsxs)("div",{className:"".concat(rY().notification," ").concat(a?rY().visible:rY().hidden),style:{transform:"translateY(".concat(-20-25*r,"px)"),opacity:c},children:["-",t]})}var rK=r(5190),rV=r.n(rK);function r$(e){let{content:t,visible:r,x:i,y:s}=e;return r?(0,n.jsxs)("div",{className:rV().tooltip,style:{left:"".concat(i,"px"),top:"".concat(s,"px")},children:[(0,n.jsx)("h3",{children:t.title}),t.description.split("\n").map((e,t)=>(0,n.jsx)("p",{children:e},t))]}):null}let rX=e=>{let{size:t,strokeWidth:r,percentage:i,borderRadius:s,isActive:o}=e,a=r/2,l=t-r,c=4*l;return(0,n.jsx)("svg",{width:t,height:t,className:rH().roundedSquareProgress,children:(0,n.jsx)("rect",{x:a,y:a,width:l,height:l,rx:s,ry:s,stroke:o?"#ff3333":"#39ff14",strokeWidth:r,fill:"none",strokeDasharray:c,strokeDashoffset:c-c*i/100,className:rH().progressForeground})})};function rJ(e){let{currentWeapon:t,playerHealth:r,maxHealth:o,abilities:a,killCount:l,activeEffects:u}=e,[h,d]=(0,i.useState)([]),m=(0,i.useRef)(0),p=(0,i.useRef)(r),[f,x]=(0,i.useState)(null),[g,y]=(0,i.useState)({x:0,y:0});(0,i.useEffect)(()=>{if(r<p.current){let e=p.current-r;d(t=>[...t,{id:m.current++,damage:e,timestamp:Date.now()}].slice(-3))}p.current=r},[r]);let j=e=>{d(t=>t.filter(t=>t.id!==e))},M=e=>e<13?1:e<30?2:3,v=(e,r)=>{let n=c[t][r],i=e.currentTarget.getBoundingClientRect();x(n),y({x:i.left+i.width/2,y:i.top})},w=()=>{x(null)};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:rH().leftPanel,children:[(0,n.jsxs)("div",{className:rH().controlsSection,children:[(0,n.jsxs)("div",{className:rH().controlGroup,children:[(0,n.jsx)("div",{className:rH().controlKey,children:"W"}),(0,n.jsx)("div",{className:rH().controlKey,children:"A"}),(0,n.jsx)("div",{className:rH().controlKey,children:"S"}),(0,n.jsx)("div",{className:rH().controlKey,children:"D"}),(0,n.jsx)("div",{className:rH().controlLabel,children:"Move"})]}),(0,n.jsx)("div",{className:rH().controlDivider}),(0,n.jsxs)("div",{className:rH().controlGroup,children:[(0,n.jsx)("div",{className:rH().controlLabel,children:"Zoom"}),(0,n.jsx)("div",{className:rH().controlKey,children:"Scroll Wheel"})]})]}),(0,n.jsxs)("div",{className:rH().controlsSection,children:[(0,n.jsxs)("div",{className:rH().controlGroup,children:[(0,n.jsx)("div",{className:rH().controlKey,children:"L-Click Hold"}),(0,n.jsx)("div",{className:rH().controlLabel,children:"Auto Attack"})]}),(0,n.jsx)("div",{className:rH().controlDivider}),(0,n.jsxs)("div",{className:rH().controlGroup,children:[(0,n.jsx)("div",{className:rH().controlLabel,children:"Camera"}),(0,n.jsx)("div",{className:rH().controlKey,children:"R-Click Hold"})]})]})]}),(0,n.jsxs)("div",{className:rH().bottomPanel,children:[a[t]&&(0,n.jsx)("div",{className:rH().abilitiesSection,children:Object.entries(a[t]).map(e=>{let[r,i]=e;return(0,n.jsxs)("div",{className:"".concat(rH().ability," ").concat(i.isUnlocked?"":rH().locked),onMouseEnter:e=>v(e,r),onMouseLeave:w,children:[(0,n.jsx)("div",{className:rH().keyBind,children:i.key.toUpperCase()}),(0,n.jsx)(rU(),{src:i.icon,alt:"".concat(r," ability"),width:40,height:40,className:rH().abilityIcon}),"active"===r&&t===s.SCYTHE&&a[s.SCYTHE].active.isUnlocked&&(null==u?void 0:u.some(e=>"summon"===e.type))?(0,n.jsx)("div",{className:rH().activeOverlay,children:(0,n.jsx)(rX,{size:50,strokeWidth:4,percentage:100,borderRadius:8,isActive:!0})}):"active"===r&&t===s.BOW?null:i.currentCooldown>0&&(0,n.jsxs)("div",{className:rH().cooldownOverlay,children:[(0,n.jsx)(rX,{size:50,strokeWidth:4,percentage:i.currentCooldown/i.cooldown*100,borderRadius:8}),(0,n.jsx)("span",{className:rH().cooldownText,children:Math.ceil(i.currentCooldown)})]})]},r)})}),(0,n.jsxs)("div",{className:rH().healthBarSection,children:[h.map((e,t)=>(0,n.jsx)(rZ,{damage:e.damage,index:t,timestamp:e.timestamp,onComplete:()=>j(e.id)},e.id)),(0,n.jsxs)("div",{className:rH().healthBarContainer,children:[(0,n.jsxs)("div",{className:rH().healthBar,children:[(0,n.jsx)("div",{className:rH().healthBarBackground}),(0,n.jsx)("div",{className:rH().healthBarInner,style:{width:"".concat(r/o*100,"%")}}),(0,n.jsx)("div",{className:rH().healthBarShine}),(0,n.jsx)("div",{className:rH().healthBarPulse})]}),(0,n.jsxs)("span",{className:rH().healthText,children:[(0,n.jsx)("span",{className:rH().healthCurrent,children:r}),(0,n.jsx)("span",{className:rH().healthSeparator,children:"/"}),(0,n.jsx)("span",{className:rH().healthMax,children:o})]})]}),(0,n.jsxs)("div",{className:rH().experienceBarContainer,children:[(0,n.jsx)("div",{className:rH().experienceBarOrnamentLeft,children:(0,n.jsx)("span",{className:rH().levelText,children:M(l)})}),(0,n.jsx)("div",{className:rH().experienceBar,children:(0,n.jsx)("div",{className:rH().xpFill,style:{width:"".concat((e=>{let t=M(e);return 1===t?e/13*100:2===t?(e-13)/17*100:(e-30)/20*100})(l),"%")}})}),(0,n.jsx)("div",{className:rH().experienceBarOrnamentRight,children:(0,n.jsx)("span",{className:rH().killCountText,children:l})})]})]}),(0,n.jsx)(r$,{content:f,visible:!!f,x:g.x,y:g.y})]})]})}var r0=r(6133),r1=r.n(r0);function r2(e){let{onWeaponSelect:t,selectedWeapon:r,onStart:o}=e,[a,l]=(0,i.useState)(null),[u,h]=(0,i.useState)({x:0,y:0}),d=(e,t,r)=>{let n=c[t][r],i=e.currentTarget.getBoundingClientRect(),s=window.innerWidth,o=i.left+i.width/2,a=i.top-10;o-150<20?o=170:o+150>s-20&&(o=s-20-150),a-150<20&&(a=i.bottom+75),l({title:n.title,description:n.description}),h({x:o,y:a})},m=()=>{l(null)};return(0,n.jsxs)("div",{className:"".concat(r1().panel," ").concat(r===s.SWORD?r1().swordTheme:r===s.SCYTHE?r1().scytheTheme:r===s.SABRES?r1().sabresTheme:r===s.SPEAR?r1().spearTheme:r===s.BOW?r1().bowTheme:""),onContextMenu:e=>e.preventDefault(),children:[(0,n.jsx)("h2",{children:"Eidolon"}),(0,n.jsxs)("div",{className:r1().iconSelection,children:[(0,n.jsxs)("div",{className:r1().weaponContainer,children:[(0,n.jsx)("div",{className:"".concat(r1().icon," ").concat(r===s.SWORD?r1().selected:""),onClick:()=>t(s.SWORD),children:(0,n.jsx)("div",{className:r1().iconContent,children:(0,n.jsx)(rU(),{src:"/Eidolon/icons/1.svg",alt:"Sword",width:240,height:280,unoptimized:!0})})}),(0,n.jsxs)("div",{className:r1().abilityIcons,children:[(0,n.jsxs)("div",{className:r1().abilityIcon,onMouseEnter:e=>d(e,s.SWORD,"q"),onMouseLeave:m,children:[(0,n.jsx)(rU(),{src:"/Eidolon/icons/q2.svg",alt:"Q Ability",width:80,height:100,unoptimized:!0}),(0,n.jsx)("span",{className:r1().abilityKey,children:"Q"})]}),(0,n.jsxs)("div",{className:r1().abilityIcon,onMouseEnter:e=>d(e,s.SWORD,"e"),onMouseLeave:m,children:[(0,n.jsx)(rU(),{src:"/Eidolon/icons/e2.svg",alt:"E Ability",width:80,height:100,unoptimized:!0}),(0,n.jsx)("span",{className:r1().abilityKey,children:"E"})]})]})]}),(0,n.jsxs)("div",{className:r1().weaponContainer,children:[(0,n.jsx)("div",{className:"".concat(r1().icon," ").concat(r===s.SCYTHE?r1().selected:""),onClick:()=>t(s.SCYTHE),children:(0,n.jsx)("div",{className:r1().iconContent,children:(0,n.jsx)(rU(),{src:"/Eidolon/icons/3.svg",alt:"Scythe",width:240,height:280,unoptimized:!0})})}),(0,n.jsxs)("div",{className:r1().abilityIcons,children:[(0,n.jsxs)("div",{className:r1().abilityIcon,onMouseEnter:e=>d(e,s.SCYTHE,"q"),onMouseLeave:m,children:[(0,n.jsx)(rU(),{src:"/Eidolon/icons/q1.svg",alt:"Q Ability",width:80,height:100,unoptimized:!0}),(0,n.jsx)("span",{className:r1().abilityKey,children:"Q"})]}),(0,n.jsxs)("div",{className:r1().abilityIcon,onMouseEnter:e=>d(e,s.SCYTHE,"e"),onMouseLeave:m,children:[(0,n.jsx)(rU(),{src:"/Eidolon/icons/e1.svg",alt:"E Ability",width:80,height:100,unoptimized:!0}),(0,n.jsx)("span",{className:r1().abilityKey,children:"E"})]})]})]}),(0,n.jsxs)("div",{className:r1().weaponContainer,children:[(0,n.jsx)("div",{className:"".concat(r1().icon," ").concat(r===s.SABRES?r1().selected:""),onClick:()=>t(s.SABRES),children:(0,n.jsx)("div",{className:r1().iconContent,children:(0,n.jsx)(rU(),{src:"/Eidolon/icons/2.svg",alt:"Sabres",width:240,height:280,unoptimized:!0})})}),(0,n.jsxs)("div",{className:r1().abilityIcons,children:[(0,n.jsxs)("div",{className:r1().abilityIcon,onMouseEnter:e=>d(e,s.SABRES,"q"),onMouseLeave:m,children:[(0,n.jsx)(rU(),{src:"/Eidolon/icons/q3.svg",alt:"Q Ability",width:80,height:100,unoptimized:!0}),(0,n.jsx)("span",{className:r1().abilityKey,children:"Q"})]}),(0,n.jsxs)("div",{className:r1().abilityIcon,onMouseEnter:e=>d(e,s.SABRES,"e"),onMouseLeave:m,children:[(0,n.jsx)(rU(),{src:"/Eidolon/icons/e3.svg",alt:"E Ability",width:80,height:100,unoptimized:!0}),(0,n.jsx)("span",{className:r1().abilityKey,children:"E"})]})]})]}),(0,n.jsxs)("div",{className:r1().weaponContainer,children:[(0,n.jsx)("div",{className:"".concat(r1().icon," ").concat(r===s.SPEAR?r1().selected:""),onClick:()=>t(s.SPEAR),children:(0,n.jsx)("div",{className:r1().iconContent,children:(0,n.jsx)(rU(),{src:"/Eidolon/icons/4.svg",alt:"Spear",width:240,height:280,unoptimized:!0})})}),(0,n.jsxs)("div",{className:r1().abilityIcons,children:[(0,n.jsxs)("div",{className:r1().abilityIcon,onMouseEnter:e=>d(e,s.SPEAR,"q"),onMouseLeave:m,children:[(0,n.jsx)(rU(),{src:"/Eidolon/icons/q4.svg",alt:"Q Ability",width:80,height:100,unoptimized:!0}),(0,n.jsx)("span",{className:r1().abilityKey,children:"Q"})]}),(0,n.jsxs)("div",{className:r1().abilityIcon,onMouseEnter:e=>d(e,s.SPEAR,"e"),onMouseLeave:m,children:[(0,n.jsx)(rU(),{src:"/Eidolon/icons/e4.svg",alt:"E Ability",width:80,height:100,unoptimized:!0}),(0,n.jsx)("span",{className:r1().abilityKey,children:"E"})]})]})]}),(0,n.jsxs)("div",{className:r1().weaponContainer,children:[(0,n.jsx)("div",{className:"".concat(r1().icon," ").concat(r===s.BOW?r1().selected:""),onClick:()=>t(s.BOW),children:(0,n.jsx)("div",{className:r1().iconContent,children:(0,n.jsx)(rU(),{src:"/Eidolon/icons/5.svg",alt:"Bow",width:240,height:280,unoptimized:!0})})}),(0,n.jsxs)("div",{className:r1().abilityIcons,children:[(0,n.jsxs)("div",{className:r1().abilityIcon,onMouseEnter:e=>d(e,s.BOW,"q"),onMouseLeave:m,children:[(0,n.jsx)(rU(),{src:"/Eidolon/icons/q5.svg",alt:"Q Ability",width:80,height:100,unoptimized:!0}),(0,n.jsx)("span",{className:r1().abilityKey,children:"Q"})]}),(0,n.jsxs)("div",{className:r1().abilityIcon,onMouseEnter:e=>d(e,s.BOW,"e"),onMouseLeave:m,children:[(0,n.jsx)(rU(),{src:"/Eidolon/icons/e5.svg",alt:"E Ability",width:80,height:100,unoptimized:!0}),(0,n.jsx)("span",{className:r1().abilityKey,children:"E"})]})]})]})]}),(0,n.jsx)("button",{className:r1().startButton,onClick:o,disabled:!r,children:"Enter"}),a&&(0,n.jsx)(r$,{content:a,visible:!!a,x:u.x,y:u.y})]})}var r5=r(5151),r3=r.n(r5);function r4(e){let{onContinue:t,onSelectIcon:r,selectedIcon:o,currentWeapon:a,onAbilityUnlock:l,abilities:u}=e,[h,d]=(0,i.useState)(null),[m,p]=(0,i.useState)({x:0,y:0}),f=(e,t)=>{let r=c[a][t],n=e.currentTarget.getBoundingClientRect();d(r),p({x:n.left-721,y:n.top-70})},x=()=>{d(null)},g=(e,t)=>{t||r(e)},y=(()=>{switch(a){case s.SCYTHE:return{r:"/Eidolon/icons/r1.svg",p:"/Eidolon/icons/p1.svg",s:"/Eidolon/icons/a1.svg"};case s.SWORD:return{r:"/Eidolon/icons/r2.svg",p:"/Eidolon/icons/p2.svg",s:"/Eidolon/icons/a2.svg"};case s.SABRES:return{r:"/Eidolon/icons/r3.svg",p:"/Eidolon/icons/p3.svg",s:"/Eidolon/icons/a3.svg"};case s.SPEAR:return{r:"/Eidolon/icons/r4.svg",p:"/Eidolon/icons/p4.svg",s:"/Eidolon/icons/a4.svg"};case s.BOW:return{r:"/Eidolon/icons/r5.svg",p:"/Eidolon/icons/p5.svg",s:"/Eidolon/icons/a5.svg"}}})();return(0,n.jsxs)("div",{className:r3().panel,style:{pointerEvents:"auto"},onContextMenu:e=>e.preventDefault(),children:[(0,n.jsx)("h2",{children:"Level Complete!"}),(0,n.jsx)("p",{children:"Choose an ability to unlock:"}),(0,n.jsxs)("div",{className:r3().iconSelection,children:[(0,n.jsx)("div",{className:"".concat(r3().icon," \n            ").concat(1===o?r3().selected:""," \n            ").concat(u[a].r.isUnlocked?r3().disabled:""),onClick:()=>g(1,u[a].r.isUnlocked),onMouseEnter:e=>f(e,"r"),onMouseLeave:x,children:(0,n.jsxs)("div",{className:r3().iconContent,children:[(null==y?void 0:y.r)&&(0,n.jsx)(rU(),{src:y.r,alt:"R Ability",width:75,height:75,priority:!0}),(0,n.jsx)("p",{children:"[R] Hotkey"})]})}),(0,n.jsx)("div",{className:"".concat(r3().icon," \n            ").concat(2===o?r3().selected:""," \n            ").concat(u[a].passive.isUnlocked?r3().disabled:""),onClick:()=>g(2,u[a].passive.isUnlocked),onMouseEnter:e=>f(e,"passive"),onMouseLeave:x,children:(0,n.jsxs)("div",{className:r3().iconContent,children:[(null==y?void 0:y.p)&&(0,n.jsx)(rU(),{src:y.p,alt:"Passive Ability",width:75,height:75,priority:!0}),(0,n.jsx)("p",{children:"[1] Hotkey"})]})}),(a===s.SCYTHE||a===s.SABRES||a===s.SWORD||a===s.SPEAR||a===s.BOW)&&(0,n.jsx)("div",{className:"".concat(r3().icon," \n              ").concat(3===o?r3().selected:""," \n              ").concat(u[a].active.isUnlocked?r3().disabled:""),onClick:()=>g(3,u[a].active.isUnlocked),onMouseEnter:e=>f(e,"active"),onMouseLeave:x,children:(0,n.jsxs)("div",{className:r3().iconContent,children:[(null==y?void 0:y.s)&&(0,n.jsx)(rU(),{src:y.s,alt:"Active Ability",width:75,height:75,priority:!0}),(0,n.jsx)("p",{children:"[2] Hotkey"})]})})]}),(0,n.jsx)("button",{className:r3().continueButton,onClick:()=>{null!==o&&(l(1===o?"r":2===o?"passive":"active"),t())},disabled:null===o,children:"Confirm"}),(0,n.jsx)(r$,{content:h,visible:!!h,x:m.x,y:m.y})]})}var r8=r(2374),r6=r.n(r8);let r7=[{title:"The Darkness Claims Another",subtitle:"Your soul joins the eternal dance..."},{title:"Fallen to Shadow",subtitle:"The necropolis grows stronger..."},{title:"Death's Embrace",subtitle:"The bones welcome their kin..."},{title:"The Last Stand",subtitle:"Your light fades into the abyss..."},{title:"Eternal Rest",subtitle:"The skeleton army claims victory..."},{title:"Denied Ascension",subtitle:"The dragons turn their backs on another unworthy soul..."},{title:"Draconic Disappointment",subtitle:"Your flames were not strong enough to join their ranks..."},{title:"Failed Wyrm",subtitle:"The ancient dragons scoff at your weakness..."},{title:"Wingless One",subtitle:"You'll never know the freedom of dragon flight..."},{title:"Mortal Chains",subtitle:"Forever bound to walk while dragons soar above..."},{title:"Lost Heritage",subtitle:"The dragon blood within you grows cold..."},{title:"Fading Ember",subtitle:"Your draconic spark extinguishes in darkness..."},{title:"Rejected by Fire",subtitle:"The dragon's flame finds you unworthy..."}];function r9(e){let{playerHealth:t,killCount:r}=e,[s,o]=(0,i.useState)(!1),[a,l]=(0,i.useState)(null);return(0,i.useEffect)(()=>{t<=0&&!s&&(l(r7[Math.floor(Math.random()*r7.length)]),o(!0),window.dispatchEvent(new CustomEvent("gameOver")))},[t,s]),(0,n.jsx)(n.Fragment,{children:s&&a&&(0,n.jsxs)("div",{className:r6().gameOverContainer,onClick:e=>e.stopPropagation(),onMouseDown:e=>e.stopPropagation(),children:[(0,n.jsx)("h1",{className:r6().gameOverTitle,children:a.title}),(0,n.jsx)("p",{className:r6().gameOverSubtitle,children:a.subtitle}),(0,n.jsx)("button",{className:r6().retryButton,onClick:()=>{window.location.reload()},children:"RETRY"}),(0,n.jsxs)("div",{className:r6().killCounter,children:["Skeletons Defeated: ",r]})]})})}let ne=(0,i.createContext)({isPaused:!1});function nt(e){let{children:t}=e,[r,s]=(0,i.useState)(!1);return(0,i.useEffect)(()=>{let e=()=>{s(document.hidden)},t=()=>{s(!0)},r=()=>{s(!1)},n=e=>{(e.ctrlKey||e.metaKey)&&"s"===e.key.toLowerCase()&&e.preventDefault(),(e.ctrlKey||e.metaKey)&&"f"===e.key.toLowerCase()&&e.preventDefault(),(e.ctrlKey||e.metaKey)&&"p"===e.key.toLowerCase()&&e.preventDefault(),(e.ctrlKey||e.metaKey)&&"n"===e.key.toLowerCase()&&e.preventDefault(),(e.ctrlKey||e.metaKey)&&"d"===e.key.toLowerCase()&&e.preventDefault()},i=e=>{e.preventDefault()};return document.addEventListener("visibilitychange",e),window.addEventListener("blur",t),window.addEventListener("focus",r),document.addEventListener("keydown",n),document.addEventListener("contextmenu",i),()=>{document.removeEventListener("visibilitychange",e),window.removeEventListener("blur",t),window.removeEventListener("focus",r),document.removeEventListener("keydown",n),document.removeEventListener("contextmenu",i)}},[]),(0,n.jsx)(ne.Provider,{value:{isPaused:r},children:t})}function nr(e){let{sceneProps:t,currentWeapon:r,onWeaponSelect:s,playerHealth:o,maxHealth:a,abilities:l,onReset:c,killCount:u,onAbilityUnlock:p}=e,[f,x]=(0,i.useState)(!1),[g,y]=(0,i.useState)(!1),[j,M]=(0,i.useState)(null),[v,w]=(0,i.useState)(1),P=(0,i.useCallback)((e,t)=>{t?y(!0):w(e=>e+1)},[]),S=(0,i.useCallback)(()=>{y(!1),M(null),w(e=>e+1)},[]),I=(0,i.useCallback)(()=>{x(!1),w(1),y(!1),M(null),c()},[c]);return(0,i.useEffect)(()=>{let e=e=>{"Space"===e.code&&e.preventDefault()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[]),(0,i.useEffect)(()=>()=>{t.unitProps.controlsRef.current&&t.unitProps.controlsRef.current.dispose(),m.l2R.clear()},[t.unitProps.controlsRef]),(0,n.jsx)(nt,{children:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{style:{width:"100vw",height:"100vh",overflow:"hidden",position:"fixed",top:0,left:0,touchAction:"none"},children:(0,n.jsxs)(h.Hl,{frameloop:"demand",performance:{min:.5},dpr:[1,2],children:[(0,n.jsx)("ambientLight",{intensity:.215}),f&&(0,n.jsx)(i.Suspense,{fallback:null,children:(0,n.jsx)(rO,{sceneProps:{...t,onReset:I},onAbilityUnlock:p,onLevelTransition:P,currentLevel:v})}),(0,n.jsx)(d.N,{ref:t.unitProps.controlsRef,enablePan:!1,minPolarAngle:Math.PI/6,maxPolarAngle:Math.PI/2.25,maxDistance:11.5,mouseButtons:{LEFT:void 0,MIDDLE:void 0,RIGHT:m.kBv.ROTATE},minDistance:11.5,rotateSpeed:.8,enableDamping:!0,dampingFactor:.075,zoomSpeed:1.25,position:[0,15,20],target:[0,0,0]})]})}),(0,n.jsx)(r9,{playerHealth:o,onReset:I,killCount:u,onEnemiesDefeated:()=>{},maxSkeletons:12}),(0,n.jsx)("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:!f||g?"auto":"none",zIndex:1e3},children:f?g?(0,n.jsx)(r4,{onContinue:S,onSelectIcon:M,selectedIcon:j,currentWeapon:r,onAbilityUnlock:p,abilities:l}):(0,n.jsx)(rJ,{currentWeapon:r,onWeaponSelect:()=>{},playerHealth:o,maxHealth:a,abilities:l,onReset:c,killCount:u}):(0,n.jsx)(r2,{onWeaponSelect:s,selectedWeapon:r,onStart:()=>{r&&x(!0)}})})]})})}function nn(){let[e,t]=(0,i.useState)(null),r=(0,i.useRef)(null),[o,c]=(0,i.useState)(200),[u,h]=(0,i.useState)(200),[d,m]=(0,i.useState)(()=>a),p=t=>{m(r=>{let n={...r};return e&&(n[e][t]={...n[e][t],isUnlocked:!0}),n})},f=e=>{t(e)};(0,i.useEffect)(()=>{let e=setInterval(()=>{m(e=>{let t={...e};return Object.keys(t).forEach(e=>{["q","e","r","passive","active"].forEach(r=>{t[e][r].currentCooldown>0&&(t[e][r].currentCooldown-=.15)})}),t})},150);return()=>clearInterval(e)},[]);let[x,g]=(0,i.useState)(0),y=(0,i.useCallback)(()=>{g(e=>{let t=e+1;return h(200+t),c(e=>e+1),t})},[]),j=()=>{h(200),c(200),m(e=>{let t={...e};return Object.keys(t).forEach(e=>{["q","e"].forEach(r=>{t[e][r].currentCooldown=0})}),t}),g(0),t(null)},M=(0,i.useCallback)(e=>{c(t=>Math.min(u,t+e))},[u]),v={bossActive:!1,onAbilityUnlock:p,onReset:j,unitProps:{controlsRef:r,currentWeapon:e||s.SCYTHE,onWeaponSelect:f,health:o,maxHealth:u,abilities:d,onAbilityUse:(e,t)=>{m(r=>{let n={...r};return n[e][t].currentCooldown=l(e,t,r),n})},onDamage:e=>{c(t=>Math.max(0,t-e))},onEnemyDeath:y,onHealthChange:M,onHit:()=>{},onPositionUpdate:()=>{},enemyData:[],onFireballDamage:()=>{},onSmiteDamage:()=>{},isPlayer:!0},killCount:x,onWeaponSelect:f,skeletonProps:[],onFireballDamage:()=>{}};return(0,i.useEffect)(()=>{let e=e=>{"Space"===e.code&&e.preventDefault()};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[]),(0,n.jsx)("div",{style:{width:"100vw",height:"100vh",overflow:"hidden",position:"fixed",top:0,left:0},children:(0,n.jsx)(nr,{sceneProps:v,currentWeapon:e,onWeaponSelect:f,playerHealth:o,maxHealth:u,abilities:d,onReset:j,killCount:x,onAbilityUnlock:p})})}},5831:e=>{e.exports={notification:"DamageNotification_notification__f3Yeu",floatUp:"DamageNotification_floatUp__Myim4",visible:"DamageNotification_visible__jYt6g",hidden:"DamageNotification_hidden__l4PWe"}},5151:e=>{e.exports={panel:"LevelCompletionPanel_panel__dcef3",iconSelection:"LevelCompletionPanel_iconSelection__jS9NE",icon:"LevelCompletionPanel_icon__lRABe",selected:"LevelCompletionPanel_selected__PqyOR",continueButton:"LevelCompletionPanel_continueButton__xlmot",iconContent:"LevelCompletionPanel_iconContent__DqvWS",disabled:"LevelCompletionPanel_disabled__npgST"}},5019:e=>{e.exports={bottomPanel:"Panel_bottomPanel__E_GFV",weaponSection:"Panel_weaponSection__zIJl0",weaponIcon:"Panel_weaponIcon__iLPYg",levelBadge:"Panel_levelBadge__XHoiD",badgePulse:"Panel_badgePulse__tCaHu",statsSection:"Panel_statsSection__cewg2",healthBarContainer:"Panel_healthBarContainer___xHn5",healthBarInner:"Panel_healthBarInner__B2SSK",experienceBar:"Panel_experienceBar__G5pO5",abilitiesSection:"Panel_abilitiesSection__LVE1_",ability:"Panel_ability__vWpFg",healthBarSection:"Panel_healthBarSection__Lc4_u",healthBarDecoration:"Panel_healthBarDecoration__ok97A",healthBarOrnamentLeft:"Panel_healthBarOrnamentLeft__l_eLO",healthBarOrnamentRight:"Panel_healthBarOrnamentRight__DlmuW",healthBar:"Panel_healthBar__Md85Z",healthBarBackground:"Panel_healthBarBackground__jdRKY",healthBarShine:"Panel_healthBarShine__88Hkf",shine:"Panel_shine__uI8op",healthBarPulse:"Panel_healthBarPulse__CZkcb",pulse:"Panel_pulse__tyA5r",healthText:"Panel_healthText__1fCQl",healthCurrent:"Panel_healthCurrent__7n6qI",healthSeparator:"Panel_healthSeparator__aVnh_",healthMax:"Panel_healthMax__tYk8m",abilityContainer:"Panel_abilityContainer__sN6a4",abilityIcon:"Panel_abilityIcon__3DloH",weaponIcons:"Panel_weaponIcons__FW360",weaponSlot:"Panel_weaponSlot__dVwz7",keyBind:"Panel_keyBind__D5m1t",activeWeapon:"Panel_activeWeapon__uZq6r",cooldownOverlay:"Panel_cooldownOverlay__GJ3zY",cooldownText:"Panel_cooldownText__kVTtb",roundedSquareProgress:"Panel_roundedSquareProgress__1eZW_",progressForeground:"Panel_progressForeground__Acr3c",gameOverOverlay:"Panel_gameOverOverlay__Bud_o",gameOverTitle:"Panel_gameOverTitle__zo4Jg",gameOverSubtitle:"Panel_gameOverSubtitle__qVO8v",retryButton:"Panel_retryButton__GOTn9",killCounter:"Panel_killCounter__iC_Sg",killCountText:"Panel_killCountText__hQyjQ",xpFill:"Panel_xpFill__RXvNL",levelText:"Panel_levelText__SgUXR",experienceBarContainer:"Panel_experienceBarContainer__9mese",experienceBarOrnamentLeft:"Panel_experienceBarOrnamentLeft__JvEOr",experienceBarOrnamentRight:"Panel_experienceBarOrnamentRight__can19",locked:"Panel_locked__Anu5g",tooltip:"Panel_tooltip__tY4zh",abilityTooltip:"Panel_abilityTooltip__QPsMI",controlsSection:"Panel_controlsSection__V2l2S",controlGroup:"Panel_controlGroup__ZKwO3",controlKey:"Panel_controlKey__NC_tm",controlLabel:"Panel_controlLabel__7c5bl",controlDivider:"Panel_controlDivider__R4TV2",leftPanel:"Panel_leftPanel___5GQG",activeOverlay:"Panel_activeOverlay__wG7FY",activeIndicator:"Panel_activeIndicator__qrpa9",weaponPulse:"Panel_weaponPulse__fP758",glowPulse:"Panel_glowPulse__Ye37n"}},5190:e=>{e.exports={tooltip:"Tooltip_tooltip__7tEfC",fadeIn:"Tooltip_fadeIn___CG3h"}},6133:e=>{e.exports={panel:"WeaponSelectionPanel_panel__XVTME",iconContent:"WeaponSelectionPanel_iconContent__0raLR",icon:"WeaponSelectionPanel_icon__s7G0N",startButton:"WeaponSelectionPanel_startButton__zI16Y",abilityIcon:"WeaponSelectionPanel_abilityIcon__QOQYl",swordTheme:"WeaponSelectionPanel_swordTheme__97rWq",scytheTheme:"WeaponSelectionPanel_scytheTheme__KVzH7",sabresTheme:"WeaponSelectionPanel_sabresTheme__cQZSC",spearTheme:"WeaponSelectionPanel_spearTheme__t3ex6",bowTheme:"WeaponSelectionPanel_bowTheme__1rwks",iconSelection:"WeaponSelectionPanel_iconSelection__b3lef",selected:"WeaponSelectionPanel_selected__yqwcS",spinHex:"WeaponSelectionPanel_spinHex__23BFC",pulseGlow:"WeaponSelectionPanel_pulseGlow__6GI0P",weaponContainer:"WeaponSelectionPanel_weaponContainer__EKXnN",abilityIcons:"WeaponSelectionPanel_abilityIcons__T_1Eq",abilityKey:"WeaponSelectionPanel_abilityKey__jRO8H",tooltip:"WeaponSelectionPanel_tooltip__RM0kA",pulseAbility:"WeaponSelectionPanel_pulseAbility__gH5Qg"}},2374:e=>{e.exports={gameOverContainer:"Behavior_gameOverContainer__wiKZW",gameOverTitle:"Behavior_gameOverTitle__B0h2R",gameOverSubtitle:"Behavior_gameOverSubtitle____YXI",retryButton:"Behavior_retryButton__N9g61",killCounter:"Behavior_killCounter__Vm3B2"}}},e=>{var t=t=>e(e.s=t);e.O(0,[624,438,84,111,636,593,792],()=>t(2022)),_N_E=e.O()}]);